import{d as e,j as t,ac as s,ad as a,ae as n,af as r,ag as i,ah as l,ai as o,aj as c,ak as d,al as u,am as m,an as p,ao as x,ap as h,aq as g,ar as b,as as f,at as y,au as v,av as j,aw as N,ax as w,ay as S,az as A,aA as T,aB as C,aC as D,aD as I,aE as P,aF as k,aG as E,aH as L,aI as _,aJ as R,aK as U,aL as z,aM as M,aN as O,aO as K,aP as q,aQ as F,aR as $,aS as B,aT as Y,aU as H,aV as V,aW as W,aX as G,aY as J,aZ as Q,a_ as X,a$ as Z,b0 as ee,b1 as te,b2 as se,b3 as ae,b4 as ne,b5 as re,b6 as ie,b7 as le,b8 as oe,b9 as ce,ba as de,bb as ue,bc as me,bd as pe,be as xe,bf as he,bg as ge,bh as be,bi as fe,bj as ye,bk as ve,bl as je,bm as Ne,bn as we,bo as Se,bp as Ae,bq as Te,br as Ce}from"./vendor-Cts3Jxd3.js";import{M as De}from"./markdown-BxWwOnGl.js";import{R as Ie,B as Pe,C as ke,X as Ee,Y as Le,T as _e,a as Re,b as Ue,L as ze,P as Me,c as Oe,d as Ke,e as qe,A as Fe,f as $e,g as Be}from"./recharts-CD5GEZxq.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Ye=(e=>(e.STOCK="STOCK",e.CRYPTO="CRYPTO",e.FUND="FUND",e.CASH="CASH",e.REAL_ESTATE="REAL_ESTATE",e.LIABILITY="LIABILITY",e.OTHER="OTHER",e))(Ye||{}),He=(e=>(e.USD="USD",e.CNY="CNY",e.HKD="HKD",e))(He||{}),Ve=(e=>(e.BUY="BUY",e.SELL="SELL",e.DIVIDEND="DIVIDEND",e.DEPOSIT="DEPOSIT",e.WITHDRAWAL="WITHDRAWAL",e.BORROW="BORROW",e.REPAY="REPAY",e.BALANCE_ADJUSTMENT="BALANCE_ADJUSTMENT",e))(Ve||{}),We=(e=>(e.API_KEY_MISSING="API_KEY_MISSING",e.API_KEY_INVALID="API_KEY_INVALID",e.RATE_LIMIT="RATE_LIMIT",e.ACCESS_DENIED="ACCESS_DENIED",e.NETWORK_ERROR="NETWORK_ERROR",e.UNKNOWN="UNKNOWN",e))(We||{});const Ge="investflow_metadata",Je="investflow_transactions_v2",Qe="investflow_settings",Xe="investflow_assets",Ze="investflow_transactions";He.USD;const et={getAssetMetas(){try{const e=localStorage.getItem(Ge);return e?JSON.parse(e):[]}catch(e){return[]}},saveAssetMetas(e){try{localStorage.setItem(Ge,JSON.stringify(e))}catch(t){}},getTransactions(){try{const e=localStorage.getItem(Je);return e?JSON.parse(e):[]}catch(e){return[]}},saveTransactions(e){try{localStorage.setItem(Je,JSON.stringify(e))}catch(t){}},getSettings(){try{const e=localStorage.getItem(Qe);return e?JSON.parse(e):null}catch(e){return null}},saveSettings(e){try{localStorage.setItem(Qe,JSON.stringify(e))}catch(t){}},getCache(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return null}},saveCache(e,t){try{const s={timestamp:Date.now(),data:t};localStorage.setItem(e,JSON.stringify(s))}catch(s){}},remove(e){localStorage.removeItem(e)},clearAllData(){localStorage.removeItem(Ge),localStorage.removeItem(Je)},getLegacyData:()=>({assets:localStorage.getItem(Xe),transactions:localStorage.getItem(Ze),v2Metadata:localStorage.getItem(Ge)}),clearLegacyData(){localStorage.removeItem(Xe),localStorage.removeItem(Ze)},clearItemsByPrefix(e){const t=[];for(let s=0;s<localStorage.length;s++){const a=localStorage.key(s);a&&a.startsWith(e)&&t.push(a)}t.forEach(e=>localStorage.removeItem(e))}};class tt{constructor(e,t=1/0,s=0){this.queue=[],this.processing=!1,this.lastRequestTime=0,this.timestamps=[],this.minInterval=e,this.maxRequestsInWindow=t,this.windowSize=s}async add(e){return new Promise((t,s)=>{this.queue.push(async()=>{try{const s=await e();t(s)}catch(a){s(a)}}),this.process()})}async process(){if(!this.processing){for(this.processing=!0;this.queue.length>0;){const e=Date.now();let t=0;const s=e-this.lastRequestTime;if(s<this.minInterval&&(t=Math.max(t,this.minInterval-s)),this.maxRequestsInWindow<1/0&&this.timestamps.length>=this.maxRequestsInWindow&&(this.timestamps=this.timestamps.filter(t=>e-t<this.windowSize),this.timestamps.length>=this.maxRequestsInWindow)){const s=this.timestamps[0],a=this.windowSize-(e-s);t=Math.max(t,a+100)}if(t>0){await new Promise(e=>setTimeout(e,t));continue}const a=this.queue.shift();a&&(this.lastRequestTime=Date.now(),this.timestamps.push(this.lastRequestTime),await a())}this.processing=!1}}}const st="investflow_rates",at="investflow_crypto_prices",nt="investflow_stock_prices",rt="investflow_asset_history",it="investflow_api_failures",lt={BTC:"bitcoin",ETH:"ethereum",USDT:"tether",SOL:"solana",BNB:"binancecoin",XRP:"ripple",ADA:"cardano",DOGE:"dogecoin",DOT:"polkadot",MATIC:"matic-network",LINK:"chainlink"},ot=["ARBITRAGE_NEW_USER","CSI300ETF_C","ZHOUZHOUBAO_FUND"],ct=e=>{const t=e.toUpperCase();return t.endsWith(".SS")||t.endsWith(".SZ")?He.CNY:t.endsWith(".HK")?He.HKD:He.USD},dt=new tt(2e3,5,65e3),ut=new tt(1500),mt=new tt(300),pt=(e,t)=>{const s=et.getCache(it),a=(null==s?void 0:s.data)||{};a[e]={timestamp:Date.now(),reason:t},et.saveCache(it,a)},xt=async e=>{const t=e.filter(e=>e.type===Ye.CRYPTO&&!e.isManualPrice&&!ot.includes(e.symbol));if(0===t.length)return{};const s=et.getCache(at),a=!s||Date.now()-s.timestamp>6e5;if(s&&!a){if(t.every(e=>void 0!==s.data[e.id]))return s.data}const n=t.map(e=>lt[e.symbol.toUpperCase()]||e.name.toLowerCase().replace(/\s+/g,"-")).join(",");if(!n)return(null==s?void 0:s.data)||{};try{const e=await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${n}&vs_currencies=usd`);if(!e.ok)throw new Error("CoinGecko API Error");const a=await e.json(),r={...(null==s?void 0:s.data)||{}};return t.forEach(e=>{const t=lt[e.symbol.toUpperCase()]||e.name.toLowerCase().replace(/\s+/g,"-");a[t]&&a[t].usd&&(r[e.id]=a[t].usd)}),et.saveCache(at,r),r}catch(r){return(null==s?void 0:s.data)||{}}},ht=e=>new Promise(t=>setTimeout(t,e)),gt=async(e,t)=>{const s=e.filter(e=>!(e.type!==Ye.STOCK&&e.type!==Ye.FUND||e.isManualPrice||ot.includes(e.symbol)));if(0===s.length)return{};const a=et.getCache(nt),n={...(null==a?void 0:a.data)||{}},r=Date.now(),i=[],l=[],o=[];for(const u of s){const e=n[u.id],s="alphavantage"===t.provider?27e5:6e5;!e||!e.lastUpdated||r-e.lastUpdated>s?(i.push(u),o.push(`${u.symbol}(${(null==e?void 0:e.lastUpdated)?`stale:${Math.round((r-e.lastUpdated)/1e3/60)}min`:"no-cache"})`)):l.push(`${u.symbol}(age:${Math.round((r-e.lastUpdated)/1e3/60)}min)`)}if(0===i.length)return n;let c=!1;if("finnhub"===t.provider){if(!t.finnhubKey)throw{category:We.API_KEY_MISSING,provider:"finnhub",message:"Finnhub API Key is missing"};const e=i.slice(0,10);for(const s of e)try{let e=s.symbol;s.currency!==He.HKD||e.includes(".")?s.currency!==He.CNY||e.includes(".")||(e=e.startsWith("6")?`${e}.SS`:`${e}.SZ`):e=`${e}.HK`;const a=await fetch(`https://finnhub.io/api/v1/quote?symbol=${e}&token=${t.finnhubKey}`);if(!a.ok){if(429===a.status)throw{category:We.RATE_LIMIT,provider:"finnhub",message:"Finnhub rate limit exceeded"};if(403===a.status||401===a.status)throw{category:We.ACCESS_DENIED,provider:"finnhub",message:"Access denied or invalid API key"};continue}const r=await a.json();if(r.error)throw{category:We.ACCESS_DENIED,provider:"finnhub",message:r.error};r.c&&r.c>0&&(n[s.id]={price:r.c,currency:ct(e),lastUpdated:Date.now()},c=!0),await ht(100)}catch(d){}}else{if(!t.alphaVantageKey)throw{category:We.API_KEY_MISSING,provider:"alphavantage",message:"Alpha Vantage API Key is missing"};const e=i.slice(0,5);for(const s of e)try{let a=s.symbol;s.currency!==He.HKD||a.includes(".")?s.currency!==He.CNY||a.includes(".")||(a=a.startsWith("6")?`${a}.SS`:`${a}.SZ`):a=`${a}.HK`;const r=await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${a}&apikey=${t.alphaVantageKey}`),i=await r.json();if(i.Note||i.Information)throw{category:We.RATE_LIMIT,provider:"alphavantage",message:"Alpha Vantage rate limit exceeded"};i["Global Quote"]&&i["Global Quote"]["05. price"]&&(n[s.id]={price:parseFloat(i["Global Quote"]["05. price"]),currency:ct(i["Global Quote"]["01. symbol"]||a),lastUpdated:Date.now()},c=!0),e.length>1&&await ht(15e3)}catch(d){}}return c&&et.saveCache(nt,n),n},bt=async(e,t,s)=>{const a=s||(()=>{const e=new Date;return e.setFullYear(e.getFullYear()-5),e})(),n=(Date.now()-a.getTime())/864e5;if(e.isManualPrice||ot.includes(e.symbol)){const t=(new Date).toISOString().split("T")[0],s=new Date;return s.setFullYear(s.getFullYear()-1),[{date:s.toISOString().split("T")[0],price:e.currentPrice},{date:t,price:e.currentPrice}]}const r=`${rt}_${e.id}`,i=et.getCache(r),l=!i||Date.now()-i.timestamp>864e5,o=i&&i.data.length>=98&&i.data.length<=102&&n>130;if(i&&i.data.length>0&&!l&&!o)return i.data;if((e=>{const t=et.getCache(it);if(!t||!t.data)return null;const s=t.data[e];return s&&Date.now()-s.timestamp<18e5?s:null})(e.id))return(null==i?void 0:i.data)||[];try{let s=[];if(e.type===Ye.CRYPTO){const t=n>365?"max":"365",a=lt[e.symbol.toUpperCase()]||e.name.toLowerCase().replace(/\s+/g,"-");await ut.add(async()=>{const n=await fetch(`https://api.coingecko.com/api/v3/coins/${a}/market_chart?vs_currency=usd&days=${t}&interval=daily`);if(n.ok){const e=await n.json();e.prices&&(s=e.prices.map(e=>({date:new Date(e[0]).toISOString().split("T")[0],price:e[1]})))}else if(404===n.status&&pt(e.id,"Not Found"),429===n.status)throw{category:We.RATE_LIMIT,provider:"coingecko"}})}else if(e.type===Ye.STOCK||e.type===Ye.FUND){let n=e.symbol;if(e.currency!==He.HKD||n.includes(".")?e.currency!==He.CNY||n.includes(".")||(n=n.startsWith("6")?`${n}.SS`:`${n}.SZ`):n=`${n}.HK`,"finnhub"===t.provider&&t.finnhubKey){const r=Math.floor(a.getTime()/1e3),i=Math.floor(Date.now()/1e3);await mt.add(async()=>{const a=await fetch(`https://finnhub.io/api/v1/stock/candle?symbol=${n}&resolution=D&from=${r}&to=${i}&token=${t.finnhubKey}`);if(a.ok){const t=await a.json();if("ok"===t.s&&t.c&&t.t)s=t.t.map((e,s)=>({date:new Date(1e3*e).toISOString().split("T")[0],price:t.c[s]}));else if("no_data"===t.s);else if(t.error)throw pt(e.id,t.error),{category:We.ACCESS_DENIED,provider:"finnhub",message:t.error}}else{if(429===a.status)throw{category:We.RATE_LIMIT,provider:"finnhub",message:"Finnhub rate limit exceeded (History)"};if(403===a.status||401===a.status)throw pt(e.id,"Access Denied"),{category:We.ACCESS_DENIED,provider:"finnhub",message:"Access denied to historical data"}}})}else if("alphavantage"===t.provider&&t.alphaVantageKey){const a="compact";await dt.add(async()=>{const r=await fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${n}&outputsize=${a}&apikey=${t.alphaVantageKey}`),i=await r.json();if(i.Note||i.Information)throw{category:We.RATE_LIMIT,provider:"alphavantage",message:"Alpha Vantage rate limit exceeded (History)"};if(i["Error Message"])throw pt(e.id,"Invalid Symbol"),{category:We.ACCESS_DENIED,provider:"alphavantage",message:"Invalid API key or symbol not found"};if(i["Time Series (Daily)"]){const e=i["Time Series (Daily)"];s=Object.keys(e).map(t=>({date:t,price:parseFloat(e[t]["4. close"])})).sort((e,t)=>e.date.localeCompare(t.date))}})}}if(s.length>0){const e=a.toISOString().split("T")[0];let t=s.filter(t=>t.date>=e);if(0===t.length&&s.length>0)t=[s[s.length-1]];else if(t.length>0&&t[0].date>e){const e=s.findIndex(e=>e.date===t[0].date);e>0&&t.unshift(s[e-1])}s=t}if(s.length>0)return et.saveCache(r,s),s;{if(null==i?void 0:i.data)return i.data;const t=(new Date).toISOString().split("T")[0],s=new Date;return s.setFullYear(s.getFullYear()-1),[{date:s.toISOString().split("T")[0],price:e.currentPrice},{date:t,price:e.currentPrice}]}}catch(c){if((null==c?void 0:c.category)===We.ACCESS_DENIED||(null==c?void 0:c.category)===We.RATE_LIMIT)throw c;return(null==i?void 0:i.data)||[]}},ft=(e,t,s,a)=>{if(t===s)return e;const n=a[t]||1,r=a[s]||1;return 0===n?e:e/n*r},yt={en:{dashboard:"Dashboard",assets:"Assets",history:"History",analytics:"Analytics",settings:"Settings",disclaimer:"Data provided for demo purposes. Not financial advice.",overview:"Overview",netWorth:"Total Net Worth",totalAssets:"Total Assets",totalLiabilities:"Total Liabilities",dayPnL:"Today's P&L",allTime:"All time",grossValue:"Gross value before debt",outstandingDebt:"Outstanding Loans & Debt",netWorthTrend:"Net Worth Trend",assetAllocation:"Asset Allocation",topAsset:"Top Asset",hidden:"Hidden",chartHidden:"Chart Hidden in Privacy Mode",changeCurrency:"Change Base Currency",refreshPrices:"Refresh Prices",refreshing:"Refreshing...",assetsManagement:"Assets Management",assetsSubtitle:"Manage holdings and record trades.",showTrend:"Show Net Value Trend",trendModalSubtitle:"Trend analysis based on current filtered assets",searchAssets:"Search assets...",addNewAsset:"Add New Asset",portfolioHoldings:"Portfolio Holdings",noAssets:'No assets found. Click "Add New Asset" to start.',actions:"Actions",asset:"Asset",currentPrice:"Price",avgCost:"Cost",holdings:"Holdings",recentReturn:"Recent Annualized Return",value:"Value",statusPnL:"Status / P&L",confirmDelete:"Are you sure you want to delete {symbol}? This action cannot be undone.",updatePrice:"Quick Update Price",delete:"Delete",editDetails:"Edit Details",live:"Live",manual:"Manual",liveData:"Data fetched automatically from API",manualValuation:"Valuation set manually",manualPrice:"Manual Price",lastUpdated:"Last Updated",dataStale:"Update failed or data delayed > 30m",offline:"Offline",selectAssetType:"Select Asset Type",whatKind:"What kind of asset do you want to track?",assetDetails:"Asset Details",enterDetails:"Enter details for",editHolding:"Edit Holding",updateParams:"Update your holding parameters",identification:"1. Identification",changeType:"Change Type",tickerLabel:"Ticker / Currency Code",nameLabel:"Full Name (Optional)",currencyLabel:"Currency",valuationHoldings:"2. Valuation & Holdings",quantity:"Quantity",balance:"Balance",principalRemaining:"Principal Remaining",unitPrice:"Current Unit Price",costBasis:"Avg Cost (USD Basis)",avgCostUnit:"Average Cost / Unit",dateAcquired:"Start Time",dateRefreshed:"Refresh Time",autoFetch:"* Live prices will be fetched automatically based on ticker symbol.",autoFetchCash:"* Live exchange rates (USD) will be fetched automatically.",saveChanges:"Save Changes",addToPortfolio:"Add Asset to Portfolio",adjustButton:"Adjust",newCorrectQuantity:"New Correct Quantity",enterActualQuantity:"Enter actual quantity",adjustmentHint:"This will create a 'Balance Adjustment' transaction to fix your holdings.",confirmAdjustment:"Confirm Adjustment",type_stock:"Stock",type_crypto:"Crypto",type_fund:"Fund / ETF",type_real_estate:"Real Estate",type_cash:"Cash",type_liability:"Liability",type_other:"Custom",recordTransaction:"Record Transaction",editTransaction:"Edit Transaction",transactionHistory:"Transaction History",relatedTransactions:"Related Transactions",historySubtitle:"View and filter your investment activity.",exportCSV:"Export CSV",action:"Action",date:"Time",pricePerUnit:"Price",fees:"Fees",totalEstimate:"Total Estimate",total:"Total",autoCalculated:"Auto-calculated based on Quantity, Price, and Fee.",type:"Type",allAssets:"All Assets",allTypes:"All Types",fromDate:"From",toDate:"To",noTransactions:"No transactions found matching your filters.",selectAssetPlaceholder:"Select an asset...",tx_BUY:"Buy",tx_SELL:"Sell",tx_DIVIDEND:"Dividend",tx_BALANCE_ADJUSTMENT:"Balance Adjustment",deleteTransaction:"Delete Transaction",confirmDeleteTransaction:"Are you sure you want to delete this transaction? This will attempt to reverse the effect on your asset balance and cost.",analyticsSubtitle:"Performance metrics & risk analysis",noAssetsAnalytics:"Add assets to see analytics",netWorthStructure:"Net Worth Structure",debtRatio:"Debt Ratio",highLeverage:"High Leverage",healthy:"Healthy",riskAnalysis:"Risk Analysis",aiAssessment:"AI Assessment",startRiskAnalysis:"Start Risk Analysis",recalculate:"Recalculate",costVsValue:"Cost vs. Value",topMovers:"Top Movers",liabilityBreakdown:"Liability Breakdown",risk_high:"High (Crypto)",risk_medium:"Medium (Stocks)",risk_low:"Low (Stable)",label_assets:"Assets",label_liabilities:"Liabilities",label_cost:"Cost",label_value:"Market Value",label_net_pnl:"Net P&L",managePreferences:"Manage your preferences and data.",apiConfiguration:"API Configuration",apiKeysSecurity:"All API keys are stored exclusively in your browser's LocalStorage.",aiProvider:"AI Model Provider",aiProviderDesc:"Select which AI service to use for Portfolio Insights.",geminiKey:"Gemini API Key",geminiKeyDesc:"Enables AI Insights & Chat Assistant.",deepSeekKey:"DeepSeek API Key",deepSeekKeyDesc:"Use DeepSeek V3 model for portfolio analysis.",qwenKey:"Qwen API Key",qwenKeyDesc:"Use Qwen (Tongyi Qianwen) model for portfolio analysis.",finnhubKey:"Finnhub API Key",finnhubKeyDesc:"Required for fetching live stock prices (Free Tier: 60 calls/min).",alphaVantageKey:"Alpha Vantage API Key",alphaVantageKeyDesc:"Alternative provider (Free Tier: 25 calls/day).",marketDataProvider:"Market Data Source",marketDataProviderDesc:"Choose your preferred stock price provider.",marketDataKeyMissing:"Please add your API Key in Settings for accurate data.",getKey:"Get a key here",generalPreferences:"General Preferences",baseCurrency:"Base Currency",baseCurrencyDesc:"Default currency for portfolio display",language:"Language",languageDesc:"Display language for the application",privacyDataManagement:"Privacy & Data Management",privacyMode:"Privacy Mode",privacyModeDesc:"Conceal all monetary values and holdings",exportUnified:"Export Unified Data",exportUnifiedDesc:"Single CSV containing all transactions & asset details.",importData:"Import CSV Data",uploadCSV:"Upload CSV File",importHint:"Upload the unified 'Panasset Data' CSV. The system will auto-restore both assets and transactions.",resetData:"Reset Data",resetDesc:"Clear all assets",resetConfirm:"Are you sure? This will permanently delete all your assets and transactions. This action cannot be undone.",importSuccess:"Import successful!",importError:"Failed to parse CSV. Please ensure the file is valid.",resetSuccess:"All data has been reset.",localDataSecurity:"Data Security: All your financial data is stored locally in this browser. We do not use servers to store your personal assets.",aiAssistant:"AI Assistant",aiInsights:"AI Portfolio Insights",wealthManagement:"Wealth Management & Optimization",analyzeNow:"Analyze Now",upToDate:"Up to date",apiKeyMissing:"API Key is missing. Please set it in Settings.",setKey:"Set Key",unableToGenerate:"Unable to generate risk analysis.",aiUnavailable:"AI features unavailable. Please check your API Key.",voiceInput:"Voice Input",listening:"Listening...",processing:"Processing...",voiceError:"Voice input failed",voicePermissionDenied:"Microphone permission denied. Please allow access.",voiceNoSupport:"Browser not supported",voiceHint:'Try: "Bought 10 Apple stocks at 150"',holdToTalk:"Hold to Talk",releaseToSend:"Release to Send",switchToKeyboard:"Switch to Keyboard",switchToVoice:"Switch to Voice",feedback:"Feedback",haveFeedback:"Have feedback?",reportBug:"Report a Bug / Suggestion",githubLinkText:"Submit on GitHub",githubDesc:"Help us improve PanassetLite by submitting issues or feature requests.",userGuide:"User Guide",about:"About PanassetLite",error_api_key_missing:"API Key is missing. Please add it in Settings.",error_api_key_invalid:"API Key is invalid or expired. Please check your credentials.",error_rate_limit:"Rate limit exceeded. Please try again later.",error_rate_limit_av:"Alpha Vantage rate limit reached (25 calls/day). Try again tomorrow or switch to Finnhub.",error_rate_limit_fh:"Finnhub rate limit reached. Please wait a moment and try again.",error_access_denied:"Access denied to this resource. Consider upgrading your plan or switching providers.",error_network:"Network error. Please check your internet connection.",error_switch_provider:"Consider switching to {provider} in Settings.",error_unknown:"An unexpected error occurred while fetching market data.",finnhubFreePlanLimitation:"Finnhub Free Plan does not support historical candle data. Please upgrade or switch to Alpha Vantage."},zh:{dashboard:"仪表盘",assets:"资产管理",history:"交易历史",analytics:"投资分析",settings:"系统设置",disclaimer:"数据仅供演示，不构成投资建议。",overview:"概览",netWorth:"总资产净值",totalAssets:"总资产",totalLiabilities:"总负债",dayPnL:"今日盈亏",allTime:"历史累计",grossValue:"资产总值 (折合)",outstandingDebt:"未偿还贷款与债务",netWorthTrend:"净值趋势",assetAllocation:"资产分布",topAsset:"最大持仓",hidden:"已隐藏",chartHidden:"隐私模式下图表已隐藏",changeCurrency:"切换基准货币",refreshPrices:"刷新价格",refreshing:"刷新中...",assetsManagement:"资产管理",assetsSubtitle:"管理您的持仓并记录交易。",showTrend:"展示净值趋势图",trendModalSubtitle:"基于当前筛选结果的净值趋势分析",searchAssets:"搜索资产...",addNewAsset:"添加新资产",portfolioHoldings:"持仓列表",noAssets:"暂无资产。点击“添加新资产”开始。",actions:"操作",asset:"资产",currentPrice:"现价",avgCost:"成本",holdings:"持仓",recentReturn:"最近年化收益率",value:"市值",statusPnL:"状态 / 盈亏",confirmDelete:"您确定要删除 {symbol} 吗？此操作无法撤销。",updatePrice:"更新价格",delete:"删除",editDetails:"编辑详情",live:"联网",manual:"手动",liveData:"价格通过 API 自动获取",manualValuation:"手动设置的估值",manualPrice:"手动定价",lastUpdated:"最后更新",dataStale:"数据更新失败或已过期 >30分",offline:"离线",selectAssetType:"选择资产类型",whatKind:"您想追踪哪类资产？",assetDetails:"资产详情",enterDetails:"输入详情：",editHolding:"编辑持仓",updateParams:"更新您的持仓参数",identification:"1. 基本信息",changeType:"更改类型",tickerLabel:"代码 / 货币符号",nameLabel:"全称 (选填)",currencyLabel:"计价货币",valuationHoldings:"2. 估值与持仓",quantity:"数量",balance:"余额",principalRemaining:"剩余本金",unitPrice:"当前单价",costBasis:"单位成本 (USD计价)",avgCostUnit:"平均成本 / 单位",dateAcquired:"持仓开始时间",dateRefreshed:"持仓刷新时间",autoFetch:"* 将根据代码自动获取实时价格。",autoFetchCash:"* 将自动获取实时汇率 (USD)。",saveChanges:"保存更改",addToPortfolio:"添加到投资组合",adjustButton:"调整",newCorrectQuantity:"新的正确数量",enterActualQuantity:"输入实际数量",adjustmentHint:'这将创建一个"余额调整"交易记录来修正您的持仓。',confirmAdjustment:"确认调整",type_stock:"股票",type_crypto:"加密货币",type_fund:"基金 / ETF",type_real_estate:"房地产",type_cash:"现金",type_liability:"负债",type_other:"自定义资产",recordTransaction:"记录交易",editTransaction:"编辑交易",transactionHistory:"交易历史",relatedTransactions:"相关交易",historySubtitle:"查看与筛选您的投资活动。",exportCSV:"导出 CSV",action:"操作",date:"交易时间",pricePerUnit:"单价",fees:"手续费",totalEstimate:"预估总额",total:"总额",autoCalculated:"根据数量、单价和手续费自动计算。",type:"类型",allAssets:"所有资产",allTypes:"所有类型",fromDate:"起始时间",toDate:"结束时间",noTransactions:"未找到符合条件的交易。",selectAssetPlaceholder:"选择资产...",tx_BUY:"买入",tx_SELL:"卖出",tx_DIVIDEND:"股息",tx_BALANCE_ADJUSTMENT:"余额调整",deleteTransaction:"删除交易",confirmDeleteTransaction:"您确定要删除这条交易记录吗？系统将尝试回滚该交易对您资产余额和成本的影响。",analyticsSubtitle:"绩效指标与风险分析",noAssetsAnalytics:"添加资产以查看分析",netWorthStructure:"净值结构",debtRatio:"负债率",highLeverage:"高杠杆",healthy:"健康",riskAnalysis:"风险分析",aiAssessment:"AI 评估",startRiskAnalysis:"开始风险分析",recalculate:"重新计算",costVsValue:"成本 vs 市值",topMovers:"盈亏排行",liabilityBreakdown:"负债明细",risk_high:"高风险 (加密货币)",risk_medium:"中风险 (股票)",risk_low:"低风险 (稳定资产)",label_assets:"资产",label_liabilities:"负债",label_cost:"成本",label_value:"市值",label_net_pnl:"净盈亏",managePreferences:"管理您的偏好与数据。",apiConfiguration:"API 配置",apiKeysSecurity:"所有 API 密钥仅存储在您浏览器的本地存储中。",aiProvider:"AI 模型服务商",aiProviderDesc:"选择用于投资组合智能分析的 AI 服务。",geminiKey:"Gemini API Key",geminiKeyDesc:"配置即可开启 AI 洞察与智能助手。",deepSeekKey:"DeepSeek API Key",deepSeekKeyDesc:"使用 DeepSeek V3 模型进行投资组合分析。",qwenKey:"通义千问 API Key",qwenKeyDesc:"使用通义千问 (Qwen) 模型进行智能分析。",finnhubKey:"Finnhub API Key",finnhubKeyDesc:"获取实时股票价格所需 (收费版: 30次/分钟)。",alphaVantageKey:"Alpha Vantage API Key",alphaVantageKeyDesc:"备用数据源 (免费版: 25次/天)。",marketDataProvider:"行情数据源",marketDataProviderDesc:"选择您偏好的股票价格数据提供商。",marketDataKeyMissing:"请在设置中添加 API 密钥以获取准确数据。",getKey:"获取密钥",generalPreferences:"通用设置",baseCurrency:"基准货币",baseCurrencyDesc:"用于投资组合展示的默认货币",language:"语言 (Language)",languageDesc:"应用程序显示语言",privacyDataManagement:"隐私与数据管理",privacyMode:"隐私模式",privacyModeDesc:"隐藏所有资产金额与持仓细节",exportUnified:"导出完整数据",exportUnifiedDesc:"下载包含所有交易与资产详情的单一 CSV 文件。",importData:"导入数据",uploadCSV:"上传 CSV 文件",importHint:"上传 Panasset 导出的统一格式 CSV。系统将自动恢复资产档案与交易流水。",resetData:"重置数据",resetDesc:"清空所有资产",resetConfirm:"确定要清空吗？这将永久删除您的所有资产和交易记录，无法撤销。",importSuccess:"导入成功！",importError:"文件解析失败，请确保格式有效。",resetSuccess:"所有数据已重置。",localDataSecurity:"数据安全声明：您的财务数据仅存储在本地设备上 (LocalStorage)。我们没有任何服务器来存储您的个人资产信息。",aiAssistant:"AI 智能助手",aiInsights:"AI 投资组合洞察",wealthManagement:"财富管理与优化建议",analyzeNow:"立即分析",upToDate:"已是最新",apiKeyMissing:"缺少 API Key。请在设置中配置。",setKey:"Set Key",unableToGenerate:"Unable to generate risk analysis.",aiUnavailable:"AI 功能不可用，请检查 API Key。",voiceInput:"语音录入",listening:"聆听中...",processing:"分析中...",voiceError:"识别失败",voicePermissionDenied:"麦克风权限被拒绝，请允许访问。",voiceNoSupport:"浏览器不支持",voiceHint:'尝试说: "今天以 180 美元买入了 10 股苹果"',holdToTalk:"按住 说话",releaseToSend:"松开 发送",switchToKeyboard:"切换键盘",switchToVoice:"切换语音",feedback:"反馈建议",haveFeedback:"有反馈意见？",reportBug:"提交 Bug 或功能建议",githubLinkText:"前往 GitHub 提交",githubDesc:"提交 Issue 或功能建议，帮助我们改进 PanassetLite。",userGuide:"使用指南",about:"关于 盘资产·轻",error_api_key_missing:"缺少 API 密钥。请在设置中添加。",error_api_key_invalid:"API 密钥无效或已过期。请检查您的凭据。",error_rate_limit:"已超出请求频率限制。请稍后重试。",error_rate_limit_av:"Alpha Vantage 已达到频率限制（25次/天）。请明天再试或切换至 Finnhub。",error_rate_limit_fh:"Finnhub 已达到频率限制。请稍等片刻后重试。",error_access_denied:"访问被拒绝。考虑升级订阅或切换数据提供商。",error_network:"网络错误。请检查您的网络连接。",error_switch_provider:"考虑在设置中切换到 {provider}。",error_unknown:"获取市场数据时发生未知错误。",finnhubFreePlanLimitation:"Finnhub 免费方案不支持历史K线数据。请升级方案或切换至 Alpha Vantage。"}},vt=(e,t)=>{const{assets:s,transactions:a,v2Metadata:n}=et.getLegacyData();if(s&&!n)try{const n=JSON.parse(s),r=a?JSON.parse(a):[],i=[],l=[...r];n.forEach(e=>{i.push({id:e.id,symbol:e.symbol,name:e.name,type:e.type,currency:e.currency,currentPrice:e.currentPrice,lastUpdated:e.lastUpdated,dateAcquired:e.dateAcquired});if(!r.some(t=>t.assetId===e.id)&&e.quantity>0){const t=e.dateAcquired?`${e.dateAcquired}T00:00:00`:(new Date).toISOString();l.push({id:crypto.randomUUID(),assetId:e.id,type:Ve.BUY,date:t,quantityChange:e.quantity,pricePerUnit:e.avgCost,fee:0,total:e.quantity*e.avgCost,note:"Migration: Initial Balance"})}}),e(i),t(l),et.saveAssetMetas(i),et.saveTransactions(l),et.clearLegacyData()}catch(r){}},jt=(e,t)=>(t(t=>{const s=[...t];return e.forEach(e=>{const t=s.findIndex(t=>t.id===e.id);t>=0?s[t]={...s[t],...e}:s.push(e)}),s}),e.length),Nt=(e,t)=>(t(t=>{const s=[...t];return e.forEach(e=>{const t=s.findIndex(t=>t.id===e.id);t>=0?s[t]={...s[t],...e}:s.push(e)}),s}),e.length);const wt=new class{constructor(){this.listeners=[],this.toastCounter=0}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notify(e){this.listeners.forEach(t=>t(e))}showToast(e,t,s){const a={id:`toast-${++this.toastCounter}-${Date.now()}`,type:e,message:t,duration:void 0!==s?s:5e3};this.notify(a)}showError(e,t){this.showToast("error",e,t)}showWarning(e,t){this.showToast("warning",e,t)}showInfo(e,t){this.showToast("info",e,t)}showSuccess(e,t){this.showToast("success",e,t)}},St=(t,s,a)=>{const[n,r]=e.useState({USD:1,CNY:7.2,HKD:7.8}),[i,l]=e.useState(!1),o=e.useRef(a);e.useEffect(()=>{o.current=a},[a]);const c=e=>{const t=yt[o.current.language],s="finnhub"===e.provider?"Alpha Vantage":"Finnhub";switch(e.category){case We.API_KEY_MISSING:return t.error_api_key_missing;case We.API_KEY_INVALID:return t.error_api_key_invalid;case We.RATE_LIMIT:return"alphavantage"===e.provider?t.error_rate_limit_av:t.error_rate_limit_fh;case We.ACCESS_DENIED:return`${t.error_access_denied} ${t.error_switch_provider.replace("{provider}",s)}`;case We.NETWORK_ERROR:return t.error_network;default:return t.error_unknown}};return{exchangeRates:n,isRefreshing:i,refreshPrices:async e=>{l(!0);const a=e||t;try{const e=await(async()=>{const e=et.getCache(st),t=!e||Date.now()-e.timestamp>864e5;if(e&&!t)return e.data;try{const e=await fetch("https://api.exchangerate-api.com/v4/latest/USD");if(!e.ok)throw new Error("Network response was not ok");const t=await e.json();return et.saveCache(st,t.rates),t.rates}catch(s){return(null==e?void 0:e.data)||{USD:1,CNY:7.2,HKD:7.8}}})();r(e);const[t,n]=await Promise.all([xt(a),gt(a,{provider:o.current.marketDataProvider||"finnhub",alphaVantageKey:o.current.alphaVantageApiKey,finnhubKey:o.current.finnhubApiKey}).catch(e=>(wt.showError(c(e)),{}))]);s(s=>s.map(s=>{let a=s.currentPrice,r=s.currency,i=s.lastUpdated;if(s.type===Ye.CRYPTO&&t[s.id])a=t[s.id],r=He.USD,i=Date.now();else if(s.type!==Ye.STOCK&&s.type!==Ye.FUND||!n[s.id]){if(s.type===Ye.CASH&&!s.isManualPrice){const t=e[s.symbol];t&&t>0&&(a=1/t,r=He.USD,i=Date.now())}}else a=n[s.id].price,r=n[s.id].currency,i=n[s.id].lastUpdated||Date.now();return{...s,currentPrice:a,currency:r,lastUpdated:i}}))}catch(n){n.category?wt.showError(c(n)):wt.showError(yt[o.current.language].error_network)}finally{l(!1)}}}},At=e.createContext(void 0),Tt={baseCurrency:He.USD,isPrivacyMode:!1,geminiApiKey:"",deepSeekApiKey:"",qwenApiKey:"",aiProvider:"gemini",marketDataProvider:"finnhub",alphaVantageApiKey:"",finnhubApiKey:"",language:navigator.language.toLowerCase().startsWith("zh")?"zh":"en"},Ct=({children:s})=>{const[a,n]=e.useState(()=>et.getAssetMetas()),[r,i]=e.useState(()=>et.getTransactions()),[l,o]=e.useState(()=>{const e=et.getSettings();return e?{...Tt,...e,geminiApiKey:e.geminiApiKey||""}:Tt}),{exchangeRates:c,isRefreshing:d,refreshPrices:u}=St(a,n,l);e.useEffect(()=>{vt(n,i)},[]),e.useEffect(()=>{(a.length>0||r.length>0)&&(et.saveAssetMetas(a),et.saveTransactions(r))},[a,r]),e.useEffect(()=>{et.saveSettings(l)},[l]);const m=((t,s)=>e.useMemo(()=>{const e=new Map;return t.forEach(t=>{e.set(t.id,{...t,quantity:0,avgCost:0,totalCost:0,currentValue:0,pnl:0,pnlPercent:0,realizedPnL:0})}),[...s].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()).forEach(t=>{const s=e.get(t.assetId);if(s)if(t.type===Ve.BUY||t.type===Ve.DEPOSIT||t.type===Ve.BORROW){const e=t.total,a=s.totalCost+e,n=s.quantity+t.quantityChange;s.quantity=n,s.totalCost=a,n>0&&(s.avgCost=a/n)}else if(t.type===Ve.SELL||t.type===Ve.WITHDRAWAL||t.type===Ve.REPAY){const e=Math.abs(t.quantityChange),a=e*s.avgCost,n=t.total-a;s.quantity-=e,s.totalCost-=a,s.realizedPnL+=n,s.quantity<=1e-6&&(s.quantity=0,s.totalCost=0,s.avgCost=0)}else if(t.type===Ve.BALANCE_ADJUSTMENT)if(t.quantityChange>0)s.quantity+=t.quantityChange,s.totalCost+=t.total,s.quantity>0&&(s.avgCost=s.totalCost/s.quantity);else{const e=Math.abs(t.quantityChange),a=e/s.quantity;s.totalCost-=s.totalCost*a,s.quantity-=e}else t.type===Ve.DIVIDEND&&(s.realizedPnL+=t.total)}),Array.from(e.values()).map(e=>{const t=e.quantity*e.currentPrice,s=t-e.totalCost,a=0!==e.totalCost?s/e.totalCost*100:0;return{...e,currentValue:t,pnl:s,pnlPercent:a}})},[t,s]))(a,r);return t.jsx(At.Provider,{value:{assets:m,transactions:r,settings:l,exchangeRates:c,isRefreshing:d,addAsset:(e,t,s,a)=>{if(n(t=>[...t,e]),t>0){const n={id:crypto.randomUUID(),assetId:e.id,type:e.type===Ye.LIABILITY?Ve.BORROW:Ve.BUY,date:a,quantityChange:t,pricePerUnit:s,fee:0,total:t*s,note:"Initial Holding"};i(e=>[...e,n])}u()},editAsset:e=>{n(t=>t.map(t=>t.id===e.id?e:t))},deleteAsset:e=>{n(t=>t.filter(t=>t.id!==e)),i(t=>t.filter(t=>t.assetId!==e)),(e=>{const t=`${rt}_${e}`;et.remove(t)})(e)},addTransaction:e=>{const t={...e,id:crypto.randomUUID()};i(e=>[...e,t])},editTransaction:e=>{i(t=>t.map(t=>t.id===e.id?e:t))},deleteTransaction:e=>{i(t=>t.filter(t=>t.id!==e))},updateAssetPrice:(e,t)=>{n(s=>s.map(s=>s.id===e?{...s,currentPrice:t,lastUpdated:Date.now()}:s))},refreshPrices:u,updateSettings:e=>{o(t=>({...t,...e}))},importAssetsCSV:e=>jt(e,n),importTransactionsCSV:e=>Nt(e,i),clearData:()=>{n([]),i([]),et.clearAllData(),et.clearItemsByPrefix(rt)},t:e=>{var t;const s=l.language||"en";return(null==(t=yt[s])?void 0:t[e])||e}},children:s})},Dt=()=>{const t=e.useContext(At);if(void 0===t)throw new Error("usePortfolio must be used within a PortfolioProvider");return t},It={name:"get_portfolio_state",description:"Get the current state of the portfolio. Returns total value, summary stats, and a list of all assets with their current holdings/prices."},Pt={name:"get_asset_details",description:"Get detailed information about a specific asset. Returns metadata, current computed state, and recent transaction history.",parameters:{type:a.OBJECT,properties:{symbolOrId:{type:a.STRING,description:"The symbol (e.g., AAPL) or ID of the asset."}},required:["symbolOrId"]}},kt={name:"search_transactions",description:"Search transaction history. Filter by date range, type, or symbol.",parameters:{type:a.OBJECT,properties:{symbol:{type:a.STRING,description:"Filter by asset symbol"},startDate:{type:a.STRING,description:"Start date (ISO 8601)"},endDate:{type:a.STRING,description:"End date (ISO 8601)"},limit:{type:a.NUMBER,description:"Max results (default 20)"}}}},Et={name:"propose_add_asset",description:"Propose adding a NEW asset to the portfolio. If the asset already exists, use propose_transaction instead.",parameters:{type:a.OBJECT,properties:{symbol:{type:a.STRING,description:"Asset Symbol (e.g. AAPL, BTC)"},name:{type:a.STRING,description:"Asset Name"},assetType:{type:a.STRING,enum:["STOCK","CRYPTO","CASH","REAL_ESTATE","LIABILITY","FUND","OTHER"],description:"Asset Type"},currency:{type:a.STRING,enum:["USD","CNY","HKD"],description:"Currency"},initialQuantity:{type:a.NUMBER,description:"Initial quantity held (will create an initial transaction)."},price:{type:a.NUMBER,description:"Current Price or Cost Basis"},dateAcquired:{type:a.STRING,description:"Date acquired (ISO 8601)"}},required:["symbol","assetType"]}},Lt={name:"propose_update_metadata",description:"Propose updating the METADATA (name, type, currency, price) of an existing asset. CANNOT change quantity (use transaction for that).",parameters:{type:a.OBJECT,properties:{assetId:{type:a.STRING,description:"Asset ID"},name:{type:a.STRING,description:"New Name"},symbol:{type:a.STRING,description:"New Symbol"},assetType:{type:a.STRING,enum:["STOCK","CRYPTO","CASH","REAL_ESTATE","LIABILITY","FUND","OTHER"],description:"New Type"},currency:{type:a.STRING,enum:["USD","CNY","HKD"],description:"New Currency"},currentPrice:{type:a.NUMBER,description:"Update current market price (does not affect quantity)"}},required:["assetId"]}},_t={name:"propose_bulk_asset_update",description:"Propose MULTIPLE asset additions or updates at once. Use this for analyzing IMAGES or for BATCH UPDATES.",parameters:{type:a.OBJECT,properties:{assets:{type:a.ARRAY,description:"List of assets identified.",items:{type:a.OBJECT,properties:{symbol:{type:a.STRING,description:"Ticker Symbol"},name:{type:a.STRING,description:"Asset Name"},quantity:{type:a.NUMBER,description:"Quantity held"},price:{type:a.NUMBER,description:"Price/Cost"},currency:{type:a.STRING,enum:["USD","CNY","HKD"]},assetType:{type:a.STRING,enum:["STOCK","CRYPTO","CASH","REAL_ESTATE","LIABILITY","FUND","OTHER"]},dateAcquired:{type:a.STRING}},required:["symbol","quantity"]}}},required:["assets"]}},Rt={name:"propose_transaction",description:"Propose to Add, Update, or Delete a Transaction. This is the ONLY way to change the quantity of an existing asset.",parameters:{type:a.OBJECT,properties:{mutationType:{type:a.STRING,enum:["ADD","UPDATE","DELETE"],description:"Type of change"},transactionId:{type:a.STRING,description:"Transaction ID (Required for UPDATE/DELETE)"},assetId:{type:a.STRING,description:"Asset ID (Required for ADD)"},txType:{type:a.STRING,enum:["BUY","SELL","DIVIDEND","DEPOSIT","WITHDRAWAL","BORROW","REPAY","BALANCE_ADJUSTMENT"],description:"Transaction Type"},quantity:{type:a.NUMBER,description:"Quantity involved"},price:{type:a.NUMBER,description:"Price per unit"},date:{type:a.STRING,description:"ISO 8601 Date Time"},fee:{type:a.NUMBER,description:"Fees"},note:{type:a.STRING,description:"Optional note"}},required:["mutationType"]}},Ut={name:"propose_batch_delete",description:"Propose to DELETE multiple assets at once.",parameters:{type:a.OBJECT,properties:{assetIds:{type:a.ARRAY,items:{type:a.STRING}},reason:{type:a.STRING}},required:["assetIds"]}};function zt(e){if(!e||"object"!=typeof e)return e;const t={...e};if(t.type&&"string"==typeof t.type&&(t.type=t.type.toLowerCase()),t.properties){const e={};for(const s in t.properties)e[s]=zt(t.properties[s]);t.properties=e}return t.items&&(t.items=zt(t.items)),t}class Mt{constructor(e,t="gemini"){this.geminiAi=null,this.modelName="gemini-2.5-flash",this.apiKey=e,this.provider=t,"gemini"===t&&e&&(this.geminiAi=new s({apiKey:e}))}async processMessage(e,t,s,a,n,r,i){var l,o,c,d,u,m;if(!this.apiKey)return{text:"zh"===r?`我需要 **${"gemini"===this.provider?"Gemini":"qwen"===this.provider?"Qwen":"DeepSeek"} API Key** 才能作为您的 AI 助手工作。\n\n请前往 **设置** 页面进行配置。`:`I need a **${"gemini"===this.provider?"Gemini":"qwen"===this.provider?"Qwen":"DeepSeek"} API Key** to function as your AI assistant. \n\nPlease go to **Settings** to configure it.`};try{const p=new Date,x=p.toISOString().split("T")[0],h=p.toISOString(),g=`\n        You are the intelligent assistant for "PanassetLite".\n        Today is ${x}. Current Time is ${h}. Base Currency: ${n}.\n        \n        **Language Rule:**\n        ${"zh"===r?"You MUST reply in Chinese (Simplified).":"You MUST reply in English."}\n        \n        **Capabilities:**\n        1. **READ**: Use \`get_portfolio_state\` to see all assets. Use \`get_asset_details\` to investigate specific assets and their history.\n        2. **WRITE**: \n           - **NEW Assets**: Use \`propose_add_asset\`.\n           - **EXISTING Assets**: \n             - To change Quantity/Cost -> Use \`propose_transaction\`.\n             - To change Name/Type/Price -> Use \`propose_update_metadata\`.\n        3. **BULK IMPORT**: If the user provides an IMAGE, use \`propose_bulk_asset_update\`.\n        \n        **Universal Asset Logic:**\n        1.  **Scope**: **ANYTHING can be an asset.**\n        2.  **Symbol/ID**: Financial = Ticker; Physical = Concise ID.\n        3.  **Asset Type**: Infer best match.\n        4.  **Quantity Rules**:\n            -   **Default**: 1 if unspecified.\n            -   **Funds**: If only Total Value known, Qty = Total Value, Price = 1.\n        5.  **Price/Value**: Estimate if unknown.\n        6.  **Currency**: Infer from context.\n            -   **US Stocks (e.g. AAPL, TSLA)** -> USD\n            -   **CN Stocks (e.g. 600519)** -> CNY\n            -   **HK Stocks (e.g. 0700)** -> HKD\n            -   **Crypto** -> USD (usually)\n            -   **Otherwise** -> Default to ${n}\n\n        **Tool Usage Rules:**\n        -   **Single Source of Truth**: The ONLY way to change an asset's quantity is via a TRANSACTION.\n        -   **Adding**: \`propose_add_asset\` creates the asset AND an initial transaction.\n        -   **Updating**: \n            -   If user says "I bought 5 more", use \`propose_transaction(ADD, type=BUY...)\`.\n            -   If user says "Update price to 100", use \`propose_update_metadata\`.\n            -   If user says "I actually have 10, not 5" (correction), use \`propose_transaction(ADD, type=BALANCE_ADJUSTMENT...)\`.\n\n        **CRITICAL INFERENCE RULES (DO NOT ASK QUESTIONS):**\n        -   **Date**: If user doesn't specify a date, **ASSUME TODAY (${x})**. DO NOT ASK.\n        -   **Currency**: **INFER** based on the asset symbol or type. DO NOT ASK unless ambiguous.\n        -   **Price**: If user doesn't specify a price, leave it as 0 or estimate it. DO NOT ASK.\n        -   **General**: **Minimize follow-up questions.** Only ask if you absolutely cannot proceed (e.g., missing symbol).\n\n        **TOOL CALLING RULES:**\n        - **DO NOT** use \`print()\`, \`console.log()\`.\n        - **DO NOT** wrap the function call in a code block (e.g. \`\`\`python ... \`\`\`).\n        - Ensure arguments match the JSON schema exactly.\n      `;let b="";if("gemini"===this.provider){if(!this.geminiAi)throw new Error("Gemini not initialized");const n=t.filter(e=>"system"!==e.role).slice(-10).map(e=>{const t=[];if(e.image){const s=e.image.split(",")[1],a=e.image.split(";")[0].split(":")[1];t.push({inlineData:{mimeType:a,data:s}})}return e.content&&e.content.trim().length>0&&t.push({text:e.content}),{role:"user"===e.role?"user":"model",parts:t}}),l=this.geminiAi.chats.create({model:this.modelName,history:n,config:{systemInstruction:g,tools:[{functionDeclarations:[It,Pt,kt,Et,Lt,_t,Rt,Ut]}]}}),o=[];if(i){const e=i.split(",")[1],t=i.split(";")[0].split(":")[1];o.push({inlineData:{mimeType:t,data:e}}),o.push({text:"Please analyze this image and list all asset holdings found. Use the bulk update tool."})}const c=e.trim();c?o.push({text:c}):0===o.length&&o.push({text:"."});let d=await l.sendMessage({message:o});const u=d.functionCalls;if(u&&u.length>0){const e=u[0],t=await this.handleToolCall(e.name,e.args,s,a,r);if(t.action)return{text:t.text||"",action:t.action};d=await l.sendMessage({message:[{functionResponse:{name:e.name,response:t.response}}]});const n=d.functionCalls;if(n&&n.length>0){const e=n[0],t=await this.handleToolCall(e.name,e.args,s,a,r);if(t.action)return{text:t.text||"",action:t.action}}}b=d.text||""}else if("qwen"===this.provider||"deepseek"===this.provider){const n=[It,Pt,kt,Et,Lt,_t,Rt,Ut].map(e=>({type:"function",function:{name:e.name,description:e.description,parameters:zt(e.parameters)}}));let p="qwen"===this.provider?"qwen-plus":"deepseek-chat";const x=[{role:"system",content:g},...t.filter(e=>"system"!==e.role).slice(-10).map(e=>({role:"model"===e.role?"assistant":e.role,content:e.content}))];i&&"qwen"===this.provider?(p="qwen-vl-max",x.push({role:"user",content:[{type:"image_url",image_url:{url:i}},{type:"text",text:e}]})):x.push({role:"user",content:e});const h="qwen"===this.provider?"https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions":"https://api.deepseek.com/chat/completions",f=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:p,messages:x,tools:n,tool_choice:"auto"})}),y=null==(l=(await f.json()).choices)?void 0:l[0],v=null==y?void 0:y.message;if((null==(o=null==v?void 0:v.tool_calls)?void 0:o.length)>0){const e=v.tool_calls[0],t=e.function.name,i=JSON.parse(e.function.arguments),l=await this.handleToolCall(t,i,s,a,r);if(l.action)return{text:l.text||"",action:l.action};x.push(v),x.push({role:"tool",tool_call_id:e.id,name:t,content:JSON.stringify(l.response)});const o=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:p,messages:x,tools:n})}),g=null==(c=(await o.json()).choices)?void 0:c[0];if((null==(u=null==(d=null==g?void 0:g.message)?void 0:d.tool_calls)?void 0:u.length)>0){const e=g.message.tool_calls[0],t=e.function.name,n=JSON.parse(e.function.arguments),i=await this.handleToolCall(t,n,s,a,r);if(i.action)return{text:i.text||"",action:i.action}}b=(null==(m=null==g?void 0:g.message)?void 0:m.content)||""}else{const e=(null==v?void 0:v.content)||"";let t=null;const n=(e=>{try{return JSON.parse(e)}catch(i){}const t=e.match(/```(?:json)?\s*([\s\S]*?)```/i);if(t)try{return JSON.parse(t[1])}catch(i){}const s=e.indexOf("{"),a=e.lastIndexOf("}");if(-1!==s&&-1!==a&&a>s)try{return JSON.parse(e.substring(s,a+1))}catch(i){}const n=e.indexOf("["),r=e.lastIndexOf("]");if(-1!==n&&-1!==r&&r>n)try{return JSON.parse(e.substring(n,r+1))}catch(i){}return null})(e);if(n&&(Array.isArray(n)?t={name:"propose_bulk_asset_update",args:{assets:n}}:n.assets&&Array.isArray(n.assets)?t={name:"propose_bulk_asset_update",args:n}:n.name&&n.arguments?t={name:n.name,args:n.arguments}:n.symbol&&(n.quantity||n.price)&&(t={name:"propose_bulk_asset_update",args:{assets:[n]}})),t){const e=await this.handleToolCall(t.name,t.args,s,a,r);if(e.action)return{text:e.text||"",action:e.action};b=JSON.stringify(e.response)}else b=e}}return{text:b}}catch(p){return{text:"zh"===r?"抱歉，AI 暂时无法处理您的请求。":"Sorry, I encountered an issue processing your request."}}}async handleToolCall(e,t,s,a,n){var r,i;if("get_portfolio_state"===e){const e=s.reduce((e,t)=>e+t.currentValue,0),t=s.reduce((e,t)=>e+t.totalCost,0);return{response:{summary:{totalValue:e,totalCost:t,totalPnL:e-t,assetCount:s.length},assets:s.map(e=>({id:e.id,symbol:e.symbol,name:e.name,type:e.type,qty:e.quantity,price:e.currentPrice,value:e.currentValue,currency:e.currency}))}}}if("get_asset_details"===e){const e=(t.symbolOrId||"").toUpperCase(),n=s.find(t=>t.id===e||t.symbol===e);if(n){const e=a.filter(e=>e.assetId===n.id).sort((e,t)=>t.date.localeCompare(e.date)).slice(0,20);return{response:{metadata:{id:n.id,symbol:n.symbol,name:n.name,type:n.type,currency:n.currency,currentPrice:n.currentPrice},computed:{quantity:n.quantity,avgCost:n.avgCost,totalCost:n.totalCost,currentValue:n.currentValue,pnl:n.pnl,pnlPercent:n.pnlPercent},recentTransactions:e.map(e=>({id:e.id,date:e.date,type:e.type,qtyChange:e.quantityChange,price:e.pricePerUnit,total:e.total,note:e.note}))}}}return{response:{error:"Asset not found"}}}if("search_transactions"===e){let e=[...a];if(t.symbol){const a=s.find(e=>e.symbol===t.symbol.toUpperCase());e=a?e.filter(e=>e.assetId===a.id):[]}t.startDate&&(e=e.filter(e=>e.date>=t.startDate)),t.endDate&&(e=e.filter(e=>e.date<=t.endDate)),e=e.sort((e,t)=>t.date.localeCompare(e.date)).slice(0,t.limit||20);return{response:{transactions:e.map(e=>{const t=s.find(t=>t.id===e.assetId);return{id:e.id,date:e.date,type:e.type,symbol:null==t?void 0:t.symbol,qty:e.quantityChange,price:e.pricePerUnit,total:e.total}})}}}if("propose_add_asset"===e){const e=`Add New Asset: ${t.symbol}`;return{action:{type:"ADD_ASSET",data:{symbol:t.symbol,name:t.name,quantity:t.initialQuantity,price:t.price,type:t.assetType,currency:t.currency,date:t.dateAcquired||(new Date).toISOString().split("T")[0]},summary:e}}}if("propose_update_metadata"===e){let e=t.assetId;const a=s.find(e=>e.id===t.assetId);a&&(e=a.symbol);const n=`Update Metadata: ${e}`;return{action:{type:"UPDATE_ASSET",targetId:t.assetId,data:{symbol:t.symbol,name:t.name,type:t.assetType,currency:t.currency,price:t.currentPrice},summary:n}}}if("propose_bulk_asset_update"===e){const e=(null==(r=t.assets)?void 0:r.length)||0,s="zh"===n?`从图片识别到 ${e} 个资产持仓`:`Identified ${e} assets from image`;return{text:"zh"===n?"我从图片中识别到了以下资产，请确认是否导入：":"I found the following assets in the image. Please confirm to import:",action:{type:"BULK_ASSET_UPDATE",data:{},items:t.assets,summary:s}}}if("propose_transaction"===e){const e={ADD:"ADD_TRANSACTION",UPDATE:"UPDATE_TRANSACTION",DELETE:"DELETE_TRANSACTION"}[t.mutationType];let a="Unknown";if(t.assetId){const e=s.find(e=>e.id===t.assetId);e&&(a=e.symbol)}const n=`${t.mutationType} Transaction: ${t.txType||""} ${a}`;return{action:{type:e,targetId:t.transactionId,data:{assetId:t.assetId,type:t.txType,quantity:t.quantity,price:t.price,date:t.date||(new Date).toISOString().split("T")[0],fee:t.fee},summary:n}}}if("propose_batch_delete"===e){const e=(null==(i=t.assetIds)?void 0:i.length)||0,s="zh"===n?`批量删除 ${e} 个资产: ${t.reason||""}`:`Batch delete ${e} assets: ${t.reason||""}`;return{text:"zh"===n?`我建议删除以下 ${e} 个资产。请确认：`:`I propose deleting the following ${e} assets. Please confirm:`,action:{type:"BATCH_DELETE_ASSET",data:{},items:t.assetIds.map(e=>({id:e})),summary:s}}}return{response:{error:"Unknown tool"}}}}const Ot=(e,t=1280,s=.7)=>new Promise((a,n)=>{const r=new FileReader;r.readAsDataURL(e),r.onload=e=>{var r;const i=new Image;i.src=null==(r=e.target)?void 0:r.result,i.onload=()=>{let e=i.width,r=i.height;e>t&&(r=Math.round(r*t/e),e=t);const l=document.createElement("canvas");l.width=e,l.height=r;const o=l.getContext("2d");if(!o)return void n(new Error("Failed to get canvas context"));o.drawImage(i,0,0,e,r);const c=l.toDataURL("image/jpeg",s);a(c)},i.onerror=e=>n(e)},r.onerror=e=>n(e)}),Kt={getNextId(e){let t=0;for(const s of e){const e=parseInt(s.id,10);!isNaN(e)&&/^\d+$/.test(s.id)&&e>t&&(t=e)}return(t+1).toString()}},qt="panasset_chat_history",Ft=({language:e,onClearHistory:s,onClose:a,isResizing:o,isMobile:c,onResizeStart:d})=>t.jsxs("div",{className:"p-4 bg-gradient-to-r from-indigo-600 to-blue-600 flex justify-between items-center shrink-0 text-white shadow-sm relative "+(o?"pointer-events-auto":""),children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-1.5 bg-white/20 rounded-lg",children:t.jsx(n,{size:18,className:"text-white"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold text-sm",children:"zh"===e?"盘资产 智能助手":"Panasset Assistant"}),t.jsxs("p",{className:"text-[10px] text-indigo-100 flex items-center gap-1 opacity-90",children:[t.jsx("span",{className:"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"}),"zh"===e?"在线":"Online"]})]})]}),t.jsxs("div",{className:"flex items-center gap-1 pr-6 md:pr-0",children:[t.jsx("button",{onClick:s,className:"text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors p-2",title:"zh"===e?"清除历史":"Clear History",children:t.jsx(r,{size:18})}),t.jsx("button",{onClick:a,className:"text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors p-2",children:t.jsx(i,{size:22})})]}),!c&&t.jsx("div",{className:"absolute top-0 right-0 w-8 h-8 cursor-ne-resize flex items-center justify-center text-white/50 hover:text-white hover:bg-white/10 rounded-bl-xl transition-colors z-20",onMouseDown:d,title:"Resize",children:t.jsx(l,{size:16})})]});class $t extends Error{constructor(e,t,s){super(e),this.provider=t,this.originalError=s,this.name="AIError"}}class Bt extends $t{constructor(e,t,s){super(e,t,s),this.name="AIParseError"}}class Yt{constructor(e){this.ai=new s({apiKey:e})}async generateText(e){try{return(await this.ai.models.generateContent({model:"gemini-2.5-flash",contents:e})).text||""}catch(t){throw new $t("Gemini Text Generation Failed","gemini",t)}}async generateJSON(e,t){const s={responseMimeType:"application/json"};t&&(s.responseSchema=t);try{const t=await this.ai.models.generateContent({model:"gemini-2.5-flash",contents:e,config:s});try{return JSON.parse(t.text)}catch(a){throw new Bt("Invalid JSON response from Gemini","gemini",a)}}catch(a){if(a instanceof Bt)throw a;throw new $t("Gemini JSON Generation Failed","gemini",a)}}}class Ht{constructor(e){this.baseUrl="https://api.deepseek.com/chat/completions",this.apiKey=e}async callAPI(e,t=!1){var s,a,n,r;try{const i=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:"deepseek-chat",messages:e,response_format:t?{type:"json_object"}:void 0,stream:!1})});if(!i.ok){const e=(null==(s=(await i.json().catch(()=>({}))).error)?void 0:s.message)||i.statusText;throw new $t(`DeepSeek API Error: ${e}`,"deepseek")}return(null==(r=null==(n=null==(a=(await i.json()).choices)?void 0:a[0])?void 0:n.message)?void 0:r.content)||""}catch(i){if(i instanceof $t)throw i;throw new $t("DeepSeek Network/API Error","deepseek",i)}}async generateText(e){return this.callAPI([{role:"user",content:e}],!1)}async generateJSON(e,t){const s=await this.callAPI([{role:"user",content:e}],!0);try{return JSON.parse(s)}catch(a){throw new Bt("Invalid JSON response from DeepSeek","deepseek",a)}}}class Vt{constructor(e){this.baseUrl="https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",this.apiKey=e}async callAPI(e,t){var s;try{const a={model:"qwen-plus",messages:e,stream:!1};t&&(a.tools=t);const n=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify(a)});if(!n.ok){const e=(null==(s=(await n.json().catch(()=>({}))).error)?void 0:s.message)||n.statusText;throw new $t(`Qwen API Error: ${e}`,"qwen")}return await n.json()}catch(a){if(a instanceof $t)throw a;throw new $t("Qwen Network/API Error","qwen",a)}}async generateText(e){var t,s,a;return(null==(a=null==(s=null==(t=(await this.callAPI([{role:"user",content:e}])).choices)?void 0:t[0])?void 0:s.message)?void 0:a.content)||""}async generateJSON(e,t){var s,a,n;const r=(null==(n=null==(a=null==(s=(await this.callAPI([{role:"user",content:e}])).choices)?void 0:s[0])?void 0:a.message)?void 0:n.content)||"";try{const e=r.match(/```json\n([\s\S]*?)\n```/)||r.match(/```\n([\s\S]*?)\n```/),t=e?e[1]:r;return JSON.parse(t)}catch(i){throw new Bt("Invalid JSON response from Qwen","qwen",i)}}}class Wt{static create(e,t){switch(e){case"deepseek":return new Ht(t);case"qwen":return new Vt(t);default:return new Yt(t)}}}const Gt="investflow_risk_cache",Jt="investflow_advisor_cache",Qt=864e5;let Xt=null,Zt=null;const es=e=>e.map(e=>{const t=e.type===Ye.REAL_ESTATE||e.type===Ye.LIABILITY||e.type===Ye.OTHER?`:${e.currentPrice}`:"";return`${e.symbol}:${e.quantity}:${e.type}${t}`}).sort().join("|"),ts=({onResult:s,onTextResult:n,mode:r,className:i="",variant:l="icon"})=>{const{settings:u,assets:m,t:p}=Dt(),[x,h]=e.useState(!1),[g,b]=e.useState(!1),[f,y]=e.useState(null),v=e.useRef(null),j=e.useRef("");e.useEffect(()=>()=>{if(v.current)try{v.current.stop()}catch(e){}},[]);const N=async e=>{if(!e||!e.trim())return;if("CHAT"===r)return void(n&&n(e));b(!0);const t="deepseek"===u.aiProvider?u.deepSeekApiKey:u.geminiApiKey;try{const n=m.map(e=>({symbol:e.symbol,name:e.name,id:e.id})),i=await(async(e,t,s,n,r=[])=>{if(!s)throw new Error("API Key is missing");const i=`\n      Role: Financial Data Parser.\n      Task: Parse user spoken input into structured JSON for an app called 'InvestFlow'.\n      \n      Time Context: \n      - Current Reference Date/Time: ${(new Date).toISOString()}.\n      - Use this date to correctly resolve relative time terms like "today", "yesterday", "last friday", "5 minutes ago".\n\n      User Input: "${e}"\n      \n      Context Mode: ${t}\n      Existing Assets: ${JSON.stringify(r.map(e=>`${e.symbol} (${e.name})`))}\n\n      Instructions:\n      1. Extract 'symbol', 'quantity', 'price', 'date' (YYYY-MM-DDTHH:mm:ss is preferred if specific time mentioned, else YYYY-MM-DD), 'currency'.\n      2. **INTELLIGENT MAPPING**:\n         - **Symbols**: Use your broad financial knowledge to map spoken company names or asset classes to standard Ticker Symbols (e.g. "Nvidia" -> "NVDA", "Gold" -> "GOLD", "Maotai" -> "600519.SS"). \n         - **Manual Assets**: For Real Estate or unique items, generate a logical, concise uppercase ID (e.g. "APT_NY", "ROLEX_SUB").\n         - **Currencies**: Map spoken currency names (e.g. "RMB", "Bucks", "Yuan") to standard ISO 4217 codes (CNY, USD, HKD, etc.).\n      3. **TRANSACTION MODE**:\n         - If mode is TRANSACTION, map the input to one of the Existing Assets if possible.\n         - Determine 'txType' (BUY, SELL, DIVIDEND). Default to BUY if ambiguous.\n      4. **ASSET MODE**:\n         - Determine 'type' (STOCK, CRYPTO, FUND, CASH, REAL_ESTATE, LIABILITY, OTHER).\n      \n      Return STRICT JSON. No markdown formatting.\n      Fields: symbol, name, type (enum: STOCK, CRYPTO, FUND, CASH, REAL_ESTATE, LIABILITY, OTHER), txType (enum: BUY, SELL, DIVIDEND), quantity (number), price (number), date (string), currency (string).\n    `,l={type:a.OBJECT,properties:{symbol:{type:a.STRING},name:{type:a.STRING},type:{type:a.STRING,enum:["STOCK","CRYPTO","FUND","CASH","REAL_ESTATE","LIABILITY","OTHER"]},txType:{type:a.STRING,enum:["BUY","SELL","DIVIDEND"]},quantity:{type:a.NUMBER},price:{type:a.NUMBER},date:{type:a.STRING},currency:{type:a.STRING}}},o=Wt.create(n,s);return await o.generateJSON(i,l)})(e,r,t,u.aiProvider,n);i&&s&&s(i)}catch(i){y(p("voiceError"))}finally{b(!1)}},w=()=>{if(v.current){try{v.current.stop()}catch(e){}v.current=null,h(!1),setTimeout(()=>{const e=j.current;e&&e.trim().length>0&&N(e)},250)}},S=e=>{if(e.preventDefault(),e.stopPropagation(),v.current)return;j.current="",y(null);const t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t)return void y(p("voiceNoSupport"));if("CHAT"!==r){if(!("deepseek"===u.aiProvider?u.deepSeekApiKey:u.geminiApiKey))return void y(p("apiKeyMissing"))}h(!0);const s=new t;v.current=s,s.continuous=!0,s.interimResults=!0,s.lang="zh"===u.language?"zh-CN":"en-US",s.onresult=e=>{const t=Array.from(e.results).map(e=>e[0].transcript).join("");j.current=t},s.onerror=e=>{if("not-allowed"===e.error||"service-not-allowed"===e.error)return y(p("voicePermissionDenied")),h(!1),void(v.current=null);"no-speech"!==e.error&&y(p("voiceError")),"no-speech"!==e.error&&(h(!1),v.current=null)};try{s.start()}catch(a){h(!1),v.current=null}},A=e=>{e.preventDefault(),e.stopPropagation(),v.current&&w()},T=e=>{e.preventDefault(),e.stopPropagation(),v.current&&w()};return"bar"===l?t.jsxs("div",{className:`relative w-full ${i} select-none touch-none`,children:[f&&t.jsx("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 bg-red-50 text-red-600 text-xs px-3 py-1.5 rounded-lg border border-red-100 shadow-sm whitespace-nowrap z-10 animate-fade-in pointer-events-none",children:f}),g?t.jsxs("div",{className:"flex items-center justify-center gap-2 w-full py-3 bg-slate-100 text-slate-500 rounded-xl font-medium border border-slate-200 cursor-wait",children:[t.jsx(o,{size:16,className:"animate-spin"}),p("processing")]}):t.jsx("button",{type:"button",onMouseDown:S,onMouseUp:A,onMouseLeave:A,onTouchStart:S,onTouchEnd:A,onTouchCancel:A,onContextMenu:T,className:`\n                        w-full py-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2\n                        ${x?"bg-emerald-500 text-white shadow-inner scale-[0.99]":"bg-white border border-slate-300 text-slate-800 shadow-sm active:bg-slate-100"}\n                    `,style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"},children:x?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"relative flex h-3 w-3 mr-1",children:[t.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"}),t.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-white"})]}),t.jsx("span",{children:p("releaseToSend")})]}):t.jsxs(t.Fragment,{children:[t.jsx(c,{size:18,className:"opacity-50"}),t.jsx("span",{children:p("holdToTalk")})]})})]}):t.jsxs("div",{className:`relative flex items-center ${i} select-none`,onClick:e=>e.stopPropagation(),children:[f&&t.jsx("div",{className:"absolute -top-8 right-0 bg-red-50 text-red-600 text-xs px-2 py-1 rounded border border-red-100 whitespace-nowrap z-10 animate-fade-in shadow-sm pointer-events-none",children:f}),g?t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 text-blue-600 rounded-full text-xs font-medium border border-blue-100 animate-pulse",children:[t.jsx(o,{size:14,className:"animate-spin"}),p("processing")]}):t.jsx("button",{type:"button",onMouseDown:S,onMouseUp:A,onMouseLeave:A,onTouchStart:S,onTouchEnd:A,onTouchCancel:A,onContextMenu:T,onClick:e=>{e.preventDefault(),e.stopPropagation()},className:`\n                    flex items-center gap-2 transition-all active:scale-95 touch-none select-none\n                    ${x?"bg-red-500 text-white shadow-md shadow-red-200 ring-4 ring-red-100 scale-105":"text-slate-400 hover:text-blue-600 hover:bg-blue-50"}\n                    ${x?"px-4 py-2 rounded-full":"p-2 rounded-full"}\n                `,style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"},title:p("voiceInput"),children:x?t.jsxs(t.Fragment,{children:[t.jsx(d,{size:16,className:"animate-pulse"}),t.jsx("span",{className:"text-xs font-bold whitespace-nowrap pointer-events-none",children:"zh"===u.language?"松开结束":"Release to Send"})]}):t.jsxs(t.Fragment,{children:[t.jsx(c,{size:20}),t.jsx("span",{className:"sr-only",children:p("holdToTalk")})]})})]})},ss=({input:s,setInput:a,isTyping:n,isVoiceMode:r,setIsVoiceMode:l,selectedImage:o,setSelectedImage:c,handleSend:d,handleFileSelect:h,handlePaste:g,language:b,t:f,isResizing:y})=>{const v=e.useRef(null),j=e.useRef(null);return e.useEffect(()=>{if(j.current){j.current.style.height="auto";const e=Math.min(j.current.scrollHeight,120);j.current.style.height=`${Math.max(24,e)}px`}},[s]),t.jsxs("div",{className:"p-3 bg-white border-t border-slate-200 flex items-end gap-2 shrink-0 pb-6 md:pb-3 transition-all duration-300 relative "+(y?"pointer-events-auto":""),children:[t.jsx("button",{onClick:()=>l(!r),className:"p-2.5 mb-0.5 text-slate-500 hover:text-slate-700 hover:bg-slate-100 rounded-full transition-colors shrink-0",title:f(r?"switchToKeyboard":"switchToVoice"),children:r?t.jsx(u,{size:24}):t.jsx(m,{size:24})}),r?t.jsx("div",{className:"flex-1 animate-in fade-in duration-200 mb-0.5",children:t.jsx(ts,{mode:"CHAT",variant:"bar",onTextResult:e=>d(e)})}):t.jsxs(t.Fragment,{children:[o&&t.jsx("div",{className:"absolute bottom-full left-0 w-full p-2 bg-gradient-to-t from-white to-transparent",children:t.jsxs("div",{className:"relative inline-block",children:[t.jsx("img",{src:o,alt:"Preview",className:"h-20 w-auto object-cover rounded-lg border border-slate-200 shadow-sm bg-white"}),t.jsx("button",{onClick:()=>c(null),className:"absolute -top-2 -right-2 bg-slate-800 text-white rounded-full p-0.5 hover:bg-slate-700 shadow-md border border-white",children:t.jsx(i,{size:12})})]})}),t.jsxs("div",{className:"flex-1 flex gap-2 items-end bg-slate-50 border border-slate-200 rounded-xl px-2 py-2 focus-within:ring-2 focus-within:ring-indigo-500 focus-within:bg-white transition-all",children:[t.jsx("button",{onClick:()=>{var e;return null==(e=v.current)?void 0:e.click()},className:"p-1.5 mb-px text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors shrink-0 self-end",title:"Upload Image",children:t.jsx(p,{size:20})}),t.jsx("input",{type:"file",ref:v,className:"hidden",accept:"image/*",onChange:h}),t.jsx("textarea",{ref:j,value:s,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),n||d())},onPaste:g,placeholder:"zh"===b?"输入消息...":"Type a message...",disabled:n,rows:1,className:"flex-1 bg-transparent border-none p-1.5 text-sm focus:ring-0 resize-none max-h-32 outline-none disabled:opacity-50 overflow-y-auto",style:{minHeight:"24px",lineHeight:"1.5"}})]}),t.jsx("button",{onClick:()=>d(),disabled:!s.trim()&&!o||n,className:"p-3 mb-0.5 bg-indigo-600 text-white rounded-xl shadow-md hover:bg-indigo-700 disabled:bg-slate-200 disabled:text-slate-400 transition-all active:scale-95 flex items-center justify-center shrink-0",children:t.jsx(x,{size:20})})]})]})},as=({items:s,onUpdate:a})=>{const[n,r]=e.useState(!1),l=(e,t,n)=>{const r=[...s];r[e]={...r[e],[t]:n},a(r)},o=e=>t.jsx("div",{className:"overflow-auto "+(e?"max-h-[80vh]":"max-h-[200px]"),children:t.jsxs("table",{className:"w-full text-left text-xs border-collapse",children:[t.jsx("thead",{className:"bg-indigo-50/50 text-indigo-600 font-medium sticky top-0 z-10 backdrop-blur-sm",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-2 border-b border-indigo-100 min-w-[80px]",children:"Symbol"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 min-w-[100px]",children:"Name"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 min-w-[80px]",children:"Type"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 text-right min-w-[60px]",children:"Qty"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 text-right min-w-[80px]",children:"Price"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 min-w-[60px]",children:"Ccy"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 text-right min-w-[100px]",children:"Date"})]})}),t.jsx("tbody",{className:"divide-y divide-indigo-50",children:s.map((e,s)=>t.jsxs("tr",{className:"hover:bg-indigo-50/30 group",children:[t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"text",value:e.symbol||"",onChange:e=>l(s,"symbol",e.target.value),className:"w-full bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors font-medium text-slate-700 uppercase"})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"text",value:e.name||"",onChange:e=>l(s,"name",e.target.value),className:"w-full bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600"})}),t.jsx("td",{className:"p-1",children:t.jsx("select",{value:e.assetType||e.type||Ye.STOCK,onChange:e=>l(s,"assetType",e.target.value),className:"w-full bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600",children:Object.values(Ye).map(e=>t.jsx("option",{value:e,children:e},e))})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"number",value:e.quantity||"",onChange:e=>l(s,"quantity",e.target.value),className:"w-full text-right bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600"})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"number",value:e.price||"",onChange:e=>l(s,"price",e.target.value),className:"w-full text-right bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600"})}),t.jsx("td",{className:"p-1",children:t.jsx("select",{value:e.currency||He.USD,onChange:e=>l(s,"currency",e.target.value),className:"w-full bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600",children:Object.values(He).map(e=>t.jsx("option",{value:e,children:e},e))})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"date",value:e.dateAcquired?e.dateAcquired.split("T")[0]:"",onChange:e=>l(s,"dateAcquired",e.target.value),className:"w-full text-right bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600 text-xs"})})]},s))})]})});return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"relative bg-white/50 rounded-lg border border-indigo-100 overflow-hidden",children:[t.jsx("div",{className:"absolute top-2 right-2 z-20",children:t.jsx("button",{onClick:()=>r(!0),className:"p-1.5 bg-white text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md shadow-sm border border-slate-200 transition-colors",title:"Expand View",children:t.jsx(h,{size:14})})}),o(!1)]}),n&&t.jsx("div",{className:"fixed inset-0 z-[100] bg-slate-900/20 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in duration-200",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-5xl flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-200",children:[t.jsxs("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50 rounded-t-xl",children:[t.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[t.jsx("span",{className:"w-2 h-2 bg-indigo-500 rounded-full"}),"Edit Asset Details"]}),t.jsx("button",{onClick:()=>r(!1),className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:t.jsx(i,{size:20})})]}),t.jsx("div",{className:"p-4 overflow-auto bg-white rounded-b-xl",children:o(!0)}),t.jsx("div",{className:"p-4 border-t border-slate-100 bg-slate-50/50 rounded-b-xl flex justify-end",children:t.jsx("button",{onClick:()=>r(!1),className:"px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 transition-colors shadow-sm",children:"Done"})})]})})]})},ns=({messages:s,isTyping:a,language:r,onUpdatePendingAction:i,onConfirmAction:l,isResizing:o})=>{const c=e.useRef(null);e.useEffect(()=>{var e;null==(e=c.current)||e.scrollIntoView({behavior:"smooth"})},[s,a]);const d=({content:e})=>e?t.jsx("div",{className:"prose prose-sm max-w-none prose-p:leading-relaxed prose-pre:bg-slate-800 prose-pre:text-white prose-p:my-1 prose-ul:my-1 prose-li:my-0",children:t.jsx(De,{children:e})}):null;return t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 bg-slate-50 scroll-smooth "+(o?"pointer-events-auto":""),children:[s.map(e=>t.jsxs("div",{className:"flex gap-3 "+("user"===e.role?"flex-row-reverse":"flex-row"),children:[t.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-sm "+("user"===e.role?"bg-slate-200 text-slate-500":"bg-indigo-100 text-indigo-600"),children:"user"===e.role?t.jsx(g,{size:16}):t.jsx(n,{size:16})}),t.jsxs("div",{className:"max-w-[85%] rounded-2xl p-3.5 text-sm shadow-sm "+("user"===e.role?"bg-slate-200 text-slate-800 rounded-tr-none":"bg-white text-slate-700 border border-slate-200 rounded-tl-none"),children:[e.image&&t.jsx("div",{className:"mb-2",children:t.jsx("img",{src:e.image,alt:"Upload",className:"max-w-full max-h-[200px] rounded-lg border border-slate-300/50"})}),t.jsx(d,{content:e.content}),e.pendingAction&&t.jsxs("div",{className:"mt-2 p-3 rounded-xl animate-fade-in border "+("executed"===e.pendingAction.status?"bg-slate-50 border-slate-200 opacity-80":"bg-indigo-50 border-indigo-100"),children:[t.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[t.jsx("div",{className:("executed"===e.pendingAction.status?"text-green-500":"text-indigo-600")+" mt-0.5 shrink-0",children:"executed"===e.pendingAction.status?t.jsx(b,{size:16}):"BULK_ASSET_UPDATE"===e.pendingAction.type?t.jsx(f,{size:16}):t.jsx(y,{size:16})}),t.jsx("div",{className:"text-xs font-medium "+("executed"===e.pendingAction.status?"text-green-700":"text-indigo-800"),children:"zh"===r?"executed"===e.pendingAction.status?"操作已执行":"需确认操作":"executed"===e.pendingAction.status?"Action Executed":"Action Required"})]}),t.jsx("div",{className:"text-sm font-bold text-slate-800 mb-3 pl-6",children:e.pendingAction.summary}),"BULK_ASSET_UPDATE"===e.pendingAction.type&&e.pendingAction.items&&t.jsx("div",{className:"pl-6 mb-3",children:t.jsx(as,{items:e.pendingAction.items,onUpdate:t=>i(e.id,t)})}),"BULK_ASSET_UPDATE"!==e.pendingAction.type&&t.jsx("div",{className:"pl-6 mb-3",children:t.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs bg-white/50 p-2 rounded-lg border border-indigo-100",children:Object.entries(e.pendingAction.data).map(([e,s])=>null!=s&&"assetId"!==e&&"targetId"!==e?t.jsxs(v.Fragment,{children:[t.jsxs("span",{className:"text-slate-500 font-medium capitalize",children:[e,":"]}),t.jsx("span",{className:"text-slate-800 text-right truncate font-mono",children:s.toString()})]},e):null)})}),"executed"!==e.pendingAction.status&&t.jsx("div",{className:"flex gap-2 pl-6",children:t.jsxs("button",{onClick:()=>l(e.id,e.pendingAction),className:"flex-1 text-white text-xs font-bold py-2 rounded-lg flex items-center justify-center gap-1 transition-colors shadow-sm "+(e.pendingAction.type.includes("DELETE")?"bg-red-500 hover:bg-red-600":"bg-indigo-600 hover:bg-indigo-700"),children:[t.jsx(j,{size:14})," ","zh"===r?"BULK_ASSET_UPDATE"===e.pendingAction.type?"确认导入全部":"执行":"Confirm"]})})]})]})]},e.id)),a&&t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0",children:t.jsx(n,{size:16})}),t.jsxs("div",{className:"bg-white border border-slate-200 rounded-2xl rounded-tl-none p-4 shadow-sm flex items-center gap-1.5 h-10",children:[t.jsx("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce"}),t.jsx("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce delay-100"}),t.jsx("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce delay-200"})]})]}),t.jsx("div",{ref:c})]})},rs="panasset_chat_dim",is=({isOpen:s,onClose:a,isSidebarCollapsed:n=!1})=>{const{t:r}=Dt(),{input:i,setInput:l,isTyping:o,messages:c,isVoiceMode:d,setIsVoiceMode:u,selectedImage:m,setSelectedImage:p,handleSend:x,handleFileSelect:h,handlePaste:g,handleConfirmAction:b,handleUpdatePendingAction:f,handleClearHistory:y,settings:v}=(()=>{const{settings:t,assets:s,transactions:a,addTransaction:n,editTransaction:r,deleteTransaction:i,addAsset:l,editAsset:o,deleteAsset:c}=Dt(),[d,u]=e.useState(""),[m,p]=e.useState(!1),[x,h]=e.useState([]),[g,b]=e.useState(!1),[f,y]=e.useState(null);return e.useEffect(()=>{const e=localStorage.getItem(qt);if(e)try{h(JSON.parse(e))}catch(s){}else h([{id:"init",role:"model",content:"zh"===t.language?"您好！我是您的全能资产助手。您可以发送截图让我识别资产信息，或直接说：“把昨天的苹果买入交易改成 20 股”。":"Hi! I'm your PanassetLite assistant. You can upload screenshots for me to analyze, or say \"Update yesterday's AAPL buy to 20 shares\".",timestamp:Date.now()}])},[t.language]),e.useEffect(()=>{if(x.length>0){const e=x.filter(e=>e.content&&""!==e.content.trim()||e.image||e.pendingAction);localStorage.setItem(qt,JSON.stringify(e.slice(-50)))}},[x]),{input:d,setInput:u,isTyping:m,messages:x,isVoiceMode:g,setIsVoiceMode:b,selectedImage:f,setSelectedImage:y,handleSend:async e=>{const n="string"==typeof e?e:d;if(!(null==n?void 0:n.trim())&&!f)return;const r={id:crypto.randomUUID(),role:"user",content:n.trim(),timestamp:Date.now(),image:f||void 0};h(e=>[...e,r]),"string"!=typeof e&&u("");const i=f;y(null),p(!0);let l=t.geminiApiKey;"qwen"===t.aiProvider?l=t.qwenApiKey:"deepseek"===t.aiProvider&&(l=t.deepSeekApiKey);const o=new Mt(l,t.aiProvider),c=await o.processMessage(r.content,x,s,a,t.baseCurrency,t.language,i||void 0),m={id:crypto.randomUUID(),role:"model",content:c.text||"",timestamp:Date.now(),pendingAction:c.action};p(!1),h(e=>[...e,m])},handleFileSelect:async e=>{if(e.target.files&&e.target.files[0]){const a=e.target.files[0];try{const e=await Ot(a);y(e)}catch(s){alert("zh"===t.language?"图片处理失败":"Failed to process image")}}e.target.value=""},handlePaste:async e=>{const s=e.clipboardData.items;for(let n=0;n<s.length;n++)if(-1!==s[n].type.indexOf("image")){e.preventDefault();const r=s[n].getAsFile();if(r)try{const e=await Ot(r);y(e)}catch(a){alert("zh"===t.language?"图片处理失败":"Failed to process image")}return}},handleConfirmAction:(e,d)=>{try{const{type:u,data:m,targetId:p,items:x}=d;if("BULK_ASSET_UPDATE"===u&&x&&x.length>0){let e=parseInt(Kt.getNextId(s),10);x.forEach(a=>{var r,i;const c=null==(r=a.symbol)?void 0:r.toUpperCase(),d=null==(i=a.name)?void 0:i.toUpperCase();let u=s.find(e=>e.symbol===c);if(!u&&d&&(u=s.find(e=>e.name.toUpperCase()===d)),!u&&c&&c.length>=3&&(u=s.find(e=>e.symbol.includes(c)||c.includes(e.symbol))),!u&&d&&d.length>=4&&(u=s.find(e=>e.name.toUpperCase().includes(d)||d.includes(e.name.toUpperCase()))),u){const e=Number(a.quantity)-u.quantity,t=Number(a.price);a.price&&Math.abs(t-u.currentPrice)>1e-5&&o({...u,currentPrice:t,lastUpdated:Date.now()}),Math.abs(e)>1e-6&&n({assetId:u.id,type:Ve.BALANCE_ADJUSTMENT,date:(new Date).toISOString(),quantityChange:e,pricePerUnit:t||u.currentPrice,fee:0,total:e*(t||u.currentPrice),note:"AI Bulk Import Adjustment"})}else{const s=e.toString();e++;const n={id:s,symbol:c||"UNKNOWN",name:a.name||c||"Unknown Asset",type:a.assetType||Ye.STOCK,currentPrice:Number(a.price)||0,currency:a.currency||t.baseCurrency,lastUpdated:Date.now(),dateAcquired:a.dateAcquired||(new Date).toISOString()};l(n,Number(a.quantity)||0,Number(a.price)||0,n.dateAcquired)}})}else if("ADD_ASSET"===u){const e={id:Kt.getNextId(s),symbol:m.symbol||"UNKNOWN",name:m.name||m.symbol||"Unknown",type:m.type||Ye.STOCK,currentPrice:m.price||0,currency:m.currency||t.baseCurrency,lastUpdated:Date.now(),dateAcquired:m.date||(new Date).toISOString()};l(e,m.quantity||0,m.price||0,e.dateAcquired)}else if("UPDATE_ASSET"===u&&p){const e=s.find(e=>e.id===p);if(e&&(o({...e,name:m.name??e.name,symbol:m.symbol??e.symbol,type:m.type??e.type,currentPrice:void 0!==m.price?m.price:e.currentPrice,currency:m.currency??e.currency}),void 0!==m.quantity&&null!==m.quantity)){const t=Number(m.quantity)-e.quantity;Math.abs(t)>1e-6&&n({assetId:e.id,type:Ve.BALANCE_ADJUSTMENT,date:(new Date).toISOString(),quantityChange:t,pricePerUnit:e.currentPrice,fee:0,total:t*e.currentPrice,note:"AI Assistant Balance Correction"})}}else if("DELETE_ASSET"===u&&p)c(p);else if("ADD_TRANSACTION"===u){let e=m.assetId;if(!e&&m.symbol){e=Kt.getNextId(s);const a={id:e,symbol:m.symbol,name:m.symbol,type:Ye.STOCK,currentPrice:m.price||0,currency:m.currency||t.baseCurrency,lastUpdated:Date.now(),dateAcquired:(new Date).toISOString()};l(a,0,0,a.dateAcquired)}if(e){const t=m.quantity||0,s=m.type===Ve.SELL||m.type===Ve.WITHDRAWAL||m.type===Ve.REPAY;n({assetId:e,type:m.type||Ve.BUY,date:m.date||(new Date).toISOString(),quantityChange:s?-Math.abs(t):Math.abs(t),pricePerUnit:m.price||0,fee:m.fee||0,total:t*(m.price||0)+(m.fee||0)})}}else if("UPDATE_TRANSACTION"===u&&p){const e=a.find(e=>e.id===p);if(e){const t=void 0!==m.quantity?m.quantity:Math.abs(e.quantityChange),s=m.price??e.pricePerUnit,a=m.fee??e.fee,n=m.type??e.type,i=n===Ve.SELL||n===Ve.WITHDRAWAL||n===Ve.REPAY;r({...e,quantityChange:i?-Math.abs(t):Math.abs(t),pricePerUnit:s,date:m.date??e.date,type:n,fee:a,total:t*s+a})}}else"DELETE_TRANSACTION"===u&&p?i(p):"BATCH_DELETE_ASSET"===u&&x&&x.length>0&&x.forEach(e=>{e.id&&c(e.id)});h(t=>t.map(t=>t.id===e?{...t,pendingAction:{...t.pendingAction,status:"executed"}}:t))}catch(u){alert("zh"===t.language?"执行操作失败。":"Failed to execute action.")}},handleUpdatePendingAction:(e,t)=>{h(s=>s.map(s=>s.id===e&&s.pendingAction?{...s,pendingAction:{...s.pendingAction,items:t}}:s))},handleClearHistory:()=>{h([]),localStorage.removeItem(qt)},settings:t}})(),[j,N]=e.useState({width:400,height:600}),[w,S]=e.useState(!1),[A,T]=e.useState(window.innerWidth<768),C=e.useRef(j);e.useEffect(()=>{C.current=j},[j]),e.useEffect(()=>{try{const e=localStorage.getItem(rs);e&&N(JSON.parse(e))}catch(t){}const e=()=>T(window.innerWidth<768);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const D=n?"md:left-24":"md:left-72",I=A?{}:{width:j.width,height:j.height};return s?t.jsxs("div",{onClick:e=>e.stopPropagation(),className:`\n        fixed z-50 flex flex-col overflow-hidden bg-white shadow-2xl transition-all duration-75\n        inset-0 rounded-none \n        md:inset-auto md:bottom-4 md:right-auto md:rounded-2xl md:border md:border-slate-200 ${D}\n        animate-slide-up origin-bottom-left\n        ${w?"pointer-events-none select-none":""}\n    `,style:I,children:[t.jsx(Ft,{language:v.language,onClearHistory:y,onClose:a,isResizing:w,isMobile:A,onResizeStart:e=>{e.preventDefault(),S(!0);const t=e.clientX,s=e.clientY,a=j.width,n=j.height,r=e=>{const r=e.clientX-t,i=e.clientY-s,l=Math.max(320,Math.min(1200,a+r)),o=Math.max(400,Math.min(window.innerHeight-50,n-i));N({width:l,height:o})},i=()=>{S(!1),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i),localStorage.setItem(rs,JSON.stringify(C.current))};window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)}}),t.jsx(ns,{messages:c,isTyping:o,language:v.language,onUpdatePendingAction:f,onConfirmAction:b,isResizing:w}),t.jsx(ss,{input:i,setInput:l,isTyping:o,isVoiceMode:d,setIsVoiceMode:u,selectedImage:m,setSelectedImage:p,handleSend:x,handleFileSelect:h,handlePaste:g,language:v.language,t:r,isResizing:w})]}):null},ls=({className:e="",collapsed:s=!1,title:a,subTitle:n})=>{const r=`cyber-gradient-${v.useId()}`;return s?t.jsx("img",{src:"/PanassetLite/assets/logo-CCnH7EBB.svg",alt:"PanassetLite Logo",className:e,width:32,height:32,style:{objectFit:"contain"}}):t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 180 32",width:"180",height:"32",className:e,children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:r,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#17EAD9"}),t.jsx("stop",{offset:"100%",stopColor:"#6078EA"})]})}),t.jsxs("text",{x:"0",y:"22",fontFamily:"'Inter', sans-serif",fontWeight:"700",fontSize:"18",fill:`url(#${r})`,letterSpacing:"-0.02em",children:[a,".",n]})]})},os=({children:s})=>{const{t:a,settings:r}=Dt(),[l,o]=v.useState(!1),[c,d]=e.useState(!1),[u,m]=e.useState(()=>"true"===localStorage.getItem("investflow_sidebar_collapsed"));e.useEffect(()=>{localStorage.setItem("investflow_sidebar_collapsed",String(u))},[u]);const p=!(!r.geminiApiKey&&!r.deepSeekApiKey),x="zh"===r.language?"盘资产":"Panasset",h="zh"===r.language?"轻":"Lite",g=({to:e,icon:s,label:a,onClick:n})=>t.jsxs(I,{to:e,onClick:n,className:({isActive:e})=>`\n        flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group relative\n        ${e?"bg-blue-600 text-white shadow-md shadow-blue-200":"text-slate-500 hover:bg-slate-100"}\n        ${u?"justify-center px-2":""}\n      `,title:u?a:void 0,children:[t.jsx("div",{className:"shrink-0",children:s}),!u&&t.jsx("span",{className:"font-medium whitespace-nowrap overflow-hidden transition-all duration-300 opacity-100",children:a})]});return t.jsxs("div",{className:"min-h-screen flex bg-[#f8fafc]",children:[t.jsxs("aside",{className:"hidden md:flex flex-col bg-white border-r border-slate-100 h-screen fixed left-0 top-0 z-20 transition-all duration-300 ease-in-out "+(u?"w-20":"w-64"),children:[t.jsx("div",{className:"p-6 flex flex-col justify-center "+(u?"items-center px-0":""),children:t.jsx("button",{onClick:()=>m(!u),className:"transition-all duration-300 hover:opacity-80 focus:outline-none cursor-pointer "+(u?"scale-90":""),title:u?"Expand Sidebar":"Collapse Sidebar",children:t.jsx(ls,{collapsed:u,title:x,subTitle:h})})}),t.jsxs("nav",{className:"flex-1 px-3 space-y-2 mt-2 overflow-y-auto overflow-x-hidden",children:[t.jsx(g,{to:"/",icon:t.jsx(N,{size:20}),label:a("dashboard")}),t.jsx(g,{to:"/assets",icon:t.jsx(w,{size:20}),label:a("assets")}),t.jsx(g,{to:"/history",icon:t.jsx(S,{size:20}),label:a("history")}),t.jsx(g,{to:"/analytics",icon:t.jsx(A,{size:20}),label:a("analytics")}),t.jsx(g,{to:"/settings",icon:t.jsx(T,{size:20}),label:a("settings")})]}),t.jsxs("div",{className:"p-4 border-t border-slate-100 flex flex-col gap-4",children:[p&&t.jsxs("button",{onClick:()=>d(e=>!e),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all border border-transparent ${c?"bg-indigo-600 text-white shadow-md shadow-indigo-200":"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 hover:border-indigo-200"} ${u?"justify-center px-2":""}`,title:a("aiAssistant"),children:[t.jsx(n,{size:20,className:c?"text-white":"text-indigo-600"}),!u&&t.jsx("span",{className:"font-semibold",children:a("aiAssistant")})]}),u?t.jsx("div",{className:"flex flex-col gap-2 items-center",children:t.jsx("a",{href:"https://mp.weixin.qq.com/s/du0wh1As2s-casSadFAgZQ",target:"_blank",rel:"noreferrer",className:"flex justify-center text-slate-400 hover:text-green-600 transition-colors",title:a("about"),children:t.jsx(C,{size:20})})}):t.jsxs("div",{className:"animate-fade-in",children:[t.jsxs("a",{href:"https://mp.weixin.qq.com/s/du0wh1As2s-casSadFAgZQ",target:"_blank",rel:"noreferrer",className:"flex items-center gap-3 text-sm font-medium text-slate-600 hover:text-green-600 transition-colors mb-2 group px-2",children:[t.jsx(C,{size:18,className:"text-slate-400 group-hover:text-green-500 shrink-0"}),t.jsx("span",{className:"whitespace-nowrap",children:a("about")})]}),t.jsx("div",{className:"text-xs text-slate-400 px-2 leading-tight",children:a("disclaimer")})]})]})]}),t.jsxs("div",{className:"md:hidden fixed top-0 left-0 right-0 bg-white z-30 px-4 py-3 border-b border-slate-100 flex justify-between items-center shadow-sm",children:[t.jsx("div",{className:"flex items-center",children:t.jsx(ls,{collapsed:!1,className:"h-8 w-auto",title:x,subTitle:h})}),t.jsxs("div",{className:"flex items-center gap-2",children:[p&&t.jsx("button",{onClick:()=>d(!c),className:"p-2 rounded-lg transition-colors "+(c?"bg-indigo-600 text-white":"text-indigo-600 bg-indigo-50 hover:bg-indigo-100"),children:t.jsx(n,{size:20})}),t.jsx("button",{onClick:()=>o(!l),className:"p-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:l?t.jsx(i,{size:24}):t.jsx(D,{size:24})})]})]}),l&&t.jsx("div",{className:"fixed inset-0 z-20 bg-slate-900/20 backdrop-blur-sm md:hidden pt-16",onClick:()=>o(!1),children:t.jsx("div",{className:"bg-white border-b border-slate-100 shadow-xl p-4 animate-in slide-in-from-top-5 duration-200",onClick:e=>e.stopPropagation(),children:t.jsxs("nav",{className:"space-y-2",children:[t.jsx(g,{to:"/",icon:t.jsx(N,{size:20}),label:a("dashboard"),onClick:()=>o(!1)}),t.jsx(g,{to:"/assets",icon:t.jsx(w,{size:20}),label:a("assets"),onClick:()=>o(!1)}),t.jsx(g,{to:"/history",icon:t.jsx(S,{size:20}),label:a("history"),onClick:()=>o(!1)}),t.jsx(g,{to:"/analytics",icon:t.jsx(A,{size:20}),label:a("analytics"),onClick:()=>o(!1)}),t.jsx(g,{to:"/settings",icon:t.jsx(T,{size:20}),label:a("settings"),onClick:()=>o(!1)}),t.jsx("div",{className:"pt-4 mt-4 border-t border-slate-100 space-y-2",children:t.jsxs("a",{href:"https://mp.weixin.qq.com/s/du0wh1As2s-casSadFAgZQ",target:"_blank",rel:"noreferrer",className:"flex items-center gap-3 px-4 py-3 text-slate-500 hover:bg-slate-50 rounded-xl transition-colors",children:[t.jsx(C,{size:20}),t.jsx("span",{className:"font-medium",children:a("about")})]})})]})})}),t.jsx("main",{className:"flex-1 pt-20 md:pt-8 md:p-8 p-4 w-full transition-all duration-300 ease-in-out "+(u?"md:ml-20":"md:ml-64"),children:s}),p&&t.jsx(is,{isOpen:c,onClose:()=>d(!1),isSidebarCollapsed:u})]})},cs=({title:e,children:s,className:a="",action:n})=>t.jsxs("div",{className:`bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden ${a}`,children:[(e||n)&&t.jsxs("div",{className:"px-4 py-3 sm:px-6 sm:py-4 border-b border-slate-100 flex justify-between items-center",children:[e&&t.jsx("div",{className:"font-semibold text-slate-800 text-base sm:text-lg flex items-center gap-3",children:e}),n&&t.jsx("div",{children:n})]}),t.jsx("div",{className:"p-4 sm:p-6",children:s})]}),ds=({isOpen:e,onClose:s,onConfirm:a,title:n,message:r,confirmText:i="Confirm",cancelText:l="Cancel",isDanger:o=!1})=>e?t.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm transition-all duration-200",children:t.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden transform transition-all scale-100",children:t.jsxs("div",{className:"p-6 text-center",children:[t.jsx("div",{className:"mx-auto w-12 h-12 rounded-full flex items-center justify-center mb-4 "+(o?"bg-red-100 text-red-600":"bg-blue-100 text-blue-600"),children:t.jsx(P,{size:24})}),t.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:n}),t.jsx("p",{className:"text-sm text-slate-500 leading-relaxed mb-6",children:r}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:s,className:"flex-1 px-4 py-2.5 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-colors",children:l}),t.jsx("button",{onClick:()=>{a(),s()},className:"flex-1 px-4 py-2.5 font-medium rounded-xl text-white transition-colors shadow-lg "+(o?"bg-red-600 hover:bg-red-700 shadow-red-200":"bg-blue-600 hover:bg-blue-700 shadow-blue-200"),children:i})]})]})})}):null,us=({isOpen:s,onClose:a,transaction:n})=>{const{editTransaction:r,assets:l,transactions:o,t:c}=Dt(),[d,u]=e.useState(""),[m,p]=e.useState(""),[x,h]=e.useState(""),[g,b]=e.useState("0"),[f,y]=e.useState("0"),[v,j]=e.useState("0"),N=e.useMemo(()=>n&&d?o.filter(e=>e.assetId===n.assetId&&e.id!==n.id&&new Date(e.date).getTime()<new Date(d).getTime()).reduce((e,t)=>e+t.quantityChange,0):0,[o,n,d]);e.useEffect(()=>{if(s&&n){u(n.date),p(Math.abs(n.quantityChange).toString()),h(n.pricePerUnit.toString()),b(n.fee.toString()),y(n.total.toString());const e=o.filter(e=>e.assetId===n.assetId&&e.id!==n.id&&new Date(e.date).getTime()<new Date(n.date).getTime()).reduce((e,t)=>e+t.quantityChange,0);j((e+n.quantityChange).toString())}},[s,n]);const S=(e,t,s,a)=>{switch(a){case Ve.BUY:case Ve.DEPOSIT:case Ve.BORROW:return e*t+s;case Ve.SELL:case Ve.WITHDRAWAL:case Ve.REPAY:case Ve.DIVIDEND:return e*t-s;default:return e*t}},A=e=>{if(p(e),!n)return;const t=parseFloat(e);let s=parseFloat(x);const a=parseFloat(g)||0;if(isNaN(t))return;let r=t;if(n.quantityChange<0&&(r=-t),j((N+r).toString()),isNaN(s)||0===s){const e=(()=>{if(!n)return 0;const e=o.filter(e=>e.assetId===n.assetId&&e.id!==n.id).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());return e.length>0?e[0].pricePerUnit:0})();e>0&&(s=e,h(e.toString()))}if(s>0){const e=S(t,s,a,n.type);y(e.toFixed(2))}};if(!s||!n)return null;const T=l.find(e=>e.id===n.assetId),C=T?T.symbol:"Unknown Asset";return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm transition-opacity",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-slide-up",children:[t.jsxs("div",{className:"px-6 py-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-2 bg-blue-100 text-blue-600 rounded-lg",children:t.jsx(k,{size:18})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-bold text-slate-800",children:c("editTransaction")}),t.jsxs("p",{className:"text-xs text-slate-500",children:[C," • ",c(`tx_${n.type}`)]})]})]}),t.jsx("button",{onClick:a,className:"text-slate-400 hover:text-slate-600",children:t.jsx(i,{size:20})})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=parseFloat(m),s=parseFloat(x),i=parseFloat(g)||0,l=parseFloat(f),o=parseFloat(v);if(isNaN(t)||isNaN(s))return;let c=t;n.type===Ve.BALANCE_ADJUSTMENT?isNaN(o)?n.quantityChange<0&&(c=-t):c=o-N:n.quantityChange<0&&(c=-t),r({...n,date:d,quantityChange:c,pricePerUnit:s,fee:i,total:l}),a()},className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:c("date")}),t.jsxs("div",{className:"relative",children:[t.jsx(E,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"datetime-local",step:"1",value:d,onChange:e=>u(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:c("quantity")}),t.jsxs("div",{className:"relative",children:[t.jsx(L,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:m,onChange:e=>A(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1 flex justify-between",children:[c("balance"),t.jsxs("span",{className:"text-[10px] text-slate-400 font-normal",children:["Prev: ",N.toLocaleString()]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(w,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:v,onChange:e=>(e=>{if(j(e),!n)return;const t=parseFloat(e);if(isNaN(t))return;const s=t-N,a=Math.abs(s);p(a.toString());let r=parseFloat(x);const i=parseFloat(g)||0;if(r>0){const e=S(a,r,i,n.type);y(e.toFixed(2))}})(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:c("pricePerUnit")}),t.jsxs("div",{className:"relative",children:[t.jsx(_,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:x,onChange:e=>(e=>{if(h(e),!n)return;const t=parseFloat(e),s=parseFloat(m),a=parseFloat(g)||0;if(!isNaN(t)&&!isNaN(s)){const e=S(s,t,a,n.type);y(e.toFixed(2))}})(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:c("fees")}),t.jsxs("div",{className:"relative",children:[t.jsx(_,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:g,onChange:e=>(e=>{if(b(e),!n)return;const t=parseFloat(e)||0,s=parseFloat(m),a=parseFloat(x);if(!isNaN(s)&&!isNaN(a)){const e=S(s,a,t,n.type);y(e.toFixed(2))}})(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]})]}),t.jsxs("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2",children:[t.jsx(R,{size:18}),c("saveChanges")]})]})]})})},ms=({options:s,value:a,onChange:n,placeholder:r="Select...",className:i=""})=>{const[l,o]=e.useState(!1),[c,d]=e.useState(""),u=e.useRef(null),m=e.useRef(null);e.useEffect(()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),e.useEffect(()=>{l&&m.current&&m.current.focus()},[l]);const p=e.useMemo(()=>{if(!c)return s;const e=c.toLowerCase();return s.filter(t=>t.label.toLowerCase().includes(e))},[s,c]),x=s.find(e=>e.value===a);return t.jsxs("div",{className:`relative ${i}`,ref:u,children:[t.jsxs("div",{onClick:()=>o(!l),className:`\n                    w-full flex items-center justify-between p-2.5 \n                    bg-slate-50 border border-slate-200 rounded-lg \n                    cursor-pointer hover:bg-slate-100 transition-colors\n                    ${l?"ring-2 ring-blue-500 border-transparent":""}\n                `,children:[t.jsx("span",{className:"block truncate "+(x?"text-slate-700":"text-slate-400"),children:x?x.label:r}),t.jsx(U,{size:16,className:"text-slate-400 transition-transform "+(l?"rotate-180":"")})]}),l&&t.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg max-h-60 overflow-hidden flex flex-col animate-in fade-in zoom-in-95 duration-100",children:[t.jsx("div",{className:"p-2 border-b border-slate-100 bg-slate-50",children:t.jsxs("div",{className:"relative",children:[t.jsx(z,{size:14,className:"absolute left-2.5 top-2.5 text-slate-400"}),t.jsx("input",{ref:m,type:"text",className:"w-full pl-8 pr-3 py-1.5 text-sm bg-white border border-slate-200 rounded-md focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"Search...",value:c,onChange:e=>d(e.target.value),onClick:e=>e.stopPropagation()})]})}),t.jsx("div",{className:"overflow-y-auto flex-1",children:0===p.length?t.jsx("div",{className:"p-3 text-sm text-slate-400 text-center",children:"No results found"}):p.map(e=>t.jsxs("div",{onClick:()=>{return t=e.value,n(t),o(!1),void d("");var t},className:`\n                                        flex items-center justify-between px-3 py-2 text-sm cursor-pointer\n                                        ${e.value===a?"bg-blue-50 text-blue-700 font-medium":"text-slate-700 hover:bg-slate-50"}\n                                    `,children:[t.jsx("span",{children:e.label}),e.value===a&&t.jsx(j,{size:14})]},e.value))})]})]})},ps=()=>{const{transactions:s,assets:a,deleteTransaction:n,settings:i,t:o}=Dt(),[c,d]=e.useState("all"),[u,m]=e.useState("all"),[p,x]=e.useState(""),[h,g]=e.useState(""),[b,f]=e.useState(!1),[y,v]=e.useState(null),[j,N]=e.useState(null),w=e=>{const t=a.find(t=>t.id===e);return t?{symbol:t.symbol,name:t.name,currency:t.currency}:{symbol:"UNKNOWN",name:"Deleted Asset",currency:He.USD}},S=e.useMemo(()=>s.filter(e=>!!e&&(("all"===c||e.assetId===c)&&(("all"===u||e.type===u)&&(!(p&&e.date<p)&&!(h&&e.date>h))))).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[s,c,u,p,h]),A=e=>{switch(e){case Ve.BUY:return"bg-blue-100 text-blue-700";case Ve.DEPOSIT:return"bg-blue-50 text-blue-600";case Ve.SELL:return"bg-purple-100 text-purple-700";case Ve.WITHDRAWAL:return"bg-purple-50 text-purple-600";case Ve.DIVIDEND:return"bg-green-100 text-green-700";case Ve.BORROW:return"bg-amber-100 text-amber-700";case Ve.REPAY:return"bg-indigo-100 text-indigo-700";case Ve.BALANCE_ADJUSTMENT:return"bg-slate-100 text-slate-700 border border-slate-200";default:return"bg-slate-100 text-slate-700"}},T=e=>{switch(e){case Ve.BUY:case Ve.DEPOSIT:return t.jsx($,{size:16});case Ve.SELL:case Ve.WITHDRAWAL:return t.jsx(l,{size:16});case Ve.DIVIDEND:return t.jsx(_,{size:16});case Ve.BORROW:return t.jsx(F,{size:16});case Ve.REPAY:return t.jsx(q,{size:16});case Ve.BALANCE_ADJUSTMENT:return t.jsx(K,{size:14});default:return null}},C=e=>{switch(e){case He.USD:return"$";case He.CNY:return"¥";case He.HKD:return"HK$";default:return"$"}},D=e=>{if(!e)return"-";try{return new Date(e).toLocaleString(void 0,{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e}},I=e.useMemo(()=>{const e=new Map;return a.forEach(t=>e.set(t.id,t)),Array.from(e.values()).sort((e,t)=>e.symbol.localeCompare(t.symbol))},[a]);return t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:o("transactionHistory")}),t.jsx("p",{className:"text-slate-500",children:o("historySubtitle")})]})}),t.jsxs(cs,{children:[t.jsx("div",{className:"md:hidden flex justify-end mb-2",children:t.jsxs("button",{onClick:()=>f(!b),className:"flex items-center gap-2 text-sm font-medium text-slate-600 bg-slate-100 px-3 py-2 rounded-lg hover:bg-slate-200 transition-colors",children:[t.jsx(M,{size:16}),"Filter",b?t.jsx(O,{size:16}):t.jsx(U,{size:16})]})}),t.jsxs("div",{className:(b?"grid":"hidden")+" md:grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6 pb-6 border-b border-slate-100 animate-fade-in",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:o("asset")}),t.jsx(ms,{options:[{value:"all",label:o("allAssets")},...I.map(e=>({value:e.id,label:`${e.symbol} - ${e.name}`}))],value:c,onChange:d,placeholder:o("selectAssetPlaceholder")})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:o("type")}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:u,onChange:e=>m(e.target.value),className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none appearance-none",children:[t.jsx("option",{value:"all",children:o("allTypes")}),t.jsx("option",{value:Ve.BUY,children:o("tx_BUY")}),t.jsx("option",{value:Ve.SELL,children:o("tx_SELL")}),t.jsx("option",{value:Ve.DIVIDEND,children:o("tx_DIVIDEND")}),t.jsx("option",{value:Ve.BALANCE_ADJUSTMENT,children:o("tx_BALANCE_ADJUSTMENT")})]}),t.jsx(M,{className:"absolute right-3 top-3 text-slate-400 pointer-events-none",size:16})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:o("fromDate")}),t.jsx("input",{type:"date",value:p,onChange:e=>x(e.target.value),className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:o("toDate")}),t.jsx("input",{type:"date",value:h,onChange:e=>g(e.target.value),className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),t.jsx("div",{className:"md:hidden space-y-3",children:S.map(e=>{if(!e)return null;const s=w(e.assetId),a=C(s.currency),n=Number(e.pricePerUnit||0),l=Number(e.total||0),c=Number(e.quantityChange||0),d=e.type===Ve.BALANCE_ADJUSTMENT,u=d?c>0?`+${c.toLocaleString()}`:c.toLocaleString():Math.abs(c).toLocaleString(),m=d?c>=0?"text-green-600":"text-red-600":"text-slate-700";return t.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-100 relative group",children:[t.jsx("button",{onClick:()=>v(e.id),className:"absolute top-3 right-3 p-1.5 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:t.jsx(r,{size:16})}),t.jsx("button",{onClick:()=>N(e),className:"absolute top-3 right-10 p-1.5 text-slate-300 hover:text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",children:t.jsx(k,{size:16})}),t.jsx("div",{className:"flex justify-between items-start mb-2 pr-8",children:t.jsxs("div",{children:[t.jsxs("div",{className:"font-bold text-slate-800 text-lg flex items-center gap-2",children:[s.symbol,t.jsx("span",{className:"text-xs font-normal text-slate-400 bg-white px-1.5 py-0.5 rounded border border-slate-100",children:s.name})]}),t.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-500 mt-1",children:[t.jsx(E,{size:12}),D(e.date)]})]})}),t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-bold ${A(e.type)}`,children:[T(e.type),o(`tx_${e.type}`)||e.type]}),t.jsx("div",{className:"text-right",children:t.jsx("div",{className:"font-bold text-lg text-slate-800",children:i.isPrivacyMode?"••••••":`${a}${l.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`})})]}),t.jsxs("div",{className:"pt-3 border-t border-slate-200/50 flex justify-between items-center text-sm",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-xs text-slate-400 uppercase mb-0.5",children:o("quantity")}),t.jsx("span",{className:`font-mono font-medium ${m}`,children:i.isPrivacyMode?"••••••":u})]}),t.jsxs("div",{className:"flex flex-col text-right",children:[t.jsx("span",{className:"text-xs text-slate-400 uppercase mb-0.5",children:o("pricePerUnit")}),t.jsxs("span",{className:"font-mono text-slate-600",children:[a,n.toLocaleString()]})]})]})]},e.id)})}),t.jsx("div",{className:"hidden md:block overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left border-collapse min-w-[800px]",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-xs text-slate-400 uppercase border-b border-slate-100",children:[t.jsx("th",{className:"pb-3 pl-2 font-medium",children:u===Ve.BALANCE_ADJUSTMENT?o("dateRefreshed"):o("date")}),t.jsx("th",{className:"pb-3 font-medium",children:o("asset")}),t.jsx("th",{className:"pb-3 font-medium",children:o("type")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:o("quantity")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:o("pricePerUnit")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:o("fees")}),t.jsx("th",{className:"pb-3 font-medium text-right pr-2",children:o("total")}),t.jsx("th",{className:"pb-3 font-medium text-right pr-2",children:o("actions")})]})}),t.jsx("tbody",{className:"text-sm",children:S.map(e=>{if(!e)return null;const s=w(e.assetId),a=C(s.currency),n=Number(e.pricePerUnit||0),l=Number(e.fee||0),c=Number(e.total||0),d=Number(e.quantityChange||0),u=e.type===Ve.BALANCE_ADJUSTMENT,m=u?d>0?`+${d.toLocaleString()}`:d.toLocaleString():Math.abs(d).toLocaleString(),p=u?d>=0?"text-green-600 font-bold":"text-red-600 font-bold":"text-slate-700";return t.jsxs("tr",{className:"border-b border-slate-50 last:border-0 hover:bg-slate-50/50 transition-colors",children:[t.jsx("td",{className:"py-4 pl-2 text-slate-600 font-mono text-xs whitespace-nowrap",children:D(e.date)}),t.jsxs("td",{className:"py-4",children:[t.jsx("div",{className:"font-semibold text-slate-800",children:s.symbol}),t.jsx("div",{className:"text-xs text-slate-400 hidden sm:block",children:s.name})]}),t.jsx("td",{className:"py-4",children:t.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-medium ${A(e.type)}`,children:[T(e.type),o(`tx_${e.type}`)||e.type]})}),t.jsx("td",{className:`py-4 text-right font-medium ${p}`,children:i.isPrivacyMode?"••••••":"0"!==m?m:"-"}),t.jsxs("td",{className:"py-4 text-right text-slate-600 whitespace-nowrap",children:[a,n.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),t.jsx("td",{className:"py-4 text-right text-slate-500 whitespace-nowrap",children:l>0?`${a}${l.toFixed(2)}`:"-"}),t.jsx("td",{className:"py-4 text-right pr-2 font-bold text-slate-800 whitespace-nowrap",children:i.isPrivacyMode?"••••••":`${a}${c.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),t.jsxs("td",{className:"py-4 text-right pr-2",children:[t.jsx("button",{onClick:()=>N(e),className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors mr-1",title:o("editTransaction"),children:t.jsx(k,{size:16})}),t.jsx("button",{onClick:()=>v(e.id),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:o("deleteTransaction"),children:t.jsx(r,{size:16})})]})]},e.id)})})]})}),0===S.length&&t.jsx("div",{className:"py-12 text-center text-slate-400 italic",children:o("noTransactions")})]}),t.jsx(ds,{isOpen:!!y,onClose:()=>v(null),onConfirm:()=>y&&n(y),title:o("deleteTransaction"),message:o("confirmDeleteTransaction"),confirmText:o("delete"),isDanger:!0}),t.jsx(us,{isOpen:!!j,onClose:()=>N(null),transaction:j})]})};var xs=(e=>(e.LOW="Low",e.MEDIUM="Medium",e.HIGH="High",e))(xs||{});const hs=["USDT","USDC","DAI","BUSD","TUSD","USDD","FRAX","USDP"],gs=["BTC","ETH"];function bs(e){return e.type===Ye.LIABILITY||e.type===Ye.CASH||e.type===Ye.REAL_ESTATE?"Low":e.type===Ye.STOCK||e.type===Ye.FUND?"Medium":e.type===Ye.CRYPTO?function(e){const t=e.toUpperCase().trim();return hs.includes(t)}(e.symbol)?"Low":function(e){const t=e.toUpperCase().trim();return gs.includes(t)}(e.symbol)?"Medium":"High":"Low"}const fs=({data:e,ratio:s,formatCurrency:a,isPrivacyMode:n,t:r})=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsx(cs,{title:r("netWorthStructure"),className:"md:col-span-2 min-w-0",children:t.jsx("div",{className:"h-[200px] w-full min-w-0",children:t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(Pe,{data:e,layout:"vertical",margin:{left:0,right:40,top:0,bottom:0},barSize:32,children:[t.jsx(ke,{strokeDasharray:"3 3",horizontal:!1,stroke:"#f1f5f9"}),t.jsx(Ee,{type:"number",tickFormatter:a,tick:{fontSize:11,fill:"#94a3b8"},axisLine:!1,tickLine:!1}),t.jsx(Le,{dataKey:"name",type:"category",width:70,tick:{fontSize:12,fontWeight:500,fill:"#64748b"},axisLine:!1,tickLine:!1}),t.jsx(_e,{cursor:{fill:"transparent"},contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>a(e)}),t.jsxs(Re,{dataKey:"value",radius:[0,6,6,0],children:[e.map((e,s)=>t.jsx(Ue,{fill:e.fill},`cell-${s}`)),!n&&t.jsx(ze,{dataKey:"value",position:"right",formatter:a,style:{fontSize:"11px",fill:"#64748b",fontWeight:600}})]})]})})})}),t.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 p-5 flex flex-col justify-center items-center md:col-span-1 relative overflow-hidden",children:[t.jsxs("h3",{className:"text-slate-500 text-sm font-medium mb-3 flex items-center gap-2 z-10",children:[t.jsx(B,{size:16})," ",r("debtRatio")]}),t.jsxs("div",{className:"relative z-10 text-center mb-2",children:[t.jsxs("div",{className:"text-3xl font-bold mb-1 "+(s>50?"text-red-500":s>30?"text-orange-500":"text-slate-800"),children:[s.toFixed(1),"%"]}),t.jsx("div",{className:"text-xs px-2 py-1 rounded-full inline-block "+(s>30?"bg-red-50 text-red-600":"bg-green-50 text-green-600"),children:r(s>30?"highLeverage":"healthy")})]}),t.jsx("div",{className:"w-full bg-slate-100 h-1.5 mt-4 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full transition-all duration-1000 "+(s>50?"bg-red-500":"bg-green-500"),style:{width:`${Math.min(s,100)}%`}})})]})]}),ys=({data:e,colors:s,formatCurrency:a,t:n})=>t.jsx(cs,{title:n("assetAllocation"),className:"lg:col-span-1 min-w-0",children:t.jsx("div",{className:"h-[240px] w-full min-w-0",children:t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(Me,{children:[t.jsx(Oe,{data:e,cx:"50%",cy:"50%",innerRadius:55,outerRadius:80,paddingAngle:3,dataKey:"value",children:e.map((e,a)=>t.jsx(Ue,{fill:s[a%s.length],stroke:"none"},`cell-${a}`))}),t.jsx(_e,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>a(e)}),t.jsx(Ke,{verticalAlign:"bottom",height:36,iconType:"circle",iconSize:8,wrapperStyle:{fontSize:"11px"}})]})})})}),vs=({riskProfile:e,riskData:s,loadingRisk:a,riskError:r,onRefreshRisk:i,formatCurrency:l,t:o})=>t.jsx(cs,{className:"lg:col-span-2 min-w-0",title:o("riskAnalysis"),children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-full",children:[t.jsx("div",{className:"h-[240px] min-w-0 flex flex-col justify-center",children:t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(Me,{children:[t.jsx(Oe,{data:e,cx:"50%",cy:"50%",startAngle:180,endAngle:0,innerRadius:60,outerRadius:90,dataKey:"value",paddingAngle:2,children:e.map((e,s)=>t.jsx(Ue,{fill:e.color,stroke:"none"},`cell-risk-${s}`))}),t.jsx(Ke,{verticalAlign:"bottom",iconType:"circle",iconSize:8,wrapperStyle:{fontSize:"11px"}}),t.jsx(_e,{formatter:e=>l(e),contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}})]})})}),t.jsx("div",{className:"flex flex-col justify-center pr-2 py-2",children:t.jsxs("div",{className:"bg-slate-50/50 rounded-2xl p-5 border border-slate-100 h-full flex flex-col relative overflow-hidden",children:[t.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-5",children:t.jsx(n,{size:64,className:"text-purple-600"})}),t.jsxs("div",{className:"flex items-center justify-between mb-4 relative z-10",children:[t.jsxs("h4",{className:"font-semibold text-slate-700 flex items-center gap-2 text-sm",children:[t.jsx("div",{className:"p-1.5 bg-purple-100 text-purple-600 rounded-lg",children:t.jsx(n,{size:14})}),o("aiAssessment")]}),s&&t.jsx("button",{onClick:i,disabled:a,className:"p-1.5 hover:bg-white hover:shadow-sm rounded-lg text-slate-400 hover:text-purple-600 transition-all",title:o("recalculate"),children:t.jsx(K,{size:14,className:a?"animate-spin":""})})]}),t.jsx("div",{className:"flex-1 flex flex-col justify-center relative z-10",children:r?t.jsxs("div",{className:"text-xs text-red-500 bg-red-50 p-3 rounded-lg border border-red-100 text-center",children:[o("unableToGenerate")," ",o("apiKeyMissing")]}):a&&!s?t.jsxs("div",{className:"space-y-3 animate-pulse px-1",children:[t.jsx("div",{className:"h-2 bg-slate-200 rounded w-full"}),t.jsx("div",{className:"h-2 bg-slate-200 rounded w-3/4"}),t.jsx("div",{className:"h-2 bg-slate-200 rounded w-5/6"})]}):s?t.jsxs("div",{className:"animate-fade-in",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("span",{className:"text-xs font-bold px-2.5 py-1 rounded-full border "+(s.riskScore>7?"bg-red-50 text-red-600 border-red-100":s.riskScore>4?"bg-orange-50 text-orange-600 border-orange-100":"bg-green-50 text-green-600 border-green-100"),children:s.riskLevel}),t.jsxs("div",{className:"text-right",children:[t.jsx("span",{className:"text-sm font-bold text-slate-800",children:s.riskScore}),t.jsx("span",{className:"text-xs text-slate-400",children:"/10"})]})]}),t.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden mb-4",children:t.jsx("div",{className:"h-full rounded-full transition-all duration-1000 ease-out "+(s.riskScore>7?"bg-red-500":s.riskScore>4?"bg-orange-500":"bg-green-500"),style:{width:10*s.riskScore+"%"}})}),t.jsxs("div",{className:"text-xs text-slate-600 leading-relaxed italic relative pl-3",children:[t.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-0.5 bg-purple-200 rounded-full"}),s.analysis]})]}):t.jsx("div",{className:"text-center",children:t.jsxs("button",{onClick:i,className:"px-5 py-2.5 bg-white hover:bg-purple-50 text-purple-600 border border-purple-100 hover:border-purple-200 text-sm font-medium rounded-xl transition-all shadow-sm hover:shadow flex items-center gap-2 mx-auto group",children:[t.jsx(Y,{size:16,className:"group-hover:fill-purple-600 transition-colors"}),o("startRiskAnalysis")]})})})]})})]})}),js=({topAssets:e,pnlRanking:s,liabilityDistribution:a,formatCurrency:n,isPrivacyMode:r,t:i})=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(cs,{title:i("costVsValue"),className:"min-w-0",children:t.jsx("div",{className:"h-[250px] w-full min-w-0",children:t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(Pe,{data:e,layout:"vertical",margin:{left:0,right:10,top:0,bottom:0},barGap:2,children:[t.jsx(ke,{strokeDasharray:"3 3",horizontal:!1,stroke:"#f1f5f9"}),t.jsx(Ee,{type:"number",tickFormatter:n,hide:!0}),t.jsx(Le,{dataKey:"name",type:"category",width:50,tick:{fontSize:11,fill:"#64748b"},interval:0}),t.jsx(_e,{cursor:{fill:"transparent"},contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>n(e)}),t.jsx(Ke,{iconSize:8,wrapperStyle:{fontSize:"11px"}}),t.jsx(Re,{dataKey:"cost",name:i("label_cost"),fill:"#cbd5e1",radius:[0,3,3,0],barSize:8}),t.jsx(Re,{dataKey:"value",name:i("label_value"),fill:"#3b82f6",radius:[0,3,3,0],barSize:8})]})})})}),t.jsx(cs,{title:i("topMovers"),className:"min-w-0",children:t.jsx("div",{className:"h-[250px] w-full min-w-0",children:t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(Pe,{data:s,margin:{top:20,bottom:0},children:[t.jsx(ke,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),t.jsx(Ee,{dataKey:"name",tick:{fontSize:11,fill:"#64748b"},axisLine:!1,tickLine:!1}),t.jsx(Le,{hide:!0}),t.jsx(_e,{cursor:{fill:"#f8fafc"},contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>n(e)}),t.jsxs(Re,{dataKey:"pnl",name:i("label_net_pnl"),radius:[4,4,0,0],children:[s.map((e,s)=>t.jsx(Ue,{fill:e.pnl>=0?"#10b981":"#ef4444"},`cell-pnl-${s}`)),!r&&t.jsx(ze,{dataKey:"pnl",position:"top",formatter:e=>new Intl.NumberFormat("en-US",{notation:"compact"}).format(e),style:{fontSize:"10px",fill:"#94a3b8"}})]}),t.jsx(qe,{y:0,stroke:"#cbd5e1"})]})})})}),a.length>0&&t.jsx(cs,{title:i("liabilityBreakdown"),className:"md:col-span-2 min-w-0",children:t.jsx("div",{className:"h-[180px] w-full flex items-center justify-center min-w-0",children:t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(Me,{children:[t.jsx(Oe,{data:a,cx:"50%",cy:"50%",innerRadius:50,outerRadius:70,paddingAngle:5,dataKey:"value",children:a.map((e,s)=>t.jsx(Ue,{fill:s%2==0?"#ef4444":"#f87171",stroke:"none"},`cell-liab-${s}`))}),t.jsx(_e,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>n(e)}),t.jsx(Ke,{iconSize:8,wrapperStyle:{fontSize:"11px"},layout:"vertical",align:"right",verticalAlign:"middle"})]})})})})]}),Ns=["#0ea5e9","#8b5cf6","#10b981","#f59e0b","#ef4444","#6366f1","#f97316"],ws={High:"#ef4444",Medium:"#f59e0b",Low:"#10b981"},Ss=()=>{const{assets:s,settings:n,exchangeRates:r,t:i}=Dt(),[l,o]=e.useState(null),[c,d]=e.useState(!1),[u,m]=e.useState(!1),p=e=>n.isPrivacyMode?"••••••":new Intl.NumberFormat("en-US",{style:"currency",currency:n.baseCurrency,notation:"compact"}).format(e),x=e.useMemo(()=>{const e={};return s.forEach(t=>{if(t.type===Ye.LIABILITY)return;const s=t.quantity*t.currentPrice,a=ft(s,t.currency,n.baseCurrency,r);e[t.type]=(e[t.type]||0)+a}),Object.entries(e).map(([e,t])=>({name:i(`type_${e.toLowerCase()}`),value:t})).sort((e,t)=>t.value-e.value)},[s,n.baseCurrency,r,i]),h=e.useMemo(()=>s.filter(e=>e.type===Ye.LIABILITY).map(e=>{const t=e.quantity*e.currentPrice,s=ft(t,e.currency,n.baseCurrency,r);return{name:e.name||e.symbol,value:s}}).sort((e,t)=>t.value-e.value),[s,n.baseCurrency,r]),g=e.useMemo(()=>{let e=0,t=0;return s.forEach(s=>{const a=s.quantity*s.currentPrice,i=ft(a,s.currency,n.baseCurrency,r);s.type===Ye.LIABILITY?t+=i:e+=i}),{data:[{name:i("label_assets"),value:e,fill:"#10b981"},{name:i("label_liabilities"),value:t,fill:"#ef4444"}],totalAssets:e,totalLiabilities:t,ratio:e>0?t/e*100:0}},[s,n.baseCurrency,r,i]),b=e.useMemo(()=>[...s].filter(e=>e.type!==Ye.LIABILITY).map(e=>{const t=ft(e.quantity*e.currentPrice,e.currency,n.baseCurrency,r),s=ft(e.quantity*e.avgCost,e.currency,n.baseCurrency,r);return{name:e.symbol,value:t,cost:s,pnl:t-s}}).sort((e,t)=>t.value-e.value).slice(0,6),[s,n.baseCurrency,r]),f=e.useMemo(()=>{let e=0,t=0,a=0;s.forEach(s=>{if(s.type===Ye.LIABILITY)return;const i=s.quantity*s.currentPrice,l=ft(i,s.currency,n.baseCurrency,r),o=bs(s);o===xs.HIGH?e+=l:o===xs.MEDIUM?t+=l:a+=l});return 0===e+t+a?[]:[{name:i("risk_high"),value:e,color:ws.High},{name:i("risk_medium"),value:t,color:ws.Medium},{name:i("risk_low"),value:a,color:ws.Low}].filter(e=>e.value>0)},[s,n.baseCurrency,r,i]),y=e.useMemo(()=>[...s].filter(e=>e.type!==Ye.LIABILITY).map(e=>{const t=ft(e.quantity*e.currentPrice,e.currency,n.baseCurrency,r)-ft(e.quantity*e.avgCost,e.currency,n.baseCurrency,r);return{name:e.symbol,pnl:t}}).sort((e,t)=>t.pnl-e.pnl).slice(0,8),[s,n.baseCurrency,r]);return 0===s.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-96 text-slate-400",children:[t.jsx(A,{size:48,className:"mb-4 opacity-50"}),t.jsx("p",{children:i("noAssetsAnalytics")})]}):t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsx("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-2 mb-2",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:i("analytics")}),t.jsx("p",{className:"text-slate-500 text-sm",children:i("analyticsSubtitle")})]})}),t.jsx(fs,{data:g.data,ratio:g.ratio,formatCurrency:p,isPrivacyMode:n.isPrivacyMode,t:i}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx(ys,{data:x,colors:Ns,formatCurrency:p,t:i}),t.jsx(vs,{riskProfile:f,riskData:l,loadingRisk:c,riskError:u,onRefreshRisk:async()=>{if(0===s.length)return;const e="deepseek"===n.aiProvider?n.deepSeekApiKey:n.geminiApiKey;if(e){d(!0),m(!1);try{const t=await(async(e,t,s,n="en",r=!1)=>{if(!t)throw new Error("API Key is missing");if(0===e.length)return null;const i=`${es(e)}:${n}:${s}`,l=Date.now();if(!r){const e=et.getCache(Gt);if(e){const{timestamp:t,data:{hash:s,data:a}}=e;if(s===i&&l-t<36e5)return a}}if(Xt&&Xt.hash===i&&!r)return Xt.promise;const o=(async()=>{const r=e.map(e=>({type:e.type,val:(e.quantity*e.currentPrice).toFixed(0)})),l="zh"===n?"Chinese":"English",o=`\n      Analyze the risk profile of this portfolio: ${JSON.stringify(r)}.\n      \n      **PRIVACY RULE**: Do not mention specific monetary amounts in the 'analysis' text. Use percentages or general terms.\n\n      Classify assets by risk level:\n      - High Risk: Altcoins and volatile cryptocurrencies (excluding stablecoins and BTC/ETH)\n      - Medium Risk: Stocks, Funds, Major Cryptocurrencies (BTC, ETH)\n      - Low/Stable Risk: Cash, Real Estate, Stablecoins (USDT, USDC, DAI, BUSD, etc.)\n      - Liability: Debt (increases overall risk profile if high)\n      \n      Return JSON with a riskScore (1-10) and a brief analysis in ${l}.\n      \n      The JSON keys must be: "riskScore", "riskLevel", "analysis".\n    `,c={type:a.OBJECT,properties:{riskScore:{type:a.NUMBER,description:"1-10 Score (10 is Aggressive)"},riskLevel:{type:a.STRING,description:"Conservative, Balanced, Aggressive"},analysis:{type:a.STRING,description:`Max 60 words summary in ${l}, no specific dollar/currency amounts.`}},required:["riskScore","riskLevel","analysis"]},d=Wt.create(s,t),u=await d.generateJSON(o,c);return et.saveCache(Gt,{hash:i,data:u}),u})();Xt={hash:i,promise:o};try{return await o}finally{Xt=null}})(s,e,n.aiProvider,n.language,!0);o(t)}catch(t){m(!0)}finally{d(!1)}}else m(!0)},formatCurrency:p,t:i})]}),t.jsx(js,{topAssets:b,pnlRanking:y,liabilityDistribution:h,formatCurrency:p,isPrivacyMode:n.isPrivacyMode,t:i})]})},As=()=>{const{assets:s,transactions:a,settings:n,updateSettings:i,importAssetsCSV:l,importTransactionsCSV:o,clearData:c,t:d}=Dt(),[u,m]=e.useState(null),[p,x]=e.useState(!1),h=e.useRef(null),[g,b]=e.useState(!1),[f,y]=e.useState(!1),[v,j]=e.useState(!1),[N,w]=e.useState(!1),[S,A]=e.useState(!1),T=e=>{if(null==e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t},C=e=>{const t=parseFloat(e);return isNaN(t)?0:t},D=e=>{const t=[];let s=0,a=!1;for(let r=0;r<e.length;r++)if('"'===e[r])a=!a;else if(","===e[r]&&!a){let a=e.substring(s,r);a.startsWith('"')&&a.endsWith('"')&&(a=a.slice(1,-1).replace(/""/g,'"')),t.push(a),s=r+1}let n=e.substring(s);return n.startsWith('"')&&n.endsWith('"')&&(n=n.slice(1,-1).replace(/""/g,'"')),t.push(n),t};return t.jsxs("div",{className:"space-y-6 animate-fade-in max-w-3xl mx-auto",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:d("settings")}),t.jsx("p",{className:"text-slate-500",children:d("managePreferences")})]})}),t.jsx(cs,{title:d("privacyDataManagement"),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"p-3 rounded-xl transition-all "+(n.isPrivacyMode?"bg-indigo-600 text-white shadow-md shadow-indigo-200":"bg-slate-100 text-slate-400"),children:n.isPrivacyMode?t.jsx(H,{size:24}):t.jsx(V,{size:24})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-slate-800 text-base",children:d("privacyMode")}),t.jsx("div",{className:"text-sm text-slate-500 mt-1 max-w-sm leading-relaxed",children:d("privacyModeDesc")})]})]}),t.jsx("button",{onClick:()=>i({isPrivacyMode:!n.isPrivacyMode}),className:"relative w-14 h-8 rounded-full transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 "+(n.isPrivacyMode?"bg-indigo-600":"bg-slate-200"),children:t.jsx("span",{className:"absolute top-1 left-1 bg-white w-6 h-6 rounded-full shadow-sm transform transition-transform duration-200 ease-in-out "+(n.isPrivacyMode?"translate-x-6":"translate-x-0")})})]}),t.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 rounded-xl p-4 flex items-start gap-3",children:[t.jsx(W,{size:20,className:"text-emerald-600 mt-0.5 shrink-0"}),t.jsx("span",{className:"text-sm text-emerald-800 leading-relaxed font-medium",children:d("localDataSecurity")})]}),t.jsx("div",{className:"border-t border-slate-200 my-4"}),u&&t.jsxs("div",{className:"p-3 rounded-lg text-sm flex items-center gap-2 "+("success"===u.type?"bg-green-50 text-green-700":"error"===u.type?"bg-red-50 text-red-700":"bg-orange-50 text-orange-700"),children:["success"===u.type?t.jsx(G,{size:16}):t.jsx(P,{size:16}),u.msg]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"group bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100 rounded-xl p-5 hover:shadow-md hover:border-blue-200 transition-all",children:[t.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[t.jsx("div",{className:"p-2.5 bg-blue-500 text-white rounded-lg group-hover:bg-blue-600 transition-colors shadow-sm",children:t.jsx(J,{size:20})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-slate-800 text-sm mb-1",children:d("exportUnified")}),t.jsx("div",{className:"text-xs text-slate-600 leading-relaxed",children:d("exportUnifiedDesc")})]})]}),t.jsxs("button",{onClick:()=>{const e=a.map(e=>{const t=s.find(t=>t.id===e.assetId),a=`\t${e.assetId}`,n=`\t${(null==t?void 0:t.symbol)||"UNKNOWN"}`;return[e.id,e.date,e.type,e.quantityChange,e.pricePerUnit,e.fee,e.total,e.note||"",a,n,(null==t?void 0:t.name)||"Unknown Asset",(null==t?void 0:t.type)||Ye.OTHER,(null==t?void 0:t.currency)||He.USD,(null==t?void 0:t.currentPrice)||0,(null==t?void 0:t.dateAcquired)||""].map(T).join(",")});((e,t)=>{const s=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.setAttribute("download",t),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)})([["tx_id","tx_date","tx_type","tx_quantity","tx_price","tx_fee","tx_total","tx_note","asset_id","asset_symbol","asset_name","asset_type","asset_currency","asset_current_price","asset_date_acquired"].join(","),...e].join("\n"),`panasset_full_data_${(new Date).toISOString().split("T")[0]}.csv`)},className:"w-full py-2.5 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors text-sm shadow-sm flex items-center justify-center gap-2",children:[t.jsx(Q,{size:16}),d("exportUnified")]})]}),t.jsxs("div",{className:"group bg-gradient-to-br from-emerald-50 to-teal-50 border border-emerald-100 rounded-xl p-5 hover:shadow-md hover:border-emerald-200 transition-all",children:[t.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[t.jsx("div",{className:"p-2.5 bg-emerald-500 text-white rounded-lg group-hover:bg-emerald-600 transition-colors shadow-sm",children:t.jsx(X,{size:20})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-slate-800 text-sm mb-1",children:d("importData")}),t.jsx("div",{className:"text-xs text-slate-600 leading-relaxed",children:d("importHint")})]})]}),t.jsxs("button",{onClick:()=>{var e;null==(e=h.current)||e.click()},className:"w-full py-2.5 px-4 bg-emerald-600 hover:bg-emerald-700 text-white font-medium rounded-lg transition-colors text-sm shadow-sm flex items-center justify-center gap-2",children:[t.jsx(X,{size:16}),d("uploadCSV")]}),t.jsx("input",{type:"file",accept:".csv",ref:h,onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;const a=new FileReader;a.onload=e=>{var t;try{const s=(null==(t=e.target)?void 0:t.result).split(/\r?\n/).filter(e=>""!==e.trim());if(s.length<2)throw new Error("File is empty or invalid");const a=D(s[0]).map(e=>e.trim());if(!a.includes("tx_id")||!a.includes("asset_id"))throw new Error("Invalid CSV format. Please use the Unified Export format.");const n=new Map,r=[];s.slice(1).forEach(e=>{const t=D(e),s=e=>{const s=a.indexOf(e);return-1!==s?t[s]:""};let i=s("asset_id");if(i.startsWith("\t")&&(i=i.substring(1)),!i)return;let l=s("asset_symbol")||"UNKNOWN";l.startsWith("\t")&&(l=l.substring(1)),n.has(i)||n.set(i,{id:i,symbol:l,name:s("asset_name")||"Unknown",type:s("asset_type")||Ye.OTHER,currency:s("asset_currency")||He.USD,currentPrice:C(s("asset_current_price")),dateAcquired:s("asset_date_acquired"),lastUpdated:Date.now()});const o=s("tx_id")||crypto.randomUUID();r.push({id:o,assetId:i,type:s("tx_type")||Ve.BUY,date:s("tx_date")||(new Date).toISOString(),quantityChange:C(s("tx_quantity")),pricePerUnit:C(s("tx_price")),fee:C(s("tx_fee")),total:C(s("tx_total")),note:s("tx_note")})});const i=Array.from(n.values()),c=r;l(i),o(c),m({msg:`${d("importSuccess")} (${i.length} Assets, ${c.length} Txs)`,type:"success"}),setTimeout(()=>m(null),5e3)}catch(s){m({msg:d("importError"),type:"error"})}},a.readAsText(s),e.target.value=""},className:"hidden"})]})]}),t.jsx("div",{className:"border-t border-slate-100 my-2"}),t.jsxs("button",{onClick:()=>x(!0),className:"w-full flex items-center justify-center gap-2 p-3 text-red-600 hover:bg-red-50 rounded-xl transition-colors text-sm font-medium",children:[t.jsx(r,{size:16}),d("resetData")]})]})}),t.jsx(cs,{title:d("apiConfiguration"),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 bg-slate-100 text-slate-600 rounded-lg mt-1",children:t.jsx(Z,{size:20})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:d("aiProvider")}),t.jsx("div",{className:"text-sm text-slate-500 mb-3",children:d("aiProviderDesc")}),t.jsxs("div",{className:"mt-6",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select AI Provider"}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:n.aiProvider,onChange:e=>i({aiProvider:e.target.value}),className:"w-full appearance-none bg-white border border-slate-200 text-slate-800 py-3 px-4 pr-8 rounded-xl leading-tight focus:outline-none focus:bg-white focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 transition-all",children:[t.jsx("option",{value:"gemini",children:"Google Gemini"}),t.jsx("option",{value:"deepseek",children:"DeepSeek V3"}),t.jsx("option",{value:"qwen",children:"Qwen (Tongyi Qianwen)"})]}),t.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-700",children:t.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]})]})]})]}),t.jsx("div",{className:"border-t border-slate-100 pt-4"}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 bg-purple-50 text-purple-600 rounded-lg mt-1",children:t.jsx(ee,{size:20})}),t.jsxs("div",{className:"flex-1",children:["gemini"===n.aiProvider&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:d("geminiKey")}),t.jsxs("div",{className:"text-sm text-slate-500 mb-3 bg-blue-50 p-3 rounded-lg border border-blue-100",children:[d("geminiKeyDesc"),t.jsx("div",{className:"mt-1",children:t.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline font-medium",children:d("getKey")})})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:g?"text":"password",name:"gemini_api_key_field",autoComplete:"off",placeholder:"Paste your Gemini API Key here...",value:n.geminiApiKey,onChange:e=>i({geminiApiKey:e.target.value}),className:"w-full p-3 pr-10 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-mono"}),t.jsx("button",{type:"button",onClick:()=>b(!g),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:g?t.jsx(H,{size:18}):t.jsx(V,{size:18})})]})]}),"deepseek"===n.aiProvider&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:d("deepSeekKey")}),t.jsxs("div",{className:"text-sm text-slate-500 mb-3 bg-blue-50 p-3 rounded-lg border border-blue-100",children:[d("deepSeekKeyDesc"),t.jsx("div",{className:"mt-1",children:t.jsx("a",{href:"https://platform.deepseek.com/api_keys",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline font-medium",children:d("getKey")})})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:f?"text":"password",name:"deepseek_api_key_field",autoComplete:"off",placeholder:"Paste your DeepSeek API Key here...",value:n.deepSeekApiKey,onChange:e=>i({deepSeekApiKey:e.target.value}),className:"w-full p-3 pr-10 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-mono"}),t.jsx("button",{type:"button",onClick:()=>y(!f),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:f?t.jsx(H,{size:18}):t.jsx(V,{size:18})})]})]}),"qwen"===n.aiProvider&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:d("qwenKey")}),t.jsxs("div",{className:"text-sm text-slate-500 mb-3 bg-blue-50 p-3 rounded-lg border border-blue-100",children:[d("qwenKeyDesc"),t.jsx("div",{className:"mt-1",children:t.jsx("a",{href:"https://bailian.console.aliyun.com/?apiKey=1",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline font-medium",children:d("getKey")})})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:S?"text":"password",name:"qwen_api_key_field",autoComplete:"off",placeholder:"Paste your Qwen API Key here...",value:n.qwenApiKey,onChange:e=>i({qwenApiKey:e.target.value}),className:"w-full p-3 pr-10 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-mono"}),t.jsx("button",{type:"button",onClick:()=>A(!S),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:S?t.jsx(H,{size:18}):t.jsx(V,{size:18})})]})]})]})]}),t.jsx("div",{className:"border-t border-slate-100 pt-4"}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 bg-slate-100 text-slate-600 rounded-lg mt-1",children:t.jsx(te,{size:20})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:d("marketDataProvider")}),t.jsx("div",{className:"text-sm text-slate-500 mb-3",children:d("marketDataProviderDesc")}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md",children:[t.jsx("label",{className:"border rounded-xl p-4 cursor-pointer transition-all "+("finnhub"===n.marketDataProvider?"border-teal-500 bg-teal-50":"border-slate-200 hover:border-teal-200"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"radio",name:"marketDataProvider",checked:"finnhub"===n.marketDataProvider,onChange:()=>i({marketDataProvider:"finnhub"}),className:"w-4 h-4 text-teal-600 focus:ring-teal-500"}),t.jsx("span",{className:"font-medium text-slate-800",children:"Finnhub"})]})}),t.jsx("label",{className:"border rounded-xl p-4 cursor-pointer transition-all "+("alphavantage"===n.marketDataProvider?"border-orange-500 bg-orange-50":"border-slate-200 hover:border-orange-200"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"radio",name:"marketDataProvider",checked:"alphavantage"===n.marketDataProvider,onChange:()=>i({marketDataProvider:"alphavantage"}),className:"w-4 h-4 text-orange-600 focus:ring-orange-500"}),t.jsx("span",{className:"font-medium text-slate-800",children:"Alpha Vantage"})]})})]})]})]}),t.jsx("div",{className:"border-t border-slate-100 pt-4"}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 bg-slate-50 text-slate-500 rounded-lg mt-1",children:t.jsx(ee,{size:20})}),t.jsx("div",{className:"flex-1",children:"finnhub"===n.marketDataProvider?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:d("finnhubKey")}),t.jsxs("div",{className:"text-sm text-slate-500 mb-3",children:[d("finnhubKeyDesc"),t.jsx("a",{href:"https://finnhub.io/",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline ml-1",children:d("getKey")}),"."]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:v?"text":"password",name:"finnhub_api_key_field",autoComplete:"off",placeholder:"Paste your Finnhub API Key here...",value:n.finnhubApiKey,onChange:e=>i({finnhubApiKey:e.target.value}),className:"w-full p-3 pr-10 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-mono"}),t.jsx("button",{type:"button",onClick:()=>j(!v),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:v?t.jsx(H,{size:18}):t.jsx(V,{size:18})})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:d("alphaVantageKey")}),t.jsxs("div",{className:"text-sm text-slate-500 mb-3",children:[d("alphaVantageKeyDesc"),t.jsx("a",{href:"https://www.alphavantage.co/support/#api-key",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline ml-1",children:d("getKey")}),"."]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:N?"text":"password",name:"alphavantage_api_key_field",autoComplete:"off",placeholder:"Paste your Alpha Vantage API Key here...",value:n.alphaVantageApiKey,onChange:e=>i({alphaVantageApiKey:e.target.value}),className:"w-full p-3 pr-10 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-mono"}),t.jsx("button",{type:"button",onClick:()=>w(!N),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:N?t.jsx(H,{size:18}):t.jsx(V,{size:18})})]})]})})]}),t.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-3 flex items-start gap-3 mt-4",children:[t.jsx(W,{size:16,className:"text-slate-400 mt-0.5 shrink-0"}),t.jsx("span",{className:"text-sm text-slate-500 leading-relaxed",children:d("apiKeysSecurity")})]})]})}),t.jsx(cs,{title:d("generalPreferences"),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-slate-50 last:border-0 last:pb-0",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-50 text-blue-600 rounded-lg",children:t.jsx(se,{size:20})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-slate-800",children:d("baseCurrency")}),t.jsx("div",{className:"text-sm text-slate-500",children:d("baseCurrencyDesc")})]})]}),t.jsxs("select",{value:n.baseCurrency,onChange:e=>i({baseCurrency:e.target.value}),className:"bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 outline-none min-w-[120px]",children:[t.jsx("option",{value:He.USD,children:"USD ($)"}),t.jsx("option",{value:He.CNY,children:"CNY (¥)"}),t.jsx("option",{value:He.HKD,children:"HKD ($)"})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-emerald-50 text-emerald-600 rounded-lg",children:t.jsx(ae,{size:20})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-slate-800",children:d("language")}),t.jsx("div",{className:"text-sm text-slate-500",children:d("languageDesc")})]})]}),t.jsxs("select",{value:n.language,onChange:e=>i({language:e.target.value}),className:"bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 outline-none min-w-[120px]",children:[t.jsx("option",{value:"en",children:"English"}),t.jsx("option",{value:"zh",children:"中文 (简体)"})]})]})]})}),t.jsx(cs,{title:d("feedback"),children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2.5 bg-slate-100 text-slate-700 rounded-lg shrink-0",children:t.jsx(ne,{size:22})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-slate-800",children:d("reportBug")}),t.jsx("div",{className:"text-sm text-slate-500",children:d("githubDesc")})]})]}),t.jsxs("a",{href:"https://github.com/kuka36/PanassetLite/issues",target:"_blank",rel:"noreferrer",className:"px-4 py-2.5 bg-slate-800 hover:bg-slate-900 text-white text-sm font-medium rounded-lg transition-colors flex items-center justify-center gap-2 shrink-0",children:[t.jsx(ne,{size:16}),t.jsx("span",{children:d("githubLinkText")}),t.jsx(re,{size:14,className:"opacity-70"})]})]})}),t.jsx(ds,{isOpen:p,onClose:()=>x(!1),onConfirm:()=>{c(),m({msg:d("resetSuccess"),type:"success"}),setTimeout(()=>m(null),3e3)},title:d("resetData"),message:d("resetConfirm"),confirmText:d("resetData"),isDanger:!0}),t.jsx("div",{className:"text-center text-slate-400 text-sm pt-4",children:"zh"===n.language?"盘资产·轻 v1.2.1 • 本地数据存储":"PanassetLite v1.2.1 • Local Data Storage"})]})},Ts=({asset:s,settings:a,exchangeRates:n,onEdit:i,onTransaction:o,onDelete:c,recentReturn:d,t:u})=>{const{updateAssetPrice:m}=Dt(),[p,x]=e.useState(null),[h,g]=e.useState(""),b=e=>{switch(e){case Ye.STOCK:return"bg-blue-100 text-blue-700";case Ye.CRYPTO:return"bg-purple-100 text-purple-700";case Ye.FUND:return"bg-orange-100 text-orange-700";case Ye.CASH:return"bg-green-100 text-green-700";case Ye.REAL_ESTATE:return"bg-amber-100 text-amber-800";case Ye.LIABILITY:return"bg-red-100 text-red-700";default:return"bg-slate-100 text-slate-700"}},f=e=>e===Ye.STOCK||e===Ye.CRYPTO||e===Ye.FUND,y=e=>{switch(e){case He.USD:return"$";case He.CNY:return"¥";case He.HKD:return"HK$";default:return"$"}},v=e=>{const t=parseFloat(h);isNaN(t)||(m(e,t),x(null))},j=e=>{if(!e)return"N/A";return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},N=y(s.currency),w=y(a.baseCurrency),A=s.quantity*s.currentPrice,T=ft(A,s.currency,a.baseCurrency,n),C=s.quantity*s.avgCost,D=A-C,I=C>0?D/C*100:0,P=s.type===Ye.LIABILITY,k=(E=s.type)===Ye.REAL_ESTATE||E===Ye.LIABILITY||E===Ye.OTHER||E===Ye.CASH;var E;const L=p===s.id,_=f(s.type),R=(e=>{if(!f(e.type))return!1;return Date.now()-(e.lastUpdated||0)>18e5})(s),U=()=>t.jsxs("div",{className:"md:hidden p-4 border-b border-slate-100 hover:bg-slate-50/50 transition-colors",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shrink-0 ${b(s.type)}`,children:s.symbol.substring(0,1)}),t.jsxs("div",{className:"min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"font-bold text-slate-800 text-base",children:s.symbol}),t.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-slate-100 text-slate-500 rounded",children:s.currency})]}),t.jsx("div",{className:"text-xs text-slate-400 truncate max-w-[180px]",children:s.name})]})]}),t.jsx("div",{className:"flex items-center gap-1 shrink-0",children:_?R?t.jsx("span",{className:"text-[10px] text-amber-600 flex items-center gap-1 bg-amber-50 px-1.5 py-0.5 rounded border border-amber-100",children:t.jsx(ie,{size:10})}):t.jsx("span",{className:"text-[10px] text-green-600 flex items-center gap-1 bg-green-50 px-1.5 py-0.5 rounded border border-green-100",children:t.jsx(le,{size:10})}):t.jsx("span",{className:"text-[10px] text-slate-400 flex items-center gap-1 bg-slate-100 px-1.5 py-0.5 rounded border border-slate-200",children:t.jsx(oe,{size:10})})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-slate-400 uppercase mb-1",children:u("currentPrice")}),t.jsxs("div",{className:"font-semibold text-slate-700",children:[N,s.currentPrice.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-slate-400 uppercase mb-1",children:u("avgCost")}),t.jsx("div",{className:"font-semibold text-slate-700",children:a.isPrivacyMode?"••••••":`${N}${s.avgCost.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4})}`})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-slate-400 uppercase mb-1",children:u("holdings")}),t.jsx("div",{className:"font-semibold text-slate-700",children:a.isPrivacyMode?"••••••":s.quantity.toLocaleString(void 0,{maximumFractionDigits:4})})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-slate-400 uppercase mb-1",children:u("value")}),t.jsx("div",{className:"font-bold "+(P?"text-red-700":"text-slate-800"),children:a.isPrivacyMode?"••••••":`${P?"-":""}${w}${T.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:1})}`})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-slate-400 uppercase mb-1",children:u("recentReturn")}),null!=d?t.jsxs("div",{className:"font-semibold "+(d>0?"text-green-600":d<0?"text-red-500":"text-slate-500"),children:[d>0?"+":"",(100*d).toFixed(2),"%"]}):t.jsx("span",{className:"text-slate-300 font-medium",children:"-"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-slate-400 uppercase mb-1",children:u("statusPnL")}),k&&!D?t.jsx("div",{className:"text-xs font-medium text-slate-500",children:j(s.lastUpdated)}):a.isPrivacyMode?t.jsx("span",{className:"text-slate-400 font-bold tracking-widest",children:"••••••"}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-1 font-semibold "+(D>=0?"text-green-600":"text-red-500"),children:[D>=0?t.jsx(l,{size:14}):t.jsx(ce,{size:14}),Math.abs(I).toFixed(2),"%"]}),t.jsxs("div",{className:"text-xs "+(D>=0?"text-green-600/70":"text-red-500/70"),children:[D>=0?"+":"-",N,Math.abs(D).toLocaleString(void 0,{maximumFractionDigits:0})]})]})]})]}),(i||o)&&t.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-slate-100",children:[o&&t.jsxs("button",{onClick:()=>o(s),className:"flex items-center gap-1.5 px-3 py-1.5 text-sm text-green-600 hover:bg-green-50 rounded-lg transition-colors",children:[t.jsx(q,{size:16}),t.jsx("span",{children:u("recordTransaction")})]}),i&&t.jsxs("button",{onClick:()=>i(s),className:"flex items-center gap-1.5 px-3 py-1.5 text-sm text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:[t.jsx(de,{size:16}),t.jsx("span",{children:u("editDetails")})]}),c&&t.jsx("button",{onClick:()=>c(s.id,s.symbol),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:u("delete"),children:t.jsx(r,{size:16})})]})]}),z=()=>t.jsxs("tr",{className:"hidden md:table-row border-b border-slate-50 hover:bg-slate-50/50 transition-colors group",children:[t.jsx("td",{className:"py-4 pl-2",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold text-xs shrink-0 ${b(s.type)}`,children:s.symbol.substring(0,1)}),t.jsxs("div",{className:"min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"font-semibold text-slate-800",children:s.symbol}),t.jsx("span",{className:"text-[10px] px-1 py-0.5 bg-slate-100 text-slate-500 rounded",children:s.currency})]}),t.jsx("div",{className:"text-xs text-slate-400 truncate max-w-[120px]",children:s.name})]})]})}),t.jsx("td",{className:"py-4",children:L?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-slate-400 text-xs",children:N}),t.jsx("input",{type:"number",autoFocus:!0,className:"w-20 p-1 text-sm border border-blue-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",value:h,onChange:e=>g(e.target.value),onKeyDown:e=>{"Enter"===e.key&&v(s.id),"Escape"===e.key&&x(null)},onBlur:()=>v(s.id)})]}):t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"font-medium text-slate-700 flex items-center gap-2",children:[N,s.currentPrice.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:6}),i&&t.jsx("button",{onClick:()=>{return x((e=s).id),void g(e.currentPrice.toString());var e},className:"opacity-0 group-hover:opacity-100 transition-opacity text-slate-300 hover:text-blue-600",title:u("updatePrice"),children:t.jsx(S,{size:14})})]}),t.jsx("div",{className:"flex items-center gap-1 mt-1",children:_?R?t.jsxs("span",{className:"text-[10px] text-amber-600 flex items-center gap-1 bg-amber-50 px-1.5 py-0.5 rounded border border-amber-100",title:u("dataStale"),children:[t.jsx(ie,{size:10})," ",u("offline")]}):t.jsxs("span",{className:"text-[10px] text-green-600 flex items-center gap-1 bg-green-50 px-1.5 py-0.5 rounded border border-green-100",title:u("liveData"),children:[t.jsx(le,{size:10})," ",u("live")]}):t.jsxs("span",{className:"text-[10px] text-slate-400 flex items-center gap-1 bg-slate-100 px-1.5 py-0.5 rounded border border-slate-200",title:u("manualValuation"),children:[t.jsx(oe,{size:10})," ",u("manual")]})})]})}),t.jsx("td",{className:"py-4",children:t.jsx("div",{className:"font-medium text-slate-700",children:a.isPrivacyMode?"••••••":`${N}${s.avgCost.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:6})}`})}),t.jsx("td",{className:"py-4",children:t.jsx("div",{className:"font-medium text-slate-700",children:a.isPrivacyMode?"••••••":s.quantity.toLocaleString()})}),t.jsx("td",{className:"py-4 text-right pr-4",children:null!=d?t.jsxs("div",{className:"font-medium "+(d>0?"text-green-600":d<0?"text-red-500":"text-slate-500"),children:[d>0?"+":"",(100*d).toFixed(2),"%"]}):t.jsx("span",{className:"text-slate-300",children:"-"})}),t.jsx("td",{className:"py-4 text-right pr-2 font-bold "+(P?"text-red-700":"text-slate-800"),children:a.isPrivacyMode?"••••••":`${P?"-":""}${w}${T.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),t.jsx("td",{className:"py-4 text-right pr-2",children:k&&!D?t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"text-xs font-medium text-slate-500 bg-slate-100 inline-block px-2 py-0.5 rounded-md",children:[u("lastUpdated"),": ",j(s.lastUpdated)]})}):a.isPrivacyMode?t.jsx("div",{className:"text-right",children:t.jsx("span",{className:"text-slate-400 font-bold tracking-widest",children:"••••••"})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-end gap-1 font-medium "+(D>=0?"text-green-600":"text-red-500"),children:[D>=0?t.jsx(l,{size:14}):t.jsx(ce,{size:14}),Math.abs(I).toFixed(2),"%"]}),t.jsxs("div",{className:"text-xs "+(D>=0?"text-green-600/70":"text-red-500/70"),children:[D>=0?"+":"-",N,Math.abs(D).toLocaleString(void 0,{maximumFractionDigits:0})]})]})}),(i||o)&&t.jsx("td",{className:"py-4 text-right pr-2",children:t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[o&&t.jsx("button",{onClick:()=>o(s),className:"p-1.5 text-slate-400 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:u("recordTransaction"),children:t.jsx(q,{size:16})}),i&&t.jsx("button",{onClick:()=>i(s),className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:u("editDetails"),children:t.jsx(de,{size:16})}),c&&t.jsx("button",{onClick:()=>c(s.id,s.symbol),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:u("delete"),children:t.jsx(r,{size:16})})]})})]});return t.jsxs(t.Fragment,{children:[t.jsx(U,{}),t.jsx(z,{})]})},Cs=({assetIds:s,title:a})=>{const{transactions:n,assets:i,deleteTransaction:o,settings:c,t:d}=Dt(),[u,m]=e.useState(null),[p,x]=e.useState(null),h=e=>{const t=i.find(t=>t.id===e);return t?{symbol:t.symbol,name:t.name,currency:t.currency}:{symbol:"UNKNOWN",name:"Deleted Asset",currency:He.USD}},g=e.useMemo(()=>n.filter(e=>!!e&&!(s&&s.length>0&&!s.includes(e.assetId))).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()).slice(0,1e3),[n,s]),b=e=>{switch(e){case Ve.BUY:return"bg-blue-100 text-blue-700";case Ve.DEPOSIT:return"bg-blue-50 text-blue-600";case Ve.SELL:return"bg-purple-100 text-purple-700";case Ve.WITHDRAWAL:return"bg-purple-50 text-purple-600";case Ve.DIVIDEND:return"bg-green-100 text-green-700";case Ve.BORROW:return"bg-amber-100 text-amber-700";case Ve.REPAY:return"bg-indigo-100 text-indigo-700";case Ve.BALANCE_ADJUSTMENT:return"bg-slate-100 text-slate-700 border border-slate-200";default:return"bg-slate-100 text-slate-700"}},f=e=>{switch(e){case Ve.BUY:case Ve.DEPOSIT:return t.jsx($,{size:16});case Ve.SELL:case Ve.WITHDRAWAL:return t.jsx(l,{size:16});case Ve.DIVIDEND:return t.jsx(_,{size:16});case Ve.BORROW:return t.jsx(F,{size:16});case Ve.REPAY:return t.jsx(q,{size:16});case Ve.BALANCE_ADJUSTMENT:return t.jsx(K,{size:14});default:return null}},y=e=>{switch(e){case He.USD:return"$";case He.CNY:return"¥";case He.HKD:return"HK$";default:return"$"}},v=e=>{if(!e)return"-";try{return new Date(e).toLocaleString(void 0,{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e}};return 0===g.length?null:t.jsxs(t.Fragment,{children:[t.jsxs(cs,{title:a||d("transactionHistory"),className:"animate-slide-up",children:[t.jsx("div",{className:"md:hidden space-y-3",children:g.map(e=>{if(!e)return null;const s=h(e.assetId),a=y(s.currency),n=Number(e.pricePerUnit||0),i=Number(e.total||0),l=Number(e.quantityChange||0),o=e.type===Ve.BALANCE_ADJUSTMENT,u=o?l>0?`+${l.toLocaleString()}`:l.toLocaleString():Math.abs(l).toLocaleString(),p=o?l>=0?"text-green-600":"text-red-600":"text-slate-700";return t.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-100 relative group",children:[t.jsx("button",{onClick:()=>m(e.id),className:"absolute top-3 right-3 p-1.5 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:t.jsx(r,{size:16})}),t.jsx("button",{onClick:()=>x(e),className:"absolute top-3 right-10 p-1.5 text-slate-300 hover:text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",children:t.jsx(k,{size:16})}),t.jsx("div",{className:"flex justify-between items-start mb-2 pr-8",children:t.jsxs("div",{children:[t.jsxs("div",{className:"font-bold text-slate-800 text-lg flex items-center gap-2",children:[s.symbol,t.jsx("span",{className:"text-xs font-normal text-slate-400 bg-white px-1.5 py-0.5 rounded border border-slate-100",children:s.name})]}),t.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-500 mt-1",children:[t.jsx(E,{size:12}),v(e.date)]})]})}),t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-bold ${b(e.type)}`,children:[f(e.type),d(`tx_${e.type}`)||e.type]}),t.jsx("div",{className:"text-right",children:t.jsx("div",{className:"font-bold text-lg text-slate-800",children:c.isPrivacyMode?"••••••":`${a}${i.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`})})]}),t.jsxs("div",{className:"pt-3 border-t border-slate-200/50 flex justify-between items-center text-sm",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-xs text-slate-400 uppercase mb-0.5",children:d("quantity")}),t.jsx("span",{className:`font-mono font-medium ${p}`,children:c.isPrivacyMode?"••••••":u})]}),t.jsxs("div",{className:"flex flex-col text-right",children:[t.jsx("span",{className:"text-xs text-slate-400 uppercase mb-0.5",children:d("pricePerUnit")}),t.jsxs("span",{className:"font-mono text-slate-600",children:[a,n.toLocaleString()]})]})]})]},e.id)})}),t.jsx("div",{className:"hidden md:block overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-xs text-slate-400 uppercase border-b border-slate-100",children:[t.jsx("th",{className:"pb-3 pl-2 font-medium",children:d("date")}),t.jsx("th",{className:"pb-3 font-medium",children:d("asset")}),t.jsx("th",{className:"pb-3 font-medium",children:d("type")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:d("quantity")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:d("pricePerUnit")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:d("fees")}),t.jsx("th",{className:"pb-3 font-medium text-right pr-2",children:d("total")}),t.jsx("th",{className:"pb-3 font-medium text-right pr-2",children:d("actions")})]})}),t.jsx("tbody",{className:"text-sm",children:g.map(e=>{if(!e)return null;const s=h(e.assetId),a=y(s.currency),n=Number(e.pricePerUnit||0),i=Number(e.fee||0),l=Number(e.total||0),o=Number(e.quantityChange||0),u=e.type===Ve.BALANCE_ADJUSTMENT,p=u?o>0?`+${o.toLocaleString()}`:o.toLocaleString():Math.abs(o).toLocaleString(),g=u?o>=0?"text-green-600 font-bold":"text-red-600 font-bold":"text-slate-700";return t.jsxs("tr",{className:"border-b border-slate-50 last:border-0 hover:bg-slate-50/50 transition-colors",children:[t.jsx("td",{className:"py-4 pl-2 text-slate-600 font-mono text-xs whitespace-nowrap",children:v(e.date)}),t.jsxs("td",{className:"py-4",children:[t.jsx("div",{className:"font-semibold text-slate-800",children:s.symbol}),t.jsx("div",{className:"text-xs text-slate-400 hidden sm:block",children:s.name})]}),t.jsx("td",{className:"py-4",children:t.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-medium ${b(e.type)}`,children:[f(e.type),d(`tx_${e.type}`)||e.type]})}),t.jsx("td",{className:`py-4 text-right font-medium ${g}`,children:c.isPrivacyMode?"••••••":"0"!==p?p:"-"}),t.jsxs("td",{className:"py-4 text-right text-slate-600 whitespace-nowrap",children:[a,n.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),t.jsx("td",{className:"py-4 text-right text-slate-500 whitespace-nowrap",children:i>0?`${a}${i.toFixed(2)}`:"-"}),t.jsx("td",{className:"py-4 text-right pr-2 font-bold text-slate-800 whitespace-nowrap",children:c.isPrivacyMode?"••••••":`${a}${l.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),t.jsxs("td",{className:"py-4 text-right pr-2",children:[t.jsx("button",{onClick:()=>x(e),className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors mr-1",title:d("editTransaction"),children:t.jsx(k,{size:16})}),t.jsx("button",{onClick:()=>m(e.id),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:d("deleteTransaction"),children:t.jsx(r,{size:16})})]})]},e.id)})})]})})]}),t.jsx(ds,{isOpen:!!u,onClose:()=>m(null),onConfirm:()=>u&&o(u),title:d("deleteTransaction"),message:d("confirmDeleteTransaction"),confirmText:d("delete"),isDanger:!0}),t.jsx(us,{isOpen:!!p,onClose:()=>x(null),transaction:p})]})},Ds=({assets:s,onEdit:a,onTransaction:n})=>{const{assets:r,transactions:i,deleteAsset:l,settings:o,exchangeRates:c,t:d}=Dt(),u=s||r,[m,p]=e.useState({key:"value",direction:"desc"}),[x,h]=e.useState(null),g=e=>{const t=i.filter(t=>t.assetId===e).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());if(t.length<2)return null;const s=t[0],a=t[1],n=u.find(t=>t.id===e);if(!n||0===n.quantity)return null;const r=s.quantityChange,l=Math.abs(new Date(s.date).getTime()-new Date(a.date).getTime())/864e5;if(0===l)return 0;return r/n.quantity/l*365},b=e.useMemo(()=>{const e=[...u];return e.sort((e,t)=>{let s=0,a=0;const n=e=>e.quantity*e.currentPrice-e.quantity*e.avgCost;switch(m.key){case"symbol":s=e.symbol.toLowerCase(),a=t.symbol.toLowerCase();break;case"price":s=e.currentPrice,a=t.currentPrice;break;case"cost":s=e.avgCost,a=t.avgCost;break;case"quantity":s=e.quantity,a=t.quantity;break;case"value":const r=ft(e.quantity*e.currentPrice,e.currency,o.baseCurrency,c),i=ft(t.quantity*t.currentPrice,t.currency,o.baseCurrency,c);s=e.type===Ye.LIABILITY?-r:r,a=t.type===Ye.LIABILITY?-i:i;break;case"pnl":s=n(e),a=n(t);break;case"recentReturn":s=g(e.id)||-1/0,a=g(t.id)||-1/0;break;default:return 0}return s<a?"asc"===m.direction?-1:1:s>a?"asc"===m.direction?1:-1:0}),e},[u,i,m,o.baseCurrency,c]),f=({label:e,sortKey:s,alignRight:a=!1,className:n=""})=>{return t.jsx("th",{className:`pb-3 font-medium cursor-pointer group select-none ${a?"text-right":"text-left"} ${a?"pr-2":"pl-2"} ${n}`,onClick:()=>{return e=s,void p(t=>({key:e,direction:t.key===e&&"desc"===t.direction?"asc":"desc"}));var e},children:t.jsxs("div",{className:`flex items-center gap-1 ${a?"justify-end":"justify-start"} text-slate-500 group-hover:text-blue-600 transition-colors`,children:[e,t.jsx("span",{className:"text-slate-400 group-hover:text-blue-500",children:(r=s,m.key!==r?t.jsx("div",{className:"w-3 h-3"}):"asc"===m.direction?t.jsx(ue,{size:12}):t.jsx(me,{size:12}))})]})});var r};return t.jsxs(t.Fragment,{children:[t.jsxs(cs,{title:d("portfolioHoldings"),className:"animate-slide-up",children:[t.jsx("div",{className:"hidden md:block overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-xs text-slate-400 uppercase border-b border-slate-100",children:[t.jsx(f,{label:d("asset"),sortKey:"symbol"}),t.jsx(f,{label:d("currentPrice"),sortKey:"price"}),t.jsx(f,{label:d("avgCost"),sortKey:"cost"}),t.jsx(f,{label:d("holdings"),sortKey:"quantity"}),t.jsx(f,{label:d("recentReturn"),sortKey:"recentReturn",alignRight:!0}),t.jsx(f,{label:d("value"),sortKey:"value",alignRight:!0}),t.jsx(f,{label:d("statusPnL"),sortKey:"pnl",alignRight:!0}),(a||n)&&t.jsx("th",{className:"pb-3 font-medium text-right pr-2",children:d("actions")})]})}),t.jsxs("tbody",{className:"text-sm",children:[b.map(e=>t.jsx(Ts,{asset:e,settings:o,exchangeRates:c,onEdit:a,onTransaction:n,onDelete:(e,t)=>h({id:e,symbol:t}),recentReturn:g(e.id),t:d},e.id)),0===b.length&&t.jsx("tr",{children:t.jsx("td",{colSpan:a?8:7,className:"text-center py-8 text-slate-400 italic",children:d("noAssets")})})]})]})}),t.jsxs("div",{className:"md:hidden",children:[b.map(e=>t.jsx(Ts,{asset:e,settings:o,exchangeRates:c,onEdit:a,onTransaction:n,onDelete:(e,t)=>h({id:e,symbol:t}),recentReturn:g(e.id),t:d},e.id)),0===b.length&&t.jsx("div",{className:"text-center py-8 text-slate-400 italic",children:d("noAssets")})]})]}),t.jsx(Cs,{assetIds:b.map(e=>e.id),title:d("relatedTransactions")}),t.jsx(ds,{isOpen:!!x,onClose:()=>h(null),onConfirm:()=>x&&l(x.id),title:d("delete"),message:x?d("confirmDelete").replace("{symbol}",x.symbol):"",confirmText:d("delete"),isDanger:!0})]})},Is=e=>{const t=e=>e.toString().padStart(2,"0");return`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())}T${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}`},Ps=({isOpen:s,onClose:a,initialAsset:n})=>{var r;const{addAsset:l,editAsset:o,addTransaction:c,t:d,assets:u}=Dt(),[m,p]=e.useState(1),[x,h]=e.useState(Ye.STOCK),[g,b]=e.useState(""),[f,y]=e.useState(""),[v,j]=e.useState(""),[N,w]=e.useState(""),[S,T]=e.useState(""),[C,D]=e.useState(He.USD),[I,P]=e.useState(""),[L,_]=e.useState(!1),[U,z]=e.useState(!1),[M,O]=e.useState(""),K=[{id:Ye.STOCK,label:d("type_stock"),icon:pe,desc:"US, HK, CN Stocks",color:"bg-blue-50 text-blue-600 border-blue-200"},{id:Ye.CRYPTO,label:d("type_crypto"),icon:xe,desc:"Coins & Tokens",color:"bg-purple-50 text-purple-600 border-purple-200"},{id:Ye.FUND,label:d("type_fund"),icon:A,desc:"Mutual Funds",color:"bg-orange-50 text-orange-600 border-orange-200"},{id:Ye.REAL_ESTATE,label:d("type_real_estate"),icon:he,desc:"Property",color:"bg-emerald-50 text-emerald-600 border-emerald-200"},{id:Ye.CASH,label:d("type_cash"),icon:ge,desc:"Fiat Reserves",color:"bg-green-50 text-green-600 border-green-200"},{id:Ye.LIABILITY,label:d("type_liability"),icon:F,desc:"Loans & Debt",color:"bg-red-50 text-red-600 border-red-200"},{id:Ye.OTHER,label:d("type_other"),icon:be,desc:"Art, Watches...",color:"bg-slate-50 text-slate-600 border-slate-200"}];e.useEffect(()=>{s&&(n?(h(n.type),b(n.symbol),y(n.name),j(n.quantity.toString()),w(n.avgCost.toString()),T(n.currentPrice.toString()),D(n.currency),P(n.dateAcquired||Is(new Date)),_(!!n.isManualPrice||ot.includes(n.symbol)),p(2),z(!1)):(p(1),h(Ye.STOCK),b(""),y(""),j(""),w(""),T(""),D(He.USD),P(Is(new Date)),_(!1),z(!1)))},[s,n]);if(!s)return null;const q=e=>e===Ye.REAL_ESTATE||e===Ye.LIABILITY||e===Ye.OTHER,$=q(x)||L,B=e=>{if(e.preventDefault(),U&&n){const e=parseFloat(M);if(isNaN(e))return;const t=e-n.quantity;if(0===t)return void z(!1);c({assetId:n.id,type:Ve.BALANCE_ADJUSTMENT,date:I,quantityChange:t,pricePerUnit:n.avgCost,fee:0,total:t*n.avgCost,note:"Manual Balance Correction"})}const t=parseFloat(v);let s=parseFloat(N),r=parseFloat(S);if($?(isNaN(s)&&!isNaN(r)&&(s=r),isNaN(r)&&!isNaN(s)&&(r=s)):isNaN(r)&&(r=s||0),!g)return;const i={id:n?n.id:Kt.getNextId(u),symbol:g.toUpperCase(),name:f||g.toUpperCase(),type:x,currentPrice:r||0,currency:C,lastUpdated:Date.now(),dateAcquired:I,isManualPrice:L};if(n)$||(i.currentPrice=n.currentPrice),o(i);else{if(isNaN(t))return;l(i,t,s||0,I)}a()};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm transition-opacity",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-xl overflow-hidden flex flex-col max-h-[90vh]",children:[t.jsxs("div",{className:"px-6 py-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center shrink-0",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:d(n?"editHolding":1===m?"selectAssetType":"assetDetails")}),t.jsx("p",{className:"text-xs text-slate-500",children:n?"Edit metadata or adjust balance":1===m?d("whatKind"):`${d("enterDetails")} ${null==(r=K.find(e=>e.id===x))?void 0:r.label}`})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[!n&&t.jsx(ts,{mode:"ASSET",onResult:e=>{if(e.symbol&&b(e.symbol),e.name&&y(e.name),e.type&&(h(e.type),p(2)),e.quantity&&j(e.quantity.toString()),e.price){const t=e.price.toString();w(t),T(t)}e.date&&P(e.date),e.currency&&D(e.currency)}}),t.jsx("button",{onClick:a,className:"text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-200 rounded-full transition-colors",children:t.jsx(i,{size:20})})]})]}),t.jsxs("div",{className:"overflow-y-auto p-6",children:[1===m&&!n&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:K.map(e=>t.jsxs("button",{onClick:()=>{h(e.id),p(2)},className:"flex flex-col items-center justify-center p-4 rounded-xl border transition-all hover:scale-[1.02] "+(e.id===x?"ring-2 ring-blue-500 bg-blue-50/50 border-blue-200":"bg-white border-slate-100 hover:border-slate-300 hover:shadow-md"),children:[t.jsx("div",{className:`p-3 rounded-full mb-3 ${e.color}`,children:t.jsx(e.icon,{size:24})}),t.jsx("span",{className:"font-semibold text-slate-700 text-sm",children:e.label}),t.jsx("span",{className:"text-[10px] text-slate-400 mt-1",children:e.desc})]},e.id))})}),(2===m||n)&&t.jsxs("form",{id:"asset-form",onSubmit:B,className:"space-y-5",children:[t.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100 space-y-4",children:[t.jsx("div",{className:"flex justify-between items-center mb-2",children:t.jsx("h3",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:d("identification")})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:d("tickerLabel")}),t.jsx("input",{type:"text",value:g,onChange:e=>b(e.target.value.toUpperCase()),className:"w-full p-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none font-medium",autoFocus:!n,required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:d("nameLabel")}),t.jsx("input",{type:"text",value:f,onChange:e=>y(e.target.value),className:"w-full p-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]})]}),t.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100 space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:d("valuationHoldings")}),!q(x)&&t.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-500 cursor-pointer select-none hover:text-blue-600 transition-colors",children:[t.jsx("input",{type:"checkbox",checked:L,onChange:e=>_(e.target.checked),className:"rounded border-slate-300 text-blue-600 focus:ring-blue-500 w-3.5 h-3.5"}),d("manualPrice")]})]}),U&&t.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-100 mb-2 animate-fade-in",children:[t.jsx("label",{className:"block text-xs font-bold text-blue-700 uppercase mb-1",children:d("newCorrectQuantity")}),t.jsx("input",{type:"number",step:"any",placeholder:d("enterActualQuantity"),value:M,onChange:e=>O(e.target.value),className:"w-full p-2 bg-white border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 outline-none font-bold text-blue-900",autoFocus:!0}),t.jsx("p",{className:"text-[10px] text-blue-600 mt-1",children:d("adjustmentHint")})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:d(U?"dateRefreshed":"dateAcquired")}),t.jsxs("div",{className:"relative",children:[t.jsx(E,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"datetime-local",step:"1",value:I,onChange:e=>P(e.target.value),className:"w-full pl-9 p-2.5 bg-white border border-slate-200 rounded-lg outline-none"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex items-center justify-between text-xs font-medium text-slate-500 uppercase mb-1",children:[x===Ye.CASH?d("balance"):x===Ye.LIABILITY?d("principalRemaining"):d("quantity"),n&&!U&&t.jsxs("button",{type:"button",onClick:()=>z(!0),className:"text-[10px] normal-case text-blue-600 hover:bg-blue-50 px-1.5 py-0.5 rounded flex items-center gap-1 transition-colors",children:[t.jsx(k,{size:10})," ",d("adjustButton")]})]}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:v,onChange:e=>j(e.target.value),disabled:!!n,className:"w-full p-2.5 bg-white border border-slate-200 rounded-lg outline-none disabled:bg-slate-100 disabled:text-slate-500",required:!n})]}),$?t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:d("unitPrice")}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("select",{value:C,onChange:e=>D(e.target.value),className:"w-24 p-2.5 bg-white border border-slate-200 rounded-lg outline-none text-sm",children:Object.values(He).map(e=>t.jsx("option",{value:e,children:e},e))}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:S,onChange:e=>T(e.target.value),className:"flex-1 p-2.5 bg-white border border-slate-200 rounded-lg outline-none"})]})]}):t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:x===Ye.CASH?d("costBasis"):d("avgCostUnit")}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("select",{value:C,onChange:e=>D(e.target.value),className:"w-24 p-2.5 bg-white border border-slate-200 rounded-lg outline-none text-sm",children:Object.values(He).map(e=>t.jsx("option",{value:e,children:e},e))}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:N,onChange:e=>w(e.target.value),disabled:!!n,className:"flex-1 p-2.5 bg-white border border-slate-200 rounded-lg outline-none disabled:bg-slate-100 disabled:text-slate-500"})]})]})]})]})]})]}),(2===m||n)&&t.jsx("div",{className:"p-6 pt-0 bg-white shrink-0",children:t.jsxs("button",{onClick:B,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2",children:[t.jsx(R,{size:18}),d(U?"confirmAdjustment":n?"saveChanges":"addToPortfolio")]})})]})})},ks=({isOpen:s,onClose:a,preselectedAssetId:n})=>{const{assets:r,addTransaction:l,t:o}=Dt(),[c,d]=e.useState(""),[u,m]=e.useState(Ve.BUY),[p,x]=e.useState(""),[h,g]=e.useState(""),[b,f]=e.useState(""),[y,v]=e.useState("0");if(e.useEffect(()=>{if(s){d(n||"");const e=r.find(e=>e.id===n);(null==e?void 0:e.type)===Ye.LIABILITY?m(Ve.BORROW):(null==e?void 0:e.type)===Ye.CASH?m(Ve.DEPOSIT):m(Ve.BUY),x((e=>{const t=e=>e.toString().padStart(2,"0");return`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())}T${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}`})(new Date)),g(""),f(""),v("0")}},[s,n,r]),!s)return null;const j=r.sort((e,t)=>e.symbol.localeCompare(t.symbol)),N=r.find(e=>e.id===c),w=(e=>{const t=[Ve.BUY,Ve.SELL];if(!e)return t;switch(e){case Ye.STOCK:case Ye.FUND:return[...t,Ve.DIVIDEND];case Ye.LIABILITY:return[Ve.BORROW,Ve.REPAY];case Ye.CASH:return[Ve.DEPOSIT,Ve.WITHDRAWAL];default:return[...t,Ve.DIVIDEND]}})(null==N?void 0:N.type);return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm transition-opacity",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-slide-up",children:[t.jsxs("div",{className:"px-6 py-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-2 bg-blue-100 text-blue-600 rounded-lg",children:t.jsx(q,{size:18})}),t.jsx("h2",{className:"text-lg font-bold text-slate-800",children:o("recordTransaction")})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[!n&&t.jsx(ts,{mode:"TRANSACTION",onResult:e=>{if(e.symbol){const t=j.find(t=>t.symbol===e.symbol);t&&d(t.id)}e.txType&&m(e.txType),e.quantity&&g(e.quantity.toString()),e.price&&f(e.price.toString()),e.date&&x(e.date)}}),t.jsx("button",{onClick:a,className:"text-slate-400 hover:text-slate-600",children:t.jsx(i,{size:20})})]})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=parseFloat(h),s=parseFloat(b),n=parseFloat(y)||0;if(!c||isNaN(t)||isNaN(s))return;let r=t;u!==Ve.SELL&&u!==Ve.WITHDRAWAL&&u!==Ve.REPAY||(r=-t),l({assetId:c,type:u,date:p,quantityChange:r,pricePerUnit:s,fee:n,total:t*s+n}),a()},className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:o("asset")}),t.jsxs("select",{value:c,onChange:e=>d(e.target.value),className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-500",required:!0,disabled:!!n,children:[t.jsx("option",{value:"",disabled:!0,children:o("selectAssetPlaceholder")}),j.map(e=>t.jsxs("option",{value:e.id,children:[e.symbol," - ",e.name]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:o("action")}),t.jsx("div",{className:"flex flex-wrap gap-1 p-1 bg-slate-100 rounded-lg",children:w.map(e=>t.jsx("button",{type:"button",onClick:()=>m(e),className:"flex-1 min-w-[60px] py-2 text-[10px] sm:text-xs font-bold rounded-md transition-all "+(u===e?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"),children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:o("date")}),t.jsxs("div",{className:"relative",children:[t.jsx(E,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"datetime-local",step:"1",value:p,onChange:e=>x(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:o("quantity")}),t.jsxs("div",{className:"relative",children:[t.jsx(L,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:h,onChange:e=>g(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:o("pricePerUnit")}),t.jsxs("div",{className:"relative",children:[t.jsx(_,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:b,onChange:e=>f(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:o("fees")}),t.jsxs("div",{className:"relative",children:[t.jsx(_,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:y,onChange:e=>v(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),t.jsxs("div",{className:"p-3 bg-slate-100 rounded-lg flex justify-between items-center text-sm",children:[t.jsx("span",{className:"text-slate-500 font-medium",children:o("totalEstimate")}),t.jsxs("span",{className:"font-bold text-slate-800",children:["$",((parseFloat(h)||0)*(parseFloat(b)||0)+(parseFloat(y)||0)).toLocaleString(void 0,{minimumFractionDigits:2})]})]}),t.jsxs("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2",children:[t.jsx(R,{size:18}),o("recordTransaction")]})]})]})})};const Es=e=>`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`,Ls=({assets:s,transactions:a,baseCurrency:n,exchangeRates:r,isPrivacyMode:i,t:l,initialRange:o="1M"})=>{const{settings:c}=Dt(),[d,u]=e.useState(o),[m,p]=e.useState({}),[x,h]=e.useState(!1),[g,b]=e.useState(!1);e.useEffect(()=>{let e=!0;return(async()=>{if(0===s.length)return;h(!0);const t={},n={provider:c.marketDataProvider||"finnhub",alphaVantageKey:c.alphaVantageApiKey,finnhubKey:c.finnhubApiKey},r=s.map(async e=>{if(e.type===Ye.REAL_ESTATE||e.type===Ye.LIABILITY||e.type===Ye.OTHER||e.type===Ye.CASH)return{id:e.id,data:[]};if(!m[e.id]||0===m[e.id].length)try{const t=function(e,t,s){const a=s.filter(t=>t.assetId===e);if(a.length>0){const e=a.reduce((e,t)=>t.date<e.date?t:e),t=new Date(e.date);return t.setDate(t.getDate()-7),t}if(t){const e=new Date(t);return e.setDate(e.getDate()-7),e}const n=new Date;return n.setFullYear(n.getFullYear()-5),n}(e.id,e.dateAcquired,a);return{id:e.id,data:await bt(e,n,t)}}catch(t){return"finnhub"===n.provider&&(null==t?void 0:t.category)===We.ACCESS_DENIED&&b(!0),{id:e.id,data:[]}}return{id:e.id,data:m[e.id]}}),i=await Promise.all(r);e&&(i.forEach(e=>t[e.id]=e.data),p(t),h(!1))})(),()=>{e=!1}},[s.length,c.marketDataProvider,c.alphaVantageApiKey,c.finnhubApiKey]);const f=e=>i?"••••••":new Intl.NumberFormat("en-US",{style:"currency",currency:n,notation:"compact",maximumFractionDigits:1}).format(e),y=e.useMemo(()=>{const e={};return Object.keys(m).forEach(t=>{const s=m[t],a=new Map;[...s].sort((e,t)=>e.date.localeCompare(t.date)).forEach(e=>{a.set(e.date,e.price)}),e[t]=a}),e},[m]),v=e.useMemo(()=>{if(0===s.length)return[];const e=a||[],t=new Set(e.map(e=>e.assetId)),i=[];s.forEach(e=>{if(!t.has(e.id)){const t=e.dateAcquired||Es(new Date);i.push({id:`synthetic-${e.id}`,assetId:e.id,type:e.type===Ye.LIABILITY?Ve.BORROW:Ve.BUY,date:t,quantityChange:e.quantity,pricePerUnit:e.avgCost,fee:0,total:e.quantity*e.avgCost})}});const l=[...e,...i].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),o=new Date,c=new Date,u=l.length>0?Math.min(...l.map(e=>new Date(e.date).getTime())):o.getTime(),p=new Date(u);switch(d){case"1W":c.setDate(o.getDate()-7);break;case"1M":c.setDate(o.getDate()-30);break;case"3M":c.setDate(o.getDate()-90);break;case"6M":c.setDate(o.getDate()-180);break;case"1Y":c.setFullYear(o.getFullYear()-1);break;case"ALL":c.setTime(u),c.setDate(c.getDate()-2)}const x=new Date(Math.min(c.getTime(),p.getTime()));x.setHours(0,0,0,0);const h=((e,t)=>{const s=[],a=new Date(e);let n=0;for(;a<=t&&n<5e3;)s.push(Es(a)),a.setDate(a.getDate()+1),n++;return s})(x,o),g={},b={};s.forEach(e=>{g[e.id]=0,b[e.id]=0});const f={};s.forEach(e=>{const t=m[e.id];t&&t.length>0?f[e.id]=t[0].price:f[e.id]=e.currentPrice});const v=[],j=Es(c);for(const a of h){s.forEach(e=>{const t=y[e.id];t&&t.has(a)&&(f[e.id]=t.get(a))});const e=l.filter(e=>e.date.startsWith(a));for(const s of e){void 0===g[s.assetId]&&(g[s.assetId]=0),void 0===b[s.assetId]&&(b[s.assetId]=0);const e=s.quantityChange||0,t=Math.abs(e),a=s.total||0;if(s.type===Ve.BUY||s.type===Ve.DEPOSIT||s.type===Ve.BORROW||s.type===Ve.BALANCE_ADJUSTMENT)if(e>=0)g[s.assetId]+=e,b[s.assetId]+=a;else{const e=g[s.assetId];if(e>0){const a=t/e;b[s.assetId]-=b[s.assetId]*a}g[s.assetId]-=t}else if(s.type===Ve.SELL||s.type===Ve.WITHDRAWAL||s.type===Ve.REPAY){const e=g[s.assetId];if(e>0){const a=t/e;b[s.assetId]-=b[s.assetId]*a}g[s.assetId]-=t,g[s.assetId]<0&&(g[s.assetId]=0)}}let t=0,i=0;s.forEach(e=>{const s=g[e.id]||0,a=f[e.id];if(s>0){const l=ft(s*a,e.currency,n,r),o=ft(b[e.id],e.currency,n,r);e.type===Ye.LIABILITY?t-=l:(t+=l,i+=o)}}),a>=j&&v.push({date:a,displayDate:new Date(a).toLocaleDateString(void 0,{month:"short",day:"numeric"}),value:t,cost:i,pnl:t-i,pnlPercent:0!==i?(t-i)/i*100:0})}return v},[s,a,d,n,r,m,y]),j=v.length>0&&v[v.length-1].pnl>=0?"#10b981":"#ef4444",N=({active:e,payload:s})=>{if(e&&s&&s.length){const e=s[0].payload;return t.jsxs("div",{className:"bg-white/95 backdrop-blur-sm p-3 sm:p-4 rounded-xl shadow-xl border border-slate-100 text-xs sm:text-sm animate-in fade-in zoom-in-95 duration-150 max-w-[180px] sm:max-w-none",children:[t.jsx("p",{className:"text-slate-500 font-medium mb-1.5 sm:mb-2 border-b border-slate-50 pb-1",children:e.displayDate}),t.jsxs("div",{className:"flex items-center justify-between gap-3 sm:gap-6 mb-1",children:[t.jsxs("span",{className:"text-slate-500 flex items-center gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full",style:{background:j}}),l("value")]}),t.jsx("span",{className:"font-bold text-slate-700",children:f(e.value)})]}),t.jsxs("div",{className:"flex items-center justify-between gap-3 sm:gap-6 mb-1.5",children:[t.jsxs("span",{className:"text-slate-400 flex items-center gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-slate-300"}),l("label_cost")]}),t.jsx("span",{className:"font-medium text-slate-400",children:f(e.cost)})]}),t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 pt-1.5 border-t border-slate-50 font-medium "+(e.pnl>=0?"text-green-600":"text-red-600"),children:[t.jsx("span",{children:e.pnl>=0?l("label_net_pnl"):"Loss"}),t.jsxs("div",{className:"flex items-center gap-1",children:[e.pnl>=0?t.jsx(pe,{size:12}):t.jsx(ye,{size:12}),t.jsxs("span",{children:[f(Math.abs(e.pnl))," ",t.jsxs("span",{className:"text-[10px] opacity-80",children:["(",Math.abs(e.pnlPercent).toFixed(1),"%)"]})]})]})]})]})}return null},w=s.some(e=>e.type===Ye.STOCK||e.type===Ye.FUND),S=c.marketDataProvider||"finnhub",A=w&&("alphavantage"===S&&!c.alphaVantageApiKey||"finnhub"===S&&!c.finnhubApiKey);return t.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden h-full flex flex-col",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-slate-50 flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-slate-800 text-lg flex items-center gap-2",children:l("netWorthTrend")}),t.jsxs("p",{className:"text-xs text-slate-400 flex items-center gap-1 mt-0.5",children:[t.jsx(fe,{size:12})," ",l("costVsValue"),x&&t.jsxs("span",{className:"flex items-center gap-1 text-blue-500 ml-2",children:[t.jsx(K,{size:10,className:"animate-spin"})," Syncing..."]})]})]}),t.jsx("div",{className:"flex bg-slate-50 p-1 rounded-lg self-start sm:self-auto overflow-x-auto max-w-full",children:["1W","1M","3M","6M","1Y","ALL"].map(e=>t.jsx("button",{onClick:()=>u(e),className:"px-3 py-1 text-xs font-medium rounded-md transition-all whitespace-nowrap "+(d===e?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700 hover:bg-slate-200/50"),children:e},e))})]}),A&&!x&&w&&t.jsxs("div",{className:"bg-amber-50 px-4 py-2 text-[10px] text-amber-700 flex items-center justify-center gap-2 border-b border-amber-100",children:[t.jsx(P,{size:12}),t.jsx("span",{children:l("marketDataKeyMissing")})]}),!A&&g&&!x&&w&&t.jsxs("div",{className:"bg-amber-50 px-4 py-2 text-[10px] text-amber-700 flex items-center justify-center gap-2 border-b border-amber-100",children:[t.jsx(P,{size:12}),t.jsx("span",{children:l("finnhubFreePlanLimitation")})]}),t.jsx("div",{className:"p-4 flex-1 min-h-[320px]",children:i?t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-300 bg-slate-50/30 rounded-xl border border-dashed border-slate-200",children:[t.jsx("div",{className:"p-4 bg-white rounded-full shadow-sm mb-3",children:t.jsx(fe,{size:24,className:"text-slate-300"})}),t.jsx("p",{children:l("chartHidden")})]}):v.length>1?t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(Fe,{data:v,margin:{top:10,right:10,left:0,bottom:0},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"colorNetWorth",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:j,stopOpacity:.15}),t.jsx("stop",{offset:"95%",stopColor:j,stopOpacity:0})]})}),t.jsx(ke,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),t.jsx(Ee,{dataKey:"displayDate",tickLine:!1,axisLine:!1,tick:{fill:"#94a3b8",fontSize:11},minTickGap:30}),t.jsx(Le,{hide:!0,domain:["auto","auto"]}),t.jsx(_e,{content:t.jsx(N,{}),cursor:{stroke:"#cbd5e1",strokeWidth:1,strokeDasharray:"4 4"}}),t.jsx($e,{type:"stepAfter",dataKey:"cost",stroke:"#94a3b8",strokeWidth:2,strokeDasharray:"4 4",dot:!1,activeDot:!1,name:"Invested"}),t.jsx(Be,{type:"monotone",dataKey:"value",stroke:j,strokeWidth:2,fillOpacity:1,fill:"url(#colorNetWorth)",activeDot:{r:4,strokeWidth:0,fill:j},name:"Net Worth"})]})}):t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400",children:[x?t.jsx(K,{size:32,className:"mb-2 animate-spin text-blue-400"}):t.jsx(E,{size:32,className:"mb-2 opacity-50"}),t.jsx("span",{className:"text-sm",children:x?"Syncing market data...":l("noTransactions")})]})})]})},_s=({isOpen:e,onClose:s,assets:a,transactions:n,baseCurrency:r,exchangeRates:l,isPrivacyMode:o,t:c})=>e?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm transition-opacity",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl overflow-hidden flex flex-col h-[600px] max-h-[90vh]",children:[t.jsxs("div",{className:"px-6 py-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center shrink-0",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:c("netWorthTrend")}),t.jsx("p",{className:"text-xs text-slate-500",children:c("trendModalSubtitle")||"Trend analysis based on current filtered assets"})]}),t.jsx("button",{onClick:s,className:"text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-200 rounded-full transition-colors",children:t.jsx(i,{size:20})})]}),t.jsx("div",{className:"flex-1 p-4 bg-slate-50/50 overflow-hidden",children:t.jsx(Ls,{assets:a,transactions:n,baseCurrency:r,exchangeRates:l,isPrivacyMode:o,t:c,initialRange:"1W"})})]})}):null,Rs=()=>{const{t:s,refreshPrices:a,isRefreshing:n,assets:r,transactions:i,settings:l,exchangeRates:o}=Dt(),[c,d]=e.useState(!1),[u,m]=e.useState(!1),[p,x]=e.useState(!1),[h,g]=e.useState(""),[b,f]=e.useState(null),[y,v]=e.useState(void 0),j=r.filter(e=>e.symbol.toLowerCase().includes(h.toLowerCase())||e.name.toLowerCase().includes(h.toLowerCase()));return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:s("assetsManagement")}),t.jsx("p",{className:"text-slate-500",children:s("assetsSubtitle")})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"relative hidden md:block mr-2",children:[t.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400",size:18}),t.jsx("input",{type:"text",placeholder:s("searchAssets"),value:h,onChange:e=>g(e.target.value),className:"pl-9 pr-4 py-2.5 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all w-64 shadow-sm"})]}),t.jsx("button",{onClick:()=>a(),disabled:n,className:"p-2.5 bg-white hover:bg-slate-50 text-slate-600 border border-slate-200 rounded-xl shadow-sm transition-all",title:s("refreshPrices"),children:t.jsx(K,{size:20,className:n?"animate-spin text-blue-600":"text-slate-400"})}),t.jsx("button",{onClick:()=>x(!0),className:"p-2.5 bg-white hover:bg-slate-50 text-slate-600 border border-slate-200 rounded-xl shadow-sm transition-all",title:s("showTrend"),children:t.jsx(pe,{size:20,className:"text-slate-400"})}),t.jsxs("button",{onClick:()=>{f(null),d(!0)},className:"px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl shadow-lg shadow-blue-200 transition-all flex items-center gap-2",children:[t.jsx(ve,{size:20})," ",t.jsx("span",{className:"hidden sm:inline",children:s("addNewAsset")}),t.jsx("span",{className:"sm:hidden",children:s("addNewAsset").split(" ")[0]})]})]})]}),t.jsxs("div",{className:"relative md:hidden",children:[t.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400",size:18}),t.jsx("input",{type:"text",placeholder:s("searchAssets"),value:h,onChange:e=>g(e.target.value),className:"w-full pl-9 pr-4 py-2.5 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all shadow-sm"})]}),t.jsx(Ds,{assets:j,onEdit:e=>{f(e),d(!0)},onTransaction:e=>{v(e.id),m(!0)}}),t.jsx(Ps,{isOpen:c,onClose:()=>{d(!1),f(null)},initialAsset:b}),t.jsx(ks,{isOpen:u,onClose:()=>{m(!1),v(void 0)},preselectedAssetId:y}),t.jsx(_s,{isOpen:p,onClose:()=>x(!1),assets:j,transactions:i,baseCurrency:l.baseCurrency,exchangeRates:o,isPrivacyMode:l.isPrivacyMode,t:s})]})},Us=(t,s)=>{const[a,n]=e.useState(null),[r,i]=e.useState(!1),[l,o]=e.useState(null),[c,d]=e.useState(!1);e.useEffect(()=>{(()=>{if(0===t.length)return void d(!1);const e=es(t),r=et.getCache(Jt);if(r){const{timestamp:t,data:{hash:i,data:l}}=r,o=Date.now()-t>Qt,c=i!==`${e}:${s.language}:${s.aiProvider}`;!a&&l&&n(l),d(o||c)}else d(!0)})()},[t,a,s.language,s.aiProvider]);return{analysis:a,loading:r,error:l,canAnalyze:c,analyze:async()=>{const e="deepseek"===s.aiProvider?s.deepSeekApiKey:s.geminiApiKey;if(!e)throw new Error("API Key is missing");if(0!==t.length){i(!0),o(null);try{const a=await(async(e,t,s,a="en",n=!1)=>{if(!t)throw new Error("API Key is missing");if(0===e.length)return"";const r=`${es(e)}:${a}:${s}`,i=Date.now();if(!n){const e=et.getCache(Jt);if(e){const{timestamp:t,data:{hash:s,data:a}}=e;if(s===r&&i-t<Qt)return a}}if(Zt&&Zt.hash===r&&!n)return Zt.promise;const l=(async()=>{const n=e.map(e=>({symbol:e.symbol,type:e.type,qty:e.quantity,val:(e.quantity*e.currentPrice).toFixed(0),curr:e.currency})),i="zh"===a?"Chinese (Simplified)":"English",l=`\n    You are the Chief Investment Officer (CIO) for 'PanassetLite' (盘资产·轻), a private wealth management platform.\n\n    **User Portfolio Snapshot (For Analysis Only):**\n    ${JSON.stringify(n)}\n\n    **Financial Context:**\n    - **Net Worth** = Total Assets - Total Liabilities.\n    - **Liquid Assets**: Stocks, Crypto, Cash, Funds.\n    - **Illiquid Assets**: Real Estate (Low volatility, hard to sell).\n    - **Liabilities**: Loans, Mortgages (Negative impact on Net Worth).\n\n    **STRICT PRIVACY & OUTPUT RULES:**\n    1. **NO ABSOLUTE NUMBERS:** You are generating a report for a privacy-focused dashboard. **DO NOT** output any specific monetary values (e.g., do NOT write "$10,000", "72,361 RMB", or "1.5 BTC") in the final report.\n    2. **USE RATIOS & PERCENTAGES:** Instead of numbers, use percentages (%), ratios, and qualitative terms (e.g., "healthy buffer", "significant portion", "minor allocation").\n    3. **LANGUAGE:** The output must be in **${i}**.\n\n    **Task:**\n    Generate a strategic wealth analysis report. Use Markdown.\n\n    **Structure:**\n    1.  **Wealth Health Check**:\n        - Analyze the **Net Worth** structure (Asset vs Liability mix) using percentages only.\n        - Assess **Debt-to-Asset Ratio**. (Liabilities > 30% is caution).\n        - Assess **Liquidity**. Are they over-leveraged or too illiquid?\n\n    2.  **Risk & Allocation**:\n        - Evaluate exposure to High Volatility (Crypto) vs Stable Assets (Real Estate/Cash) based on portfolio weight.\n        - Comment on concentration risk (e.g., "Allocated heavily in a single asset").\n\n    3.  **Strategic Recommendations**:\n        - Provide 3 specific, actionable steps to optimize the portfolio based on the asset mix.\n\n    **Tone:** Professional, insightful, objective, and encouraging.\n    **Length:** Concise (~300 words).\n    `,o=Wt.create(s,t),c=await o.generateText(l)||("zh"===a?"暂时无法生成分析报告。":"Unable to generate analysis report.");return et.saveCache(Jt,{hash:r,data:c}),c})();Zt={hash:r,promise:l};try{return await l}finally{Zt=null}})(t,e,s.aiProvider,s.language);n(a),d(!1)}catch(a){o(a.message||"AI Service Unavailable")}finally{i(!1)}}},setError:o}},zs=()=>{const{assets:s,settings:a,t:r}=Dt(),[i,l]=e.useState(!1),{analysis:o,loading:c,error:d,canAnalyze:u,analyze:m,setError:p}=Us(s,a);return 0===s.length?null:t.jsxs(cs,{className:"border-purple-100 bg-gradient-to-br from-white to-purple-50/50 transition-all duration-300",children:[t.jsxs("div",{className:"flex items-center justify-between cursor-pointer select-none",onClick:()=>l(!i),children:[t.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[t.jsx("div",{className:"p-2 bg-purple-600 rounded-lg shadow-md shadow-purple-200 shrink-0",children:t.jsx(n,{className:"text-white",size:18})}),t.jsxs("div",{className:"min-w-0 flex flex-col justify-center",children:[t.jsx("h3",{className:"font-bold text-slate-800 text-sm sm:text-base truncate leading-tight",children:r("aiInsights")}),t.jsx("p",{className:"text-xs text-slate-500 hidden sm:block truncate mt-0.5",children:r("wealthManagement")})]})]}),t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 shrink-0 ml-2",children:[u?t.jsx("button",{onClick:async e=>{e&&e.stopPropagation();if(!("deepseek"===a.aiProvider?a.deepSeekApiKey:a.geminiApiKey))return p(r("apiKeyMissing")),void l(!0);l(!0),await m()},disabled:c,className:"text-xs sm:text-sm px-3 py-1.5 sm:px-4 sm:py-2 bg-white border border-slate-200 hover:border-purple-300 text-purple-600 hover:text-purple-700 hover:bg-purple-50 rounded-lg transition-all flex items-center gap-1.5 sm:gap-2 shadow-sm z-10 font-medium",children:c?t.jsx(K,{className:"animate-spin",size:14}):t.jsxs(t.Fragment,{children:[t.jsx(n,{size:14})," ",t.jsx("span",{children:r("analyzeNow")})]})}):t.jsxs("div",{className:"text-[10px] sm:text-xs px-2 py-1 sm:px-3 sm:py-1.5 bg-green-50 text-green-600 rounded-lg border border-green-100 flex items-center gap-1 whitespace-nowrap",children:[t.jsx(G,{size:12})," ",t.jsx("span",{className:"hidden sm:inline",children:r("upToDate")})]}),t.jsx("div",{className:"text-slate-400 hover:text-purple-600 transition-colors p-1",children:i?t.jsx(O,{size:18}):t.jsx(U,{size:18})})]})]}),i&&t.jsxs("div",{className:"mt-3 pt-3 sm:mt-4 sm:pt-4 border-t border-purple-100/50 animate-fade-in",children:[c&&!o&&t.jsxs("div",{className:"space-y-3 animate-pulse",children:[t.jsx("div",{className:"h-4 bg-purple-100 rounded w-3/4"}),t.jsx("div",{className:"h-4 bg-purple-100 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-purple-100 rounded w-5/6"})]}),d&&t.jsxs("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded-lg border border-red-100 flex justify-between items-center",children:[t.jsx("span",{children:d}),t.jsxs(je,{to:"/settings",className:"flex items-center gap-1 text-blue-600 hover:underline font-medium",children:[t.jsx(ee,{size:14})," ",r("setKey")]})]}),o&&t.jsx("div",{className:"prose prose-sm prose-purple max-w-none text-slate-600",children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed text-xs sm:text-sm",children:o})})]})]})},Ms=["#0ea5e9","#6366f1","#8b5cf6","#ec4899","#10b981","#f59e0b","#f97316"],Os=()=>{var s;const{assets:a,transactions:n,settings:r,exchangeRates:i,t:l}=Dt(),o=e.useMemo(()=>{let e=0,t=0,s=0,n=0;a.forEach(a=>{const l=a.quantity*a.currentPrice,o=a.quantity*a.avgCost,c=ft(l,a.currency,r.baseCurrency,i),d=ft(o,a.currency,r.baseCurrency,i);var u;a.type===Ye.LIABILITY?(t+=c,s-=d):(e+=c,s+=d,(u=a.type)!==Ye.REAL_ESTATE&&u!==Ye.LIABILITY&&u!==Ye.OTHER&&(n+=c*(.03*Math.random()-.01)))});const l=e-t,o=l-s,c=0!==s?o/Math.abs(s)*100:0;return{totalNetWorth:l,totalAssetsValue:e,totalLiabilitiesValue:t,totalCost:s,totalPnL:o,totalPnLPercent:c,dayPnL:n}},[a,r.baseCurrency,i]),c=e.useMemo(()=>a.filter(e=>e.type!==Ye.LIABILITY).map(e=>{const t=e.quantity*e.currentPrice,s=ft(t,e.currency,r.baseCurrency,i);return{name:e.symbol,value:s}}).filter(e=>e.value>0).sort((e,t)=>t.value-e.value),[a,r.baseCurrency,i]),d=e=>r.isPrivacyMode?"••••••":new Intl.NumberFormat("en-US",{style:"currency",currency:r.baseCurrency,maximumFractionDigits:0}).format(e),u=e=>r.isPrivacyMode?"•••%":`${e.toFixed(2)}%`,m=r.baseCurrency===He.CNY?Ne:_;return t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-700 rounded-2xl p-6 text-white shadow-lg relative overflow-hidden group",children:[r.isPrivacyMode&&t.jsx(H,{className:"absolute top-6 right-6 text-blue-400 opacity-50",size:24}),t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("span",{className:"text-blue-100 font-medium",children:l("netWorth")}),t.jsx(je,{to:"/settings",className:"p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors cursor-pointer flex items-center justify-center",title:l("changeCurrency"),children:t.jsx(m,{size:20})})]}),t.jsx(je,{to:"/assets",className:"block cursor-pointer hover:opacity-90 transition-opacity",children:t.jsx("div",{className:"text-3xl font-bold mb-1",children:d(o.totalNetWorth)})}),t.jsxs("div",{className:"text-sm text-blue-100 flex items-center gap-2",children:[t.jsxs("span",{className:o.totalPnL>=0?"text-green-300":"text-red-300",children:[r.isPrivacyMode?"":o.totalPnL>=0?"+":"",u(o.totalPnLPercent)]}),l("allTime")]})]}),t.jsxs(cs,{className:"flex flex-col justify-center",children:[t.jsxs("span",{className:"text-slate-500 font-medium mb-2 flex items-center gap-2",children:[t.jsx(w,{size:16,className:"text-blue-500"})," ",l("totalAssets")]}),t.jsx(je,{to:"/assets",className:"block cursor-pointer hover:opacity-75 transition-opacity",children:t.jsx("div",{className:"text-2xl font-bold text-slate-800 mb-1",children:d(o.totalAssetsValue)})}),t.jsx("div",{className:"text-xs text-slate-400",children:l("grossValue")})]}),t.jsxs(cs,{className:"flex flex-col justify-center "+(o.totalLiabilitiesValue>0?"border-red-100 bg-red-50/30":""),children:[t.jsxs("span",{className:"text-slate-500 font-medium mb-2 flex items-center gap-2",children:[t.jsx(F,{size:16,className:"text-red-500"})," ",l("totalLiabilities")]}),t.jsx("div",{className:"text-2xl font-bold mb-1 "+(o.totalLiabilitiesValue>0?"text-red-600":"text-slate-800"),children:r.isPrivacyMode?"••••••":(o.totalLiabilitiesValue>0?"-":"")+new Intl.NumberFormat("en-US",{style:"currency",currency:r.baseCurrency,maximumFractionDigits:0}).format(o.totalLiabilitiesValue)}),t.jsx("div",{className:"text-xs text-slate-400",children:l("outstandingDebt")})]}),t.jsxs(cs,{className:"flex flex-col justify-center",children:[t.jsxs("span",{className:"text-slate-500 font-medium mb-2 flex items-center gap-2",children:[l("dayPnL")," ",t.jsx(te,{size:16})]}),t.jsx("div",{className:"text-2xl font-bold text-slate-800 mb-1",children:d(o.dayPnL)}),t.jsxs("div",{className:"text-sm font-medium flex items-center gap-1 "+(o.dayPnL>=0?"text-green-600":"text-red-500"),children:[r.isPrivacyMode?null:o.dayPnL>=0?t.jsx(pe,{size:14}):t.jsx(ye,{size:14}),u(0!==o.dayPnL?100*Math.abs(o.dayPnL/(o.totalNetWorth||1)):0)]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2 min-w-0 h-[400px]",children:t.jsx(Ls,{assets:a,transactions:n,baseCurrency:r.baseCurrency,exchangeRates:i,isPrivacyMode:r.isPrivacyMode,t:l})}),t.jsxs(cs,{title:`${l("assetAllocation")} (${r.baseCurrency})`,className:"min-w-0",children:[t.jsx("div",{className:"h-[300px] w-full relative min-w-0",children:r.isPrivacyMode?t.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-slate-300",children:[t.jsx(H,{size:48,className:"mb-2"}),t.jsx("p",{children:l("hidden")})]}):t.jsxs(t.Fragment,{children:[t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(Me,{children:[t.jsx(Oe,{data:c,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:c.map((e,s)=>t.jsx(Ue,{fill:Ms[s%Ms.length],stroke:"none"},`cell-${s}`))}),t.jsx(_e,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>d(e)})]})}),t.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center pointer-events-none",children:[t.jsx("div",{className:"text-xs text-slate-400",children:l("topAsset")}),t.jsx("div",{className:"font-bold text-slate-700",children:(null==(s=c[0])?void 0:s.name)||"-"})]})]})}),!r.isPrivacyMode&&t.jsx("div",{className:"flex flex-wrap gap-2 justify-center pb-2 mt-2",children:c.slice(0,4).map((e,s)=>t.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:Ms[s%Ms.length]}}),e.name," ",(e.value/(c.reduce((e,t)=>e+t.value,0)||1)*100).toFixed(0),"%"]},e.name))})]})]})]})},Ks=()=>{const{t:e}=Dt();return t.jsxs("div",{className:"space-y-6 md:space-y-8",children:[t.jsx("div",{className:"flex flex-col xl:flex-row xl:items-center justify-between gap-4",children:t.jsx("div",{children:t.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-800",children:e("overview")})})}),t.jsx(zs,{}),t.jsx(Os,{})]})},qs=()=>{const[s,a]=e.useState([]);e.useEffect(()=>wt.subscribe(e=>{a(t=>[...t,e]),e.duration&&setTimeout(()=>{n(e.id)},e.duration)}),[]);const n=e=>{a(t=>t.filter(t=>t.id!==e))},r=e=>{switch(e){case"error":return t.jsx(y,{size:20});case"warning":return t.jsx(P,{size:20});case"success":return t.jsx(G,{size:20});case"info":return t.jsx(we,{size:20})}},l=e=>{switch(e){case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"success":return"bg-green-50 border-green-200 text-green-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800"}};return 0===s.length?null:t.jsxs("div",{className:"toast-container",children:[s.map(e=>t.jsxs("div",{className:`toast-item ${l(e.type)}`,children:[t.jsx("div",{className:"toast-icon",children:r(e.type)}),t.jsx("div",{className:"toast-message",children:e.message}),t.jsx("button",{onClick:()=>n(e.id),className:"toast-close","aria-label":"Close notification",children:t.jsx(i,{size:18})})]},e.id)),t.jsx("style",{children:"\n        .toast-container {\n          position: fixed;\n          top: 20px;\n          right: 20px;\n          z-index: 9999;\n          display: flex;\n          flex-direction: column;\n          gap: 12px;\n          max-width: 420px;\n          pointer-events: none;\n        }\n\n        .toast-item {\n          pointer-events: auto;\n          display: flex;\n          align-items: flex-start;\n          gap: 12px;\n          padding: 14px 16px;\n          border-radius: 8px;\n          border: 1px solid;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n          animation: slideIn 0.3s ease-out;\n          min-width: 300px;\n        }\n\n        @keyframes slideIn {\n          from {\n            transform: translateX(100%);\n            opacity: 0;\n          }\n          to {\n            transform: translateX(0);\n            opacity: 1;\n          }\n        }\n\n        .toast-icon {\n          flex-shrink: 0;\n          display: flex;\n          align-items: center;\n          margin-top: 1px;\n        }\n\n        .toast-message {\n          flex: 1;\n          font-size: 14px;\n          line-height: 1.5;\n          word-break: break-word;\n        }\n\n        .toast-close {\n          flex-shrink: 0;\n          background: transparent;\n          border: none;\n          cursor: pointer;\n          padding: 2px;\n          border-radius: 4px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          opacity: 0.6;\n          transition: opacity 0.2s;\n        }\n\n        .toast-close:hover {\n          opacity: 1;\n        }\n\n        @media (max-width: 640px) {\n          .toast-container {\n            top: 10px;\n            right: 10px;\n            left: 10px;\n            max-width: none;\n          }\n\n          .toast-item {\n            min-width: 0;\n          }\n        }\n      "})]})},Fs=()=>t.jsxs(t.Fragment,{children:[t.jsx(Ct,{children:t.jsx(Se,{children:t.jsx(os,{children:t.jsxs(Ae,{children:[t.jsx(Te,{path:"/",element:t.jsx(Ks,{})}),t.jsx(Te,{path:"/assets",element:t.jsx(Rs,{})}),t.jsx(Te,{path:"/history",element:t.jsx(ps,{})}),t.jsx(Te,{path:"/analytics",element:t.jsx(Ss,{})}),t.jsx(Te,{path:"/settings",element:t.jsx(As,{})})]})})})}),t.jsx(qs,{})]}),$s=document.getElementById("root");if(!$s)throw new Error("Could not find root element to mount to");Ce.createRoot($s).render(t.jsx(v.StrictMode,{children:t.jsx(Fs,{})}));
