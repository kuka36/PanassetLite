import{d as e,j as t,ac as s,ad as a,ae as r,af as i,ag as n,ah as l,ai as o,aj as c,ak as d,al as u,am as m,an as p,ao as x,ap as h,aq as g,ar as b,as as y,at as f,au as v,av as j,aw as N,ax as w,ay as S,az as A,aA as D,aB as T,aC as C,aD as I,aE as k,aF as E,aG as P,aH as _,aI as L,aJ as R,aK as U,aL as M,aM as z,aN as O,aO as K,aP as q,aQ as $,aR as B,aS as F,aT as Y,aU as H,aV as V,aW as W,aX as G,aY as J,aZ as Q,a_ as X,a$ as Z,b0 as ee,b1 as te,b2 as se,b3 as ae,b4 as re,b5 as ie,b6 as ne,b7 as le,b8 as oe,b9 as ce,ba as de,bb as ue,bc as me,bd as pe,be as xe,bf as he,bg as ge,bh as be,bi as ye,bj as fe,bk as ve,bl as je,bm as Ne,bn as we,bo as Se,bp as Ae,bq as De}from"./vendor-U6PayXA0.js";import{M as Te}from"./markdown-BUEf8Jua.js";import{R as Ce,B as Ie,C as ke,X as Ee,Y as Pe,T as _e,a as Le,b as Re,L as Ue,P as Me,c as ze,d as Oe,e as Ke,A as qe,f as $e,g as Be}from"./recharts-B05viCB2.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Fe=(e=>(e.STOCK="STOCK",e.CRYPTO="CRYPTO",e.FUND="FUND",e.CASH="CASH",e.REAL_ESTATE="REAL_ESTATE",e.LIABILITY="LIABILITY",e.OTHER="OTHER",e))(Fe||{}),Ye=(e=>(e.USD="USD",e.CNY="CNY",e.HKD="HKD",e))(Ye||{}),He=(e=>(e.BUY="BUY",e.SELL="SELL",e.DIVIDEND="DIVIDEND",e.DEPOSIT="DEPOSIT",e.WITHDRAWAL="WITHDRAWAL",e.BORROW="BORROW",e.REPAY="REPAY",e.BALANCE_ADJUSTMENT="BALANCE_ADJUSTMENT",e))(He||{}),Ve=(e=>(e.API_KEY_MISSING="API_KEY_MISSING",e.API_KEY_INVALID="API_KEY_INVALID",e.RATE_LIMIT="RATE_LIMIT",e.ACCESS_DENIED="ACCESS_DENIED",e.NETWORK_ERROR="NETWORK_ERROR",e.UNKNOWN="UNKNOWN",e))(Ve||{});const We="investflow_metadata",Ge="investflow_transactions_v2",Je="investflow_settings",Qe="investflow_assets",Xe="investflow_transactions";Ye.USD;const Ze={getAssetMetas(){try{const e=localStorage.getItem(We);return e?JSON.parse(e):[]}catch(e){return[]}},saveAssetMetas(e){try{localStorage.setItem(We,JSON.stringify(e))}catch(t){}},getTransactions(){try{const e=localStorage.getItem(Ge);return e?JSON.parse(e):[]}catch(e){return[]}},saveTransactions(e){try{localStorage.setItem(Ge,JSON.stringify(e))}catch(t){}},getSettings(){try{const e=localStorage.getItem(Je);return e?JSON.parse(e):null}catch(e){return null}},saveSettings(e){try{localStorage.setItem(Je,JSON.stringify(e))}catch(t){}},getCache(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return null}},saveCache(e,t){try{const s={timestamp:Date.now(),data:t};localStorage.setItem(e,JSON.stringify(s))}catch(s){}},remove(e){localStorage.removeItem(e)},clearAllData(){localStorage.removeItem(We),localStorage.removeItem(Ge)},getLegacyData:()=>({assets:localStorage.getItem(Qe),transactions:localStorage.getItem(Xe),v2Metadata:localStorage.getItem(We)}),clearLegacyData(){localStorage.removeItem(Qe),localStorage.removeItem(Xe)},clearItemsByPrefix(e){const t=[];for(let s=0;s<localStorage.length;s++){const a=localStorage.key(s);a&&a.startsWith(e)&&t.push(a)}t.forEach(e=>localStorage.removeItem(e))}},et="investflow_rates",tt="investflow_crypto_prices",st="investflow_stock_prices",at="investflow_asset_history",rt={BTC:"bitcoin",ETH:"ethereum",USDT:"tether",SOL:"solana",BNB:"binancecoin",XRP:"ripple",ADA:"cardano",DOGE:"dogecoin",DOT:"polkadot",MATIC:"matic-network",LINK:"chainlink"},it=e=>{const t=e.toUpperCase();return t.endsWith(".SS")||t.endsWith(".SZ")?Ye.CNY:t.endsWith(".HK")?Ye.HKD:Ye.USD},nt=async e=>{const t=e.filter(e=>e.type===Fe.CRYPTO);if(0===t.length)return{};const s=Ze.getCache(tt),a=!s||Date.now()-s.timestamp>6e5;if(s&&!a){if(t.every(e=>void 0!==s.data[e.id]))return s.data}const r=t.map(e=>rt[e.symbol.toUpperCase()]||e.name.toLowerCase().replace(/\s+/g,"-")).join(",");if(!r)return(null==s?void 0:s.data)||{};try{const e=await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${r}&vs_currencies=usd`);if(!e.ok)throw new Error("CoinGecko API Error");const a=await e.json(),i={...(null==s?void 0:s.data)||{}};return t.forEach(e=>{const t=rt[e.symbol.toUpperCase()]||e.name.toLowerCase().replace(/\s+/g,"-");a[t]&&a[t].usd&&(i[e.id]=a[t].usd)}),Ze.saveCache(tt,i),i}catch(i){return(null==s?void 0:s.data)||{}}},lt=e=>new Promise(t=>setTimeout(t,e)),ot=async(e,t)=>{const s=e.filter(e=>e.type===Fe.STOCK||e.type===Fe.FUND);if(0===s.length)return{};const a=Ze.getCache(st),r={...(null==a?void 0:a.data)||{}},i=Date.now(),n=[],l=[],o=[];for(const u of s){const e=r[u.id],s="alphavantage"===t.provider?27e5:6e5;!e||!e.lastUpdated||i-e.lastUpdated>s?(n.push(u),o.push(`${u.symbol}(${(null==e?void 0:e.lastUpdated)?`stale:${Math.round((i-e.lastUpdated)/1e3/60)}min`:"no-cache"})`)):l.push(`${u.symbol}(age:${Math.round((i-e.lastUpdated)/1e3/60)}min)`)}if(0===n.length)return r;let c=!1;if("finnhub"===t.provider){if(!t.finnhubKey)throw{category:Ve.API_KEY_MISSING,provider:"finnhub",message:"Finnhub API Key is missing"};const e=n.slice(0,10);for(const s of e)try{let e=s.symbol;s.currency!==Ye.HKD||e.includes(".")?s.currency!==Ye.CNY||e.includes(".")||(e=e.startsWith("6")?`${e}.SS`:`${e}.SZ`):e=`${e}.HK`;const a=await fetch(`https://finnhub.io/api/v1/quote?symbol=${e}&token=${t.finnhubKey}`);if(!a.ok){if(429===a.status)throw{category:Ve.RATE_LIMIT,provider:"finnhub",message:"Finnhub rate limit exceeded"};if(403===a.status||401===a.status)throw{category:Ve.ACCESS_DENIED,provider:"finnhub",message:"Access denied or invalid API key"};continue}const i=await a.json();if(i.error)throw{category:Ve.ACCESS_DENIED,provider:"finnhub",message:i.error};i.c&&i.c>0&&(r[s.id]={price:i.c,currency:it(e),lastUpdated:Date.now()},c=!0),await lt(100)}catch(d){}}else{if(!t.alphaVantageKey)throw{category:Ve.API_KEY_MISSING,provider:"alphavantage",message:"Alpha Vantage API Key is missing"};const e=n.slice(0,5);for(const s of e)try{let a=s.symbol;s.currency!==Ye.HKD||a.includes(".")?s.currency!==Ye.CNY||a.includes(".")||(a=a.startsWith("6")?`${a}.SS`:`${a}.SZ`):a=`${a}.HK`;const i=await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${a}&apikey=${t.alphaVantageKey}`),n=await i.json();if(n.Note||n.Information)throw{category:Ve.RATE_LIMIT,provider:"alphavantage",message:"Alpha Vantage rate limit exceeded"};n["Global Quote"]&&n["Global Quote"]["05. price"]&&(r[s.id]={price:parseFloat(n["Global Quote"]["05. price"]),currency:it(n["Global Quote"]["01. symbol"]||a),lastUpdated:Date.now()},c=!0),e.length>1&&await lt(15e3)}catch(d){}}return c&&Ze.saveCache(st,r),r},ct=async(e,t,s)=>{const a=s||(()=>{const e=new Date;return e.setFullYear(e.getFullYear()-5),e})(),r=(Date.now()-a.getTime())/864e5,i=`${at}_${e.id}`,n=Ze.getCache(i),l=!n||Date.now()-n.timestamp>864e5,o=n&&n.data.length>=98&&n.data.length<=102&&r>130;if(n&&n.data.length>0&&!l&&!o)return n.data;try{let s=[];if(e.type===Fe.CRYPTO){const t=r>365?"max":"365",a=rt[e.symbol.toUpperCase()]||e.name.toLowerCase().replace(/\s+/g,"-"),i=await fetch(`https://api.coingecko.com/api/v3/coins/${a}/market_chart?vs_currency=usd&days=${t}&interval=daily`);if(i.ok){const e=await i.json();e.prices&&(s=e.prices.map(e=>({date:new Date(e[0]).toISOString().split("T")[0],price:e[1]})))}}else if(e.type===Fe.STOCK||e.type===Fe.FUND){let r=e.symbol;if(e.currency!==Ye.HKD||r.includes(".")?e.currency!==Ye.CNY||r.includes(".")||(r=r.startsWith("6")?`${r}.SS`:`${r}.SZ`):r=`${r}.HK`,"finnhub"===t.provider&&t.finnhubKey){const e=Math.floor(a.getTime()/1e3),i=Math.floor(Date.now()/1e3),l=await fetch(`https://finnhub.io/api/v1/stock/candle?symbol=${r}&resolution=D&from=${e}&to=${i}&token=${t.finnhubKey}`);if(l.ok){const e=await l.json();if("ok"===e.s&&e.c&&e.t)s=e.t.map((t,s)=>({date:new Date(1e3*t).toISOString().split("T")[0],price:e.c[s]}));else{if("no_data"===e.s)return(null==n?void 0:n.data)||[];if(e.error)throw{category:Ve.ACCESS_DENIED,provider:"finnhub",message:e.error}}}else{if(429===l.status)throw{category:Ve.RATE_LIMIT,provider:"finnhub",message:"Finnhub rate limit exceeded (History)"};if(403===l.status||401===l.status)throw{category:Ve.ACCESS_DENIED,provider:"finnhub",message:"Access denied to historical data"}}}else if("alphavantage"===t.provider&&t.alphaVantageKey){const e="compact",a=await fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${r}&outputsize=${e}&apikey=${t.alphaVantageKey}`),i=await a.json();if(i.Note||i.Information)throw{category:Ve.RATE_LIMIT,provider:"alphavantage",message:"Alpha Vantage rate limit exceeded (History)"};if(i["Error Message"])throw{category:Ve.ACCESS_DENIED,provider:"alphavantage",message:"Invalid API key or symbol not found"};if(i["Time Series (Daily)"]){const e=i["Time Series (Daily)"];s=Object.keys(e).map(t=>({date:t,price:parseFloat(e[t]["4. close"])})).sort((e,t)=>e.date.localeCompare(t.date))}}}if(s.length>0){const e=a.toISOString().split("T")[0];let t=s.filter(t=>t.date>=e);if(0===t.length&&s.length>0)t=[s[s.length-1]];else if(t.length>0&&t[0].date>e){const e=s.findIndex(e=>e.date===t[0].date);e>0&&t.unshift(s[e-1])}s=t}if(s.length>0)return Ze.saveCache(i,s),s;{if(null==n?void 0:n.data)return n.data;const t=(new Date).toISOString().split("T")[0],s=new Date;return s.setFullYear(s.getFullYear()-1),[{date:s.toISOString().split("T")[0],price:e.currentPrice},{date:t,price:e.currentPrice}]}}catch(c){return(null==n?void 0:n.data)||[]}},dt=(e,t,s,a)=>{if(t===s)return e;const r=a[t]||1,i=a[s]||1;return 0===r?e:e/r*i},ut={en:{dashboard:"Dashboard",assets:"Assets",history:"History",analytics:"Analytics",settings:"Settings",disclaimer:"Data provided for demo purposes. Not financial advice.",overview:"Overview",netWorth:"Total Net Worth",totalAssets:"Total Assets",totalLiabilities:"Total Liabilities",dayPnL:"Today's P&L",allTime:"All time",grossValue:"Gross value before debt",outstandingDebt:"Outstanding Loans & Debt",netWorthTrend:"Net Worth Trend (30D)",assetAllocation:"Asset Allocation",topAsset:"Top Asset",hidden:"Hidden",chartHidden:"Chart Hidden in Privacy Mode",changeCurrency:"Change Base Currency",refreshPrices:"Refresh Prices",refreshing:"Refreshing...",assetsManagement:"Assets Management",assetsSubtitle:"Manage holdings and record trades.",addNewAsset:"Add New Asset",portfolioHoldings:"Portfolio Holdings",noAssets:'No assets found. Click "Add New Asset" to start.',actions:"Actions",asset:"Asset",currentPrice:"Price",avgCost:"Cost",holdings:"Holdings",value:"Value",statusPnL:"Status / P&L",confirmDelete:"Are you sure you want to delete {symbol}? This action cannot be undone.",updatePrice:"Quick Update Price",delete:"Delete",editDetails:"Edit Details",live:"Live",manual:"Manual",liveData:"Data fetched automatically from API",manualValuation:"Valuation set manually",lastUpdated:"Last Updated",dataStale:"Update failed or data delayed > 30m",offline:"Offline",selectAssetType:"Select Asset Type",whatKind:"What kind of asset do you want to track?",assetDetails:"Asset Details",enterDetails:"Enter details for",editHolding:"Edit Holding",updateParams:"Update your holding parameters",identification:"1. Identification",changeType:"Change Type",tickerLabel:"Ticker / Currency Code",nameLabel:"Full Name (Optional)",currencyLabel:"Currency",valuationHoldings:"2. Valuation & Holdings",quantity:"Quantity",balance:"Balance",principalRemaining:"Principal Remaining",unitPrice:"Current Unit Price",costBasis:"Avg Cost (USD Basis)",avgCostUnit:"Average Cost / Unit",dateAcquired:"Start Time",autoFetch:"* Live prices will be fetched automatically based on ticker symbol.",autoFetchCash:"* Live exchange rates (USD) will be fetched automatically.",saveChanges:"Save Changes",addToPortfolio:"Add Asset to Portfolio",type_stock:"Stock",type_crypto:"Crypto",type_fund:"Fund / ETF",type_real_estate:"Real Estate",type_cash:"Cash",type_liability:"Liability",type_other:"Custom",recordTransaction:"Record Transaction",transactionHistory:"Transaction History",historySubtitle:"View and filter your investment activity.",exportCSV:"Export CSV",action:"Action",date:"Time",pricePerUnit:"Price",fees:"Fees",totalEstimate:"Total Estimate",total:"Total",type:"Type",allAssets:"All Assets",allTypes:"All Types",fromDate:"From",toDate:"To",noTransactions:"No transactions found matching your filters.",selectAssetPlaceholder:"Select an asset...",tx_BUY:"Buy",tx_SELL:"Sell",tx_DIVIDEND:"Dividend",deleteTransaction:"Delete Transaction",confirmDeleteTransaction:"Are you sure you want to delete this transaction? This will attempt to reverse the effect on your asset balance and cost.",analyticsSubtitle:"Performance metrics & risk analysis",noAssetsAnalytics:"Add assets to see analytics",netWorthStructure:"Net Worth Structure",debtRatio:"Debt Ratio",highLeverage:"High Leverage",healthy:"Healthy",riskAnalysis:"Risk Analysis",aiAssessment:"AI Assessment",startRiskAnalysis:"Start Risk Analysis",recalculate:"Recalculate",costVsValue:"Cost vs. Value",topMovers:"Top Movers",liabilityBreakdown:"Liability Breakdown",risk_high:"High (Crypto)",risk_medium:"Medium (Stocks)",risk_low:"Low (Stable)",label_assets:"Assets",label_liabilities:"Liabilities",label_cost:"Cost",label_value:"Market Value",label_net_pnl:"Net P&L",managePreferences:"Manage your preferences and data.",apiConfiguration:"API Configuration",apiKeysSecurity:"All API keys are stored exclusively in your browser's LocalStorage.",aiProvider:"AI Model Provider",aiProviderDesc:"Select which AI service to use for Portfolio Insights.",geminiKey:"Gemini API Key",geminiKeyDesc:"Enables AI Insights & Chat Assistant.",deepSeekKey:"DeepSeek API Key",deepSeekKeyDesc:"Use DeepSeek V3 model for portfolio analysis.",finnhubKey:"Finnhub API Key",finnhubKeyDesc:"Required for fetching live stock prices (Free Tier: 60 calls/min).",alphaVantageKey:"Alpha Vantage API Key",alphaVantageKeyDesc:"Alternative provider (Free Tier: 25 calls/day).",marketDataProvider:"Market Data Source",marketDataProviderDesc:"Choose your preferred stock price provider.",marketDataKeyMissing:"Please add your API Key in Settings for accurate data.",getKey:"Get a key here",generalPreferences:"General Preferences",baseCurrency:"Base Currency",baseCurrencyDesc:"Default currency for portfolio display",language:"Language",languageDesc:"Display language for the application",privacyDataManagement:"Privacy & Data Management",privacyMode:"Privacy Mode",privacyModeDesc:"Conceal all monetary values and holdings",exportUnified:"Export Unified Data",exportUnifiedDesc:"Single CSV containing all transactions & asset details.",importData:"Import CSV Data",uploadCSV:"Upload CSV File",importHint:"Upload the unified 'Panasset Data' CSV. The system will auto-restore both assets and transactions.",resetData:"Reset Data",resetDesc:"Clear all assets",resetConfirm:"Are you sure? This will permanently delete all your assets and transactions. This action cannot be undone.",importSuccess:"Import successful!",importError:"Failed to parse CSV. Please ensure the file is valid.",resetSuccess:"All data has been reset.",localDataSecurity:"Data Security: All your financial data is stored locally in this browser. We do not use servers to store your personal assets.",aiAssistant:"AI Assistant",aiInsights:"AI Portfolio Insights",wealthManagement:"Wealth Management & Optimization",analyzeNow:"Analyze Now",upToDate:"Up to date",apiKeyMissing:"API Key is missing. Please set it in Settings.",setKey:"Set Key",unableToGenerate:"Unable to generate risk analysis.",aiUnavailable:"AI features unavailable. Please check your API Key.",voiceInput:"Voice Input",listening:"Listening...",processing:"Processing...",voiceError:"Voice input failed",voicePermissionDenied:"Microphone permission denied. Please allow access.",voiceNoSupport:"Browser not supported",voiceHint:'Try: "Bought 10 Apple stocks at 150"',holdToTalk:"Hold to Talk",releaseToSend:"Release to Send",switchToKeyboard:"Switch to Keyboard",switchToVoice:"Switch to Voice",feedback:"Feedback",haveFeedback:"Have feedback?",reportBug:"Report a Bug / Suggestion",githubLinkText:"Submit on GitHub",githubDesc:"Help us improve PanassetLite by submitting issues or feature requests.",userGuide:"User Guide",about:"About PanassetLite",error_api_key_missing:"API Key is missing. Please add it in Settings.",error_api_key_invalid:"API Key is invalid or expired. Please check your credentials.",error_rate_limit:"Rate limit exceeded. Please try again later.",error_rate_limit_av:"Alpha Vantage rate limit reached (25 calls/day). Try again tomorrow or switch to Finnhub.",error_rate_limit_fh:"Finnhub rate limit reached. Please wait a moment and try again.",error_access_denied:"Access denied to this resource. Consider upgrading your plan or switching providers.",error_network:"Network error. Please check your internet connection.",error_switch_provider:"Consider switching to {provider} in Settings.",error_unknown:"An unexpected error occurred while fetching market data."},zh:{dashboard:"仪表盘",assets:"资产管理",history:"交易历史",analytics:"投资分析",settings:"系统设置",disclaimer:"数据仅供演示，不构成投资建议。",overview:"概览",netWorth:"总资产净值",totalAssets:"总资产",totalLiabilities:"总负债",dayPnL:"今日盈亏",allTime:"历史累计",grossValue:"资产总值 (折合)",outstandingDebt:"未偿还贷款与债务",netWorthTrend:"净值趋势 (30天)",assetAllocation:"资产分布",topAsset:"最大持仓",hidden:"已隐藏",chartHidden:"隐私模式下图表已隐藏",changeCurrency:"切换基准货币",refreshPrices:"刷新价格",refreshing:"刷新中...",assetsManagement:"资产管理",assetsSubtitle:"管理您的持仓并记录交易。",addNewAsset:"添加新资产",portfolioHoldings:"持仓列表",noAssets:"暂无资产。点击“添加新资产”开始。",actions:"操作",asset:"资产",currentPrice:"现价",avgCost:"成本",holdings:"持仓",value:"市值",statusPnL:"状态 / 盈亏",confirmDelete:"您确定要删除 {symbol} 吗？此操作无法撤销。",updatePrice:"更新价格",delete:"删除",editDetails:"编辑详情",live:"联网",manual:"手动",liveData:"价格通过 API 自动获取",manualValuation:"手动设置的估值",lastUpdated:"最后更新",dataStale:"数据更新失败或已过期 >30分",offline:"离线",selectAssetType:"选择资产类型",whatKind:"您想追踪哪类资产？",assetDetails:"资产详情",enterDetails:"输入详情：",editHolding:"编辑持仓",updateParams:"更新您的持仓参数",identification:"1. 基本信息",changeType:"更改类型",tickerLabel:"代码 / 货币符号",nameLabel:"全称 (选填)",currencyLabel:"计价货币",valuationHoldings:"2. 估值与持仓",quantity:"数量",balance:"余额",principalRemaining:"剩余本金",unitPrice:"当前单价",costBasis:"单位成本 (USD计价)",avgCostUnit:"平均成本 / 单位",dateAcquired:"持仓开始时间",autoFetch:"* 将根据代码自动获取实时价格。",autoFetchCash:"* 将自动获取实时汇率 (USD)。",saveChanges:"保存更改",addToPortfolio:"添加到投资组合",type_stock:"股票",type_crypto:"加密货币",type_fund:"基金 / ETF",type_real_estate:"房地产",type_cash:"现金",type_liability:"负债",type_other:"自定义资产",recordTransaction:"记录交易",transactionHistory:"交易历史",historySubtitle:"查看与筛选您的投资活动。",exportCSV:"导出 CSV",action:"操作",date:"交易时间",pricePerUnit:"单价",fees:"手续费",totalEstimate:"预估总额",total:"总额",type:"类型",allAssets:"所有资产",allTypes:"所有类型",fromDate:"起始时间",toDate:"结束时间",noTransactions:"未找到符合条件的交易。",selectAssetPlaceholder:"选择资产...",tx_BUY:"买入",tx_SELL:"卖出",tx_DIVIDEND:"股息",deleteTransaction:"删除交易",confirmDeleteTransaction:"您确定要删除这条交易记录吗？系统将尝试回滚该交易对您资产余额和成本的影响。",analyticsSubtitle:"绩效指标与风险分析",noAssetsAnalytics:"添加资产以查看分析",netWorthStructure:"净值结构",debtRatio:"负债率",highLeverage:"高杠杆",healthy:"健康",riskAnalysis:"风险分析",aiAssessment:"AI 评估",startRiskAnalysis:"开始风险分析",recalculate:"重新计算",costVsValue:"成本 vs 市值",topMovers:"盈亏排行",liabilityBreakdown:"负债明细",risk_high:"高风险 (加密货币)",risk_medium:"中风险 (股票)",risk_low:"低风险 (稳定资产)",label_assets:"资产",label_liabilities:"负债",label_cost:"成本",label_value:"市值",label_net_pnl:"净盈亏",managePreferences:"管理您的偏好与数据。",apiConfiguration:"API 配置",apiKeysSecurity:"所有 API 密钥仅存储在您浏览器的本地存储中。",aiProvider:"AI 模型服务商",aiProviderDesc:"选择用于投资组合智能分析的 AI 服务。",geminiKey:"Gemini API Key",geminiKeyDesc:"配置即可开启 AI 洞察与智能助手。",deepSeekKey:"DeepSeek API Key",deepSeekKeyDesc:"使用 DeepSeek V3 模型进行投资组合分析。",finnhubKey:"Finnhub API Key",finnhubKeyDesc:"获取实时股票价格所需 (收费版: 30次/分钟)。",alphaVantageKey:"Alpha Vantage API Key",alphaVantageKeyDesc:"备用数据源 (免费版: 25次/天)。",marketDataProvider:"行情数据源",marketDataProviderDesc:"选择您偏好的股票价格数据提供商。",marketDataKeyMissing:"请在设置中添加 API 密钥以获取准确数据。",getKey:"获取密钥",generalPreferences:"通用设置",baseCurrency:"基准货币",baseCurrencyDesc:"用于投资组合展示的默认货币",language:"语言 (Language)",languageDesc:"应用程序显示语言",privacyDataManagement:"隐私与数据管理",privacyMode:"隐私模式",privacyModeDesc:"隐藏所有资产金额与持仓细节",exportUnified:"导出完整数据",exportUnifiedDesc:"下载包含所有交易与资产详情的单一 CSV 文件。",importData:"导入数据",uploadCSV:"上传 CSV 文件",importHint:"上传 Panasset 导出的统一格式 CSV。系统将自动恢复资产档案与交易流水。",resetData:"重置数据",resetDesc:"清空所有资产",resetConfirm:"确定要清空吗？这将永久删除您的所有资产和交易记录，无法撤销。",importSuccess:"导入成功！",importError:"文件解析失败，请确保格式有效。",resetSuccess:"所有数据已重置。",localDataSecurity:"数据安全声明：您的财务数据仅存储在本地设备上 (LocalStorage)。我们没有任何服务器来存储您的个人资产信息。",aiAssistant:"AI 智能助手",aiInsights:"AI 投资组合洞察",wealthManagement:"财富管理与优化建议",analyzeNow:"立即分析",upToDate:"已是最新",apiKeyMissing:"缺少 API Key。请在设置中配置。",setKey:"Set Key",unableToGenerate:"Unable to generate risk analysis.",aiUnavailable:"AI 功能不可用，请检查 API Key。",voiceInput:"语音录入",listening:"聆听中...",processing:"分析中...",voiceError:"识别失败",voicePermissionDenied:"麦克风权限被拒绝，请允许访问。",voiceNoSupport:"浏览器不支持",voiceHint:'尝试说: "今天以 180 美元买入了 10 股苹果"',holdToTalk:"按住 说话",releaseToSend:"松开 发送",switchToKeyboard:"切换键盘",switchToVoice:"切换语音",feedback:"反馈建议",haveFeedback:"有反馈意见？",reportBug:"提交 Bug 或功能建议",githubLinkText:"前往 GitHub 提交",githubDesc:"提交 Issue 或功能建议，帮助我们改进 PanassetLite。",userGuide:"使用指南",about:"关于 盘资产·轻",error_api_key_missing:"缺少 API 密钥。请在设置中添加。",error_api_key_invalid:"API 密钥无效或已过期。请检查您的凭据。",error_rate_limit:"已超出请求频率限制。请稍后重试。",error_rate_limit_av:"Alpha Vantage 已达到频率限制（25次/天）。请明天再试或切换至 Finnhub。",error_rate_limit_fh:"Finnhub 已达到频率限制。请稍等片刻后重试。",error_access_denied:"访问被拒绝。考虑升级订阅或切换数据提供商。",error_network:"网络错误。请检查您的网络连接。",error_switch_provider:"考虑在设置中切换到 {provider}。",error_unknown:"获取市场数据时发生未知错误。"}},mt=(e,t)=>{const{assets:s,transactions:a,v2Metadata:r}=Ze.getLegacyData();if(s&&!r)try{const r=JSON.parse(s),i=a?JSON.parse(a):[],n=[],l=[...i];r.forEach(e=>{n.push({id:e.id,symbol:e.symbol,name:e.name,type:e.type,currency:e.currency,currentPrice:e.currentPrice,lastUpdated:e.lastUpdated,dateAcquired:e.dateAcquired});if(!i.some(t=>t.assetId===e.id)&&e.quantity>0){const t=e.dateAcquired?`${e.dateAcquired}T00:00:00`:(new Date).toISOString();l.push({id:crypto.randomUUID(),assetId:e.id,type:He.BUY,date:t,quantityChange:e.quantity,pricePerUnit:e.avgCost,fee:0,total:e.quantity*e.avgCost,note:"Migration: Initial Balance"})}}),e(n),t(l),Ze.saveAssetMetas(n),Ze.saveTransactions(l),Ze.clearLegacyData()}catch(i){}},pt=(e,t)=>(t(t=>{const s=[...t];return e.forEach(e=>{const t=s.findIndex(t=>t.id===e.id);t>=0?s[t]={...s[t],...e}:s.push(e)}),s}),e.length),xt=(e,t)=>(t(t=>{const s=[...t];return e.forEach(e=>{const t=s.findIndex(t=>t.id===e.id);t>=0?s[t]={...s[t],...e}:s.push(e)}),s}),e.length);const ht=new class{constructor(){this.listeners=[],this.toastCounter=0}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notify(e){this.listeners.forEach(t=>t(e))}showToast(e,t,s){const a={id:`toast-${++this.toastCounter}-${Date.now()}`,type:e,message:t,duration:void 0!==s?s:5e3};this.notify(a)}showError(e,t){this.showToast("error",e,t)}showWarning(e,t){this.showToast("warning",e,t)}showInfo(e,t){this.showToast("info",e,t)}showSuccess(e,t){this.showToast("success",e,t)}},gt=(t,s,a)=>{const[r,i]=e.useState({USD:1,CNY:7.2,HKD:7.8}),[n,l]=e.useState(!1),o=e.useRef(a);e.useEffect(()=>{o.current=a},[a]);const c=e=>{const t=ut[o.current.language],s="finnhub"===e.provider?"Alpha Vantage":"Finnhub";switch(e.category){case Ve.API_KEY_MISSING:return t.error_api_key_missing;case Ve.API_KEY_INVALID:return t.error_api_key_invalid;case Ve.RATE_LIMIT:return"alphavantage"===e.provider?t.error_rate_limit_av:t.error_rate_limit_fh;case Ve.ACCESS_DENIED:return`${t.error_access_denied} ${t.error_switch_provider.replace("{provider}",s)}`;case Ve.NETWORK_ERROR:return t.error_network;default:return t.error_unknown}};return{exchangeRates:r,isRefreshing:n,refreshPrices:async e=>{l(!0);const a=e||t;try{const e=await(async()=>{const e=Ze.getCache(et),t=!e||Date.now()-e.timestamp>864e5;if(e&&!t)return e.data;try{const e=await fetch("https://api.exchangerate-api.com/v4/latest/USD");if(!e.ok)throw new Error("Network response was not ok");const t=await e.json();return Ze.saveCache(et,t.rates),t.rates}catch(s){return(null==e?void 0:e.data)||{USD:1,CNY:7.2,HKD:7.8}}})();i(e);const[t,r]=await Promise.all([nt(a),ot(a,{provider:o.current.marketDataProvider||"finnhub",alphaVantageKey:o.current.alphaVantageApiKey,finnhubKey:o.current.finnhubApiKey}).catch(e=>(ht.showError(c(e)),{}))]);s(s=>s.map(s=>{let a=s.currentPrice,i=s.currency,n=s.lastUpdated;if(s.type===Fe.CRYPTO&&t[s.id])a=t[s.id],i=Ye.USD,n=Date.now();else if(s.type!==Fe.STOCK&&s.type!==Fe.FUND||!r[s.id]){if(s.type===Fe.CASH){const t=e[s.symbol];t&&t>0&&(a=1/t,i=Ye.USD,n=Date.now())}}else a=r[s.id].price,i=r[s.id].currency,n=r[s.id].lastUpdated||Date.now();return{...s,currentPrice:a,currency:i,lastUpdated:n}}))}catch(r){r.category?ht.showError(c(r)):ht.showError(ut[o.current.language].error_network)}finally{l(!1)}}}},bt=e.createContext(void 0),yt={baseCurrency:Ye.USD,isPrivacyMode:!1,geminiApiKey:"",deepSeekApiKey:"",aiProvider:"gemini",marketDataProvider:"finnhub",alphaVantageApiKey:"",finnhubApiKey:"",language:navigator.language.toLowerCase().startsWith("zh")?"zh":"en"},ft=({children:s})=>{const[a,r]=e.useState(()=>Ze.getAssetMetas()),[i,n]=e.useState(()=>Ze.getTransactions()),[l,o]=e.useState(()=>{const e=Ze.getSettings();return e?{...yt,...e,geminiApiKey:e.geminiApiKey||""}:yt}),{exchangeRates:c,isRefreshing:d,refreshPrices:u}=gt(a,r,l);e.useEffect(()=>{mt(r,n)},[]),e.useEffect(()=>{(a.length>0||i.length>0)&&(Ze.saveAssetMetas(a),Ze.saveTransactions(i))},[a,i]),e.useEffect(()=>{Ze.saveSettings(l)},[l]);const m=((t,s)=>e.useMemo(()=>{const e=new Map;return t.forEach(t=>{e.set(t.id,{...t,quantity:0,avgCost:0,totalCost:0,currentValue:0,pnl:0,pnlPercent:0,realizedPnL:0})}),[...s].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()).forEach(t=>{const s=e.get(t.assetId);if(s)if(t.type===He.BUY||t.type===He.DEPOSIT||t.type===He.BORROW){const e=t.total,a=s.totalCost+e,r=s.quantity+t.quantityChange;s.quantity=r,s.totalCost=a,r>0&&(s.avgCost=a/r)}else if(t.type===He.SELL||t.type===He.WITHDRAWAL||t.type===He.REPAY){const e=Math.abs(t.quantityChange),a=e*s.avgCost,r=t.total-a;s.quantity-=e,s.totalCost-=a,s.realizedPnL+=r,s.quantity<=1e-6&&(s.quantity=0,s.totalCost=0,s.avgCost=0)}else if(t.type===He.BALANCE_ADJUSTMENT)if(t.quantityChange>0)s.quantity+=t.quantityChange,s.totalCost+=t.total,s.quantity>0&&(s.avgCost=s.totalCost/s.quantity);else{const e=Math.abs(t.quantityChange),a=e/s.quantity;s.totalCost-=s.totalCost*a,s.quantity-=e}else t.type===He.DIVIDEND&&(s.realizedPnL+=t.total)}),Array.from(e.values()).map(e=>{const t=e.quantity*e.currentPrice,s=t-e.totalCost,a=0!==e.totalCost?s/e.totalCost*100:0;return{...e,currentValue:t,pnl:s,pnlPercent:a}})},[t,s]))(a,i);return t.jsx(bt.Provider,{value:{assets:m,transactions:i,settings:l,exchangeRates:c,isRefreshing:d,addAsset:(e,t,s,a)=>{if(r(t=>[...t,e]),t>0){const r={id:crypto.randomUUID(),assetId:e.id,type:e.type===Fe.LIABILITY?He.BORROW:He.BUY,date:a,quantityChange:t,pricePerUnit:s,fee:0,total:t*s,note:"Initial Holding"};n(e=>[...e,r])}u()},editAsset:e=>{r(t=>t.map(t=>t.id===e.id?e:t))},deleteAsset:e=>{r(t=>t.filter(t=>t.id!==e)),n(t=>t.filter(t=>t.assetId!==e)),(e=>{const t=`${at}_${e}`;Ze.remove(t)})(e)},addTransaction:e=>{const t={...e,id:crypto.randomUUID()};n(e=>[...e,t])},editTransaction:e=>{n(t=>t.map(t=>t.id===e.id?e:t))},deleteTransaction:e=>{n(t=>t.filter(t=>t.id!==e))},updateAssetPrice:(e,t)=>{r(s=>s.map(s=>s.id===e?{...s,currentPrice:t,lastUpdated:Date.now()}:s))},refreshPrices:u,updateSettings:e=>{o(t=>({...t,...e}))},importAssetsCSV:e=>pt(e,r),importTransactionsCSV:e=>xt(e,n),clearData:()=>{r([]),n([]),Ze.clearAllData(),Ze.clearItemsByPrefix(at)},t:e=>{var t;const s=l.language||"en";return(null==(t=ut[s])?void 0:t[e])||e}},children:s})},vt=()=>{const t=e.useContext(bt);if(void 0===t)throw new Error("usePortfolio must be used within a PortfolioProvider");return t},jt={name:"get_assets",description:"Read current portfolio holdings/assets. Returns list of assets with ids, symbols, quantities, etc."},Nt={name:"get_transactions",description:"Read transaction history. Supports filtering by symbol or type. Returns list of transactions with ids, dates, prices.",parameters:{type:a.OBJECT,properties:{symbol:{type:a.STRING,description:"Filter by asset symbol (e.g. AAPL)"},limit:{type:a.NUMBER,description:"Limit number of results (default 10)"}}}},wt={name:"propose_asset_mutation",description:"Propose to Add, Update, or Delete a single Asset Metadata. Use this for precise single edits.",parameters:{type:a.OBJECT,properties:{mutationType:{type:a.STRING,enum:["ADD","UPDATE","DELETE"],description:"Type of change"},symbol:{type:a.STRING,description:"Asset Symbol (Required for ADD)"},assetId:{type:a.STRING,description:"Asset ID (Required for UPDATE/DELETE). Use get_assets to find ID."},initialQuantity:{type:a.NUMBER,description:"Initial quantity to hold immediately (for ADD only)."},price:{type:a.NUMBER,description:"Price or Cost"},assetType:{type:a.STRING,enum:["STOCK","CRYPTO","CASH","REAL_ESTATE","LIABILITY","FUND","OTHER"],description:"Asset Type (for ADD)"},name:{type:a.STRING,description:"Asset Name"},currency:{type:a.STRING,enum:["USD","CNY","HKD"],description:"Currency of the asset."},dateAcquired:{type:a.STRING,description:"Date acquired (ISO 8601 YYYY-MM-DD or YYYY-MM-DDTHH:mm:ss). Use if user specifies a past date."}},required:["mutationType"]}},St={name:"propose_bulk_asset_update",description:"Propose MULTIPLE asset additions or updates at once. Use this for analyzing IMAGES or for BATCH UPDATES (e.g. 'set all stocks to quantity 10').",parameters:{type:a.OBJECT,properties:{assets:{type:a.ARRAY,description:"List of assets identified from the image.",items:{type:a.OBJECT,properties:{symbol:{type:a.STRING,description:"Ticker Symbol (e.g. AAPL, 00700)"},name:{type:a.STRING,description:"Asset Name"},quantity:{type:a.NUMBER,description:"Quantity held"},price:{type:a.NUMBER,description:"Current Price or Cost Basis"},currency:{type:a.STRING,enum:["USD","CNY","HKD"],description:"Inferred currency"},assetType:{type:a.STRING,enum:["STOCK","CRYPTO","CASH","REAL_ESTATE","LIABILITY","FUND","OTHER"],description:"Asset Type"},dateAcquired:{type:a.STRING,description:"Date acquired if visible/known"}},required:["symbol","quantity"]}}},required:["assets"]}},At={name:"propose_transaction_mutation",description:"Propose to Add (Record), Update, or Delete a Transaction. Use this for adding trades to EXISTING assets.",parameters:{type:a.OBJECT,properties:{mutationType:{type:a.STRING,enum:["ADD","UPDATE","DELETE"],description:"Type of change"},transactionId:{type:a.STRING,description:"Transaction ID (Required for UPDATE/DELETE). Use get_transactions to find ID."},assetId:{type:a.STRING,description:"Asset ID (Required for ADD). Use get_assets to find ID."},txType:{type:a.STRING,enum:["BUY","SELL","DIVIDEND","DEPOSIT","WITHDRAWAL","BORROW","REPAY"],description:"Transaction Type"},quantity:{type:a.NUMBER,description:"Quantity"},price:{type:a.NUMBER,description:"Price per unit"},date:{type:a.STRING,description:"ISO 8601 Date Time string (YYYY-MM-DDTHH:mm:ss)"},fee:{type:a.NUMBER,description:"Transaction fees"}},required:["mutationType"]}},Dt={name:"propose_batch_delete",description:"Propose to DELETE multiple assets at once based on criteria (e.g. 'delete all crypto', 'delete everything except Tesla').",parameters:{type:a.OBJECT,properties:{assetIds:{type:a.ARRAY,description:"List of Asset IDs to delete. Use get_assets to find IDs matching the user's criteria.",items:{type:a.STRING}},reason:{type:a.STRING,description:"Reason for deletion (for summary)"}},required:["assetIds"]}};class Tt{constructor(e){this.ai=null,this.modelName="gemini-2.5-flash",e&&(this.ai=new s({apiKey:e}))}async processMessage(e,t,s,a,r,i,n){var l,o;if(!this.ai)return{text:"zh"===i?"我需要 **Gemini API Key** 才能作为您的 AI 助手工作。\n\n请前往 **设置** 页面进行配置。":"I need a **Gemini API Key** to function as your AI assistant. \n\nPlease go to **Settings** to configure it."};try{const c=new Date,d=c.toISOString().split("T")[0],u=c.toISOString(),m=`\n        You are the intelligent assistant for "PanassetLite".\n        Today is ${d}. Current Time is ${u}. Base Currency: ${r}.\n        \n        **Language Rule:**\n        ${"zh"===i?"You MUST reply in Chinese (Simplified).":"You MUST reply in English."}\n        \n        **Capabilities:**\n        1. **READ**: You can inspect the user's Assets and Transaction History using \`get_assets\` and \`get_transactions\`.\n        2. **WRITE**: You can propose changes using \`propose_asset_mutation\` (single) or \`propose_transaction_mutation\` (trades).\n        3. **BULK IMPORT**: If the user provides an IMAGE/SCREENSHOT, use \`propose_bulk_asset_update\` to extract items.\n        \n        **Universal Asset Logic:**\n        1.  **Scope**: **ANYTHING can be an asset.** You are NOT limited to financial documents.\n            -   **Physical Items**: Cars, watches, electronics, bags, wine, etc.\n            -   **Virtual Items**: Game skins, domain names, etc.\n            -   **Financial**: Stocks, crypto, cash, funds.\n\n        2.  **Symbol/ID Generation**:\n            -   **Financial**: Use the Ticker (e.g., AAPL, BTC).\n            -   **Physical/Other**: Generate a concise, logical ID (e.g., "ROLEX_SUB_DATE", "MACBOOK_PRO_M3", "VINTAGE_WINE_1990").\n\n        3.  **Asset Type Inference**:\n            -   Stocks/Crypto/Funds/Cash -> Use respective types.\n            -   Real Estate -> REAL_ESTATE.\n            -   Everything else (Cars, Watches, Electronics, Art) -> **OTHER**.\n\n        4.  **Quantity Rules**:\n            -   **Default**: If the user mentions buying/adding an item without specifying a quantity (e.g., "I bought a laptop", "Add a roller skate"), you MUST set quantity to 1.\n            -   **Count**: For images, count the items.\n\n        5.  **Price/Value**:\n            -   If a price is visible/stated, use it.\n            -   If NO price is stated, **ESTIMATE** the current market value based on your knowledge.\n\n        6.  **Currency Inference**:\n            -   Infer based on symbol, name, or context (e.g. RMB for Chinese items, USD for global tech).\n\n        **Tool Usage Rules:**\n        -   **Single Item (Text)**: Use \`propose_asset_mutation\` (ADD/UPDATE).\n        -   **Multiple Items (Image/Text)**: Use \`propose_bulk_asset_update\`.\n        -   **Transactions**: If the asset ALREADY exists (check \`get_assets\`), use \`propose_transaction_mutation\` instead of adding it again.\n\n\n        **TOOL CALLING RULES:**\n        - **DO NOT** use \`print()\`, \`console.log()\`, or any other output wrapper.\n        - **DO NOT** wrap the function call in a code block (e.g. \`\`\`python ... \`\`\`).\n        - **DO NOT** use \`default_api.\` or any other object prefix. Just call the function name directly.\n        - **CORRECT**: \`propose_bulk_asset_update(assets = [...])\`\n        - **INCORRECT**: \`print(propose_bulk_asset_update(...))\`\n        - **INCORRECT**: \`default_api.propose_bulk_asset_update(...)\`\n        - Ensure arguments match the JSON schema exactly.\n      `,p=t.filter(e=>"system"!==e.role).slice(-10).map(e=>{const t=[];if(e.image){const s=e.image.split(",")[1],a=e.image.split(";")[0].split(":")[1];t.push({inlineData:{mimeType:a,data:s}})}return e.content&&e.content.trim().length>0&&t.push({text:e.content}),{role:"user"===e.role?"user":"model",parts:t}}),x=this.ai.chats.create({model:this.modelName,history:p,config:{systemInstruction:m,tools:[{functionDeclarations:[jt,Nt,wt,St,At,Dt]}]}}),h=[];if(n){const e=n.split(",")[1],t=n.split(";")[0].split(":")[1];h.push({inlineData:{mimeType:t,data:e}}),h.push({text:"Please analyze this image and list all asset holdings found. Use the bulk update tool."})}const g=e.trim();g?h.push({text:g}):0===h.length&&h.push({text:"."});let b=await x.sendMessage({message:h});const y=b.functionCalls;if(y&&y.length>0){const e=y[0];if("get_assets"===e.name){const t={assets:s.map(e=>({id:e.id,symbol:e.symbol,name:e.name,qty:e.quantity,price:e.currentPrice}))};b=await x.sendMessage({message:[{functionResponse:{name:e.name,response:t}}]})}else if("get_transactions"===e.name){const t=e.args;let r=[...a];if(t.symbol){const e=s.find(e=>e.symbol===t.symbol.toUpperCase());r=e?r.filter(t=>t.assetId===e.id):[]}r=r.sort((e,t)=>t.date.localeCompare(e.date)).slice(0,t.limit||10);const i={transactions:r.map(e=>{const t=s.find(t=>t.id===e.assetId);return{id:e.id,date:e.date,type:e.type,symbol:null==t?void 0:t.symbol,qty:e.quantityChange,price:e.pricePerUnit}})};b=await x.sendMessage({message:[{functionResponse:{name:e.name,response:i}}]})}const t=b.functionCalls;if(t&&t.length>0){const e=t[0],a=e.args;if("propose_asset_mutation"===e.name){const e={ADD:"ADD_ASSET",UPDATE:"UPDATE_ASSET",DELETE:"DELETE_ASSET"}[a.mutationType];let t=a.symbol;if(!t&&a.assetId){const e=s.find(e=>e.id===a.assetId);e&&(t=e.symbol)}const r=`${a.mutationType} Asset: ${t||a.assetId||"Unknown"}`;return{text:"",action:{type:e,targetId:a.assetId,data:{symbol:a.symbol,name:a.name,quantity:a.initialQuantity,price:a.price,type:a.assetType,currency:a.currency,date:a.dateAcquired},summary:r}}}if("propose_bulk_asset_update"===e.name){const e=(null==(l=a.assets)?void 0:l.length)||0,t="zh"===i?`从图片识别到 ${e} 个资产持仓`:`Identified ${e} assets from image`;return{text:"zh"===i?"我从图片中识别到了以下资产，请确认是否导入：":"I found the following assets in the image. Please confirm to import:",action:{type:"BULK_ASSET_UPDATE",data:{},items:a.assets,summary:t}}}if("propose_transaction_mutation"===e.name){const e={ADD:"ADD_TRANSACTION",UPDATE:"UPDATE_TRANSACTION",DELETE:"DELETE_TRANSACTION"}[a.mutationType];let t="Unknown";if(a.assetId){const e=s.find(e=>e.id===a.assetId);e&&(t=e.symbol)}const r=`${a.mutationType} Transaction: ${a.txType||""} ${t}`;return{text:"",action:{type:e,targetId:a.transactionId,data:{assetId:a.assetId,type:a.txType,quantity:a.quantity,price:a.price,date:a.date,fee:a.fee},summary:r}}}if("propose_batch_delete"===e.name){const e=(null==(o=a.assetIds)?void 0:o.length)||0,t="zh"===i?`批量删除 ${e} 个资产: ${a.reason||""}`:`Batch delete ${e} assets: ${a.reason||""}`;return{text:"zh"===i?`我建议删除以下 ${e} 个资产。请确认：`:`I propose deleting the following ${e} assets. Please confirm:`,action:{type:"BATCH_DELETE_ASSET",data:{},items:a.assetIds.map(e=>({id:e})),summary:t}}}}}return{text:b.text||""}}catch(c){return{text:"zh"===i?"抱歉，AI 暂时无法处理您的请求。":"Sorry, I encountered an issue processing your request."}}}}class Ct extends Error{constructor(e,t,s){super(e),this.provider=t,this.originalError=s,this.name="AIError"}}class It extends Ct{constructor(e,t,s){super(e,t,s),this.name="AIParseError"}}class kt{constructor(e){this.ai=new s({apiKey:e})}async generateText(e){try{return(await this.ai.models.generateContent({model:"gemini-2.5-flash",contents:e})).text||""}catch(t){throw new Ct("Gemini Text Generation Failed","gemini",t)}}async generateJSON(e,t){const s={responseMimeType:"application/json"};t&&(s.responseSchema=t);try{const t=await this.ai.models.generateContent({model:"gemini-2.5-flash",contents:e,config:s});try{return JSON.parse(t.text)}catch(a){throw new It("Invalid JSON response from Gemini","gemini",a)}}catch(a){if(a instanceof It)throw a;throw new Ct("Gemini JSON Generation Failed","gemini",a)}}}class Et{constructor(e){this.baseUrl="https://api.deepseek.com/chat/completions",this.apiKey=e}async callAPI(e,t=!1){var s,a,r,i;try{const n=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:"deepseek-chat",messages:e,response_format:t?{type:"json_object"}:void 0,stream:!1})});if(!n.ok){const e=(null==(s=(await n.json().catch(()=>({}))).error)?void 0:s.message)||n.statusText;throw new Ct(`DeepSeek API Error: ${e}`,"deepseek")}return(null==(i=null==(r=null==(a=(await n.json()).choices)?void 0:a[0])?void 0:r.message)?void 0:i.content)||""}catch(n){if(n instanceof Ct)throw n;throw new Ct("DeepSeek Network/API Error","deepseek",n)}}async generateText(e){return this.callAPI([{role:"user",content:e}],!1)}async generateJSON(e,t){const s=await this.callAPI([{role:"user",content:e}],!0);try{return JSON.parse(s)}catch(a){throw new It("Invalid JSON response from DeepSeek","deepseek",a)}}}class Pt{static create(e,t){return"deepseek"===e?new Et(t):new kt(t)}}const _t="investflow_risk_cache",Lt="investflow_advisor_cache",Rt=864e5;let Ut=null,Mt=null;const zt=e=>e.map(e=>{const t=e.type===Fe.REAL_ESTATE||e.type===Fe.LIABILITY||e.type===Fe.OTHER?`:${e.currentPrice}`:"";return`${e.symbol}:${e.quantity}:${e.type}${t}`}).sort().join("|"),Ot=({onResult:s,onTextResult:l,mode:o,className:c="",variant:d="icon"})=>{const{settings:u,assets:m,t:p}=vt(),[x,h]=e.useState(!1),[g,b]=e.useState(!1),[y,f]=e.useState(null),v=e.useRef(null),j=e.useRef("");e.useEffect(()=>()=>{if(v.current)try{v.current.stop()}catch(e){}},[]);const N=async e=>{if(!e||!e.trim())return;if("CHAT"===o)return void(l&&l(e));b(!0);const t="deepseek"===u.aiProvider?u.deepSeekApiKey:u.geminiApiKey;try{const r=m.map(e=>({symbol:e.symbol,name:e.name,id:e.id})),i=await(async(e,t,s,r,i=[])=>{if(!s)throw new Error("API Key is missing");const n=`\n      Role: Financial Data Parser.\n      Task: Parse user spoken input into structured JSON for an app called 'InvestFlow'.\n      \n      Time Context: \n      - Current Reference Date/Time: ${(new Date).toISOString()}.\n      - Use this date to correctly resolve relative time terms like "today", "yesterday", "last friday", "5 minutes ago".\n\n      User Input: "${e}"\n      \n      Context Mode: ${t}\n      Existing Assets: ${JSON.stringify(i.map(e=>`${e.symbol} (${e.name})`))}\n\n      Instructions:\n      1. Extract 'symbol', 'quantity', 'price', 'date' (YYYY-MM-DDTHH:mm:ss is preferred if specific time mentioned, else YYYY-MM-DD), 'currency'.\n      2. **INTELLIGENT MAPPING**:\n         - **Symbols**: Use your broad financial knowledge to map spoken company names or asset classes to standard Ticker Symbols (e.g. "Nvidia" -> "NVDA", "Gold" -> "GOLD", "Maotai" -> "600519.SS"). \n         - **Manual Assets**: For Real Estate or unique items, generate a logical, concise uppercase ID (e.g. "APT_NY", "ROLEX_SUB").\n         - **Currencies**: Map spoken currency names (e.g. "RMB", "Bucks", "Yuan") to standard ISO 4217 codes (CNY, USD, HKD, etc.).\n      3. **TRANSACTION MODE**:\n         - If mode is TRANSACTION, map the input to one of the Existing Assets if possible.\n         - Determine 'txType' (BUY, SELL, DIVIDEND). Default to BUY if ambiguous.\n      4. **ASSET MODE**:\n         - Determine 'type' (STOCK, CRYPTO, FUND, CASH, REAL_ESTATE, LIABILITY, OTHER).\n      \n      Return STRICT JSON. No markdown formatting.\n      Fields: symbol, name, type (enum: STOCK, CRYPTO, FUND, CASH, REAL_ESTATE, LIABILITY, OTHER), txType (enum: BUY, SELL, DIVIDEND), quantity (number), price (number), date (string), currency (string).\n    `,l={type:a.OBJECT,properties:{symbol:{type:a.STRING},name:{type:a.STRING},type:{type:a.STRING,enum:["STOCK","CRYPTO","FUND","CASH","REAL_ESTATE","LIABILITY","OTHER"]},txType:{type:a.STRING,enum:["BUY","SELL","DIVIDEND"]},quantity:{type:a.NUMBER},price:{type:a.NUMBER},date:{type:a.STRING},currency:{type:a.STRING}}},o=Pt.create(r,s);return await o.generateJSON(n,l)})(e,o,t,u.aiProvider,r);i&&s&&s(i)}catch(r){f(p("voiceError"))}finally{b(!1)}},w=()=>{if(v.current){try{v.current.stop()}catch(e){}v.current=null,h(!1),setTimeout(()=>{const e=j.current;e&&e.trim().length>0&&N(e)},250)}},S=e=>{if(e.preventDefault(),e.stopPropagation(),v.current)return;j.current="",f(null);const t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t)return void f(p("voiceNoSupport"));if("CHAT"!==o){if(!("deepseek"===u.aiProvider?u.deepSeekApiKey:u.geminiApiKey))return void f(p("apiKeyMissing"))}h(!0);const s=new t;v.current=s,s.continuous=!0,s.interimResults=!0,s.lang="zh"===u.language?"zh-CN":"en-US",s.onresult=e=>{const t=Array.from(e.results).map(e=>e[0].transcript).join("");j.current=t},s.onerror=e=>{if("not-allowed"===e.error||"service-not-allowed"===e.error)return f(p("voicePermissionDenied")),h(!1),void(v.current=null);"no-speech"!==e.error&&f(p("voiceError")),"no-speech"!==e.error&&(h(!1),v.current=null)};try{s.start()}catch(a){h(!1),v.current=null}},A=e=>{e.preventDefault(),e.stopPropagation(),v.current&&w()},D=e=>{e.preventDefault(),e.stopPropagation(),v.current&&w()};return"bar"===d?t.jsxs("div",{className:`relative w-full ${c} select-none touch-none`,children:[y&&t.jsx("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 bg-red-50 text-red-600 text-xs px-3 py-1.5 rounded-lg border border-red-100 shadow-sm whitespace-nowrap z-10 animate-fade-in pointer-events-none",children:y}),g?t.jsxs("div",{className:"flex items-center justify-center gap-2 w-full py-3 bg-slate-100 text-slate-500 rounded-xl font-medium border border-slate-200 cursor-wait",children:[t.jsx(r,{size:16,className:"animate-spin"}),p("processing")]}):t.jsx("button",{type:"button",onMouseDown:S,onMouseUp:A,onMouseLeave:A,onTouchStart:S,onTouchEnd:A,onTouchCancel:A,onContextMenu:D,className:`\n                        w-full py-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2\n                        ${x?"bg-emerald-500 text-white shadow-inner scale-[0.99]":"bg-white border border-slate-300 text-slate-800 shadow-sm active:bg-slate-100"}\n                    `,style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"},children:x?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"relative flex h-3 w-3 mr-1",children:[t.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"}),t.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-white"})]}),t.jsx("span",{children:p("releaseToSend")})]}):t.jsxs(t.Fragment,{children:[t.jsx(i,{size:18,className:"opacity-50"}),t.jsx("span",{children:p("holdToTalk")})]})})]}):t.jsxs("div",{className:`relative flex items-center ${c} select-none`,onClick:e=>e.stopPropagation(),children:[y&&t.jsx("div",{className:"absolute -top-8 right-0 bg-red-50 text-red-600 text-xs px-2 py-1 rounded border border-red-100 whitespace-nowrap z-10 animate-fade-in shadow-sm pointer-events-none",children:y}),g?t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 text-blue-600 rounded-full text-xs font-medium border border-blue-100 animate-pulse",children:[t.jsx(r,{size:14,className:"animate-spin"}),p("processing")]}):t.jsx("button",{type:"button",onMouseDown:S,onMouseUp:A,onMouseLeave:A,onTouchStart:S,onTouchEnd:A,onTouchCancel:A,onContextMenu:D,onClick:e=>{e.preventDefault(),e.stopPropagation()},className:`\n                    flex items-center gap-2 transition-all active:scale-95 touch-none select-none\n                    ${x?"bg-red-500 text-white shadow-md shadow-red-200 ring-4 ring-red-100 scale-105":"text-slate-400 hover:text-blue-600 hover:bg-blue-50"}\n                    ${x?"px-4 py-2 rounded-full":"p-2 rounded-full"}\n                `,style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"},title:p("voiceInput"),children:x?t.jsxs(t.Fragment,{children:[t.jsx(n,{size:16,className:"animate-pulse"}),t.jsx("span",{className:"text-xs font-bold whitespace-nowrap pointer-events-none",children:"zh"===u.language?"松开结束":"Release to Send"})]}):t.jsxs(t.Fragment,{children:[t.jsx(i,{size:20}),t.jsx("span",{className:"sr-only",children:p("holdToTalk")})]})})]})},Kt=(e,t=1280,s=.7)=>new Promise((a,r)=>{const i=new FileReader;i.readAsDataURL(e),i.onload=e=>{var i;const n=new Image;n.src=null==(i=e.target)?void 0:i.result,n.onload=()=>{let e=n.width,i=n.height;e>t&&(i=Math.round(i*t/e),e=t);const l=document.createElement("canvas");l.width=e,l.height=i;const o=l.getContext("2d");if(!o)return void r(new Error("Failed to get canvas context"));o.drawImage(n,0,0,e,i);const c=l.toDataURL("image/jpeg",s);a(c)},n.onerror=e=>r(e)},i.onerror=e=>r(e)}),qt=({items:s,onUpdate:a})=>{const[r,i]=e.useState(!1),n=(e,t,r)=>{const i=[...s];i[e]={...i[e],[t]:r},a(i)},c=e=>t.jsx("div",{className:"overflow-auto "+(e?"max-h-[80vh]":"max-h-[200px]"),children:t.jsxs("table",{className:"w-full text-left text-xs border-collapse",children:[t.jsx("thead",{className:"bg-indigo-50/50 text-indigo-600 font-medium sticky top-0 z-10 backdrop-blur-sm",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-2 border-b border-indigo-100 min-w-[80px]",children:"Symbol"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 min-w-[100px]",children:"Name"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 min-w-[80px]",children:"Type"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 text-right min-w-[60px]",children:"Qty"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 text-right min-w-[80px]",children:"Price"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 min-w-[60px]",children:"Ccy"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 text-right min-w-[100px]",children:"Date"})]})}),t.jsx("tbody",{className:"divide-y divide-indigo-50",children:s.map((e,s)=>t.jsxs("tr",{className:"hover:bg-indigo-50/30 group",children:[t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"text",value:e.symbol||"",onChange:e=>n(s,"symbol",e.target.value),className:"w-full bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors font-medium text-slate-700 uppercase"})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"text",value:e.name||"",onChange:e=>n(s,"name",e.target.value),className:"w-full bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600"})}),t.jsx("td",{className:"p-1",children:t.jsx("select",{value:e.assetType||e.type||Fe.STOCK,onChange:e=>n(s,"assetType",e.target.value),className:"w-full bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600",children:Object.values(Fe).map(e=>t.jsx("option",{value:e,children:e},e))})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"number",value:e.quantity||"",onChange:e=>n(s,"quantity",e.target.value),className:"w-full text-right bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600"})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"number",value:e.price||"",onChange:e=>n(s,"price",e.target.value),className:"w-full text-right bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600"})}),t.jsx("td",{className:"p-1",children:t.jsx("select",{value:e.currency||Ye.USD,onChange:e=>n(s,"currency",e.target.value),className:"w-full bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600",children:Object.values(Ye).map(e=>t.jsx("option",{value:e,children:e},e))})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"date",value:e.dateAcquired?e.dateAcquired.split("T")[0]:"",onChange:e=>n(s,"dateAcquired",e.target.value),className:"w-full text-right bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600 text-xs"})})]},s))})]})});return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"relative bg-white/50 rounded-lg border border-indigo-100 overflow-hidden",children:[t.jsx("div",{className:"absolute top-2 right-2 z-20",children:t.jsx("button",{onClick:()=>i(!0),className:"p-1.5 bg-white text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md shadow-sm border border-slate-200 transition-colors",title:"Expand View",children:t.jsx(l,{size:14})})}),c(!1)]}),r&&t.jsx("div",{className:"fixed inset-0 z-[100] bg-slate-900/20 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in duration-200",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-5xl flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-200",children:[t.jsxs("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50 rounded-t-xl",children:[t.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[t.jsx("span",{className:"w-2 h-2 bg-indigo-500 rounded-full"}),"Edit Asset Details"]}),t.jsx("button",{onClick:()=>i(!1),className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:t.jsx(o,{size:20})})]}),t.jsx("div",{className:"p-4 overflow-auto bg-white rounded-b-xl",children:c(!0)}),t.jsx("div",{className:"p-4 border-t border-slate-100 bg-slate-50/50 rounded-b-xl flex justify-end",children:t.jsx("button",{onClick:()=>i(!1),className:"px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 transition-colors shadow-sm",children:"Done"})})]})})]})},$t="panasset_chat_history",Bt="panasset_chat_dim",Ft=({isOpen:s,onClose:a,isSidebarCollapsed:r=!1})=>{const{settings:i,assets:n,transactions:l,addTransaction:N,editTransaction:w,deleteTransaction:S,addAsset:A,editAsset:D,deleteAsset:T,t:C}=vt(),[I,k]=e.useState(""),[E,P]=e.useState(!1),[_,L]=e.useState([]),[R,U]=e.useState(!1),[M,z]=e.useState(null),[O,K]=e.useState({width:400,height:600}),[q,$]=e.useState(!1),[B,F]=e.useState(window.innerWidth<768),Y=e.useRef(null),H=e.useRef(null),V=e.useRef(null),W=e.useRef(O);e.useEffect(()=>{W.current=O},[O]),e.useEffect(()=>{const e=localStorage.getItem($t);if(e)try{L(JSON.parse(e))}catch(s){}else L([{id:"init",role:"model",content:"zh"===i.language?"您好！我是您的全能资产助手。您可以发送截图让我识别资产信息，或直接说：“把昨天的苹果买入交易改成 20 股”。":"Hi! I'm your PanassetLite assistant. You can upload screenshots for me to analyze, or say \"Update yesterday's AAPL buy to 20 shares\".",timestamp:Date.now()}]);try{const e=localStorage.getItem(Bt);e&&K(JSON.parse(e))}catch(s){}const t=()=>F(window.innerWidth<768);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),e.useEffect(()=>{if(_.length>0){const e=_.filter(e=>e.content&&""!==e.content.trim()||e.image||e.pendingAction);localStorage.setItem($t,JSON.stringify(e.slice(-50)))}},[_]),e.useEffect(()=>{var e;null==(e=Y.current)||e.scrollIntoView({behavior:"smooth"})},[_,s,E,R,M]),e.useEffect(()=>{if(V.current){V.current.style.height="auto";const e=Math.min(V.current.scrollHeight,120);V.current.style.height=`${Math.max(24,e)}px`}},[I]);const G=async e=>{const t="string"==typeof e?e:I;if(!(null==t?void 0:t.trim())&&!M)return;const s={id:crypto.randomUUID(),role:"user",content:t.trim(),timestamp:Date.now(),image:M||void 0};L(e=>[...e,s]),"string"!=typeof e&&k("");const a=M;z(null),P(!0);const r=new Tt(i.geminiApiKey),o=await r.processMessage(s.content,_,n,l,i.baseCurrency,i.language,a||void 0),c={id:crypto.randomUUID(),role:"model",content:o.text||"",timestamp:Date.now(),pendingAction:o.action};P(!1),L(e=>[...e,c])},J=r?"md:left-24":"md:left-72",Q=B?{}:{width:O.width,height:O.height},X=({content:e})=>e?t.jsx("div",{className:"prose prose-sm max-w-none prose-p:leading-relaxed prose-pre:bg-slate-800 prose-pre:text-white prose-p:my-1 prose-ul:my-1 prose-li:my-0",children:t.jsx(Te,{children:e})}):null;return s?t.jsxs("div",{onClick:e=>e.stopPropagation(),className:`\n        fixed z-50 flex flex-col overflow-hidden bg-white shadow-2xl transition-all duration-75\n        inset-0 rounded-none \n        md:inset-auto md:bottom-4 md:right-auto md:rounded-2xl md:border md:border-slate-200 ${J}\n        animate-slide-up origin-bottom-left\n        ${q?"pointer-events-none select-none":""}\n    `,style:Q,children:[t.jsxs("div",{className:"p-4 bg-gradient-to-r from-indigo-600 to-blue-600 flex justify-between items-center shrink-0 text-white shadow-sm relative "+(q?"pointer-events-auto":""),children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-1.5 bg-white/20 rounded-lg",children:t.jsx(c,{size:18,className:"text-white"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold text-sm",children:"zh"===i.language?"盘资产 智能助手":"Panasset Assistant"}),t.jsxs("p",{className:"text-[10px] text-indigo-100 flex items-center gap-1 opacity-90",children:[t.jsx("span",{className:"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"}),"zh"===i.language?"在线":"Online"]})]})]}),t.jsxs("div",{className:"flex items-center gap-1 pr-6 md:pr-0",children:[t.jsx("button",{onClick:()=>{L([]),localStorage.removeItem($t)},className:"text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors p-2",title:"zh"===i.language?"清除历史":"Clear History",children:t.jsx(d,{size:18})}),t.jsx("button",{onClick:a,className:"text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors p-2",children:t.jsx(o,{size:22})})]}),!B&&t.jsx("div",{className:"absolute top-0 right-0 w-8 h-8 cursor-ne-resize flex items-center justify-center text-white/50 hover:text-white hover:bg-white/10 rounded-bl-xl transition-colors z-20",onMouseDown:e=>{e.preventDefault(),$(!0);const t=e.clientX,s=e.clientY,a=O.width,r=O.height,i=e=>{const i=e.clientX-t,n=e.clientY-s,l=Math.max(320,Math.min(1200,a+i)),o=Math.max(400,Math.min(window.innerHeight-50,r-n));K({width:l,height:o})},n=()=>{$(!1),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",n),localStorage.setItem(Bt,JSON.stringify(W.current))};window.addEventListener("mousemove",i),window.addEventListener("mouseup",n)},title:"Resize",children:t.jsx(u,{size:16})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 bg-slate-50 scroll-smooth "+(q?"pointer-events-auto":""),children:[_.map(e=>t.jsxs("div",{className:"flex gap-3 "+("user"===e.role?"flex-row-reverse":"flex-row"),children:[t.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-sm "+("user"===e.role?"bg-slate-200 text-slate-500":"bg-indigo-100 text-indigo-600"),children:"user"===e.role?t.jsx(m,{size:16}):t.jsx(c,{size:16})}),t.jsxs("div",{className:"max-w-[85%] rounded-2xl p-3.5 text-sm shadow-sm "+("user"===e.role?"bg-slate-200 text-slate-800 rounded-tr-none":"bg-white text-slate-700 border border-slate-200 rounded-tl-none"),children:[e.image&&t.jsx("div",{className:"mb-2",children:t.jsx("img",{src:e.image,alt:"Upload",className:"max-w-full max-h-[200px] rounded-lg border border-slate-300/50"})}),t.jsx(X,{content:e.content}),e.pendingAction&&t.jsxs("div",{className:"mt-2 p-3 rounded-xl animate-fade-in border "+("executed"===e.pendingAction.status?"bg-slate-50 border-slate-200 opacity-80":"bg-indigo-50 border-indigo-100"),children:[t.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[t.jsx("div",{className:("executed"===e.pendingAction.status?"text-green-500":"text-indigo-600")+" mt-0.5 shrink-0",children:"executed"===e.pendingAction.status?t.jsx(p,{size:16}):"BULK_ASSET_UPDATE"===e.pendingAction.type?t.jsx(x,{size:16}):t.jsx(h,{size:16})}),t.jsx("div",{className:"text-xs font-medium "+("executed"===e.pendingAction.status?"text-green-700":"text-indigo-800"),children:"zh"===i.language?"executed"===e.pendingAction.status?"操作已执行":"需确认操作":"executed"===e.pendingAction.status?"Action Executed":"Action Required"})]}),t.jsx("div",{className:"text-sm font-bold text-slate-800 mb-3 pl-6",children:e.pendingAction.summary}),"BULK_ASSET_UPDATE"===e.pendingAction.type&&e.pendingAction.items&&t.jsx("div",{className:"pl-6 mb-3",children:t.jsx(qt,{items:e.pendingAction.items,onUpdate:t=>((e,t)=>{L(s=>s.map(s=>s.id===e&&s.pendingAction?{...s,pendingAction:{...s.pendingAction,items:t}}:s))})(e.id,t)})}),"BULK_ASSET_UPDATE"!==e.pendingAction.type&&t.jsx("div",{className:"pl-6 mb-3",children:t.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs bg-white/50 p-2 rounded-lg border border-indigo-100",children:Object.entries(e.pendingAction.data).map(([e,s])=>null!=s&&"assetId"!==e&&"targetId"!==e?t.jsxs(g.Fragment,{children:[t.jsxs("span",{className:"text-slate-500 font-medium capitalize",children:[e,":"]}),t.jsx("span",{className:"text-slate-800 text-right truncate font-mono",children:s.toString()})]},e):null)})}),"executed"!==e.pendingAction.status&&t.jsx("div",{className:"flex gap-2 pl-6",children:t.jsxs("button",{onClick:()=>((e,t)=>{try{const{type:s,data:a,targetId:r,items:o}=t;if("BULK_ASSET_UPDATE"===s&&o&&o.length>0)o.forEach(e=>{var t;const s=null==(t=e.symbol)?void 0:t.toUpperCase();if(!s)return;const a=n.find(e=>e.symbol===s);if(a){const t=Number(e.quantity)-a.quantity;e.price&&Math.abs(e.price-a.currentPrice)>1e-5&&D({...a,currentPrice:Number(e.price),lastUpdated:Date.now()}),Math.abs(t)>1e-6&&N({assetId:a.id,type:He.BALANCE_ADJUSTMENT,date:(new Date).toISOString(),quantityChange:t,pricePerUnit:e.price||a.currentPrice,fee:0,total:t*(e.price||a.currentPrice),note:"AI Bulk Import Adjustment"})}else{const t={id:crypto.randomUUID(),symbol:s,name:e.name||s,type:e.assetType||Fe.STOCK,currentPrice:Number(e.price)||0,currency:e.currency||i.baseCurrency,lastUpdated:Date.now(),dateAcquired:e.dateAcquired||(new Date).toISOString()};A(t,Number(e.quantity)||0,Number(e.price)||0,t.dateAcquired)}});else if("ADD_ASSET"===s){const e={id:crypto.randomUUID(),symbol:a.symbol||"UNKNOWN",name:a.name||a.symbol||"Unknown",type:a.type||Fe.STOCK,currentPrice:a.price||0,currency:a.currency||i.baseCurrency,lastUpdated:Date.now(),dateAcquired:a.date||(new Date).toISOString()};A(e,a.quantity||0,a.price||0,e.dateAcquired)}else if("UPDATE_ASSET"===s&&r){const e=n.find(e=>e.id===r);if(e&&(D({...e,name:a.name??e.name,symbol:a.symbol??e.symbol,type:a.type??e.type,currentPrice:void 0!==a.price?a.price:e.currentPrice,currency:a.currency??e.currency}),void 0!==a.quantity&&null!==a.quantity)){const t=Number(a.quantity)-e.quantity;Math.abs(t)>1e-6&&N({assetId:e.id,type:He.BALANCE_ADJUSTMENT,date:(new Date).toISOString(),quantityChange:t,pricePerUnit:e.currentPrice,fee:0,total:t*e.currentPrice,note:"AI Assistant Balance Correction"})}}else if("DELETE_ASSET"===s&&r)T(r);else if("ADD_TRANSACTION"===s){let e=a.assetId;if(!e&&a.symbol){e=crypto.randomUUID();const t={id:e,symbol:a.symbol,name:a.symbol,type:Fe.STOCK,currentPrice:a.price||0,currency:a.currency||i.baseCurrency,lastUpdated:Date.now(),dateAcquired:(new Date).toISOString()};A(t,0,0,t.dateAcquired)}if(e){const t=a.quantity||0,s=a.type===He.SELL||a.type===He.WITHDRAWAL||a.type===He.REPAY;N({assetId:e,type:a.type||He.BUY,date:a.date||(new Date).toISOString(),quantityChange:s?-Math.abs(t):Math.abs(t),pricePerUnit:a.price||0,fee:a.fee||0,total:t*(a.price||0)+(a.fee||0)})}}else if("UPDATE_TRANSACTION"===s&&r){const e=l.find(e=>e.id===r);if(e){const t=void 0!==a.quantity?a.quantity:Math.abs(e.quantityChange),s=a.price??e.pricePerUnit,r=a.fee??e.fee,i=a.type??e.type,n=i===He.SELL||i===He.WITHDRAWAL||i===He.REPAY;w({...e,quantityChange:n?-Math.abs(t):Math.abs(t),pricePerUnit:s,date:a.date??e.date,type:i,fee:r,total:t*s+r})}}else"DELETE_TRANSACTION"===s&&r?S(r):"BATCH_DELETE_ASSET"===s&&o&&o.length>0&&o.forEach(e=>{e.id&&T(e.id)});L(t=>t.map(t=>t.id===e?{...t,pendingAction:{...t.pendingAction,status:"executed"}}:t))}catch(s){alert("zh"===i.language?"执行操作失败。":"Failed to execute action.")}})(e.id,e.pendingAction),className:"flex-1 text-white text-xs font-bold py-2 rounded-lg flex items-center justify-center gap-1 transition-colors shadow-sm "+(e.pendingAction.type.includes("DELETE")?"bg-red-500 hover:bg-red-600":"bg-indigo-600 hover:bg-indigo-700"),children:[t.jsx(b,{size:14})," ","zh"===i.language?"BULK_ASSET_UPDATE"===e.pendingAction.type?"确认导入全部":"执行":"Confirm"]})})]})]})]},e.id)),E&&t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0",children:t.jsx(c,{size:16})}),t.jsxs("div",{className:"bg-white border border-slate-200 rounded-2xl rounded-tl-none p-4 shadow-sm flex items-center gap-1.5 h-10",children:[t.jsx("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce"}),t.jsx("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce delay-100"}),t.jsx("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce delay-200"})]})]}),t.jsx("div",{ref:Y})]}),t.jsxs("div",{className:"p-3 bg-white border-t border-slate-200 flex items-end gap-2 shrink-0 pb-6 md:pb-3 transition-all duration-300 relative "+(q?"pointer-events-auto":""),children:[t.jsx("button",{onClick:()=>U(!R),className:"p-2.5 mb-0.5 text-slate-500 hover:text-slate-700 hover:bg-slate-100 rounded-full transition-colors shrink-0",title:C(R?"switchToKeyboard":"switchToVoice"),children:R?t.jsx(y,{size:24}):t.jsx(f,{size:24})}),R?t.jsx("div",{className:"flex-1 animate-in fade-in duration-200 mb-0.5",children:t.jsx(Ot,{mode:"CHAT",variant:"bar",onTextResult:e=>G(e)})}):t.jsxs(t.Fragment,{children:[M&&t.jsx("div",{className:"absolute bottom-full left-0 w-full p-2 bg-gradient-to-t from-white to-transparent",children:t.jsxs("div",{className:"relative inline-block",children:[t.jsx("img",{src:M,alt:"Preview",className:"h-20 w-auto object-cover rounded-lg border border-slate-200 shadow-sm bg-white"}),t.jsx("button",{onClick:()=>z(null),className:"absolute -top-2 -right-2 bg-slate-800 text-white rounded-full p-0.5 hover:bg-slate-700 shadow-md border border-white",children:t.jsx(o,{size:12})})]})}),t.jsxs("div",{className:"flex-1 flex gap-2 items-end bg-slate-50 border border-slate-200 rounded-xl px-2 py-2 focus-within:ring-2 focus-within:ring-indigo-500 focus-within:bg-white transition-all",children:[t.jsx("button",{onClick:()=>{var e;return null==(e=H.current)?void 0:e.click()},className:"p-1.5 mb-px text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors shrink-0 self-end",title:"Upload Image",children:t.jsx(v,{size:20})}),t.jsx("input",{type:"file",ref:H,className:"hidden",accept:"image/*",onChange:async e=>{if(e.target.files&&e.target.files[0]){const s=e.target.files[0];try{const e=await Kt(s);z(e)}catch(t){alert("zh"===i.language?"图片处理失败":"Failed to process image")}}e.target.value=""}}),t.jsx("textarea",{ref:V,value:I,onChange:e=>k(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),E||G())},onPaste:async e=>{const t=e.clipboardData.items;for(let a=0;a<t.length;a++)if(-1!==t[a].type.indexOf("image")){e.preventDefault();const r=t[a].getAsFile();if(r)try{const e=await Kt(r);z(e)}catch(s){alert("zh"===i.language?"图片处理失败":"Failed to process image")}return}},placeholder:"zh"===i.language?"输入消息...":"Type a message...",disabled:E,rows:1,className:"flex-1 bg-transparent border-none p-1.5 text-sm focus:ring-0 resize-none max-h-32 outline-none disabled:opacity-50 overflow-y-auto",style:{minHeight:"24px",lineHeight:"1.5"}})]}),t.jsx("button",{onClick:()=>G(),disabled:!I.trim()&&!M||E,className:"p-3 mb-0.5 bg-indigo-600 text-white rounded-xl shadow-md hover:bg-indigo-700 disabled:bg-slate-200 disabled:text-slate-400 transition-all active:scale-95 flex items-center justify-center shrink-0",children:t.jsx(j,{size:20})})]})]})]}):null},Yt=({className:e="",collapsed:s=!1,title:a,subTitle:r})=>s?t.jsx("img",{src:"/PanassetLite/assets/logo-CCnH7EBB.svg",alt:"PanassetLite Logo",className:e,width:32,height:32,style:{objectFit:"contain"}}):t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 180 32",width:"180",height:"32",children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"cyber-gradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#17EAD9"}),t.jsx("stop",{offset:"100%",stopColor:"#6078EA"})]})}),t.jsxs("text",{x:"0",y:"22",fontFamily:"'Inter', sans-serif",fontWeight:"700",fontSize:"18",fill:"url(#cyber-gradient)",letterSpacing:"-0.02em",children:[a,".",r]})]}),Ht=({children:s})=>{const{t:a,settings:r}=vt(),[i,n]=g.useState(!1),[l,d]=e.useState(!1),[u,m]=e.useState(()=>"true"===localStorage.getItem("investflow_sidebar_collapsed"));e.useEffect(()=>{localStorage.setItem("investflow_sidebar_collapsed",String(u))},[u]);const p=!(!r.geminiApiKey&&!r.deepSeekApiKey),x="zh"===r.language?"盘资产":"Panasset",h="zh"===r.language?"轻":"Lite",b=({to:e,icon:s,label:a,onClick:r})=>t.jsxs(I,{to:e,onClick:r,className:({isActive:e})=>`\n        flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group relative\n        ${e?"bg-blue-600 text-white shadow-md shadow-blue-200":"text-slate-500 hover:bg-slate-100"}\n        ${u?"justify-center px-2":""}\n      `,title:u?a:void 0,children:[t.jsx("div",{className:"shrink-0",children:s}),!u&&t.jsx("span",{className:"font-medium whitespace-nowrap overflow-hidden transition-all duration-300 opacity-100",children:a})]});return t.jsxs("div",{className:"min-h-screen flex bg-[#f8fafc]",children:[t.jsxs("aside",{className:"hidden md:flex flex-col bg-white border-r border-slate-100 h-screen fixed left-0 top-0 z-20 transition-all duration-300 ease-in-out "+(u?"w-20":"w-64"),children:[t.jsx("div",{className:"p-6 flex flex-col justify-center "+(u?"items-center px-0":""),children:t.jsx("button",{onClick:()=>m(!u),className:"transition-all duration-300 hover:opacity-80 focus:outline-none cursor-pointer "+(u?"scale-90":""),title:u?"Expand Sidebar":"Collapse Sidebar",children:t.jsx(Yt,{collapsed:u,title:x,subTitle:h})})}),t.jsxs("nav",{className:"flex-1 px-3 space-y-2 mt-2 overflow-y-auto overflow-x-hidden",children:[t.jsx(b,{to:"/",icon:t.jsx(N,{size:20}),label:a("dashboard")}),t.jsx(b,{to:"/assets",icon:t.jsx(w,{size:20}),label:a("assets")}),t.jsx(b,{to:"/history",icon:t.jsx(S,{size:20}),label:a("history")}),t.jsx(b,{to:"/analytics",icon:t.jsx(A,{size:20}),label:a("analytics")}),t.jsx(b,{to:"/settings",icon:t.jsx(D,{size:20}),label:a("settings")})]}),t.jsxs("div",{className:"p-4 border-t border-slate-100 flex flex-col gap-4",children:[p&&t.jsxs("button",{onClick:()=>d(e=>!e),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all border border-transparent ${l?"bg-indigo-600 text-white shadow-md shadow-indigo-200":"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 hover:border-indigo-200"} ${u?"justify-center px-2":""}`,title:a("aiAssistant"),children:[t.jsx(c,{size:20,className:l?"text-white":"text-indigo-600"}),!u&&t.jsx("span",{className:"font-semibold",children:a("aiAssistant")})]}),u?t.jsx("div",{className:"flex flex-col gap-2 items-center",children:t.jsx("a",{href:"https://mp.weixin.qq.com/s/du0wh1As2s-casSadFAgZQ",target:"_blank",rel:"noreferrer",className:"flex justify-center text-slate-400 hover:text-green-600 transition-colors",title:a("about"),children:t.jsx(T,{size:20})})}):t.jsxs("div",{className:"animate-fade-in",children:[t.jsxs("a",{href:"https://mp.weixin.qq.com/s/du0wh1As2s-casSadFAgZQ",target:"_blank",rel:"noreferrer",className:"flex items-center gap-3 text-sm font-medium text-slate-600 hover:text-green-600 transition-colors mb-2 group px-2",children:[t.jsx(T,{size:18,className:"text-slate-400 group-hover:text-green-500 shrink-0"}),t.jsx("span",{className:"whitespace-nowrap",children:a("about")})]}),t.jsx("div",{className:"text-xs text-slate-400 px-2 leading-tight",children:a("disclaimer")})]})]})]}),t.jsxs("div",{className:"md:hidden fixed top-0 left-0 right-0 bg-white z-30 px-4 py-3 border-b border-slate-100 flex justify-between items-center shadow-sm",children:[t.jsx("div",{className:"flex items-center",children:t.jsx(Yt,{collapsed:!1,className:"h-8 w-auto"})}),t.jsxs("div",{className:"flex items-center gap-2",children:[p&&t.jsx("button",{onClick:()=>d(!l),className:"p-2 rounded-lg transition-colors "+(l?"bg-indigo-600 text-white":"text-indigo-600 bg-indigo-50 hover:bg-indigo-100"),children:t.jsx(c,{size:20})}),t.jsx("button",{onClick:()=>n(!i),className:"p-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:i?t.jsx(o,{size:24}):t.jsx(C,{size:24})})]})]}),i&&t.jsx("div",{className:"fixed inset-0 z-20 bg-slate-900/20 backdrop-blur-sm md:hidden pt-16",onClick:()=>n(!1),children:t.jsx("div",{className:"bg-white border-b border-slate-100 shadow-xl p-4 animate-in slide-in-from-top-5 duration-200",onClick:e=>e.stopPropagation(),children:t.jsxs("nav",{className:"space-y-2",children:[t.jsx(b,{to:"/",icon:t.jsx(N,{size:20}),label:a("dashboard"),onClick:()=>n(!1)}),t.jsx(b,{to:"/assets",icon:t.jsx(w,{size:20}),label:a("assets"),onClick:()=>n(!1)}),t.jsx(b,{to:"/history",icon:t.jsx(S,{size:20}),label:a("history"),onClick:()=>n(!1)}),t.jsx(b,{to:"/analytics",icon:t.jsx(A,{size:20}),label:a("analytics"),onClick:()=>n(!1)}),t.jsx(b,{to:"/settings",icon:t.jsx(D,{size:20}),label:a("settings"),onClick:()=>n(!1)}),t.jsx("div",{className:"pt-4 mt-4 border-t border-slate-100 space-y-2",children:t.jsxs("a",{href:"https://mp.weixin.qq.com/s/du0wh1As2s-casSadFAgZQ",target:"_blank",rel:"noreferrer",className:"flex items-center gap-3 px-4 py-3 text-slate-500 hover:bg-slate-50 rounded-xl transition-colors",children:[t.jsx(T,{size:20}),t.jsx("span",{className:"font-medium",children:a("about")})]})})]})})}),t.jsx("main",{className:"flex-1 pt-20 md:pt-8 md:p-8 p-4 w-full transition-all duration-300 ease-in-out "+(u?"md:ml-20":"md:ml-64"),children:s}),p&&t.jsx(Ft,{isOpen:l,onClose:()=>d(!1),isSidebarCollapsed:u})]})},Vt=({title:e,children:s,className:a="",action:r})=>t.jsxs("div",{className:`bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden ${a}`,children:[(e||r)&&t.jsxs("div",{className:"px-4 py-3 sm:px-6 sm:py-4 border-b border-slate-100 flex justify-between items-center",children:[e&&t.jsx("div",{className:"font-semibold text-slate-800 text-base sm:text-lg flex items-center gap-3",children:e}),r&&t.jsx("div",{children:r})]}),t.jsx("div",{className:"p-4 sm:p-6",children:s})]}),Wt=({isOpen:e,onClose:s,onConfirm:a,title:r,message:i,confirmText:n="Confirm",cancelText:l="Cancel",isDanger:o=!1})=>e?t.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm transition-all duration-200",children:t.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden transform transition-all scale-100",children:t.jsxs("div",{className:"p-6 text-center",children:[t.jsx("div",{className:"mx-auto w-12 h-12 rounded-full flex items-center justify-center mb-4 "+(o?"bg-red-100 text-red-600":"bg-blue-100 text-blue-600"),children:t.jsx(k,{size:24})}),t.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:r}),t.jsx("p",{className:"text-sm text-slate-500 leading-relaxed mb-6",children:i}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:s,className:"flex-1 px-4 py-2.5 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-colors",children:l}),t.jsx("button",{onClick:()=>{a(),s()},className:"flex-1 px-4 py-2.5 font-medium rounded-xl text-white transition-colors shadow-lg "+(o?"bg-red-600 hover:bg-red-700 shadow-red-200":"bg-blue-600 hover:bg-blue-700 shadow-blue-200"),children:n})]})]})})}):null,Gt=()=>{const{transactions:s,assets:a,deleteTransaction:r,settings:i,t:n}=vt(),[l,o]=e.useState("all"),[c,m]=e.useState("all"),[p,x]=e.useState(""),[h,g]=e.useState(""),[b,y]=e.useState(!1),[f,v]=e.useState(null),j=e=>{const t=a.find(t=>t.id===e);return t?{symbol:t.symbol,name:t.name,currency:t.currency}:{symbol:"UNKNOWN",name:"Deleted Asset",currency:Ye.USD}},N=e.useMemo(()=>s.filter(e=>!!e&&(("all"===l||e.assetId===l)&&(("all"===c||e.type===c)&&(!(p&&e.date<p)&&!(h&&e.date>h))))).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[s,l,c,p,h]),w=e=>{switch(e){case He.BUY:return"bg-blue-100 text-blue-700";case He.DEPOSIT:return"bg-blue-50 text-blue-600";case He.SELL:return"bg-purple-100 text-purple-700";case He.WITHDRAWAL:return"bg-purple-50 text-purple-600";case He.DIVIDEND:return"bg-green-100 text-green-700";case He.BORROW:return"bg-amber-100 text-amber-700";case He.REPAY:return"bg-indigo-100 text-indigo-700";case He.BALANCE_ADJUSTMENT:return"bg-slate-100 text-slate-700 border border-slate-200";default:return"bg-slate-100 text-slate-700"}},S=e=>{switch(e){case He.BUY:case He.DEPOSIT:return t.jsx(O,{size:16});case He.SELL:case He.WITHDRAWAL:return t.jsx(u,{size:16});case He.DIVIDEND:return t.jsx(z,{size:16});case He.BORROW:return t.jsx(M,{size:16});case He.REPAY:return t.jsx(U,{size:16});case He.BALANCE_ADJUSTMENT:return t.jsx(R,{size:14});default:return null}},A=e=>{switch(e){case Ye.USD:return"$";case Ye.CNY:return"¥";case Ye.HKD:return"HK$";default:return"$"}},D=e=>{if(!e)return"-";try{return new Date(e).toLocaleString(void 0,{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e}},T=e.useMemo(()=>{const e=new Map;return a.forEach(t=>e.set(t.id,t)),Array.from(e.values()).sort((e,t)=>e.symbol.localeCompare(t.symbol))},[a]);return t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:n("transactionHistory")}),t.jsx("p",{className:"text-slate-500",children:n("historySubtitle")})]})}),t.jsxs(Vt,{children:[t.jsx("div",{className:"md:hidden flex justify-end mb-2",children:t.jsxs("button",{onClick:()=>y(!b),className:"flex items-center gap-2 text-sm font-medium text-slate-600 bg-slate-100 px-3 py-2 rounded-lg hover:bg-slate-200 transition-colors",children:[t.jsx(E,{size:16}),"Filter",b?t.jsx(P,{size:16}):t.jsx(_,{size:16})]})}),t.jsxs("div",{className:(b?"grid":"hidden")+" md:grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6 pb-6 border-b border-slate-100 animate-fade-in",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:n("asset")}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:l,onChange:e=>o(e.target.value),className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none appearance-none",children:[t.jsx("option",{value:"all",children:n("allAssets")}),T.map(e=>t.jsxs("option",{value:e.id,children:[e.symbol," - ",e.name]},e.id))]}),t.jsx(E,{className:"absolute right-3 top-3 text-slate-400 pointer-events-none",size:16})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:n("type")}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:c,onChange:e=>m(e.target.value),className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none appearance-none",children:[t.jsx("option",{value:"all",children:n("allTypes")}),t.jsx("option",{value:He.BUY,children:n("tx_BUY")}),t.jsx("option",{value:He.SELL,children:n("tx_SELL")}),t.jsx("option",{value:He.DIVIDEND,children:n("tx_DIVIDEND")}),t.jsx("option",{value:He.BALANCE_ADJUSTMENT,children:"Adjustment"})]}),t.jsx(E,{className:"absolute right-3 top-3 text-slate-400 pointer-events-none",size:16})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:n("fromDate")}),t.jsx("input",{type:"date",value:p,onChange:e=>x(e.target.value),className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:n("toDate")}),t.jsx("input",{type:"date",value:h,onChange:e=>g(e.target.value),className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),t.jsx("div",{className:"md:hidden space-y-3",children:N.map(e=>{if(!e)return null;const s=j(e.assetId),a=A(s.currency),r=Number(e.pricePerUnit||0),l=Number(e.total||0),o=Number(e.quantityChange||0),c=e.type===He.BALANCE_ADJUSTMENT,u=c?o>0?`+${o.toLocaleString()}`:o.toLocaleString():Math.abs(o).toLocaleString(),m=c?o>=0?"text-green-600":"text-red-600":"text-slate-700";return t.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-100 relative group",children:[t.jsx("button",{onClick:()=>v(e.id),className:"absolute top-3 right-3 p-1.5 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:t.jsx(d,{size:16})}),t.jsx("div",{className:"flex justify-between items-start mb-2 pr-8",children:t.jsxs("div",{children:[t.jsxs("div",{className:"font-bold text-slate-800 text-lg flex items-center gap-2",children:[s.symbol,t.jsx("span",{className:"text-xs font-normal text-slate-400 bg-white px-1.5 py-0.5 rounded border border-slate-100",children:s.name})]}),t.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-500 mt-1",children:[t.jsx(L,{size:12}),D(e.date)]})]})}),t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-bold ${w(e.type)}`,children:[S(e.type),n(`tx_${e.type}`)||e.type]}),t.jsx("div",{className:"text-right",children:t.jsx("div",{className:"font-bold text-lg text-slate-800",children:i.isPrivacyMode?"••••••":`${a}${l.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`})})]}),t.jsxs("div",{className:"pt-3 border-t border-slate-200/50 flex justify-between items-center text-sm",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-xs text-slate-400 uppercase mb-0.5",children:n("quantity")}),t.jsx("span",{className:`font-mono font-medium ${m}`,children:i.isPrivacyMode?"••••••":u})]}),t.jsxs("div",{className:"flex flex-col text-right",children:[t.jsx("span",{className:"text-xs text-slate-400 uppercase mb-0.5",children:n("pricePerUnit")}),t.jsxs("span",{className:"font-mono text-slate-600",children:[a,r.toLocaleString()]})]})]})]},e.id)})}),t.jsx("div",{className:"hidden md:block overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left border-collapse min-w-[800px]",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-xs text-slate-400 uppercase border-b border-slate-100",children:[t.jsx("th",{className:"pb-3 pl-2 font-medium",children:n("date")}),t.jsx("th",{className:"pb-3 font-medium",children:n("asset")}),t.jsx("th",{className:"pb-3 font-medium",children:n("type")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:n("quantity")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:n("pricePerUnit")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:n("fees")}),t.jsx("th",{className:"pb-3 font-medium text-right pr-2",children:n("total")}),t.jsx("th",{className:"pb-3 font-medium text-right pr-2",children:n("actions")})]})}),t.jsx("tbody",{className:"text-sm",children:N.map(e=>{if(!e)return null;const s=j(e.assetId),a=A(s.currency),r=Number(e.pricePerUnit||0),l=Number(e.fee||0),o=Number(e.total||0),c=Number(e.quantityChange||0),u=e.type===He.BALANCE_ADJUSTMENT,m=u?c>0?`+${c.toLocaleString()}`:c.toLocaleString():Math.abs(c).toLocaleString(),p=u?c>=0?"text-green-600 font-bold":"text-red-600 font-bold":"text-slate-700";return t.jsxs("tr",{className:"border-b border-slate-50 last:border-0 hover:bg-slate-50/50 transition-colors",children:[t.jsx("td",{className:"py-4 pl-2 text-slate-600 font-mono text-xs whitespace-nowrap",children:D(e.date)}),t.jsxs("td",{className:"py-4",children:[t.jsx("div",{className:"font-semibold text-slate-800",children:s.symbol}),t.jsx("div",{className:"text-xs text-slate-400 hidden sm:block",children:s.name})]}),t.jsx("td",{className:"py-4",children:t.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-medium ${w(e.type)}`,children:[S(e.type),n(`tx_${e.type}`)||e.type]})}),t.jsx("td",{className:`py-4 text-right font-medium ${p}`,children:i.isPrivacyMode?"••••••":"0"!==m?m:"-"}),t.jsxs("td",{className:"py-4 text-right text-slate-600 whitespace-nowrap",children:[a,r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),t.jsx("td",{className:"py-4 text-right text-slate-500 whitespace-nowrap",children:l>0?`${a}${l.toFixed(2)}`:"-"}),t.jsx("td",{className:"py-4 text-right pr-2 font-bold text-slate-800 whitespace-nowrap",children:i.isPrivacyMode?"••••••":`${a}${o.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),t.jsx("td",{className:"py-4 text-right pr-2",children:t.jsx("button",{onClick:()=>v(e.id),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:n("deleteTransaction"),children:t.jsx(d,{size:16})})})]},e.id)})})]})}),0===N.length&&t.jsx("div",{className:"py-12 text-center text-slate-400 italic",children:n("noTransactions")})]}),t.jsx(Wt,{isOpen:!!f,onClose:()=>v(null),onConfirm:()=>f&&r(f),title:n("deleteTransaction"),message:n("confirmDeleteTransaction"),confirmText:n("delete"),isDanger:!0})]})};var Jt=(e=>(e.LOW="Low",e.MEDIUM="Medium",e.HIGH="High",e))(Jt||{});const Qt=["USDT","USDC","DAI","BUSD","TUSD","USDD","FRAX","USDP"],Xt=["BTC","ETH"];function Zt(e){return e.type===Fe.LIABILITY||e.type===Fe.CASH||e.type===Fe.REAL_ESTATE?"Low":e.type===Fe.STOCK||e.type===Fe.FUND?"Medium":e.type===Fe.CRYPTO?function(e){const t=e.toUpperCase().trim();return Qt.includes(t)}(e.symbol)?"Low":function(e){const t=e.toUpperCase().trim();return Xt.includes(t)}(e.symbol)?"Medium":"High":"Low"}const es=({data:e,ratio:s,formatCurrency:a,isPrivacyMode:r,t:i})=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsx(Vt,{title:i("netWorthStructure"),className:"md:col-span-2 min-w-0",children:t.jsx("div",{className:"h-[200px] w-full min-w-0",children:t.jsx(Ce,{width:"100%",height:"100%",children:t.jsxs(Ie,{data:e,layout:"vertical",margin:{left:0,right:40,top:0,bottom:0},barSize:32,children:[t.jsx(ke,{strokeDasharray:"3 3",horizontal:!1,stroke:"#f1f5f9"}),t.jsx(Ee,{type:"number",tickFormatter:a,tick:{fontSize:11,fill:"#94a3b8"},axisLine:!1,tickLine:!1}),t.jsx(Pe,{dataKey:"name",type:"category",width:70,tick:{fontSize:12,fontWeight:500,fill:"#64748b"},axisLine:!1,tickLine:!1}),t.jsx(_e,{cursor:{fill:"transparent"},contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>a(e)}),t.jsxs(Le,{dataKey:"value",radius:[0,6,6,0],children:[e.map((e,s)=>t.jsx(Re,{fill:e.fill},`cell-${s}`)),!r&&t.jsx(Ue,{dataKey:"value",position:"right",formatter:a,style:{fontSize:"11px",fill:"#64748b",fontWeight:600}})]})]})})})}),t.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 p-5 flex flex-col justify-center items-center md:col-span-1 relative overflow-hidden",children:[t.jsxs("h3",{className:"text-slate-500 text-sm font-medium mb-3 flex items-center gap-2 z-10",children:[t.jsx(K,{size:16})," ",i("debtRatio")]}),t.jsxs("div",{className:"relative z-10 text-center mb-2",children:[t.jsxs("div",{className:"text-3xl font-bold mb-1 "+(s>50?"text-red-500":s>30?"text-orange-500":"text-slate-800"),children:[s.toFixed(1),"%"]}),t.jsx("div",{className:"text-xs px-2 py-1 rounded-full inline-block "+(s>30?"bg-red-50 text-red-600":"bg-green-50 text-green-600"),children:i(s>30?"highLeverage":"healthy")})]}),t.jsx("div",{className:"w-full bg-slate-100 h-1.5 mt-4 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full transition-all duration-1000 "+(s>50?"bg-red-500":"bg-green-500"),style:{width:`${Math.min(s,100)}%`}})})]})]}),ts=({data:e,colors:s,formatCurrency:a,t:r})=>t.jsx(Vt,{title:r("assetAllocation"),className:"lg:col-span-1 min-w-0",children:t.jsx("div",{className:"h-[240px] w-full min-w-0",children:t.jsx(Ce,{width:"100%",height:"100%",children:t.jsxs(Me,{children:[t.jsx(ze,{data:e,cx:"50%",cy:"50%",innerRadius:55,outerRadius:80,paddingAngle:3,dataKey:"value",children:e.map((e,a)=>t.jsx(Re,{fill:s[a%s.length],stroke:"none"},`cell-${a}`))}),t.jsx(_e,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>a(e)}),t.jsx(Oe,{verticalAlign:"bottom",height:36,iconType:"circle",iconSize:8,wrapperStyle:{fontSize:"11px"}})]})})})}),ss=({riskProfile:e,riskData:s,loadingRisk:a,riskError:r,onRefreshRisk:i,formatCurrency:n,t:l})=>t.jsx(Vt,{className:"lg:col-span-2 min-w-0",title:l("riskAnalysis"),children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-full",children:[t.jsx("div",{className:"h-[240px] min-w-0 flex flex-col justify-center",children:t.jsx(Ce,{width:"100%",height:"100%",children:t.jsxs(Me,{children:[t.jsx(ze,{data:e,cx:"50%",cy:"50%",startAngle:180,endAngle:0,innerRadius:60,outerRadius:90,dataKey:"value",paddingAngle:2,children:e.map((e,s)=>t.jsx(Re,{fill:e.color,stroke:"none"},`cell-risk-${s}`))}),t.jsx(Oe,{verticalAlign:"bottom",iconType:"circle",iconSize:8,wrapperStyle:{fontSize:"11px"}}),t.jsx(_e,{formatter:e=>n(e),contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}})]})})}),t.jsx("div",{className:"flex flex-col justify-center pr-2 py-2",children:t.jsxs("div",{className:"bg-slate-50/50 rounded-2xl p-5 border border-slate-100 h-full flex flex-col relative overflow-hidden",children:[t.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-5",children:t.jsx(c,{size:64,className:"text-purple-600"})}),t.jsxs("div",{className:"flex items-center justify-between mb-4 relative z-10",children:[t.jsxs("h4",{className:"font-semibold text-slate-700 flex items-center gap-2 text-sm",children:[t.jsx("div",{className:"p-1.5 bg-purple-100 text-purple-600 rounded-lg",children:t.jsx(c,{size:14})}),l("aiAssessment")]}),s&&t.jsx("button",{onClick:i,disabled:a,className:"p-1.5 hover:bg-white hover:shadow-sm rounded-lg text-slate-400 hover:text-purple-600 transition-all",title:l("recalculate"),children:t.jsx(R,{size:14,className:a?"animate-spin":""})})]}),t.jsx("div",{className:"flex-1 flex flex-col justify-center relative z-10",children:r?t.jsxs("div",{className:"text-xs text-red-500 bg-red-50 p-3 rounded-lg border border-red-100 text-center",children:[l("unableToGenerate")," ",l("apiKeyMissing")]}):a&&!s?t.jsxs("div",{className:"space-y-3 animate-pulse px-1",children:[t.jsx("div",{className:"h-2 bg-slate-200 rounded w-full"}),t.jsx("div",{className:"h-2 bg-slate-200 rounded w-3/4"}),t.jsx("div",{className:"h-2 bg-slate-200 rounded w-5/6"})]}):s?t.jsxs("div",{className:"animate-fade-in",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("span",{className:"text-xs font-bold px-2.5 py-1 rounded-full border "+(s.riskScore>7?"bg-red-50 text-red-600 border-red-100":s.riskScore>4?"bg-orange-50 text-orange-600 border-orange-100":"bg-green-50 text-green-600 border-green-100"),children:s.riskLevel}),t.jsxs("div",{className:"text-right",children:[t.jsx("span",{className:"text-sm font-bold text-slate-800",children:s.riskScore}),t.jsx("span",{className:"text-xs text-slate-400",children:"/10"})]})]}),t.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden mb-4",children:t.jsx("div",{className:"h-full rounded-full transition-all duration-1000 ease-out "+(s.riskScore>7?"bg-red-500":s.riskScore>4?"bg-orange-500":"bg-green-500"),style:{width:10*s.riskScore+"%"}})}),t.jsxs("div",{className:"text-xs text-slate-600 leading-relaxed italic relative pl-3",children:[t.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-0.5 bg-purple-200 rounded-full"}),s.analysis]})]}):t.jsx("div",{className:"text-center",children:t.jsxs("button",{onClick:i,className:"px-5 py-2.5 bg-white hover:bg-purple-50 text-purple-600 border border-purple-100 hover:border-purple-200 text-sm font-medium rounded-xl transition-all shadow-sm hover:shadow flex items-center gap-2 mx-auto group",children:[t.jsx(q,{size:16,className:"group-hover:fill-purple-600 transition-colors"}),l("startRiskAnalysis")]})})})]})})]})}),as=({topAssets:e,pnlRanking:s,liabilityDistribution:a,formatCurrency:r,isPrivacyMode:i,t:n})=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(Vt,{title:n("costVsValue"),className:"min-w-0",children:t.jsx("div",{className:"h-[250px] w-full min-w-0",children:t.jsx(Ce,{width:"100%",height:"100%",children:t.jsxs(Ie,{data:e,layout:"vertical",margin:{left:0,right:10,top:0,bottom:0},barGap:2,children:[t.jsx(ke,{strokeDasharray:"3 3",horizontal:!1,stroke:"#f1f5f9"}),t.jsx(Ee,{type:"number",tickFormatter:r,hide:!0}),t.jsx(Pe,{dataKey:"name",type:"category",width:50,tick:{fontSize:11,fill:"#64748b"},interval:0}),t.jsx(_e,{cursor:{fill:"transparent"},contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>r(e)}),t.jsx(Oe,{iconSize:8,wrapperStyle:{fontSize:"11px"}}),t.jsx(Le,{dataKey:"cost",name:n("label_cost"),fill:"#cbd5e1",radius:[0,3,3,0],barSize:8}),t.jsx(Le,{dataKey:"value",name:n("label_value"),fill:"#3b82f6",radius:[0,3,3,0],barSize:8})]})})})}),t.jsx(Vt,{title:n("topMovers"),className:"min-w-0",children:t.jsx("div",{className:"h-[250px] w-full min-w-0",children:t.jsx(Ce,{width:"100%",height:"100%",children:t.jsxs(Ie,{data:s,margin:{top:20,bottom:0},children:[t.jsx(ke,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),t.jsx(Ee,{dataKey:"name",tick:{fontSize:11,fill:"#64748b"},axisLine:!1,tickLine:!1}),t.jsx(Pe,{hide:!0}),t.jsx(_e,{cursor:{fill:"#f8fafc"},contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>r(e)}),t.jsxs(Le,{dataKey:"pnl",name:n("label_net_pnl"),radius:[4,4,0,0],children:[s.map((e,s)=>t.jsx(Re,{fill:e.pnl>=0?"#10b981":"#ef4444"},`cell-pnl-${s}`)),!i&&t.jsx(Ue,{dataKey:"pnl",position:"top",formatter:e=>new Intl.NumberFormat("en-US",{notation:"compact"}).format(e),style:{fontSize:"10px",fill:"#94a3b8"}})]}),t.jsx(Ke,{y:0,stroke:"#cbd5e1"})]})})})}),a.length>0&&t.jsx(Vt,{title:n("liabilityBreakdown"),className:"md:col-span-2 min-w-0",children:t.jsx("div",{className:"h-[180px] w-full flex items-center justify-center min-w-0",children:t.jsx(Ce,{width:"100%",height:"100%",children:t.jsxs(Me,{children:[t.jsx(ze,{data:a,cx:"50%",cy:"50%",innerRadius:50,outerRadius:70,paddingAngle:5,dataKey:"value",children:a.map((e,s)=>t.jsx(Re,{fill:s%2==0?"#ef4444":"#f87171",stroke:"none"},`cell-liab-${s}`))}),t.jsx(_e,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>r(e)}),t.jsx(Oe,{iconSize:8,wrapperStyle:{fontSize:"11px"},layout:"vertical",align:"right",verticalAlign:"middle"})]})})})})]}),rs=["#0ea5e9","#8b5cf6","#10b981","#f59e0b","#ef4444","#6366f1","#f97316"],is={High:"#ef4444",Medium:"#f59e0b",Low:"#10b981"},ns=()=>{const{assets:s,settings:r,exchangeRates:i,t:n}=vt(),[l,o]=e.useState(null),[c,d]=e.useState(!1),[u,m]=e.useState(!1),p=e=>r.isPrivacyMode?"••••••":new Intl.NumberFormat("en-US",{style:"currency",currency:r.baseCurrency,notation:"compact"}).format(e),x=e.useMemo(()=>{const e={};return s.forEach(t=>{if(t.type===Fe.LIABILITY)return;const s=t.quantity*t.currentPrice,a=dt(s,t.currency,r.baseCurrency,i);e[t.type]=(e[t.type]||0)+a}),Object.entries(e).map(([e,t])=>({name:n(`type_${e.toLowerCase()}`),value:t})).sort((e,t)=>t.value-e.value)},[s,r.baseCurrency,i,n]),h=e.useMemo(()=>s.filter(e=>e.type===Fe.LIABILITY).map(e=>{const t=e.quantity*e.currentPrice,s=dt(t,e.currency,r.baseCurrency,i);return{name:e.name||e.symbol,value:s}}).sort((e,t)=>t.value-e.value),[s,r.baseCurrency,i]),g=e.useMemo(()=>{let e=0,t=0;return s.forEach(s=>{const a=s.quantity*s.currentPrice,n=dt(a,s.currency,r.baseCurrency,i);s.type===Fe.LIABILITY?t+=n:e+=n}),{data:[{name:n("label_assets"),value:e,fill:"#10b981"},{name:n("label_liabilities"),value:t,fill:"#ef4444"}],totalAssets:e,totalLiabilities:t,ratio:e>0?t/e*100:0}},[s,r.baseCurrency,i,n]),b=e.useMemo(()=>[...s].filter(e=>e.type!==Fe.LIABILITY).map(e=>{const t=dt(e.quantity*e.currentPrice,e.currency,r.baseCurrency,i),s=dt(e.quantity*e.avgCost,e.currency,r.baseCurrency,i);return{name:e.symbol,value:t,cost:s,pnl:t-s}}).sort((e,t)=>t.value-e.value).slice(0,6),[s,r.baseCurrency,i]),y=e.useMemo(()=>{let e=0,t=0,a=0;s.forEach(s=>{if(s.type===Fe.LIABILITY)return;const n=s.quantity*s.currentPrice,l=dt(n,s.currency,r.baseCurrency,i),o=Zt(s);o===Jt.HIGH?e+=l:o===Jt.MEDIUM?t+=l:a+=l});return 0===e+t+a?[]:[{name:n("risk_high"),value:e,color:is.High},{name:n("risk_medium"),value:t,color:is.Medium},{name:n("risk_low"),value:a,color:is.Low}].filter(e=>e.value>0)},[s,r.baseCurrency,i,n]),f=e.useMemo(()=>[...s].filter(e=>e.type!==Fe.LIABILITY).map(e=>{const t=dt(e.quantity*e.currentPrice,e.currency,r.baseCurrency,i)-dt(e.quantity*e.avgCost,e.currency,r.baseCurrency,i);return{name:e.symbol,pnl:t}}).sort((e,t)=>t.pnl-e.pnl).slice(0,8),[s,r.baseCurrency,i]);return 0===s.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-96 text-slate-400",children:[t.jsx(A,{size:48,className:"mb-4 opacity-50"}),t.jsx("p",{children:n("noAssetsAnalytics")})]}):t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsx("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-2 mb-2",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:n("analytics")}),t.jsx("p",{className:"text-slate-500 text-sm",children:n("analyticsSubtitle")})]})}),t.jsx(es,{data:g.data,ratio:g.ratio,formatCurrency:p,isPrivacyMode:r.isPrivacyMode,t:n}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx(ts,{data:x,colors:rs,formatCurrency:p,t:n}),t.jsx(ss,{riskProfile:y,riskData:l,loadingRisk:c,riskError:u,onRefreshRisk:async()=>{if(0===s.length)return;const e="deepseek"===r.aiProvider?r.deepSeekApiKey:r.geminiApiKey;if(e){d(!0),m(!1);try{const t=await(async(e,t,s,r="en",i=!1)=>{if(!t)throw new Error("API Key is missing");if(0===e.length)return null;const n=`${zt(e)}:${r}:${s}`,l=Date.now();if(!i){const e=Ze.getCache(_t);if(e){const{timestamp:t,data:{hash:s,data:a}}=e;if(s===n&&l-t<36e5)return a}}if(Ut&&Ut.hash===n&&!i)return Ut.promise;const o=(async()=>{const i=e.map(e=>({type:e.type,val:(e.quantity*e.currentPrice).toFixed(0)})),l="zh"===r?"Chinese":"English",o=`\n      Analyze the risk profile of this portfolio: ${JSON.stringify(i)}.\n      \n      **PRIVACY RULE**: Do not mention specific monetary amounts in the 'analysis' text. Use percentages or general terms.\n\n      Classify assets by risk level:\n      - High Risk: Altcoins and volatile cryptocurrencies (excluding stablecoins and BTC/ETH)\n      - Medium Risk: Stocks, Funds, Major Cryptocurrencies (BTC, ETH)\n      - Low/Stable Risk: Cash, Real Estate, Stablecoins (USDT, USDC, DAI, BUSD, etc.)\n      - Liability: Debt (increases overall risk profile if high)\n      \n      Return JSON with a riskScore (1-10) and a brief analysis in ${l}.\n      \n      The JSON keys must be: "riskScore", "riskLevel", "analysis".\n    `,c={type:a.OBJECT,properties:{riskScore:{type:a.NUMBER,description:"1-10 Score (10 is Aggressive)"},riskLevel:{type:a.STRING,description:"Conservative, Balanced, Aggressive"},analysis:{type:a.STRING,description:`Max 60 words summary in ${l}, no specific dollar/currency amounts.`}},required:["riskScore","riskLevel","analysis"]},d=Pt.create(s,t),u=await d.generateJSON(o,c);return Ze.saveCache(_t,{hash:n,data:u}),u})();Ut={hash:n,promise:o};try{return await o}finally{Ut=null}})(s,e,r.aiProvider,r.language,!0);o(t)}catch(t){m(!0)}finally{d(!1)}}else m(!0)},formatCurrency:p,t:n})]}),t.jsx(as,{topAssets:b,pnlRanking:f,liabilityDistribution:h,formatCurrency:p,isPrivacyMode:r.isPrivacyMode,t:n})]})},ls=()=>{const{assets:s,transactions:a,settings:r,updateSettings:i,importAssetsCSV:n,importTransactionsCSV:l,clearData:o,t:c}=vt(),[u,m]=e.useState(null),[p,x]=e.useState(!1),h=e.useRef(null),[g,b]=e.useState(!1),[y,f]=e.useState(!1),[v,j]=e.useState(!1),[N,w]=e.useState(!1),S=e=>{if(null==e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t},A=e=>{const t=parseFloat(e);return isNaN(t)?0:t},D=e=>{const t=[];let s=0,a=!1;for(let i=0;i<e.length;i++)if('"'===e[i])a=!a;else if(","===e[i]&&!a){let a=e.substring(s,i);a.startsWith('"')&&a.endsWith('"')&&(a=a.slice(1,-1).replace(/""/g,'"')),t.push(a),s=i+1}let r=e.substring(s);return r.startsWith('"')&&r.endsWith('"')&&(r=r.slice(1,-1).replace(/""/g,'"')),t.push(r),t};return t.jsxs("div",{className:"space-y-6 animate-fade-in max-w-3xl mx-auto",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:c("settings")}),t.jsx("p",{className:"text-slate-500",children:c("managePreferences")})]})}),t.jsx(Vt,{title:c("privacyDataManagement"),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"p-3 rounded-xl transition-all "+(r.isPrivacyMode?"bg-indigo-600 text-white shadow-md shadow-indigo-200":"bg-slate-100 text-slate-400"),children:r.isPrivacyMode?t.jsx($,{size:24}):t.jsx(B,{size:24})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-slate-800 text-base",children:c("privacyMode")}),t.jsx("div",{className:"text-sm text-slate-500 mt-1 max-w-sm leading-relaxed",children:c("privacyModeDesc")})]})]}),t.jsx("button",{onClick:()=>i({isPrivacyMode:!r.isPrivacyMode}),className:"relative w-14 h-8 rounded-full transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 "+(r.isPrivacyMode?"bg-indigo-600":"bg-slate-200"),children:t.jsx("span",{className:"absolute top-1 left-1 bg-white w-6 h-6 rounded-full shadow-sm transform transition-transform duration-200 ease-in-out "+(r.isPrivacyMode?"translate-x-6":"translate-x-0")})})]}),t.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 rounded-xl p-4 flex items-start gap-3",children:[t.jsx(F,{size:20,className:"text-emerald-600 mt-0.5 shrink-0"}),t.jsx("span",{className:"text-sm text-emerald-800 leading-relaxed font-medium",children:c("localDataSecurity")})]}),t.jsx("div",{className:"border-t border-slate-200 my-4"}),u&&t.jsxs("div",{className:"p-3 rounded-lg text-sm flex items-center gap-2 "+("success"===u.type?"bg-green-50 text-green-700":"error"===u.type?"bg-red-50 text-red-700":"bg-orange-50 text-orange-700"),children:["success"===u.type?t.jsx(Y,{size:16}):t.jsx(k,{size:16}),u.msg]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"group bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100 rounded-xl p-5 hover:shadow-md hover:border-blue-200 transition-all",children:[t.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[t.jsx("div",{className:"p-2.5 bg-blue-500 text-white rounded-lg group-hover:bg-blue-600 transition-colors shadow-sm",children:t.jsx(H,{size:20})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-slate-800 text-sm mb-1",children:c("exportUnified")}),t.jsx("div",{className:"text-xs text-slate-600 leading-relaxed",children:c("exportUnifiedDesc")})]})]}),t.jsxs("button",{onClick:()=>{const e=a.map(e=>{const t=s.find(t=>t.id===e.assetId);return[e.id,e.date,e.type,e.quantityChange,e.pricePerUnit,e.fee,e.total,e.note||"",e.assetId,(null==t?void 0:t.symbol)||"UNKNOWN",(null==t?void 0:t.name)||"Unknown Asset",(null==t?void 0:t.type)||Fe.OTHER,(null==t?void 0:t.currency)||Ye.USD,(null==t?void 0:t.currentPrice)||0,(null==t?void 0:t.dateAcquired)||""].map(S).join(",")});((e,t)=>{const s=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.setAttribute("download",t),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)})([["tx_id","tx_date","tx_type","tx_quantity","tx_price","tx_fee","tx_total","tx_note","asset_id","asset_symbol","asset_name","asset_type","asset_currency","asset_current_price","asset_date_acquired"].join(","),...e].join("\n"),`panasset_full_data_${(new Date).toISOString().split("T")[0]}.csv`)},className:"w-full py-2.5 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors text-sm shadow-sm flex items-center justify-center gap-2",children:[t.jsx(V,{size:16}),c("exportUnified")]})]}),t.jsxs("div",{className:"group bg-gradient-to-br from-emerald-50 to-teal-50 border border-emerald-100 rounded-xl p-5 hover:shadow-md hover:border-emerald-200 transition-all",children:[t.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[t.jsx("div",{className:"p-2.5 bg-emerald-500 text-white rounded-lg group-hover:bg-emerald-600 transition-colors shadow-sm",children:t.jsx(W,{size:20})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-slate-800 text-sm mb-1",children:c("importData")}),t.jsx("div",{className:"text-xs text-slate-600 leading-relaxed",children:c("importHint")})]})]}),t.jsxs("button",{onClick:()=>{var e;null==(e=h.current)||e.click()},className:"w-full py-2.5 px-4 bg-emerald-600 hover:bg-emerald-700 text-white font-medium rounded-lg transition-colors text-sm shadow-sm flex items-center justify-center gap-2",children:[t.jsx(W,{size:16}),c("uploadCSV")]}),t.jsx("input",{type:"file",accept:".csv",ref:h,onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;const a=new FileReader;a.onload=e=>{var t;try{const s=(null==(t=e.target)?void 0:t.result).split(/\r?\n/).filter(e=>""!==e.trim());if(s.length<2)throw new Error("File is empty or invalid");const a=D(s[0]).map(e=>e.trim());if(!a.includes("tx_id")||!a.includes("asset_id"))throw new Error("Invalid CSV format. Please use the Unified Export format.");const r=new Map,i=[];s.slice(1).forEach(e=>{const t=D(e),s=e=>{const s=a.indexOf(e);return-1!==s?t[s]:""},n=s("asset_id");if(!n)return;r.has(n)||r.set(n,{id:n,symbol:s("asset_symbol")||"UNKNOWN",name:s("asset_name")||"Unknown",type:s("asset_type")||Fe.OTHER,currency:s("asset_currency")||Ye.USD,currentPrice:A(s("asset_current_price")),dateAcquired:s("asset_date_acquired"),lastUpdated:Date.now()});const l=s("tx_id")||crypto.randomUUID();i.push({id:l,assetId:n,type:s("tx_type")||He.BUY,date:s("tx_date")||(new Date).toISOString(),quantityChange:A(s("tx_quantity")),pricePerUnit:A(s("tx_price")),fee:A(s("tx_fee")),total:A(s("tx_total")),note:s("tx_note")})});const o=Array.from(r.values()),d=i;n(o),l(d),m({msg:`${c("importSuccess")} (${o.length} Assets, ${d.length} Txs)`,type:"success"}),setTimeout(()=>m(null),5e3)}catch(s){m({msg:c("importError"),type:"error"})}},a.readAsText(s),e.target.value=""},className:"hidden"})]})]}),t.jsx("div",{className:"border-t border-slate-100 my-2"}),t.jsxs("button",{onClick:()=>x(!0),className:"w-full flex items-center justify-center gap-2 p-3 text-red-600 hover:bg-red-50 rounded-xl transition-colors text-sm font-medium",children:[t.jsx(d,{size:16}),c("resetData")]})]})}),t.jsx(Vt,{title:c("apiConfiguration"),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 bg-slate-100 text-slate-600 rounded-lg mt-1",children:t.jsx(G,{size:20})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:c("aiProvider")}),t.jsx("div",{className:"text-sm text-slate-500 mb-3",children:c("aiProviderDesc")}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md",children:[t.jsx("label",{className:"border rounded-xl p-4 cursor-pointer transition-all "+("gemini"===r.aiProvider?"border-purple-500 bg-purple-50":"border-slate-200 hover:border-purple-200"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"radio",name:"aiProvider",checked:"gemini"===r.aiProvider,onChange:()=>i({aiProvider:"gemini"}),className:"w-4 h-4 text-purple-600 focus:ring-purple-500"}),t.jsx("span",{className:"font-medium text-slate-800",children:"Google Gemini"})]})}),t.jsx("label",{className:"border rounded-xl p-4 cursor-pointer transition-all "+("deepseek"===r.aiProvider?"border-blue-500 bg-blue-50":"border-slate-200 hover:border-blue-200"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"radio",name:"aiProvider",checked:"deepseek"===r.aiProvider,onChange:()=>i({aiProvider:"deepseek"}),className:"w-4 h-4 text-blue-600 focus:ring-blue-500"}),t.jsx("span",{className:"font-medium text-slate-800",children:"DeepSeek"})]})})]})]})]}),t.jsx("div",{className:"border-t border-slate-100 pt-4"}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 bg-purple-50 text-purple-600 rounded-lg mt-1",children:t.jsx(J,{size:20})}),t.jsx("div",{className:"flex-1",children:"gemini"===r.aiProvider?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:c("geminiKey")}),t.jsxs("div",{className:"text-sm text-slate-500 mb-3 bg-blue-50 p-3 rounded-lg border border-blue-100",children:[c("geminiKeyDesc"),t.jsx("div",{className:"mt-1",children:t.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline font-medium",children:c("getKey")})})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:g?"text":"password",name:"gemini_api_key_field",autoComplete:"off",placeholder:"Paste your Gemini API Key here...",value:r.geminiApiKey,onChange:e=>i({geminiApiKey:e.target.value}),className:"w-full p-3 pr-10 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-mono"}),t.jsx("button",{type:"button",onClick:()=>b(!g),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:g?t.jsx($,{size:18}):t.jsx(B,{size:18})})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:c("deepSeekKey")}),t.jsxs("div",{className:"text-sm text-slate-500 mb-3 bg-blue-50 p-3 rounded-lg border border-blue-100",children:[c("deepSeekKeyDesc"),t.jsx("div",{className:"mt-1",children:t.jsx("a",{href:"https://platform.deepseek.com/api_keys",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline font-medium",children:c("getKey")})})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:y?"text":"password",name:"deepseek_api_key_field",autoComplete:"off",placeholder:"Paste your DeepSeek API Key here...",value:r.deepSeekApiKey,onChange:e=>i({deepSeekApiKey:e.target.value}),className:"w-full p-3 pr-10 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-mono"}),t.jsx("button",{type:"button",onClick:()=>f(!y),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:y?t.jsx($,{size:18}):t.jsx(B,{size:18})})]})]})})]}),t.jsx("div",{className:"border-t border-slate-100 pt-4"}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 bg-slate-100 text-slate-600 rounded-lg mt-1",children:t.jsx(Q,{size:20})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:c("marketDataProvider")}),t.jsx("div",{className:"text-sm text-slate-500 mb-3",children:c("marketDataProviderDesc")}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md",children:[t.jsx("label",{className:"border rounded-xl p-4 cursor-pointer transition-all "+("finnhub"===r.marketDataProvider?"border-teal-500 bg-teal-50":"border-slate-200 hover:border-teal-200"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"radio",name:"marketDataProvider",checked:"finnhub"===r.marketDataProvider,onChange:()=>i({marketDataProvider:"finnhub"}),className:"w-4 h-4 text-teal-600 focus:ring-teal-500"}),t.jsx("span",{className:"font-medium text-slate-800",children:"Finnhub"})]})}),t.jsx("label",{className:"border rounded-xl p-4 cursor-pointer transition-all "+("alphavantage"===r.marketDataProvider?"border-orange-500 bg-orange-50":"border-slate-200 hover:border-orange-200"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"radio",name:"marketDataProvider",checked:"alphavantage"===r.marketDataProvider,onChange:()=>i({marketDataProvider:"alphavantage"}),className:"w-4 h-4 text-orange-600 focus:ring-orange-500"}),t.jsx("span",{className:"font-medium text-slate-800",children:"Alpha Vantage"})]})})]})]})]}),t.jsx("div",{className:"border-t border-slate-100 pt-4"}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 bg-slate-50 text-slate-500 rounded-lg mt-1",children:t.jsx(J,{size:20})}),t.jsx("div",{className:"flex-1",children:"finnhub"===r.marketDataProvider?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:c("finnhubKey")}),t.jsxs("div",{className:"text-sm text-slate-500 mb-3",children:[c("finnhubKeyDesc"),t.jsx("a",{href:"https://finnhub.io/",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline ml-1",children:c("getKey")}),"."]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:v?"text":"password",name:"finnhub_api_key_field",autoComplete:"off",placeholder:"Paste your Finnhub API Key here...",value:r.finnhubApiKey,onChange:e=>i({finnhubApiKey:e.target.value}),className:"w-full p-3 pr-10 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-mono"}),t.jsx("button",{type:"button",onClick:()=>j(!v),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:v?t.jsx($,{size:18}):t.jsx(B,{size:18})})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:c("alphaVantageKey")}),t.jsxs("div",{className:"text-sm text-slate-500 mb-3",children:[c("alphaVantageKeyDesc"),t.jsx("a",{href:"https://www.alphavantage.co/support/#api-key",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline ml-1",children:c("getKey")}),"."]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:N?"text":"password",name:"alphavantage_api_key_field",autoComplete:"off",placeholder:"Paste your Alpha Vantage API Key here...",value:r.alphaVantageApiKey,onChange:e=>i({alphaVantageApiKey:e.target.value}),className:"w-full p-3 pr-10 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-mono"}),t.jsx("button",{type:"button",onClick:()=>w(!N),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:N?t.jsx($,{size:18}):t.jsx(B,{size:18})})]})]})})]}),t.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-3 flex items-start gap-3 mt-4",children:[t.jsx(F,{size:16,className:"text-slate-400 mt-0.5 shrink-0"}),t.jsx("span",{className:"text-sm text-slate-500 leading-relaxed",children:c("apiKeysSecurity")})]})]})}),t.jsx(Vt,{title:c("generalPreferences"),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-slate-50 last:border-0 last:pb-0",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-50 text-blue-600 rounded-lg",children:t.jsx(X,{size:20})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-slate-800",children:c("baseCurrency")}),t.jsx("div",{className:"text-sm text-slate-500",children:c("baseCurrencyDesc")})]})]}),t.jsxs("select",{value:r.baseCurrency,onChange:e=>i({baseCurrency:e.target.value}),className:"bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 outline-none min-w-[120px]",children:[t.jsx("option",{value:Ye.USD,children:"USD ($)"}),t.jsx("option",{value:Ye.CNY,children:"CNY (¥)"}),t.jsx("option",{value:Ye.HKD,children:"HKD ($)"})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-emerald-50 text-emerald-600 rounded-lg",children:t.jsx(Z,{size:20})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-slate-800",children:c("language")}),t.jsx("div",{className:"text-sm text-slate-500",children:c("languageDesc")})]})]}),t.jsxs("select",{value:r.language,onChange:e=>i({language:e.target.value}),className:"bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 outline-none min-w-[120px]",children:[t.jsx("option",{value:"en",children:"English"}),t.jsx("option",{value:"zh",children:"中文 (简体)"})]})]})]})}),t.jsx(Vt,{title:c("feedback"),children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2.5 bg-slate-100 text-slate-700 rounded-lg shrink-0",children:t.jsx(ee,{size:22})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-slate-800",children:c("reportBug")}),t.jsx("div",{className:"text-sm text-slate-500",children:c("githubDesc")})]})]}),t.jsxs("a",{href:"https://github.com/kuka36/PanassetLite/issues",target:"_blank",rel:"noreferrer",className:"px-4 py-2.5 bg-slate-800 hover:bg-slate-900 text-white text-sm font-medium rounded-lg transition-colors flex items-center justify-center gap-2 shrink-0",children:[t.jsx(ee,{size:16}),t.jsx("span",{children:c("githubLinkText")}),t.jsx(te,{size:14,className:"opacity-70"})]})]})}),t.jsx(Wt,{isOpen:p,onClose:()=>x(!1),onConfirm:()=>{o(),m({msg:c("resetSuccess"),type:"success"}),setTimeout(()=>m(null),3e3)},title:c("resetData"),message:c("resetConfirm"),confirmText:c("resetData"),isDanger:!0}),t.jsx("div",{className:"text-center text-slate-400 text-sm pt-4",children:"zh"===r.language?"盘资产·轻 v1.2.1 • 本地数据存储":"PanassetLite v1.2.1 • Local Data Storage"})]})},os=({asset:s,settings:a,exchangeRates:r,onEdit:i,onTransaction:n,onDelete:l,t:o})=>{const{updateAssetPrice:c}=vt(),[m,p]=e.useState(null),[x,h]=e.useState(""),g=e=>e===Fe.STOCK||e===Fe.CRYPTO||e===Fe.FUND,b=e=>{switch(e){case Ye.USD:return"$";case Ye.CNY:return"¥";case Ye.HKD:return"HK$";default:return"$"}},y=e=>{const t=parseFloat(x);isNaN(t)||(c(e,t),p(null))},f=b(s.currency),v=b(a.baseCurrency),j=s.quantity*s.currentPrice,N=dt(j,s.currency,a.baseCurrency,r),w=s.quantity*s.avgCost,A=j-w,D=w>0?A/w*100:0,T=s.type===Fe.LIABILITY,C=(I=s.type)===Fe.REAL_ESTATE||I===Fe.LIABILITY||I===Fe.OTHER||I===Fe.CASH;var I;const k=m===s.id,E=g(s.type),P=(e=>{if(!g(e.type))return!1;return Date.now()-(e.lastUpdated||0)>18e5})(s);return t.jsxs("tr",{className:"border-b border-slate-50 hover:bg-slate-50/50 transition-colors group",children:[t.jsx("td",{className:"py-4 pl-2",children:t.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[t.jsx("div",{className:`w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center font-bold text-xs shrink-0 ${(e=>{switch(e){case Fe.STOCK:return"bg-blue-100 text-blue-700";case Fe.CRYPTO:return"bg-purple-100 text-purple-700";case Fe.FUND:return"bg-orange-100 text-orange-700";case Fe.CASH:return"bg-green-100 text-green-700";case Fe.REAL_ESTATE:return"bg-amber-100 text-amber-800";case Fe.LIABILITY:return"bg-red-100 text-red-700";default:return"bg-slate-100 text-slate-700"}})(s.type)}`,children:s.symbol.substring(0,1)}),t.jsxs("div",{className:"min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"font-semibold text-slate-800 truncate max-w-[80px] md:max-w-none",children:s.symbol}),t.jsx("span",{className:"hidden md:inline-block text-[10px] px-1 py-0.5 bg-slate-100 text-slate-500 rounded",children:s.currency})]}),t.jsx("div",{className:"text-xs text-slate-400 truncate max-w-[90px] md:max-w-[120px]",children:s.name})]})]})}),t.jsxs("td",{className:"md:hidden py-4 text-right pr-2",children:[t.jsx("div",{className:"font-bold text-sm "+(T?"text-red-700":"text-slate-800"),children:a.isPrivacyMode?"••••••":`${T?"-":""}${v}${N.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:1})}`}),t.jsx("div",{className:"text-xs text-slate-500 mt-0.5",children:a.isPrivacyMode?"••••••":s.quantity.toLocaleString(void 0,{maximumFractionDigits:4})})]}),t.jsxs("td",{className:"md:hidden py-4 text-right pr-2",children:[t.jsxs("div",{className:"font-medium text-sm text-slate-700",children:[f,s.currentPrice.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),t.jsx("div",{className:"text-xs text-slate-400 mt-0.5",children:a.isPrivacyMode?"••••••":`${f}${s.avgCost.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`})]}),t.jsx("td",{className:"hidden md:table-cell py-4",children:k?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-slate-400 text-xs",children:f}),t.jsx("input",{type:"number",autoFocus:!0,className:"w-20 p-1 text-sm border border-blue-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",value:x,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"===e.key&&y(s.id),"Escape"===e.key&&p(null)},onBlur:()=>y(s.id)})]}):t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"font-medium text-slate-700 flex items-center gap-2",children:[f,s.currentPrice.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:6}),i&&t.jsx("button",{onClick:()=>{return p((e=s).id),void h(e.currentPrice.toString());var e},className:"opacity-0 group-hover:opacity-100 transition-opacity text-slate-300 hover:text-blue-600",title:o("updatePrice"),children:t.jsx(S,{size:14})})]}),t.jsx("div",{className:"flex items-center gap-1 mt-1",children:E?P?t.jsxs("span",{className:"text-[10px] text-amber-600 flex items-center gap-1 bg-amber-50 px-1.5 py-0.5 rounded border border-amber-100",title:o("dataStale"),children:[t.jsx(se,{size:10})," ",o("offline")]}):t.jsxs("span",{className:"text-[10px] text-green-600 flex items-center gap-1 bg-green-50 px-1.5 py-0.5 rounded border border-green-100",title:o("liveData"),children:[t.jsx(ae,{size:10})," ",o("live")]}):t.jsxs("span",{className:"text-[10px] text-slate-400 flex items-center gap-1 bg-slate-100 px-1.5 py-0.5 rounded border border-slate-200",title:o("manualValuation"),children:[t.jsx(re,{size:10})," ",o("manual")]})})]})}),t.jsx("td",{className:"hidden md:table-cell py-4",children:t.jsx("div",{className:"font-medium text-slate-700",children:a.isPrivacyMode?"••••••":`${f}${s.avgCost.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:6})}`})}),t.jsx("td",{className:"hidden md:table-cell py-4",children:t.jsx("div",{className:"font-medium text-slate-700",children:a.isPrivacyMode?"••••••":s.quantity.toLocaleString()})}),t.jsx("td",{className:"hidden md:table-cell py-4 text-right pr-2 font-bold "+(T?"text-red-700":"text-slate-800"),children:a.isPrivacyMode?"••••••":`${T?"-":""}${v}${N.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),t.jsx("td",{className:"py-4 text-right pr-2",children:C&&!A?t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"text-xs font-medium text-slate-500 bg-slate-100 inline-block px-2 py-0.5 rounded-md",children:[o("lastUpdated"),t.jsxs("span",{className:"hidden md:inline",children:[": ",(e=>{if(!e)return"N/A";return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})(s.lastUpdated)]})]})}):a.isPrivacyMode?t.jsx("div",{className:"text-right",children:t.jsx("span",{className:"text-slate-400 font-bold tracking-widest",children:"••••••"})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-end gap-1 font-medium "+(A>=0?"text-green-600":"text-red-500"),children:[A>=0?t.jsx(u,{size:14}):t.jsx(ie,{size:14}),Math.abs(D).toFixed(2),"%"]}),t.jsxs("div",{className:"text-xs "+(A>=0?"text-green-600/70":"text-red-500/70"),children:[A>=0?"+":"-",f,Math.abs(A).toLocaleString(void 0,{maximumFractionDigits:0})]})]})}),(i||n)&&t.jsx("td",{className:"py-4 text-right pr-2",children:t.jsxs("div",{className:"flex items-center justify-end gap-1 md:gap-2",children:[n&&t.jsx("button",{onClick:()=>n(s),className:"p-1.5 text-slate-400 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:o("recordTransaction"),children:t.jsx(U,{size:16})}),i&&t.jsx("button",{onClick:()=>i(s),className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:o("editDetails"),children:t.jsx(ne,{size:16})}),l&&t.jsx("button",{onClick:()=>l(s.id,s.symbol),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:o("delete"),children:t.jsx(d,{size:16})})]})})]})},cs=({onEdit:s,onTransaction:a})=>{const{assets:r,deleteAsset:i,settings:n,exchangeRates:l,t:o}=vt(),[c,d]=e.useState({key:"value",direction:"desc"}),[u,m]=e.useState(null),p=e.useMemo(()=>{const e=[...r];return e.sort((e,t)=>{let s=0,a=0;const r=e=>e.quantity*e.currentPrice-e.quantity*e.avgCost;switch(c.key){case"symbol":s=e.symbol.toLowerCase(),a=t.symbol.toLowerCase();break;case"price":s=e.currentPrice,a=t.currentPrice;break;case"cost":s=e.avgCost,a=t.avgCost;break;case"quantity":s=e.quantity,a=t.quantity;break;case"value":const i=dt(e.quantity*e.currentPrice,e.currency,n.baseCurrency,l),o=dt(t.quantity*t.currentPrice,t.currency,n.baseCurrency,l);s=e.type===Fe.LIABILITY?-i:i,a=t.type===Fe.LIABILITY?-o:o;break;case"pnl":s=r(e),a=r(t);break;default:return 0}return s<a?"asc"===c.direction?-1:1:s>a?"asc"===c.direction?1:-1:0}),e},[r,c,n.baseCurrency,l]),x=e=>{d(t=>({key:e,direction:t.key===e&&"desc"===t.direction?"asc":"desc"}))},h=e=>c.key!==e?t.jsx("div",{className:"w-3 h-3"}):"asc"===c.direction?t.jsx(le,{size:12}):t.jsx(oe,{size:12}),g=({label:e,sortKey:s,alignRight:a=!1,className:r=""})=>t.jsx("th",{className:`pb-3 font-medium cursor-pointer group select-none ${a?"text-right":"text-left"} ${a?"pr-2":"pl-2"} ${r}`,onClick:()=>x(s),children:t.jsxs("div",{className:`flex items-center gap-1 ${a?"justify-end":"justify-start"} text-slate-500 group-hover:text-blue-600 transition-colors`,children:[e,t.jsx("span",{className:"text-slate-400 group-hover:text-blue-500",children:h(s)})]})});return t.jsxs(t.Fragment,{children:[t.jsx(Vt,{title:o("portfolioHoldings"),className:"animate-slide-up",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-xs text-slate-400 uppercase border-b border-slate-100",children:[t.jsx(g,{label:o("asset"),sortKey:"symbol"}),t.jsx("th",{className:"md:hidden pb-3 text-right pr-2 font-medium cursor-pointer",onClick:()=>x("value"),children:t.jsx("div",{className:"flex flex-col items-end gap-0.5",children:t.jsxs("span",{className:"flex items-center gap-1 text-slate-500",children:[o("value")," ","value"===c.key&&h("value")]})})}),t.jsx("th",{className:"md:hidden pb-3 text-right pr-2 font-medium cursor-pointer",onClick:()=>x("price"),children:t.jsx("div",{className:"flex flex-col items-end gap-0.5",children:t.jsxs("span",{className:"flex items-center gap-1 text-slate-500",children:[o("currentPrice")," ","price"===c.key&&h("price")]})})}),t.jsx(g,{label:o("currentPrice"),sortKey:"price",className:"hidden md:table-cell"}),t.jsx(g,{label:o("avgCost"),sortKey:"cost",className:"hidden md:table-cell"}),t.jsx(g,{label:o("holdings"),sortKey:"quantity",className:"hidden md:table-cell"}),t.jsx(g,{label:o("value"),sortKey:"value",alignRight:!0,className:"hidden md:table-cell"}),t.jsx(g,{label:o("statusPnL"),sortKey:"pnl",alignRight:!0}),(s||a)&&t.jsx("th",{className:"pb-3 font-medium text-right pr-2",children:o("actions")})]})}),t.jsxs("tbody",{className:"text-sm",children:[p.map(e=>t.jsx(os,{asset:e,settings:n,exchangeRates:l,onEdit:s,onTransaction:a,onDelete:(e,t)=>m({id:e,symbol:t}),t:o},e.id)),0===p.length&&t.jsx("tr",{children:t.jsx("td",{colSpan:s?7:6,className:"text-center py-8 text-slate-400 italic",children:o("noAssets")})})]})]})})}),t.jsx(Wt,{isOpen:!!u,onClose:()=>m(null),onConfirm:()=>u&&i(u.id),title:o("delete"),message:u?o("confirmDelete").replace("{symbol}",u.symbol):"",confirmText:o("delete"),isDanger:!0})]})},ds=e=>{const t=e=>e.toString().padStart(2,"0");return`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())}T${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}`},us=({isOpen:s,onClose:a,initialAsset:r})=>{var i;const{addAsset:n,editAsset:l,addTransaction:c,t:d}=vt(),[u,m]=e.useState(1),[p,x]=e.useState(Fe.STOCK),[h,g]=e.useState(""),[b,y]=e.useState(""),[f,v]=e.useState(""),[j,N]=e.useState(""),[w,S]=e.useState(""),[D,T]=e.useState(Ye.USD),[C,I]=e.useState(""),[k,E]=e.useState(!1),[P,_]=e.useState(""),R=[{id:Fe.STOCK,label:d("type_stock"),icon:ce,desc:"US, HK, CN Stocks",color:"bg-blue-50 text-blue-600 border-blue-200"},{id:Fe.CRYPTO,label:d("type_crypto"),icon:de,desc:"Coins & Tokens",color:"bg-purple-50 text-purple-600 border-purple-200"},{id:Fe.FUND,label:d("type_fund"),icon:A,desc:"Mutual Funds",color:"bg-orange-50 text-orange-600 border-orange-200"},{id:Fe.REAL_ESTATE,label:d("type_real_estate"),icon:ue,desc:"Property",color:"bg-emerald-50 text-emerald-600 border-emerald-200"},{id:Fe.CASH,label:d("type_cash"),icon:me,desc:"Fiat Reserves",color:"bg-green-50 text-green-600 border-green-200"},{id:Fe.LIABILITY,label:d("type_liability"),icon:M,desc:"Loans & Debt",color:"bg-red-50 text-red-600 border-red-200"},{id:Fe.OTHER,label:d("type_other"),icon:pe,desc:"Art, Watches...",color:"bg-slate-50 text-slate-600 border-slate-200"}];e.useEffect(()=>{s&&(r?(x(r.type),g(r.symbol),y(r.name),v(r.quantity.toString()),N(r.avgCost.toString()),S(r.currentPrice.toString()),T(r.currency),I(r.dateAcquired||ds(new Date)),m(2),E(!1)):(m(1),x(Fe.STOCK),g(""),y(""),v(""),N(""),S(""),T(Ye.USD),I(ds(new Date)),E(!1)))},[s,r]);if(!s)return null;const U=e=>e===Fe.REAL_ESTATE||e===Fe.LIABILITY||e===Fe.OTHER,z=e=>{if(e.preventDefault(),k&&r){const e=parseFloat(P);if(isNaN(e))return;const t=e-r.quantity;if(0===t)return void E(!1);c({assetId:r.id,type:He.BALANCE_ADJUSTMENT,date:ds(new Date),quantityChange:t,pricePerUnit:r.avgCost,fee:0,total:t*r.avgCost,note:"Manual Balance Correction"})}const t=parseFloat(f);let s=parseFloat(j),i=parseFloat(w);if(U(p)?(isNaN(s)&&!isNaN(i)&&(s=i),isNaN(i)&&!isNaN(s)&&(i=s)):isNaN(i)&&(i=s||0),!h)return;const o={id:r?r.id:crypto.randomUUID(),symbol:h.toUpperCase(),name:b||h.toUpperCase(),type:p,currentPrice:i||0,currency:U(p)?D:Ye.USD,lastUpdated:Date.now(),dateAcquired:C};if(r)U(p)||(o.currentPrice=r.currentPrice,o.currency=r.currency),l(o);else{if(isNaN(t))return;n(o,t,s||0,C)}a()};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm transition-opacity",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-xl overflow-hidden flex flex-col max-h-[90vh]",children:[t.jsxs("div",{className:"px-6 py-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center shrink-0",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:d(r?"editHolding":1===u?"selectAssetType":"assetDetails")}),t.jsx("p",{className:"text-xs text-slate-500",children:r?"Edit metadata or adjust balance":1===u?d("whatKind"):`${d("enterDetails")} ${null==(i=R.find(e=>e.id===p))?void 0:i.label}`})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[!r&&t.jsx(Ot,{mode:"ASSET",onResult:e=>{if(e.symbol&&g(e.symbol),e.name&&y(e.name),e.type&&(x(e.type),m(2)),e.quantity&&v(e.quantity.toString()),e.price){const t=e.price.toString();N(t),S(t)}e.date&&I(e.date),e.currency&&T(e.currency)}}),t.jsx("button",{onClick:a,className:"text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-200 rounded-full transition-colors",children:t.jsx(o,{size:20})})]})]}),t.jsxs("div",{className:"overflow-y-auto p-6",children:[1===u&&!r&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:R.map(e=>t.jsxs("button",{onClick:()=>{x(e.id),m(2)},className:"flex flex-col items-center justify-center p-4 rounded-xl border transition-all hover:scale-[1.02] "+(e.id===p?"ring-2 ring-blue-500 bg-blue-50/50 border-blue-200":"bg-white border-slate-100 hover:border-slate-300 hover:shadow-md"),children:[t.jsx("div",{className:`p-3 rounded-full mb-3 ${e.color}`,children:t.jsx(e.icon,{size:24})}),t.jsx("span",{className:"font-semibold text-slate-700 text-sm",children:e.label}),t.jsx("span",{className:"text-[10px] text-slate-400 mt-1",children:e.desc})]},e.id))})}),(2===u||r)&&t.jsxs("form",{id:"asset-form",onSubmit:z,className:"space-y-5",children:[t.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100 space-y-4",children:[t.jsx("div",{className:"flex justify-between items-center mb-2",children:t.jsx("h3",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:d("identification")})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:d("tickerLabel")}),t.jsx("input",{type:"text",value:h,onChange:e=>g(e.target.value.toUpperCase()),className:"w-full p-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none font-medium",autoFocus:!r,required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:d("nameLabel")}),t.jsx("input",{type:"text",value:b,onChange:e=>y(e.target.value),className:"w-full p-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]})]}),t.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100 space-y-4",children:[t.jsx("div",{className:"flex justify-between items-center",children:t.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:d("valuationHoldings")})}),k&&t.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-100 mb-2 animate-fade-in",children:[t.jsx("label",{className:"block text-xs font-bold text-blue-700 uppercase mb-1",children:"New Correct Quantity"}),t.jsx("input",{type:"number",step:"any",placeholder:"Enter actual quantity",value:P,onChange:e=>_(e.target.value),className:"w-full p-2 bg-white border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 outline-none font-bold text-blue-900",autoFocus:!0}),t.jsx("p",{className:"text-[10px] text-blue-600 mt-1",children:"This will create a 'Balance Adjustment' transaction to fix your holdings."})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:d("dateAcquired")}),t.jsxs("div",{className:"relative",children:[t.jsx(L,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"datetime-local",step:"1",value:C,onChange:e=>I(e.target.value),className:"w-full pl-9 p-2.5 bg-white border border-slate-200 rounded-lg outline-none"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex items-center justify-between text-xs font-medium text-slate-500 uppercase mb-1",children:[p===Fe.CASH?d("balance"):p===Fe.LIABILITY?d("principalRemaining"):d("quantity"),r&&!k&&t.jsxs("button",{type:"button",onClick:()=>E(!0),className:"text-[10px] normal-case text-blue-600 hover:bg-blue-50 px-1.5 py-0.5 rounded flex items-center gap-1 transition-colors",children:[t.jsx(xe,{size:10})," Adjust"]})]}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:f,onChange:e=>v(e.target.value),disabled:!!r,className:"w-full p-2.5 bg-white border border-slate-200 rounded-lg outline-none disabled:bg-slate-100 disabled:text-slate-500",required:!r})]}),U(p)?t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:d("unitPrice")}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:w,onChange:e=>S(e.target.value),className:"w-full p-2.5 bg-white border border-slate-200 rounded-lg outline-none"})]}):t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:p===Fe.CASH?d("costBasis"):d("avgCostUnit")}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:j,onChange:e=>N(e.target.value),disabled:!!r,className:"w-full p-2.5 bg-white border border-slate-200 rounded-lg outline-none disabled:bg-slate-100 disabled:text-slate-500"})]})]})]})]})]}),(2===u||r)&&t.jsx("div",{className:"p-6 pt-0 bg-white shrink-0",children:t.jsxs("button",{onClick:z,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2",children:[t.jsx(he,{size:18}),k?"Confirm Adjustment":d(r?"saveChanges":"addToPortfolio")]})})]})})},ms=({isOpen:s,onClose:a,preselectedAssetId:r})=>{const{assets:i,addTransaction:n,t:l}=vt(),[c,d]=e.useState(""),[u,m]=e.useState(He.BUY),[p,x]=e.useState(""),[h,g]=e.useState(""),[b,y]=e.useState(""),[f,v]=e.useState("0");if(e.useEffect(()=>{if(s){d(r||"");const e=i.find(e=>e.id===r);(null==e?void 0:e.type)===Fe.LIABILITY?m(He.BORROW):(null==e?void 0:e.type)===Fe.CASH?m(He.DEPOSIT):m(He.BUY),x((e=>{const t=e=>e.toString().padStart(2,"0");return`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())}T${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}`})(new Date)),g(""),y(""),v("0")}},[s,r,i]),!s)return null;const j=i.sort((e,t)=>e.symbol.localeCompare(t.symbol)),N=i.find(e=>e.id===c),w=(e=>{const t=[He.BUY,He.SELL];if(!e)return t;switch(e){case Fe.STOCK:case Fe.FUND:return[...t,He.DIVIDEND];case Fe.LIABILITY:return[He.BORROW,He.REPAY];case Fe.CASH:return[He.DEPOSIT,He.WITHDRAWAL];default:return[...t,He.DIVIDEND]}})(null==N?void 0:N.type);return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm transition-opacity",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-slide-up",children:[t.jsxs("div",{className:"px-6 py-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-2 bg-blue-100 text-blue-600 rounded-lg",children:t.jsx(U,{size:18})}),t.jsx("h2",{className:"text-lg font-bold text-slate-800",children:l("recordTransaction")})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[!r&&t.jsx(Ot,{mode:"TRANSACTION",onResult:e=>{if(e.symbol){const t=j.find(t=>t.symbol===e.symbol);t&&d(t.id)}e.txType&&m(e.txType),e.quantity&&g(e.quantity.toString()),e.price&&y(e.price.toString()),e.date&&x(e.date)}}),t.jsx("button",{onClick:a,className:"text-slate-400 hover:text-slate-600",children:t.jsx(o,{size:20})})]})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=parseFloat(h),s=parseFloat(b),r=parseFloat(f)||0;if(!c||isNaN(t)||isNaN(s))return;let i=t;u!==He.SELL&&u!==He.WITHDRAWAL&&u!==He.REPAY||(i=-t),n({assetId:c,type:u,date:p,quantityChange:i,pricePerUnit:s,fee:r,total:t*s+r}),a()},className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:l("asset")}),t.jsxs("select",{value:c,onChange:e=>d(e.target.value),className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-500",required:!0,disabled:!!r,children:[t.jsx("option",{value:"",disabled:!0,children:l("selectAssetPlaceholder")}),j.map(e=>t.jsxs("option",{value:e.id,children:[e.symbol," - ",e.name]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:l("action")}),t.jsx("div",{className:"flex flex-wrap gap-1 p-1 bg-slate-100 rounded-lg",children:w.map(e=>t.jsx("button",{type:"button",onClick:()=>m(e),className:"flex-1 min-w-[60px] py-2 text-[10px] sm:text-xs font-bold rounded-md transition-all "+(u===e?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"),children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:l("date")}),t.jsxs("div",{className:"relative",children:[t.jsx(L,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"datetime-local",step:"1",value:p,onChange:e=>x(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:l("quantity")}),t.jsxs("div",{className:"relative",children:[t.jsx(ge,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:h,onChange:e=>g(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:l("pricePerUnit")}),t.jsxs("div",{className:"relative",children:[t.jsx(z,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:b,onChange:e=>y(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:l("fees")}),t.jsxs("div",{className:"relative",children:[t.jsx(z,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:f,onChange:e=>v(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),t.jsxs("div",{className:"p-3 bg-slate-100 rounded-lg flex justify-between items-center text-sm",children:[t.jsx("span",{className:"text-slate-500 font-medium",children:l("totalEstimate")}),t.jsxs("span",{className:"font-bold text-slate-800",children:["$",((parseFloat(h)||0)*(parseFloat(b)||0)+(parseFloat(f)||0)).toLocaleString(void 0,{minimumFractionDigits:2})]})]}),t.jsxs("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2",children:[t.jsx(he,{size:18}),l("recordTransaction")]})]})]})})},ps=()=>{const{t:s,refreshPrices:a,isRefreshing:r}=vt(),[i,n]=e.useState(!1),[l,o]=e.useState(!1),[c,d]=e.useState(null),[u,m]=e.useState(void 0);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:s("assetsManagement")}),t.jsx("p",{className:"text-slate-500",children:s("assetsSubtitle")})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>a(),disabled:r,className:"p-2.5 bg-white hover:bg-slate-50 text-slate-600 border border-slate-200 rounded-xl shadow-sm transition-all",title:s("refreshPrices"),children:t.jsx(R,{size:20,className:r?"animate-spin text-blue-600":"text-slate-400"})}),t.jsxs("button",{onClick:()=>{d(null),n(!0)},className:"px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl shadow-lg shadow-blue-200 transition-all flex items-center gap-2",children:[t.jsx(be,{size:20})," ",s("addNewAsset")]})]})]}),t.jsx(cs,{onEdit:e=>{d(e),n(!0)},onTransaction:e=>{m(e.id),o(!0)}}),t.jsx(us,{isOpen:i,onClose:()=>{n(!1),d(null)},initialAsset:c}),t.jsx(ms,{isOpen:l,onClose:()=>{o(!1),m(void 0)},preselectedAssetId:u})]})},xs=(t,s)=>{const[a,r]=e.useState(null),[i,n]=e.useState(!1),[l,o]=e.useState(null),[c,d]=e.useState(!1);e.useEffect(()=>{(()=>{if(0===t.length)return void d(!1);const e=zt(t),i=Ze.getCache(Lt);if(i){const{timestamp:t,data:{hash:n,data:l}}=i,o=Date.now()-t>Rt,c=n!==`${e}:${s.language}:${s.aiProvider}`;!a&&l&&r(l),d(o||c)}else d(!0)})()},[t,a,s.language,s.aiProvider]);return{analysis:a,loading:i,error:l,canAnalyze:c,analyze:async()=>{const e="deepseek"===s.aiProvider?s.deepSeekApiKey:s.geminiApiKey;if(!e)throw new Error("API Key is missing");if(0!==t.length){n(!0),o(null);try{const a=await(async(e,t,s,a="en",r=!1)=>{if(!t)throw new Error("API Key is missing");if(0===e.length)return"";const i=`${zt(e)}:${a}:${s}`,n=Date.now();if(!r){const e=Ze.getCache(Lt);if(e){const{timestamp:t,data:{hash:s,data:a}}=e;if(s===i&&n-t<Rt)return a}}if(Mt&&Mt.hash===i&&!r)return Mt.promise;const l=(async()=>{const r=e.map(e=>({symbol:e.symbol,type:e.type,qty:e.quantity,val:(e.quantity*e.currentPrice).toFixed(0),curr:e.currency})),n="zh"===a?"Chinese (Simplified)":"English",l=`\n    You are the Chief Investment Officer (CIO) for 'PanassetLite' (盘资产·轻), a private wealth management platform.\n\n    **User Portfolio Snapshot (For Analysis Only):**\n    ${JSON.stringify(r)}\n\n    **Financial Context:**\n    - **Net Worth** = Total Assets - Total Liabilities.\n    - **Liquid Assets**: Stocks, Crypto, Cash, Funds.\n    - **Illiquid Assets**: Real Estate (Low volatility, hard to sell).\n    - **Liabilities**: Loans, Mortgages (Negative impact on Net Worth).\n\n    **STRICT PRIVACY & OUTPUT RULES:**\n    1. **NO ABSOLUTE NUMBERS:** You are generating a report for a privacy-focused dashboard. **DO NOT** output any specific monetary values (e.g., do NOT write "$10,000", "72,361 RMB", or "1.5 BTC") in the final report.\n    2. **USE RATIOS & PERCENTAGES:** Instead of numbers, use percentages (%), ratios, and qualitative terms (e.g., "healthy buffer", "significant portion", "minor allocation").\n    3. **LANGUAGE:** The output must be in **${n}**.\n\n    **Task:**\n    Generate a strategic wealth analysis report. Use Markdown.\n\n    **Structure:**\n    1.  **Wealth Health Check**:\n        - Analyze the **Net Worth** structure (Asset vs Liability mix) using percentages only.\n        - Assess **Debt-to-Asset Ratio**. (Liabilities > 30% is caution).\n        - Assess **Liquidity**. Are they over-leveraged or too illiquid?\n\n    2.  **Risk & Allocation**:\n        - Evaluate exposure to High Volatility (Crypto) vs Stable Assets (Real Estate/Cash) based on portfolio weight.\n        - Comment on concentration risk (e.g., "Allocated heavily in a single asset").\n\n    3.  **Strategic Recommendations**:\n        - Provide 3 specific, actionable steps to optimize the portfolio based on the asset mix.\n\n    **Tone:** Professional, insightful, objective, and encouraging.\n    **Length:** Concise (~300 words).\n    `,o=Pt.create(s,t),c=await o.generateText(l)||("zh"===a?"暂时无法生成分析报告。":"Unable to generate analysis report.");return Ze.saveCache(Lt,{hash:i,data:c}),c})();Mt={hash:i,promise:l};try{return await l}finally{Mt=null}})(t,e,s.aiProvider,s.language);r(a),d(!1)}catch(a){o(a.message||"AI Service Unavailable")}finally{n(!1)}}},setError:o}},hs=()=>{const{assets:s,settings:a,t:r}=vt(),[i,n]=e.useState(!1),{analysis:l,loading:o,error:d,canAnalyze:u,analyze:m,setError:p}=xs(s,a);return 0===s.length?null:t.jsxs(Vt,{className:"border-purple-100 bg-gradient-to-br from-white to-purple-50/50 transition-all duration-300",children:[t.jsxs("div",{className:"flex items-center justify-between cursor-pointer select-none",onClick:()=>n(!i),children:[t.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[t.jsx("div",{className:"p-2 bg-purple-600 rounded-lg shadow-md shadow-purple-200 shrink-0",children:t.jsx(c,{className:"text-white",size:18})}),t.jsxs("div",{className:"min-w-0 flex flex-col justify-center",children:[t.jsx("h3",{className:"font-bold text-slate-800 text-sm sm:text-base truncate leading-tight",children:r("aiInsights")}),t.jsx("p",{className:"text-xs text-slate-500 hidden sm:block truncate mt-0.5",children:r("wealthManagement")})]})]}),t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 shrink-0 ml-2",children:[u?t.jsx("button",{onClick:async e=>{e&&e.stopPropagation();if(!("deepseek"===a.aiProvider?a.deepSeekApiKey:a.geminiApiKey))return p(r("apiKeyMissing")),void n(!0);n(!0),await m()},disabled:o,className:"text-xs sm:text-sm px-3 py-1.5 sm:px-4 sm:py-2 bg-white border border-slate-200 hover:border-purple-300 text-purple-600 hover:text-purple-700 hover:bg-purple-50 rounded-lg transition-all flex items-center gap-1.5 sm:gap-2 shadow-sm z-10 font-medium",children:o?t.jsx(R,{className:"animate-spin",size:14}):t.jsxs(t.Fragment,{children:[t.jsx(c,{size:14})," ",t.jsx("span",{children:r("analyzeNow")})]})}):t.jsxs("div",{className:"text-[10px] sm:text-xs px-2 py-1 sm:px-3 sm:py-1.5 bg-green-50 text-green-600 rounded-lg border border-green-100 flex items-center gap-1 whitespace-nowrap",children:[t.jsx(Y,{size:12})," ",t.jsx("span",{className:"hidden sm:inline",children:r("upToDate")})]}),t.jsx("div",{className:"text-slate-400 hover:text-purple-600 transition-colors p-1",children:i?t.jsx(P,{size:18}):t.jsx(_,{size:18})})]})]}),i&&t.jsxs("div",{className:"mt-3 pt-3 sm:mt-4 sm:pt-4 border-t border-purple-100/50 animate-fade-in",children:[o&&!l&&t.jsxs("div",{className:"space-y-3 animate-pulse",children:[t.jsx("div",{className:"h-4 bg-purple-100 rounded w-3/4"}),t.jsx("div",{className:"h-4 bg-purple-100 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-purple-100 rounded w-5/6"})]}),d&&t.jsxs("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded-lg border border-red-100 flex justify-between items-center",children:[t.jsx("span",{children:d}),t.jsxs(ye,{to:"/settings",className:"flex items-center gap-1 text-blue-600 hover:underline font-medium",children:[t.jsx(J,{size:14})," ",r("setKey")]})]}),l&&t.jsx("div",{className:"prose prose-sm prose-purple max-w-none text-slate-600",children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed text-xs sm:text-sm",children:l})})]})]})};const gs=e=>`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`,bs=({assets:s,transactions:a,baseCurrency:r,exchangeRates:i,isPrivacyMode:n,t:l})=>{const{settings:o}=vt(),[c,d]=e.useState("1M"),[u,m]=e.useState({}),[p,x]=e.useState(!1);e.useEffect(()=>{let e=!0;return(async()=>{if(0===s.length)return;x(!0);const t={},r={provider:o.marketDataProvider||"finnhub",alphaVantageKey:o.alphaVantageApiKey,finnhubKey:o.finnhubApiKey},i=s.map(async e=>{if(e.type===Fe.REAL_ESTATE||e.type===Fe.LIABILITY||e.type===Fe.OTHER||e.type===Fe.CASH)return{id:e.id,data:[]};if(!u[e.id]||0===u[e.id].length)try{const t=function(e,t,s){const a=s.filter(t=>t.assetId===e);if(a.length>0){const e=a.reduce((e,t)=>t.date<e.date?t:e),t=new Date(e.date);return t.setDate(t.getDate()-7),t}if(t){const e=new Date(t);return e.setDate(e.getDate()-7),e}const r=new Date;return r.setFullYear(r.getFullYear()-5),r}(e.id,e.dateAcquired,a);return{id:e.id,data:await ct(e,r,t)}}catch(t){return{id:e.id,data:[]}}return{id:e.id,data:u[e.id]}}),n=await Promise.all(i);e&&(n.forEach(e=>t[e.id]=e.data),m(t),x(!1))})(),()=>{e=!1}},[s.length,o.marketDataProvider,o.alphaVantageApiKey,o.finnhubApiKey]);const h=e=>n?"••••••":new Intl.NumberFormat("en-US",{style:"currency",currency:r,notation:"compact",maximumFractionDigits:1}).format(e),g=e.useMemo(()=>{const e={};return Object.keys(u).forEach(t=>{const s=u[t],a=new Map;[...s].sort((e,t)=>e.date.localeCompare(t.date)).forEach(e=>{a.set(e.date,e.price)}),e[t]=a}),e},[u]),b=e.useMemo(()=>{if(0===s.length)return[];const e=a||[],t=new Set(e.map(e=>e.assetId)),n=[];s.forEach(e=>{if(!t.has(e.id)){const t=e.dateAcquired||gs(new Date);n.push({id:`synthetic-${e.id}`,assetId:e.id,type:e.type===Fe.LIABILITY?He.BORROW:He.BUY,date:t,quantityChange:e.quantity,pricePerUnit:e.avgCost,fee:0,total:e.quantity*e.avgCost})}});const l=[...e,...n].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),o=new Date,d=new Date,m=l.length>0?Math.min(...l.map(e=>new Date(e.date).getTime())):o.getTime(),p=new Date(m);switch(c){case"1W":d.setDate(o.getDate()-7);break;case"1M":d.setDate(o.getDate()-30);break;case"3M":d.setDate(o.getDate()-90);break;case"6M":d.setDate(o.getDate()-180);break;case"1Y":d.setFullYear(o.getFullYear()-1);break;case"ALL":d.setTime(m),d.setDate(d.getDate()-2)}const x=new Date(Math.min(d.getTime(),p.getTime()));x.setHours(0,0,0,0);const h=((e,t)=>{const s=[],a=new Date(e);let r=0;for(;a<=t&&r<5e3;)s.push(gs(a)),a.setDate(a.getDate()+1),r++;return s})(x,o),b={},y={};s.forEach(e=>{b[e.id]=0,y[e.id]=0});const f={};s.forEach(e=>{const t=u[e.id];t&&t.length>0?f[e.id]=t[0].price:f[e.id]=e.currentPrice});const v=[],j=gs(d);for(const a of h){s.forEach(e=>{const t=g[e.id];t&&t.has(a)&&(f[e.id]=t.get(a))});const e=l.filter(e=>e.date.startsWith(a));for(const s of e){void 0===b[s.assetId]&&(b[s.assetId]=0),void 0===y[s.assetId]&&(y[s.assetId]=0);const e=s.quantityChange||0,t=Math.abs(e),a=s.total||0;if(s.type===He.BUY||s.type===He.DEPOSIT||s.type===He.BORROW||s.type===He.BALANCE_ADJUSTMENT)if(e>=0)b[s.assetId]+=e,y[s.assetId]+=a;else{const e=b[s.assetId];if(e>0){const a=t/e;y[s.assetId]-=y[s.assetId]*a}b[s.assetId]-=t}else if(s.type===He.SELL||s.type===He.WITHDRAWAL||s.type===He.REPAY){const e=b[s.assetId];if(e>0){const a=t/e;y[s.assetId]-=y[s.assetId]*a}b[s.assetId]-=t,b[s.assetId]<0&&(b[s.assetId]=0)}}let t=0,n=0;s.forEach(e=>{const s=b[e.id]||0,a=f[e.id];if(s>0){const l=dt(s*a,e.currency,r,i),o=dt(y[e.id],e.currency,r,i);e.type===Fe.LIABILITY?t-=l:(t+=l,n+=o)}}),a>=j&&v.push({date:a,displayDate:new Date(a).toLocaleDateString(void 0,{month:"short",day:"numeric"}),value:t,cost:n,pnl:t-n,pnlPercent:0!==n?(t-n)/n*100:0})}return v},[s,a,c,r,i,u,g]),y=b.length>0&&b[b.length-1].pnl>=0?"#10b981":"#ef4444",f=({active:e,payload:s})=>{if(e&&s&&s.length){const e=s[0].payload;return t.jsxs("div",{className:"bg-white/95 backdrop-blur-sm p-3 sm:p-4 rounded-xl shadow-xl border border-slate-100 text-xs sm:text-sm animate-in fade-in zoom-in-95 duration-150 max-w-[180px] sm:max-w-none",children:[t.jsx("p",{className:"text-slate-500 font-medium mb-1.5 sm:mb-2 border-b border-slate-50 pb-1",children:e.displayDate}),t.jsxs("div",{className:"flex items-center justify-between gap-3 sm:gap-6 mb-1",children:[t.jsxs("span",{className:"text-slate-500 flex items-center gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full",style:{background:y}}),l("value")]}),t.jsx("span",{className:"font-bold text-slate-700",children:h(e.value)})]}),t.jsxs("div",{className:"flex items-center justify-between gap-3 sm:gap-6 mb-1.5",children:[t.jsxs("span",{className:"text-slate-400 flex items-center gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-slate-300"}),l("label_cost")]}),t.jsx("span",{className:"font-medium text-slate-400",children:h(e.cost)})]}),t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 pt-1.5 border-t border-slate-50 font-medium "+(e.pnl>=0?"text-green-600":"text-red-600"),children:[t.jsx("span",{children:e.pnl>=0?l("label_net_pnl"):"Loss"}),t.jsxs("div",{className:"flex items-center gap-1",children:[e.pnl>=0?t.jsx(ce,{size:12}):t.jsx(ve,{size:12}),t.jsxs("span",{children:[h(Math.abs(e.pnl))," ",t.jsxs("span",{className:"text-[10px] opacity-80",children:["(",Math.abs(e.pnlPercent).toFixed(1),"%)"]})]})]})]})]})}return null},v=s.some(e=>e.type===Fe.STOCK||e.type===Fe.FUND),j=o.marketDataProvider||"finnhub",N=v&&("alphavantage"===j&&!o.alphaVantageApiKey||"finnhub"===j&&!o.finnhubApiKey);return t.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden h-full flex flex-col",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-slate-50 flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-slate-800 text-lg flex items-center gap-2",children:l("netWorthTrend")}),t.jsxs("p",{className:"text-xs text-slate-400 flex items-center gap-1 mt-0.5",children:[t.jsx(fe,{size:12})," ",l("costVsValue"),p&&t.jsxs("span",{className:"flex items-center gap-1 text-blue-500 ml-2",children:[t.jsx(R,{size:10,className:"animate-spin"})," Syncing..."]})]})]}),t.jsx("div",{className:"flex bg-slate-50 p-1 rounded-lg self-start sm:self-auto overflow-x-auto max-w-full",children:["1W","1M","3M","6M","1Y","ALL"].map(e=>t.jsx("button",{onClick:()=>d(e),className:"px-3 py-1 text-xs font-medium rounded-md transition-all whitespace-nowrap "+(c===e?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700 hover:bg-slate-200/50"),children:e},e))})]}),N&&!p&&v&&t.jsxs("div",{className:"bg-amber-50 px-4 py-2 text-[10px] text-amber-700 flex items-center justify-center gap-2 border-b border-amber-100",children:[t.jsx(k,{size:12}),t.jsx("span",{children:l("marketDataKeyMissing")})]}),t.jsx("div",{className:"p-4 flex-1 min-h-[320px]",children:n?t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-300 bg-slate-50/30 rounded-xl border border-dashed border-slate-200",children:[t.jsx("div",{className:"p-4 bg-white rounded-full shadow-sm mb-3",children:t.jsx(fe,{size:24,className:"text-slate-300"})}),t.jsx("p",{children:l("chartHidden")})]}):b.length>1?t.jsx(Ce,{width:"100%",height:"100%",children:t.jsxs(qe,{data:b,margin:{top:10,right:10,left:0,bottom:0},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"colorNetWorth",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:y,stopOpacity:.15}),t.jsx("stop",{offset:"95%",stopColor:y,stopOpacity:0})]})}),t.jsx(ke,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),t.jsx(Ee,{dataKey:"displayDate",tickLine:!1,axisLine:!1,tick:{fill:"#94a3b8",fontSize:11},minTickGap:30}),t.jsx(Pe,{hide:!0,domain:["auto","auto"]}),t.jsx(_e,{content:t.jsx(f,{}),cursor:{stroke:"#cbd5e1",strokeWidth:1,strokeDasharray:"4 4"}}),t.jsx($e,{type:"stepAfter",dataKey:"cost",stroke:"#94a3b8",strokeWidth:2,strokeDasharray:"4 4",dot:!1,activeDot:!1,name:"Invested"}),t.jsx(Be,{type:"monotone",dataKey:"value",stroke:y,strokeWidth:2,fillOpacity:1,fill:"url(#colorNetWorth)",activeDot:{r:4,strokeWidth:0,fill:y},name:"Net Worth"})]})}):t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400",children:[p?t.jsx(R,{size:32,className:"mb-2 animate-spin text-blue-400"}):t.jsx(L,{size:32,className:"mb-2 opacity-50"}),t.jsx("span",{className:"text-sm",children:p?"Syncing market data...":l("noTransactions")})]})})]})},ys=["#0ea5e9","#6366f1","#8b5cf6","#ec4899","#10b981","#f59e0b","#f97316"],fs=()=>{var s;const{assets:a,transactions:r,settings:i,exchangeRates:n,t:l}=vt(),o=e.useMemo(()=>{let e=0,t=0,s=0,r=0;a.forEach(a=>{const l=a.quantity*a.currentPrice,o=a.quantity*a.avgCost,c=dt(l,a.currency,i.baseCurrency,n),d=dt(o,a.currency,i.baseCurrency,n);var u;a.type===Fe.LIABILITY?(t+=c,s-=d):(e+=c,s+=d,(u=a.type)!==Fe.REAL_ESTATE&&u!==Fe.LIABILITY&&u!==Fe.OTHER&&(r+=c*(.03*Math.random()-.01)))});const l=e-t,o=l-s,c=0!==s?o/Math.abs(s)*100:0;return{totalNetWorth:l,totalAssetsValue:e,totalLiabilitiesValue:t,totalCost:s,totalPnL:o,totalPnLPercent:c,dayPnL:r}},[a,i.baseCurrency,n]),c=e.useMemo(()=>a.filter(e=>e.type!==Fe.LIABILITY).map(e=>{const t=e.quantity*e.currentPrice,s=dt(t,e.currency,i.baseCurrency,n);return{name:e.symbol,value:s}}).filter(e=>e.value>0).sort((e,t)=>t.value-e.value),[a,i.baseCurrency,n]),d=e=>i.isPrivacyMode?"••••••":new Intl.NumberFormat("en-US",{style:"currency",currency:i.baseCurrency,maximumFractionDigits:0}).format(e),u=e=>i.isPrivacyMode?"•••%":`${e.toFixed(2)}%`,m=i.baseCurrency===Ye.CNY?je:z;return t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-700 rounded-2xl p-6 text-white shadow-lg relative overflow-hidden group",children:[i.isPrivacyMode&&t.jsx($,{className:"absolute top-6 right-6 text-blue-400 opacity-50",size:24}),t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("span",{className:"text-blue-100 font-medium",children:l("netWorth")}),t.jsx(ye,{to:"/settings",className:"p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors cursor-pointer flex items-center justify-center",title:l("changeCurrency"),children:t.jsx(m,{size:20})})]}),t.jsx(ye,{to:"/assets",className:"block cursor-pointer hover:opacity-90 transition-opacity",children:t.jsx("div",{className:"text-3xl font-bold mb-1",children:d(o.totalNetWorth)})}),t.jsxs("div",{className:"text-sm text-blue-100 flex items-center gap-2",children:[t.jsxs("span",{className:o.totalPnL>=0?"text-green-300":"text-red-300",children:[i.isPrivacyMode?"":o.totalPnL>=0?"+":"",u(o.totalPnLPercent)]}),l("allTime")]})]}),t.jsxs(Vt,{className:"flex flex-col justify-center",children:[t.jsxs("span",{className:"text-slate-500 font-medium mb-2 flex items-center gap-2",children:[t.jsx(w,{size:16,className:"text-blue-500"})," ",l("totalAssets")]}),t.jsx(ye,{to:"/assets",className:"block cursor-pointer hover:opacity-75 transition-opacity",children:t.jsx("div",{className:"text-2xl font-bold text-slate-800 mb-1",children:d(o.totalAssetsValue)})}),t.jsx("div",{className:"text-xs text-slate-400",children:l("grossValue")})]}),t.jsxs(Vt,{className:"flex flex-col justify-center "+(o.totalLiabilitiesValue>0?"border-red-100 bg-red-50/30":""),children:[t.jsxs("span",{className:"text-slate-500 font-medium mb-2 flex items-center gap-2",children:[t.jsx(M,{size:16,className:"text-red-500"})," ",l("totalLiabilities")]}),t.jsx("div",{className:"text-2xl font-bold mb-1 "+(o.totalLiabilitiesValue>0?"text-red-600":"text-slate-800"),children:i.isPrivacyMode?"••••••":(o.totalLiabilitiesValue>0?"-":"")+new Intl.NumberFormat("en-US",{style:"currency",currency:i.baseCurrency,maximumFractionDigits:0}).format(o.totalLiabilitiesValue)}),t.jsx("div",{className:"text-xs text-slate-400",children:l("outstandingDebt")})]}),t.jsxs(Vt,{className:"flex flex-col justify-center",children:[t.jsxs("span",{className:"text-slate-500 font-medium mb-2 flex items-center gap-2",children:[l("dayPnL")," ",t.jsx(Q,{size:16})]}),t.jsx("div",{className:"text-2xl font-bold text-slate-800 mb-1",children:d(o.dayPnL)}),t.jsxs("div",{className:"text-sm font-medium flex items-center gap-1 "+(o.dayPnL>=0?"text-green-600":"text-red-500"),children:[i.isPrivacyMode?null:o.dayPnL>=0?t.jsx(ce,{size:14}):t.jsx(ve,{size:14}),u(0!==o.dayPnL?100*Math.abs(o.dayPnL/(o.totalNetWorth||1)):0)]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2 min-w-0 h-[400px]",children:t.jsx(bs,{assets:a,transactions:r,baseCurrency:i.baseCurrency,exchangeRates:n,isPrivacyMode:i.isPrivacyMode,t:l})}),t.jsxs(Vt,{title:`${l("assetAllocation")} (${i.baseCurrency})`,className:"min-w-0",children:[t.jsx("div",{className:"h-[300px] w-full relative min-w-0",children:i.isPrivacyMode?t.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-slate-300",children:[t.jsx($,{size:48,className:"mb-2"}),t.jsx("p",{children:l("hidden")})]}):t.jsxs(t.Fragment,{children:[t.jsx(Ce,{width:"100%",height:"100%",children:t.jsxs(Me,{children:[t.jsx(ze,{data:c,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:c.map((e,s)=>t.jsx(Re,{fill:ys[s%ys.length],stroke:"none"},`cell-${s}`))}),t.jsx(_e,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>d(e)})]})}),t.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center pointer-events-none",children:[t.jsx("div",{className:"text-xs text-slate-400",children:l("topAsset")}),t.jsx("div",{className:"font-bold text-slate-700",children:(null==(s=c[0])?void 0:s.name)||"-"})]})]})}),!i.isPrivacyMode&&t.jsx("div",{className:"flex flex-wrap gap-2 justify-center pb-2 mt-2",children:c.slice(0,4).map((e,s)=>t.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:ys[s%ys.length]}}),e.name," ",(e.value/(c.reduce((e,t)=>e+t.value,0)||1)*100).toFixed(0),"%"]},e.name))})]})]})]})},vs=()=>{const{t:e}=vt();return t.jsxs("div",{className:"space-y-6 md:space-y-8",children:[t.jsx("div",{className:"flex flex-col xl:flex-row xl:items-center justify-between gap-4",children:t.jsx("div",{children:t.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-800",children:e("overview")})})}),t.jsx(hs,{}),t.jsx(fs,{})]})},js=()=>{const[s,a]=e.useState([]);e.useEffect(()=>ht.subscribe(e=>{a(t=>[...t,e]),e.duration&&setTimeout(()=>{r(e.id)},e.duration)}),[]);const r=e=>{a(t=>t.filter(t=>t.id!==e))},i=e=>{switch(e){case"error":return t.jsx(h,{size:20});case"warning":return t.jsx(k,{size:20});case"success":return t.jsx(Y,{size:20});case"info":return t.jsx(Ne,{size:20})}},n=e=>{switch(e){case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"success":return"bg-green-50 border-green-200 text-green-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800"}};return 0===s.length?null:t.jsxs("div",{className:"toast-container",children:[s.map(e=>t.jsxs("div",{className:`toast-item ${n(e.type)}`,children:[t.jsx("div",{className:"toast-icon",children:i(e.type)}),t.jsx("div",{className:"toast-message",children:e.message}),t.jsx("button",{onClick:()=>r(e.id),className:"toast-close","aria-label":"Close notification",children:t.jsx(o,{size:18})})]},e.id)),t.jsx("style",{children:"\n        .toast-container {\n          position: fixed;\n          top: 20px;\n          right: 20px;\n          z-index: 9999;\n          display: flex;\n          flex-direction: column;\n          gap: 12px;\n          max-width: 420px;\n          pointer-events: none;\n        }\n\n        .toast-item {\n          pointer-events: auto;\n          display: flex;\n          align-items: flex-start;\n          gap: 12px;\n          padding: 14px 16px;\n          border-radius: 8px;\n          border: 1px solid;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n          animation: slideIn 0.3s ease-out;\n          min-width: 300px;\n        }\n\n        @keyframes slideIn {\n          from {\n            transform: translateX(100%);\n            opacity: 0;\n          }\n          to {\n            transform: translateX(0);\n            opacity: 1;\n          }\n        }\n\n        .toast-icon {\n          flex-shrink: 0;\n          display: flex;\n          align-items: center;\n          margin-top: 1px;\n        }\n\n        .toast-message {\n          flex: 1;\n          font-size: 14px;\n          line-height: 1.5;\n          word-break: break-word;\n        }\n\n        .toast-close {\n          flex-shrink: 0;\n          background: transparent;\n          border: none;\n          cursor: pointer;\n          padding: 2px;\n          border-radius: 4px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          opacity: 0.6;\n          transition: opacity 0.2s;\n        }\n\n        .toast-close:hover {\n          opacity: 1;\n        }\n\n        @media (max-width: 640px) {\n          .toast-container {\n            top: 10px;\n            right: 10px;\n            left: 10px;\n            max-width: none;\n          }\n\n          .toast-item {\n            min-width: 0;\n          }\n        }\n      "})]})},Ns=()=>t.jsxs(t.Fragment,{children:[t.jsx(ft,{children:t.jsx(we,{children:t.jsx(Ht,{children:t.jsxs(Se,{children:[t.jsx(Ae,{path:"/",element:t.jsx(vs,{})}),t.jsx(Ae,{path:"/assets",element:t.jsx(ps,{})}),t.jsx(Ae,{path:"/history",element:t.jsx(Gt,{})}),t.jsx(Ae,{path:"/analytics",element:t.jsx(ns,{})}),t.jsx(Ae,{path:"/settings",element:t.jsx(ls,{})})]})})})}),t.jsx(js,{})]}),ws=document.getElementById("root");if(!ws)throw new Error("Could not find root element to mount to");De.createRoot(ws).render(t.jsx(g.StrictMode,{children:t.jsx(Ns,{})}));
