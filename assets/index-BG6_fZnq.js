import{d as e,j as t,ac as s,ad as a,ae as r,af as n,ag as i,ah as l,ai as o,aj as c,ak as d,al as u,am as m,an as x,ao as p,ap as h,aq as g,ar as b,as as f,at as y,au as v,av as j,aw as N,ax as w,ay as S,az as A,aA as T,aB as D,aC as C,aD as I,aE as E,aF as k,aG as P,aH as L,aI as _,aJ as R,aK as U,aL as M,aM as z,aN as O,aO as K,aP as q,aQ as F,aR as $,aS as B,aT as Y,aU as H,aV as V,aW as W,aX as G,aY as J,aZ as Q,a_ as X,a$ as Z,b0 as ee,b1 as te,b2 as se,b3 as ae,b4 as re,b5 as ne,b6 as ie,b7 as le,b8 as oe,b9 as ce,ba as de,bb as ue,bc as me,bd as xe,be as pe,bf as he,bg as ge,bh as be,bi as fe,bj as ye,bk as ve,bl as je,bm as Ne,bn as we,bo as Se,bp as Ae,bq as Te,br as De}from"./vendor-BT3unzQg.js";import{M as Ce}from"./markdown-DtsFYEcY.js";import{R as Ie,B as Ee,C as ke,X as Pe,Y as Le,T as _e,a as Re,b as Ue,L as Me,P as ze,c as Oe,d as Ke,e as qe,A as Fe,f as $e,g as Be}from"./recharts-D2Q3mQXS.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Ye=(e=>(e.STOCK="STOCK",e.CRYPTO="CRYPTO",e.FUND="FUND",e.CASH="CASH",e.REAL_ESTATE="REAL_ESTATE",e.LIABILITY="LIABILITY",e.OTHER="OTHER",e))(Ye||{}),He=(e=>(e.USD="USD",e.CNY="CNY",e.HKD="HKD",e))(He||{}),Ve=(e=>(e.BUY="BUY",e.SELL="SELL",e.DIVIDEND="DIVIDEND",e.DEPOSIT="DEPOSIT",e.WITHDRAWAL="WITHDRAWAL",e.BORROW="BORROW",e.REPAY="REPAY",e.BALANCE_ADJUSTMENT="BALANCE_ADJUSTMENT",e))(Ve||{}),We=(e=>(e.API_KEY_MISSING="API_KEY_MISSING",e.API_KEY_INVALID="API_KEY_INVALID",e.RATE_LIMIT="RATE_LIMIT",e.ACCESS_DENIED="ACCESS_DENIED",e.NETWORK_ERROR="NETWORK_ERROR",e.UNKNOWN="UNKNOWN",e))(We||{});const Ge="investflow_metadata",Je="investflow_transactions_v2",Qe="investflow_settings",Xe="investflow_assets",Ze="investflow_transactions";He.USD;const et={getAssetMetas(){try{const e=localStorage.getItem(Ge);return e?JSON.parse(e):[]}catch(e){return[]}},saveAssetMetas(e){try{localStorage.setItem(Ge,JSON.stringify(e))}catch(t){}},getTransactions(){try{const e=localStorage.getItem(Je);return e?JSON.parse(e):[]}catch(e){return[]}},saveTransactions(e){try{localStorage.setItem(Je,JSON.stringify(e))}catch(t){}},getSettings(){try{const e=localStorage.getItem(Qe);return e?JSON.parse(e):null}catch(e){return null}},saveSettings(e){try{localStorage.setItem(Qe,JSON.stringify(e))}catch(t){}},getCache(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return null}},saveCache(e,t){try{const s={timestamp:Date.now(),data:t};localStorage.setItem(e,JSON.stringify(s))}catch(s){}},remove(e){localStorage.removeItem(e)},clearAllData(){localStorage.removeItem(Ge),localStorage.removeItem(Je)},getLegacyData:()=>({assets:localStorage.getItem(Xe),transactions:localStorage.getItem(Ze),v2Metadata:localStorage.getItem(Ge)}),clearLegacyData(){localStorage.removeItem(Xe),localStorage.removeItem(Ze)},clearItemsByPrefix(e){const t=[];for(let s=0;s<localStorage.length;s++){const a=localStorage.key(s);a&&a.startsWith(e)&&t.push(a)}t.forEach(e=>localStorage.removeItem(e))}},tt="investflow_rates",st="investflow_crypto_prices",at="investflow_stock_prices",rt="investflow_asset_history",nt="investflow_api_failures",it={BTC:"bitcoin",ETH:"ethereum",USDT:"tether",SOL:"solana",BNB:"binancecoin",XRP:"ripple",ADA:"cardano",DOGE:"dogecoin",DOT:"polkadot",MATIC:"matic-network",LINK:"chainlink"},lt=["ARBITRAGE_NEW_USER","CSI300ETF_C","ZHOUZHOUBAO_FUND"],ot=e=>{const t=e.toUpperCase();return t.endsWith(".SS")||t.endsWith(".SZ")?He.CNY:t.endsWith(".HK")?He.HKD:He.USD};class ct{constructor(e,t=1/0,s=0){this.queue=[],this.processing=!1,this.lastRequestTime=0,this.timestamps=[],this.minInterval=e,this.maxRequestsInWindow=t,this.windowSize=s}async add(e){return new Promise((t,s)=>{this.queue.push(async()=>{try{const s=await e();t(s)}catch(a){s(a)}}),this.process()})}async process(){if(!this.processing){for(this.processing=!0;this.queue.length>0;){const e=Date.now();let t=0;const s=e-this.lastRequestTime;if(s<this.minInterval&&(t=Math.max(t,this.minInterval-s)),this.maxRequestsInWindow<1/0&&this.timestamps.length>=this.maxRequestsInWindow&&(this.timestamps=this.timestamps.filter(t=>e-t<this.windowSize),this.timestamps.length>=this.maxRequestsInWindow)){const s=this.timestamps[0],a=this.windowSize-(e-s);t=Math.max(t,a+100)}if(t>0){await new Promise(e=>setTimeout(e,t));continue}const a=this.queue.shift();a&&(this.lastRequestTime=Date.now(),this.timestamps.push(this.lastRequestTime),await a())}this.processing=!1}}}const dt=new ct(2e3,5,65e3),ut=new ct(1500),mt=new ct(300),xt=(e,t)=>{const s=et.getCache(nt),a=(null==s?void 0:s.data)||{};a[e]={timestamp:Date.now(),reason:t},et.saveCache(nt,a)},pt=async e=>{const t=e.filter(e=>e.type===Ye.CRYPTO&&!e.isManualPrice&&!lt.includes(e.symbol));if(0===t.length)return{};const s=et.getCache(st),a=!s||Date.now()-s.timestamp>6e5;if(s&&!a){if(t.every(e=>void 0!==s.data[e.id]))return s.data}const r=t.map(e=>it[e.symbol.toUpperCase()]||e.name.toLowerCase().replace(/\s+/g,"-")).join(",");if(!r)return(null==s?void 0:s.data)||{};try{const e=await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${r}&vs_currencies=usd`);if(!e.ok)throw new Error("CoinGecko API Error");const a=await e.json(),n={...(null==s?void 0:s.data)||{}};return t.forEach(e=>{const t=it[e.symbol.toUpperCase()]||e.name.toLowerCase().replace(/\s+/g,"-");a[t]&&a[t].usd&&(n[e.id]=a[t].usd)}),et.saveCache(st,n),n}catch(n){return(null==s?void 0:s.data)||{}}},ht=e=>new Promise(t=>setTimeout(t,e)),gt=async(e,t)=>{const s=e.filter(e=>!(e.type!==Ye.STOCK&&e.type!==Ye.FUND||e.isManualPrice||lt.includes(e.symbol)));if(0===s.length)return{};const a=et.getCache(at),r={...(null==a?void 0:a.data)||{}},n=Date.now(),i=[],l=[],o=[];for(const u of s){const e=r[u.id],s="alphavantage"===t.provider?27e5:6e5;!e||!e.lastUpdated||n-e.lastUpdated>s?(i.push(u),o.push(`${u.symbol}(${(null==e?void 0:e.lastUpdated)?`stale:${Math.round((n-e.lastUpdated)/1e3/60)}min`:"no-cache"})`)):l.push(`${u.symbol}(age:${Math.round((n-e.lastUpdated)/1e3/60)}min)`)}if(0===i.length)return r;let c=!1;if("finnhub"===t.provider){if(!t.finnhubKey)throw{category:We.API_KEY_MISSING,provider:"finnhub",message:"Finnhub API Key is missing"};const e=i.slice(0,10);for(const s of e)try{let e=s.symbol;s.currency!==He.HKD||e.includes(".")?s.currency!==He.CNY||e.includes(".")||(e=e.startsWith("6")?`${e}.SS`:`${e}.SZ`):e=`${e}.HK`;const a=await fetch(`https://finnhub.io/api/v1/quote?symbol=${e}&token=${t.finnhubKey}`);if(!a.ok){if(429===a.status)throw{category:We.RATE_LIMIT,provider:"finnhub",message:"Finnhub rate limit exceeded"};if(403===a.status||401===a.status)throw{category:We.ACCESS_DENIED,provider:"finnhub",message:"Access denied or invalid API key"};continue}const n=await a.json();if(n.error)throw{category:We.ACCESS_DENIED,provider:"finnhub",message:n.error};n.c&&n.c>0&&(r[s.id]={price:n.c,currency:ot(e),lastUpdated:Date.now()},c=!0),await ht(100)}catch(d){}}else{if(!t.alphaVantageKey)throw{category:We.API_KEY_MISSING,provider:"alphavantage",message:"Alpha Vantage API Key is missing"};const e=i.slice(0,5);for(const s of e)try{let a=s.symbol;s.currency!==He.HKD||a.includes(".")?s.currency!==He.CNY||a.includes(".")||(a=a.startsWith("6")?`${a}.SS`:`${a}.SZ`):a=`${a}.HK`;const n=await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${a}&apikey=${t.alphaVantageKey}`),i=await n.json();if(i.Note||i.Information)throw{category:We.RATE_LIMIT,provider:"alphavantage",message:"Alpha Vantage rate limit exceeded"};i["Global Quote"]&&i["Global Quote"]["05. price"]&&(r[s.id]={price:parseFloat(i["Global Quote"]["05. price"]),currency:ot(i["Global Quote"]["01. symbol"]||a),lastUpdated:Date.now()},c=!0),e.length>1&&await ht(15e3)}catch(d){}}return c&&et.saveCache(at,r),r},bt=async(e,t,s)=>{const a=s||(()=>{const e=new Date;return e.setFullYear(e.getFullYear()-5),e})(),r=(Date.now()-a.getTime())/864e5;if(e.isManualPrice||lt.includes(e.symbol)){const t=(new Date).toISOString().split("T")[0],s=new Date;return s.setFullYear(s.getFullYear()-1),[{date:s.toISOString().split("T")[0],price:e.currentPrice},{date:t,price:e.currentPrice}]}const n=`${rt}_${e.id}`,i=et.getCache(n),l=!i||Date.now()-i.timestamp>864e5,o=i&&i.data.length>=98&&i.data.length<=102&&r>130;if(i&&i.data.length>0&&!l&&!o)return i.data;if((e=>{const t=et.getCache(nt);if(!t||!t.data)return null;const s=t.data[e];return s&&Date.now()-s.timestamp<18e5?s:null})(e.id))return(null==i?void 0:i.data)||[];try{let s=[];if(e.type===Ye.CRYPTO){const t=r>365?"max":"365",a=it[e.symbol.toUpperCase()]||e.name.toLowerCase().replace(/\s+/g,"-");await ut.add(async()=>{const r=await fetch(`https://api.coingecko.com/api/v3/coins/${a}/market_chart?vs_currency=usd&days=${t}&interval=daily`);if(r.ok){const e=await r.json();e.prices&&(s=e.prices.map(e=>({date:new Date(e[0]).toISOString().split("T")[0],price:e[1]})))}else if(404===r.status&&xt(e.id,"Not Found"),429===r.status)throw{category:We.RATE_LIMIT,provider:"coingecko"}})}else if(e.type===Ye.STOCK||e.type===Ye.FUND){let r=e.symbol;if(e.currency!==He.HKD||r.includes(".")?e.currency!==He.CNY||r.includes(".")||(r=r.startsWith("6")?`${r}.SS`:`${r}.SZ`):r=`${r}.HK`,"finnhub"===t.provider&&t.finnhubKey){const n=Math.floor(a.getTime()/1e3),i=Math.floor(Date.now()/1e3);await mt.add(async()=>{const a=await fetch(`https://finnhub.io/api/v1/stock/candle?symbol=${r}&resolution=D&from=${n}&to=${i}&token=${t.finnhubKey}`);if(a.ok){const t=await a.json();if("ok"===t.s&&t.c&&t.t)s=t.t.map((e,s)=>({date:new Date(1e3*e).toISOString().split("T")[0],price:t.c[s]}));else if("no_data"===t.s);else if(t.error)throw xt(e.id,t.error),{category:We.ACCESS_DENIED,provider:"finnhub",message:t.error}}else{if(429===a.status)throw{category:We.RATE_LIMIT,provider:"finnhub",message:"Finnhub rate limit exceeded (History)"};if(403===a.status||401===a.status)throw xt(e.id,"Access Denied"),{category:We.ACCESS_DENIED,provider:"finnhub",message:"Access denied to historical data"}}})}else if("alphavantage"===t.provider&&t.alphaVantageKey){const a="compact";await dt.add(async()=>{const n=await fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${r}&outputsize=${a}&apikey=${t.alphaVantageKey}`),i=await n.json();if(i.Note||i.Information)throw{category:We.RATE_LIMIT,provider:"alphavantage",message:"Alpha Vantage rate limit exceeded (History)"};if(i["Error Message"])throw xt(e.id,"Invalid Symbol"),{category:We.ACCESS_DENIED,provider:"alphavantage",message:"Invalid API key or symbol not found"};if(i["Time Series (Daily)"]){const e=i["Time Series (Daily)"];s=Object.keys(e).map(t=>({date:t,price:parseFloat(e[t]["4. close"])})).sort((e,t)=>e.date.localeCompare(t.date))}})}}if(s.length>0){const e=a.toISOString().split("T")[0];let t=s.filter(t=>t.date>=e);if(0===t.length&&s.length>0)t=[s[s.length-1]];else if(t.length>0&&t[0].date>e){const e=s.findIndex(e=>e.date===t[0].date);e>0&&t.unshift(s[e-1])}s=t}if(s.length>0)return et.saveCache(n,s),s;{if(null==i?void 0:i.data)return i.data;const t=(new Date).toISOString().split("T")[0],s=new Date;return s.setFullYear(s.getFullYear()-1),[{date:s.toISOString().split("T")[0],price:e.currentPrice},{date:t,price:e.currentPrice}]}}catch(c){if((null==c?void 0:c.category)===We.ACCESS_DENIED||(null==c?void 0:c.category)===We.RATE_LIMIT)throw c;return(null==i?void 0:i.data)||[]}},ft=(e,t,s,a)=>{if(t===s)return e;const r=a[t]||1,n=a[s]||1;return 0===r?e:e/r*n},yt={en:{dashboard:"Dashboard",assets:"Assets",history:"History",analytics:"Analytics",settings:"Settings",disclaimer:"Data provided for demo purposes. Not financial advice.",overview:"Overview",netWorth:"Total Net Worth",totalAssets:"Total Assets",totalLiabilities:"Total Liabilities",dayPnL:"Today's P&L",allTime:"All time",grossValue:"Gross value before debt",outstandingDebt:"Outstanding Loans & Debt",netWorthTrend:"Net Worth Trend",assetAllocation:"Asset Allocation",topAsset:"Top Asset",hidden:"Hidden",chartHidden:"Chart Hidden in Privacy Mode",changeCurrency:"Change Base Currency",refreshPrices:"Refresh Prices",refreshing:"Refreshing...",assetsManagement:"Assets Management",assetsSubtitle:"Manage holdings and record trades.",showTrend:"Show Net Value Trend",trendModalSubtitle:"Trend analysis based on current filtered assets",searchAssets:"Search assets...",addNewAsset:"Add New Asset",portfolioHoldings:"Portfolio Holdings",noAssets:'No assets found. Click "Add New Asset" to start.',actions:"Actions",asset:"Asset",currentPrice:"Price",avgCost:"Cost",holdings:"Holdings",recentReturn:"Recent Annualized Return",value:"Value",statusPnL:"Status / P&L",confirmDelete:"Are you sure you want to delete {symbol}? This action cannot be undone.",updatePrice:"Quick Update Price",delete:"Delete",editDetails:"Edit Details",live:"Live",manual:"Manual",liveData:"Data fetched automatically from API",manualValuation:"Valuation set manually",manualPrice:"Manual Price",lastUpdated:"Last Updated",dataStale:"Update failed or data delayed > 30m",offline:"Offline",selectAssetType:"Select Asset Type",whatKind:"What kind of asset do you want to track?",assetDetails:"Asset Details",enterDetails:"Enter details for",editHolding:"Edit Holding",updateParams:"Update your holding parameters",identification:"1. Identification",changeType:"Change Type",tickerLabel:"Ticker / Currency Code",nameLabel:"Full Name (Optional)",currencyLabel:"Currency",valuationHoldings:"2. Valuation & Holdings",quantity:"Quantity",balance:"Balance",principalRemaining:"Principal Remaining",unitPrice:"Current Unit Price",costBasis:"Avg Cost (USD Basis)",avgCostUnit:"Average Cost / Unit",dateAcquired:"Start Time",dateRefreshed:"Refresh Time",autoFetch:"* Live prices will be fetched automatically based on ticker symbol.",autoFetchCash:"* Live exchange rates (USD) will be fetched automatically.",saveChanges:"Save Changes",addToPortfolio:"Add Asset to Portfolio",adjustButton:"Adjust",newCorrectQuantity:"New Correct Quantity",enterActualQuantity:"Enter actual quantity",adjustmentHint:"This will create a 'Balance Adjustment' transaction to fix your holdings.",confirmAdjustment:"Confirm Adjustment",type_stock:"Stock",type_crypto:"Crypto",type_fund:"Fund / ETF",type_real_estate:"Real Estate",type_cash:"Cash",type_liability:"Liability",type_other:"Custom",recordTransaction:"Record Transaction",editTransaction:"Edit Transaction",transactionHistory:"Transaction History",relatedTransactions:"Related Transactions",historySubtitle:"View and filter your investment activity.",exportCSV:"Export CSV",action:"Action",date:"Time",pricePerUnit:"Price",fees:"Fees",totalEstimate:"Total Estimate",total:"Total",autoCalculated:"Auto-calculated based on Quantity, Price, and Fee.",type:"Type",allAssets:"All Assets",allTypes:"All Types",fromDate:"From",toDate:"To",noTransactions:"No transactions found matching your filters.",selectAssetPlaceholder:"Select an asset...",tx_BUY:"Buy",tx_SELL:"Sell",tx_DIVIDEND:"Dividend",tx_BALANCE_ADJUSTMENT:"Balance Adjustment",deleteTransaction:"Delete Transaction",confirmDeleteTransaction:"Are you sure you want to delete this transaction? This will attempt to reverse the effect on your asset balance and cost.",analyticsSubtitle:"Performance metrics & risk analysis",noAssetsAnalytics:"Add assets to see analytics",netWorthStructure:"Net Worth Structure",debtRatio:"Debt Ratio",highLeverage:"High Leverage",healthy:"Healthy",riskAnalysis:"Risk Analysis",aiAssessment:"AI Assessment",startRiskAnalysis:"Start Risk Analysis",recalculate:"Recalculate",costVsValue:"Cost vs. Value",topMovers:"Top Movers",liabilityBreakdown:"Liability Breakdown",risk_high:"High (Crypto)",risk_medium:"Medium (Stocks)",risk_low:"Low (Stable)",label_assets:"Assets",label_liabilities:"Liabilities",label_cost:"Cost",label_value:"Market Value",label_net_pnl:"Net P&L",managePreferences:"Manage your preferences and data.",apiConfiguration:"API Configuration",apiKeysSecurity:"All API keys are stored exclusively in your browser's LocalStorage.",aiProvider:"AI Model Provider",aiProviderDesc:"Select which AI service to use for Portfolio Insights.",geminiKey:"Gemini API Key",geminiKeyDesc:"Enables AI Insights & Chat Assistant.",deepSeekKey:"DeepSeek API Key",deepSeekKeyDesc:"Use DeepSeek V3 model for portfolio analysis.",finnhubKey:"Finnhub API Key",finnhubKeyDesc:"Required for fetching live stock prices (Free Tier: 60 calls/min).",alphaVantageKey:"Alpha Vantage API Key",alphaVantageKeyDesc:"Alternative provider (Free Tier: 25 calls/day).",marketDataProvider:"Market Data Source",marketDataProviderDesc:"Choose your preferred stock price provider.",marketDataKeyMissing:"Please add your API Key in Settings for accurate data.",getKey:"Get a key here",generalPreferences:"General Preferences",baseCurrency:"Base Currency",baseCurrencyDesc:"Default currency for portfolio display",language:"Language",languageDesc:"Display language for the application",privacyDataManagement:"Privacy & Data Management",privacyMode:"Privacy Mode",privacyModeDesc:"Conceal all monetary values and holdings",exportUnified:"Export Unified Data",exportUnifiedDesc:"Single CSV containing all transactions & asset details.",importData:"Import CSV Data",uploadCSV:"Upload CSV File",importHint:"Upload the unified 'Panasset Data' CSV. The system will auto-restore both assets and transactions.",resetData:"Reset Data",resetDesc:"Clear all assets",resetConfirm:"Are you sure? This will permanently delete all your assets and transactions. This action cannot be undone.",importSuccess:"Import successful!",importError:"Failed to parse CSV. Please ensure the file is valid.",resetSuccess:"All data has been reset.",localDataSecurity:"Data Security: All your financial data is stored locally in this browser. We do not use servers to store your personal assets.",aiAssistant:"AI Assistant",aiInsights:"AI Portfolio Insights",wealthManagement:"Wealth Management & Optimization",analyzeNow:"Analyze Now",upToDate:"Up to date",apiKeyMissing:"API Key is missing. Please set it in Settings.",setKey:"Set Key",unableToGenerate:"Unable to generate risk analysis.",aiUnavailable:"AI features unavailable. Please check your API Key.",voiceInput:"Voice Input",listening:"Listening...",processing:"Processing...",voiceError:"Voice input failed",voicePermissionDenied:"Microphone permission denied. Please allow access.",voiceNoSupport:"Browser not supported",voiceHint:'Try: "Bought 10 Apple stocks at 150"',holdToTalk:"Hold to Talk",releaseToSend:"Release to Send",switchToKeyboard:"Switch to Keyboard",switchToVoice:"Switch to Voice",feedback:"Feedback",haveFeedback:"Have feedback?",reportBug:"Report a Bug / Suggestion",githubLinkText:"Submit on GitHub",githubDesc:"Help us improve PanassetLite by submitting issues or feature requests.",userGuide:"User Guide",about:"About PanassetLite",error_api_key_missing:"API Key is missing. Please add it in Settings.",error_api_key_invalid:"API Key is invalid or expired. Please check your credentials.",error_rate_limit:"Rate limit exceeded. Please try again later.",error_rate_limit_av:"Alpha Vantage rate limit reached (25 calls/day). Try again tomorrow or switch to Finnhub.",error_rate_limit_fh:"Finnhub rate limit reached. Please wait a moment and try again.",error_access_denied:"Access denied to this resource. Consider upgrading your plan or switching providers.",error_network:"Network error. Please check your internet connection.",error_switch_provider:"Consider switching to {provider} in Settings.",error_unknown:"An unexpected error occurred while fetching market data.",finnhubFreePlanLimitation:"Finnhub Free Plan does not support historical candle data. Please upgrade or switch to Alpha Vantage."},zh:{dashboard:"仪表盘",assets:"资产管理",history:"交易历史",analytics:"投资分析",settings:"系统设置",disclaimer:"数据仅供演示，不构成投资建议。",overview:"概览",netWorth:"总资产净值",totalAssets:"总资产",totalLiabilities:"总负债",dayPnL:"今日盈亏",allTime:"历史累计",grossValue:"资产总值 (折合)",outstandingDebt:"未偿还贷款与债务",netWorthTrend:"净值趋势",assetAllocation:"资产分布",topAsset:"最大持仓",hidden:"已隐藏",chartHidden:"隐私模式下图表已隐藏",changeCurrency:"切换基准货币",refreshPrices:"刷新价格",refreshing:"刷新中...",assetsManagement:"资产管理",assetsSubtitle:"管理您的持仓并记录交易。",showTrend:"展示净值趋势图",trendModalSubtitle:"基于当前筛选结果的净值趋势分析",searchAssets:"搜索资产...",addNewAsset:"添加新资产",portfolioHoldings:"持仓列表",noAssets:"暂无资产。点击“添加新资产”开始。",actions:"操作",asset:"资产",currentPrice:"现价",avgCost:"成本",holdings:"持仓",recentReturn:"最近年化收益率",value:"市值",statusPnL:"状态 / 盈亏",confirmDelete:"您确定要删除 {symbol} 吗？此操作无法撤销。",updatePrice:"更新价格",delete:"删除",editDetails:"编辑详情",live:"联网",manual:"手动",liveData:"价格通过 API 自动获取",manualValuation:"手动设置的估值",manualPrice:"手动定价",lastUpdated:"最后更新",dataStale:"数据更新失败或已过期 >30分",offline:"离线",selectAssetType:"选择资产类型",whatKind:"您想追踪哪类资产？",assetDetails:"资产详情",enterDetails:"输入详情：",editHolding:"编辑持仓",updateParams:"更新您的持仓参数",identification:"1. 基本信息",changeType:"更改类型",tickerLabel:"代码 / 货币符号",nameLabel:"全称 (选填)",currencyLabel:"计价货币",valuationHoldings:"2. 估值与持仓",quantity:"数量",balance:"余额",principalRemaining:"剩余本金",unitPrice:"当前单价",costBasis:"单位成本 (USD计价)",avgCostUnit:"平均成本 / 单位",dateAcquired:"持仓开始时间",dateRefreshed:"持仓刷新时间",autoFetch:"* 将根据代码自动获取实时价格。",autoFetchCash:"* 将自动获取实时汇率 (USD)。",saveChanges:"保存更改",addToPortfolio:"添加到投资组合",adjustButton:"调整",newCorrectQuantity:"新的正确数量",enterActualQuantity:"输入实际数量",adjustmentHint:'这将创建一个"余额调整"交易记录来修正您的持仓。',confirmAdjustment:"确认调整",type_stock:"股票",type_crypto:"加密货币",type_fund:"基金 / ETF",type_real_estate:"房地产",type_cash:"现金",type_liability:"负债",type_other:"自定义资产",recordTransaction:"记录交易",editTransaction:"编辑交易",transactionHistory:"交易历史",relatedTransactions:"相关交易",historySubtitle:"查看与筛选您的投资活动。",exportCSV:"导出 CSV",action:"操作",date:"交易时间",pricePerUnit:"单价",fees:"手续费",totalEstimate:"预估总额",total:"总额",autoCalculated:"根据数量、单价和手续费自动计算。",type:"类型",allAssets:"所有资产",allTypes:"所有类型",fromDate:"起始时间",toDate:"结束时间",noTransactions:"未找到符合条件的交易。",selectAssetPlaceholder:"选择资产...",tx_BUY:"买入",tx_SELL:"卖出",tx_DIVIDEND:"股息",tx_BALANCE_ADJUSTMENT:"余额调整",deleteTransaction:"删除交易",confirmDeleteTransaction:"您确定要删除这条交易记录吗？系统将尝试回滚该交易对您资产余额和成本的影响。",analyticsSubtitle:"绩效指标与风险分析",noAssetsAnalytics:"添加资产以查看分析",netWorthStructure:"净值结构",debtRatio:"负债率",highLeverage:"高杠杆",healthy:"健康",riskAnalysis:"风险分析",aiAssessment:"AI 评估",startRiskAnalysis:"开始风险分析",recalculate:"重新计算",costVsValue:"成本 vs 市值",topMovers:"盈亏排行",liabilityBreakdown:"负债明细",risk_high:"高风险 (加密货币)",risk_medium:"中风险 (股票)",risk_low:"低风险 (稳定资产)",label_assets:"资产",label_liabilities:"负债",label_cost:"成本",label_value:"市值",label_net_pnl:"净盈亏",managePreferences:"管理您的偏好与数据。",apiConfiguration:"API 配置",apiKeysSecurity:"所有 API 密钥仅存储在您浏览器的本地存储中。",aiProvider:"AI 模型服务商",aiProviderDesc:"选择用于投资组合智能分析的 AI 服务。",geminiKey:"Gemini API Key",geminiKeyDesc:"配置即可开启 AI 洞察与智能助手。",deepSeekKey:"DeepSeek API Key",deepSeekKeyDesc:"使用 DeepSeek V3 模型进行投资组合分析。",finnhubKey:"Finnhub API Key",finnhubKeyDesc:"获取实时股票价格所需 (收费版: 30次/分钟)。",alphaVantageKey:"Alpha Vantage API Key",alphaVantageKeyDesc:"备用数据源 (免费版: 25次/天)。",marketDataProvider:"行情数据源",marketDataProviderDesc:"选择您偏好的股票价格数据提供商。",marketDataKeyMissing:"请在设置中添加 API 密钥以获取准确数据。",getKey:"获取密钥",generalPreferences:"通用设置",baseCurrency:"基准货币",baseCurrencyDesc:"用于投资组合展示的默认货币",language:"语言 (Language)",languageDesc:"应用程序显示语言",privacyDataManagement:"隐私与数据管理",privacyMode:"隐私模式",privacyModeDesc:"隐藏所有资产金额与持仓细节",exportUnified:"导出完整数据",exportUnifiedDesc:"下载包含所有交易与资产详情的单一 CSV 文件。",importData:"导入数据",uploadCSV:"上传 CSV 文件",importHint:"上传 Panasset 导出的统一格式 CSV。系统将自动恢复资产档案与交易流水。",resetData:"重置数据",resetDesc:"清空所有资产",resetConfirm:"确定要清空吗？这将永久删除您的所有资产和交易记录，无法撤销。",importSuccess:"导入成功！",importError:"文件解析失败，请确保格式有效。",resetSuccess:"所有数据已重置。",localDataSecurity:"数据安全声明：您的财务数据仅存储在本地设备上 (LocalStorage)。我们没有任何服务器来存储您的个人资产信息。",aiAssistant:"AI 智能助手",aiInsights:"AI 投资组合洞察",wealthManagement:"财富管理与优化建议",analyzeNow:"立即分析",upToDate:"已是最新",apiKeyMissing:"缺少 API Key。请在设置中配置。",setKey:"Set Key",unableToGenerate:"Unable to generate risk analysis.",aiUnavailable:"AI 功能不可用，请检查 API Key。",voiceInput:"语音录入",listening:"聆听中...",processing:"分析中...",voiceError:"识别失败",voicePermissionDenied:"麦克风权限被拒绝，请允许访问。",voiceNoSupport:"浏览器不支持",voiceHint:'尝试说: "今天以 180 美元买入了 10 股苹果"',holdToTalk:"按住 说话",releaseToSend:"松开 发送",switchToKeyboard:"切换键盘",switchToVoice:"切换语音",feedback:"反馈建议",haveFeedback:"有反馈意见？",reportBug:"提交 Bug 或功能建议",githubLinkText:"前往 GitHub 提交",githubDesc:"提交 Issue 或功能建议，帮助我们改进 PanassetLite。",userGuide:"使用指南",about:"关于 盘资产·轻",error_api_key_missing:"缺少 API 密钥。请在设置中添加。",error_api_key_invalid:"API 密钥无效或已过期。请检查您的凭据。",error_rate_limit:"已超出请求频率限制。请稍后重试。",error_rate_limit_av:"Alpha Vantage 已达到频率限制（25次/天）。请明天再试或切换至 Finnhub。",error_rate_limit_fh:"Finnhub 已达到频率限制。请稍等片刻后重试。",error_access_denied:"访问被拒绝。考虑升级订阅或切换数据提供商。",error_network:"网络错误。请检查您的网络连接。",error_switch_provider:"考虑在设置中切换到 {provider}。",error_unknown:"获取市场数据时发生未知错误。",finnhubFreePlanLimitation:"Finnhub 免费方案不支持历史K线数据。请升级方案或切换至 Alpha Vantage。"}},vt=(e,t)=>{const{assets:s,transactions:a,v2Metadata:r}=et.getLegacyData();if(s&&!r)try{const r=JSON.parse(s),n=a?JSON.parse(a):[],i=[],l=[...n];r.forEach(e=>{i.push({id:e.id,symbol:e.symbol,name:e.name,type:e.type,currency:e.currency,currentPrice:e.currentPrice,lastUpdated:e.lastUpdated,dateAcquired:e.dateAcquired});if(!n.some(t=>t.assetId===e.id)&&e.quantity>0){const t=e.dateAcquired?`${e.dateAcquired}T00:00:00`:(new Date).toISOString();l.push({id:crypto.randomUUID(),assetId:e.id,type:Ve.BUY,date:t,quantityChange:e.quantity,pricePerUnit:e.avgCost,fee:0,total:e.quantity*e.avgCost,note:"Migration: Initial Balance"})}}),e(i),t(l),et.saveAssetMetas(i),et.saveTransactions(l),et.clearLegacyData()}catch(n){}},jt=(e,t)=>(t(t=>{const s=[...t];return e.forEach(e=>{const t=s.findIndex(t=>t.id===e.id);t>=0?s[t]={...s[t],...e}:s.push(e)}),s}),e.length),Nt=(e,t)=>(t(t=>{const s=[...t];return e.forEach(e=>{const t=s.findIndex(t=>t.id===e.id);t>=0?s[t]={...s[t],...e}:s.push(e)}),s}),e.length);const wt=new class{constructor(){this.listeners=[],this.toastCounter=0}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notify(e){this.listeners.forEach(t=>t(e))}showToast(e,t,s){const a={id:`toast-${++this.toastCounter}-${Date.now()}`,type:e,message:t,duration:void 0!==s?s:5e3};this.notify(a)}showError(e,t){this.showToast("error",e,t)}showWarning(e,t){this.showToast("warning",e,t)}showInfo(e,t){this.showToast("info",e,t)}showSuccess(e,t){this.showToast("success",e,t)}},St=(t,s,a)=>{const[r,n]=e.useState({USD:1,CNY:7.2,HKD:7.8}),[i,l]=e.useState(!1),o=e.useRef(a);e.useEffect(()=>{o.current=a},[a]);const c=e=>{const t=yt[o.current.language],s="finnhub"===e.provider?"Alpha Vantage":"Finnhub";switch(e.category){case We.API_KEY_MISSING:return t.error_api_key_missing;case We.API_KEY_INVALID:return t.error_api_key_invalid;case We.RATE_LIMIT:return"alphavantage"===e.provider?t.error_rate_limit_av:t.error_rate_limit_fh;case We.ACCESS_DENIED:return`${t.error_access_denied} ${t.error_switch_provider.replace("{provider}",s)}`;case We.NETWORK_ERROR:return t.error_network;default:return t.error_unknown}};return{exchangeRates:r,isRefreshing:i,refreshPrices:async e=>{l(!0);const a=e||t;try{const e=await(async()=>{const e=et.getCache(tt),t=!e||Date.now()-e.timestamp>864e5;if(e&&!t)return e.data;try{const e=await fetch("https://api.exchangerate-api.com/v4/latest/USD");if(!e.ok)throw new Error("Network response was not ok");const t=await e.json();return et.saveCache(tt,t.rates),t.rates}catch(s){return(null==e?void 0:e.data)||{USD:1,CNY:7.2,HKD:7.8}}})();n(e);const[t,r]=await Promise.all([pt(a),gt(a,{provider:o.current.marketDataProvider||"finnhub",alphaVantageKey:o.current.alphaVantageApiKey,finnhubKey:o.current.finnhubApiKey}).catch(e=>(wt.showError(c(e)),{}))]);s(s=>s.map(s=>{let a=s.currentPrice,n=s.currency,i=s.lastUpdated;if(s.type===Ye.CRYPTO&&t[s.id])a=t[s.id],n=He.USD,i=Date.now();else if(s.type!==Ye.STOCK&&s.type!==Ye.FUND||!r[s.id]){if(s.type===Ye.CASH&&!s.isManualPrice){const t=e[s.symbol];t&&t>0&&(a=1/t,n=He.USD,i=Date.now())}}else a=r[s.id].price,n=r[s.id].currency,i=r[s.id].lastUpdated||Date.now();return{...s,currentPrice:a,currency:n,lastUpdated:i}}))}catch(r){r.category?wt.showError(c(r)):wt.showError(yt[o.current.language].error_network)}finally{l(!1)}}}},At=e.createContext(void 0),Tt={baseCurrency:He.USD,isPrivacyMode:!1,geminiApiKey:"",deepSeekApiKey:"",aiProvider:"gemini",marketDataProvider:"finnhub",alphaVantageApiKey:"",finnhubApiKey:"",language:navigator.language.toLowerCase().startsWith("zh")?"zh":"en"},Dt=({children:s})=>{const[a,r]=e.useState(()=>et.getAssetMetas()),[n,i]=e.useState(()=>et.getTransactions()),[l,o]=e.useState(()=>{const e=et.getSettings();return e?{...Tt,...e,geminiApiKey:e.geminiApiKey||""}:Tt}),{exchangeRates:c,isRefreshing:d,refreshPrices:u}=St(a,r,l);e.useEffect(()=>{vt(r,i)},[]),e.useEffect(()=>{(a.length>0||n.length>0)&&(et.saveAssetMetas(a),et.saveTransactions(n))},[a,n]),e.useEffect(()=>{et.saveSettings(l)},[l]);const m=((t,s)=>e.useMemo(()=>{const e=new Map;return t.forEach(t=>{e.set(t.id,{...t,quantity:0,avgCost:0,totalCost:0,currentValue:0,pnl:0,pnlPercent:0,realizedPnL:0})}),[...s].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()).forEach(t=>{const s=e.get(t.assetId);if(s)if(t.type===Ve.BUY||t.type===Ve.DEPOSIT||t.type===Ve.BORROW){const e=t.total,a=s.totalCost+e,r=s.quantity+t.quantityChange;s.quantity=r,s.totalCost=a,r>0&&(s.avgCost=a/r)}else if(t.type===Ve.SELL||t.type===Ve.WITHDRAWAL||t.type===Ve.REPAY){const e=Math.abs(t.quantityChange),a=e*s.avgCost,r=t.total-a;s.quantity-=e,s.totalCost-=a,s.realizedPnL+=r,s.quantity<=1e-6&&(s.quantity=0,s.totalCost=0,s.avgCost=0)}else if(t.type===Ve.BALANCE_ADJUSTMENT)if(t.quantityChange>0)s.quantity+=t.quantityChange,s.totalCost+=t.total,s.quantity>0&&(s.avgCost=s.totalCost/s.quantity);else{const e=Math.abs(t.quantityChange),a=e/s.quantity;s.totalCost-=s.totalCost*a,s.quantity-=e}else t.type===Ve.DIVIDEND&&(s.realizedPnL+=t.total)}),Array.from(e.values()).map(e=>{const t=e.quantity*e.currentPrice,s=t-e.totalCost,a=0!==e.totalCost?s/e.totalCost*100:0;return{...e,currentValue:t,pnl:s,pnlPercent:a}})},[t,s]))(a,n);return t.jsx(At.Provider,{value:{assets:m,transactions:n,settings:l,exchangeRates:c,isRefreshing:d,addAsset:(e,t,s,a)=>{if(r(t=>[...t,e]),t>0){const r={id:crypto.randomUUID(),assetId:e.id,type:e.type===Ye.LIABILITY?Ve.BORROW:Ve.BUY,date:a,quantityChange:t,pricePerUnit:s,fee:0,total:t*s,note:"Initial Holding"};i(e=>[...e,r])}u()},editAsset:e=>{r(t=>t.map(t=>t.id===e.id?e:t))},deleteAsset:e=>{r(t=>t.filter(t=>t.id!==e)),i(t=>t.filter(t=>t.assetId!==e)),(e=>{const t=`${rt}_${e}`;et.remove(t)})(e)},addTransaction:e=>{const t={...e,id:crypto.randomUUID()};i(e=>[...e,t])},editTransaction:e=>{i(t=>t.map(t=>t.id===e.id?e:t))},deleteTransaction:e=>{i(t=>t.filter(t=>t.id!==e))},updateAssetPrice:(e,t)=>{r(s=>s.map(s=>s.id===e?{...s,currentPrice:t,lastUpdated:Date.now()}:s))},refreshPrices:u,updateSettings:e=>{o(t=>({...t,...e}))},importAssetsCSV:e=>jt(e,r),importTransactionsCSV:e=>Nt(e,i),clearData:()=>{r([]),i([]),et.clearAllData(),et.clearItemsByPrefix(rt)},t:e=>{var t;const s=l.language||"en";return(null==(t=yt[s])?void 0:t[e])||e}},children:s})},Ct=()=>{const t=e.useContext(At);if(void 0===t)throw new Error("usePortfolio must be used within a PortfolioProvider");return t},It={name:"get_assets",description:"Read current portfolio holdings/assets. Returns list of assets with ids, symbols, quantities, etc."},Et={name:"get_transactions",description:"Read transaction history. Supports filtering by symbol or type. Returns list of transactions with ids, dates, prices.",parameters:{type:a.OBJECT,properties:{symbol:{type:a.STRING,description:"Filter by asset symbol (e.g. AAPL)"},limit:{type:a.NUMBER,description:"Limit number of results (default 10)"}}}},kt={name:"propose_asset_mutation",description:"Propose to Add, Update, or Delete a single Asset Metadata. Use this for precise single edits.",parameters:{type:a.OBJECT,properties:{mutationType:{type:a.STRING,enum:["ADD","UPDATE","DELETE"],description:"Type of change"},symbol:{type:a.STRING,description:"Asset Symbol (Required for ADD)"},assetId:{type:a.STRING,description:"Asset ID (Required for UPDATE/DELETE). Use get_assets to find ID."},initialQuantity:{type:a.NUMBER,description:"Initial quantity to hold immediately (for ADD only)."},price:{type:a.NUMBER,description:"Price or Cost"},assetType:{type:a.STRING,enum:["STOCK","CRYPTO","CASH","REAL_ESTATE","LIABILITY","FUND","OTHER"],description:"Asset Type (for ADD)"},name:{type:a.STRING,description:"Asset Name"},currency:{type:a.STRING,enum:["USD","CNY","HKD"],description:"Currency of the asset."},dateAcquired:{type:a.STRING,description:"Date acquired (ISO 8601 YYYY-MM-DD or YYYY-MM-DDTHH:mm:ss). Use if user specifies a past date."}},required:["mutationType"]}},Pt={name:"propose_bulk_asset_update",description:"Propose MULTIPLE asset additions or updates at once. Use this for analyzing IMAGES or for BATCH UPDATES (e.g. 'set all stocks to quantity 10').",parameters:{type:a.OBJECT,properties:{assets:{type:a.ARRAY,description:"List of assets identified from the image.",items:{type:a.OBJECT,properties:{symbol:{type:a.STRING,description:"Ticker Symbol (e.g. AAPL, 00700)"},name:{type:a.STRING,description:"Asset Name"},quantity:{type:a.NUMBER,description:"Quantity held"},price:{type:a.NUMBER,description:"Current Price or Cost Basis"},currency:{type:a.STRING,enum:["USD","CNY","HKD"],description:"Inferred currency"},assetType:{type:a.STRING,enum:["STOCK","CRYPTO","CASH","REAL_ESTATE","LIABILITY","FUND","OTHER"],description:"Asset Type"},dateAcquired:{type:a.STRING,description:"Date acquired if visible/known"}},required:["symbol","quantity"]}}},required:["assets"]}},Lt={name:"propose_transaction_mutation",description:"Propose to Add (Record), Update, or Delete a Transaction. Use this for adding trades to EXISTING assets.",parameters:{type:a.OBJECT,properties:{mutationType:{type:a.STRING,enum:["ADD","UPDATE","DELETE"],description:"Type of change"},transactionId:{type:a.STRING,description:"Transaction ID (Required for UPDATE/DELETE). Use get_transactions to find ID."},assetId:{type:a.STRING,description:"Asset ID (Required for ADD). Use get_assets to find ID."},txType:{type:a.STRING,enum:["BUY","SELL","DIVIDEND","DEPOSIT","WITHDRAWAL","BORROW","REPAY"],description:"Transaction Type"},quantity:{type:a.NUMBER,description:"Quantity"},price:{type:a.NUMBER,description:"Price per unit"},date:{type:a.STRING,description:"ISO 8601 Date Time string (YYYY-MM-DDTHH:mm:ss)"},fee:{type:a.NUMBER,description:"Transaction fees"}},required:["mutationType"]}},_t={name:"propose_batch_delete",description:"Propose to DELETE multiple assets at once based on criteria (e.g. 'delete all crypto', 'delete everything except Tesla').",parameters:{type:a.OBJECT,properties:{assetIds:{type:a.ARRAY,description:"List of Asset IDs to delete. Use get_assets to find IDs matching the user's criteria.",items:{type:a.STRING}},reason:{type:a.STRING,description:"Reason for deletion (for summary)"}},required:["assetIds"]}};class Rt{constructor(e){this.ai=null,this.modelName="gemini-2.5-flash",e&&(this.ai=new s({apiKey:e}))}async processMessage(e,t,s,a,r,n,i){var l,o;if(!this.ai)return{text:"zh"===n?"我需要 **Gemini API Key** 才能作为您的 AI 助手工作。\n\n请前往 **设置** 页面进行配置。":"I need a **Gemini API Key** to function as your AI assistant. \n\nPlease go to **Settings** to configure it."};try{const c=new Date,d=c.toISOString().split("T")[0],u=c.toISOString(),m=`\n        You are the intelligent assistant for "PanassetLite".\n        Today is ${d}. Current Time is ${u}. Base Currency: ${r}.\n        \n        **Language Rule:**\n        ${"zh"===n?"You MUST reply in Chinese (Simplified).":"You MUST reply in English."}\n        \n        **Capabilities:**\n        1. **READ**: You can inspect the user's Assets and Transaction History using \`get_assets\` and \`get_transactions\`.\n        2. **WRITE**: You can propose changes using \`propose_asset_mutation\` (single) or \`propose_transaction_mutation\` (trades).\n        3. **BULK IMPORT**: If the user provides an IMAGE/SCREENSHOT, use \`propose_bulk_asset_update\` to extract items.\n        \n        **Universal Asset Logic:**\n        1.  **Scope**: **ANYTHING can be an asset.** You are NOT limited to financial documents.\n            -   **Physical Items**: Cars, watches, electronics, bags, wine, etc.\n            -   **Virtual Items**: Game skins, domain names, etc.\n            -   **Financial**: Stocks, crypto, cash, funds.\n\n        2.  **Symbol/ID Generation**:\n            -   **Financial**: Use the Ticker (e.g., AAPL, BTC).\n            -   **Physical/Other**: Generate a concise, logical ID (e.g., "ROLEX_SUB_DATE", "MACBOOK_PRO_M3", "VINTAGE_WINE_1990").\n\n        3.  **Asset Type Inference**:\n            -   Stocks/Crypto/Funds/Cash -> Use respective types.\n            -   Real Estate -> REAL_ESTATE.\n            -   Everything else (Cars, Watches, Electronics, Art) -> **OTHER**.\n\n        4.  **Quantity Rules**:\n            -   **Default**: If the user mentions buying/adding an item without specifying a quantity (e.g., "I bought a laptop", "Add a roller skate"), you MUST set quantity to 1.\n            -   **Count**: For images, count the items.\n            -   **Funds**: If you see a Total Value (Holding Amount) but cannot find the Number of Units (Quantity), set Quantity = Total Value and Price = 1.\n\n        5.  **Price/Value**:\n            -   If a price is visible/stated, use it.\n            -   If NO price is stated, **ESTIMATE** the current market value based on your knowledge.\n\n        6.  **Currency Inference**:\n            -   Infer based on symbol, name, or context (e.g. RMB for Chinese items, USD for global tech).\n\n        **Tool Usage Rules:**\n        -   **Single Item (Text)**: Use \`propose_asset_mutation\` (ADD/UPDATE).\n        -   **Multiple Items (Image/Text)**: Use \`propose_bulk_asset_update\`.\n        -   **Transactions**: If the asset ALREADY exists (check \`get_assets\`), use \`propose_transaction_mutation\` instead of adding it again.\n\n\n        **TOOL CALLING RULES:**\n        - **DO NOT** use \`print()\`, \`console.log()\`, or any other output wrapper.\n        - **DO NOT** wrap the function call in a code block (e.g. \`\`\`python ... \`\`\`).\n        - **DO NOT** use \`default_api.\` or any other object prefix. Just call the function name directly.\n        - **CORRECT**: \`propose_bulk_asset_update(assets = [...])\`\n        - **INCORRECT**: \`print(propose_bulk_asset_update(...))\`\n        - **INCORRECT**: \`default_api.propose_bulk_asset_update(...)\`\n        - Ensure arguments match the JSON schema exactly.\n      `,x=t.filter(e=>"system"!==e.role).slice(-10).map(e=>{const t=[];if(e.image){const s=e.image.split(",")[1],a=e.image.split(";")[0].split(":")[1];t.push({inlineData:{mimeType:a,data:s}})}return e.content&&e.content.trim().length>0&&t.push({text:e.content}),{role:"user"===e.role?"user":"model",parts:t}}),p=this.ai.chats.create({model:this.modelName,history:x,config:{systemInstruction:m,tools:[{functionDeclarations:[It,Et,kt,Pt,Lt,_t]}]}}),h=[];if(i){const e=i.split(",")[1],t=i.split(";")[0].split(":")[1];h.push({inlineData:{mimeType:t,data:e}}),h.push({text:"Please analyze this image and list all asset holdings found. Use the bulk update tool."})}const g=e.trim();g?h.push({text:g}):0===h.length&&h.push({text:"."});let b=await p.sendMessage({message:h});const f=b.functionCalls;if(f&&f.length>0){const e=f[0];if("get_assets"===e.name){const t={assets:s.map(e=>({id:e.id,symbol:e.symbol,name:e.name,qty:e.quantity,price:e.currentPrice}))};b=await p.sendMessage({message:[{functionResponse:{name:e.name,response:t}}]})}else if("get_transactions"===e.name){const t=e.args;let r=[...a];if(t.symbol){const e=s.find(e=>e.symbol===t.symbol.toUpperCase());r=e?r.filter(t=>t.assetId===e.id):[]}r=r.sort((e,t)=>t.date.localeCompare(e.date)).slice(0,t.limit||10);const n={transactions:r.map(e=>{const t=s.find(t=>t.id===e.assetId);return{id:e.id,date:e.date,type:e.type,symbol:null==t?void 0:t.symbol,qty:e.quantityChange,price:e.pricePerUnit}})};b=await p.sendMessage({message:[{functionResponse:{name:e.name,response:n}}]})}const t=b.functionCalls;if(t&&t.length>0){const e=t[0],a=e.args;if("propose_asset_mutation"===e.name){const e={ADD:"ADD_ASSET",UPDATE:"UPDATE_ASSET",DELETE:"DELETE_ASSET"}[a.mutationType];let t=a.symbol;if(!t&&a.assetId){const e=s.find(e=>e.id===a.assetId);e&&(t=e.symbol)}const r=`${a.mutationType} Asset: ${t||a.assetId||"Unknown"}`;return{text:"",action:{type:e,targetId:a.assetId,data:{symbol:a.symbol,name:a.name,quantity:a.initialQuantity,price:a.price,type:a.assetType,currency:a.currency,date:a.dateAcquired},summary:r}}}if("propose_bulk_asset_update"===e.name){const e=(null==(l=a.assets)?void 0:l.length)||0,t="zh"===n?`从图片识别到 ${e} 个资产持仓`:`Identified ${e} assets from image`;return{text:"zh"===n?"我从图片中识别到了以下资产，请确认是否导入：":"I found the following assets in the image. Please confirm to import:",action:{type:"BULK_ASSET_UPDATE",data:{},items:a.assets,summary:t}}}if("propose_transaction_mutation"===e.name){const e={ADD:"ADD_TRANSACTION",UPDATE:"UPDATE_TRANSACTION",DELETE:"DELETE_TRANSACTION"}[a.mutationType];let t="Unknown";if(a.assetId){const e=s.find(e=>e.id===a.assetId);e&&(t=e.symbol)}const r=`${a.mutationType} Transaction: ${a.txType||""} ${t}`;return{text:"",action:{type:e,targetId:a.transactionId,data:{assetId:a.assetId,type:a.txType,quantity:a.quantity,price:a.price,date:a.date,fee:a.fee},summary:r}}}if("propose_batch_delete"===e.name){const e=(null==(o=a.assetIds)?void 0:o.length)||0,t="zh"===n?`批量删除 ${e} 个资产: ${a.reason||""}`:`Batch delete ${e} assets: ${a.reason||""}`;return{text:"zh"===n?`我建议删除以下 ${e} 个资产。请确认：`:`I propose deleting the following ${e} assets. Please confirm:`,action:{type:"BATCH_DELETE_ASSET",data:{},items:a.assetIds.map(e=>({id:e})),summary:t}}}}}return{text:b.text||""}}catch(c){return{text:"zh"===n?"抱歉，AI 暂时无法处理您的请求。":"Sorry, I encountered an issue processing your request."}}}}class Ut extends Error{constructor(e,t,s){super(e),this.provider=t,this.originalError=s,this.name="AIError"}}class Mt extends Ut{constructor(e,t,s){super(e,t,s),this.name="AIParseError"}}class zt{constructor(e){this.ai=new s({apiKey:e})}async generateText(e){try{return(await this.ai.models.generateContent({model:"gemini-2.5-flash",contents:e})).text||""}catch(t){throw new Ut("Gemini Text Generation Failed","gemini",t)}}async generateJSON(e,t){const s={responseMimeType:"application/json"};t&&(s.responseSchema=t);try{const t=await this.ai.models.generateContent({model:"gemini-2.5-flash",contents:e,config:s});try{return JSON.parse(t.text)}catch(a){throw new Mt("Invalid JSON response from Gemini","gemini",a)}}catch(a){if(a instanceof Mt)throw a;throw new Ut("Gemini JSON Generation Failed","gemini",a)}}}class Ot{constructor(e){this.baseUrl="https://api.deepseek.com/chat/completions",this.apiKey=e}async callAPI(e,t=!1){var s,a,r,n;try{const i=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:"deepseek-chat",messages:e,response_format:t?{type:"json_object"}:void 0,stream:!1})});if(!i.ok){const e=(null==(s=(await i.json().catch(()=>({}))).error)?void 0:s.message)||i.statusText;throw new Ut(`DeepSeek API Error: ${e}`,"deepseek")}return(null==(n=null==(r=null==(a=(await i.json()).choices)?void 0:a[0])?void 0:r.message)?void 0:n.content)||""}catch(i){if(i instanceof Ut)throw i;throw new Ut("DeepSeek Network/API Error","deepseek",i)}}async generateText(e){return this.callAPI([{role:"user",content:e}],!1)}async generateJSON(e,t){const s=await this.callAPI([{role:"user",content:e}],!0);try{return JSON.parse(s)}catch(a){throw new Mt("Invalid JSON response from DeepSeek","deepseek",a)}}}class Kt{static create(e,t){return"deepseek"===e?new Ot(t):new zt(t)}}const qt="investflow_risk_cache",Ft="investflow_advisor_cache",$t=864e5;let Bt=null,Yt=null;const Ht=e=>e.map(e=>{const t=e.type===Ye.REAL_ESTATE||e.type===Ye.LIABILITY||e.type===Ye.OTHER?`:${e.currentPrice}`:"";return`${e.symbol}:${e.quantity}:${e.type}${t}`}).sort().join("|"),Vt=({onResult:s,onTextResult:l,mode:o,className:c="",variant:d="icon"})=>{const{settings:u,assets:m,t:x}=Ct(),[p,h]=e.useState(!1),[g,b]=e.useState(!1),[f,y]=e.useState(null),v=e.useRef(null),j=e.useRef("");e.useEffect(()=>()=>{if(v.current)try{v.current.stop()}catch(e){}},[]);const N=async e=>{if(!e||!e.trim())return;if("CHAT"===o)return void(l&&l(e));b(!0);const t="deepseek"===u.aiProvider?u.deepSeekApiKey:u.geminiApiKey;try{const r=m.map(e=>({symbol:e.symbol,name:e.name,id:e.id})),n=await(async(e,t,s,r,n=[])=>{if(!s)throw new Error("API Key is missing");const i=`\n      Role: Financial Data Parser.\n      Task: Parse user spoken input into structured JSON for an app called 'InvestFlow'.\n      \n      Time Context: \n      - Current Reference Date/Time: ${(new Date).toISOString()}.\n      - Use this date to correctly resolve relative time terms like "today", "yesterday", "last friday", "5 minutes ago".\n\n      User Input: "${e}"\n      \n      Context Mode: ${t}\n      Existing Assets: ${JSON.stringify(n.map(e=>`${e.symbol} (${e.name})`))}\n\n      Instructions:\n      1. Extract 'symbol', 'quantity', 'price', 'date' (YYYY-MM-DDTHH:mm:ss is preferred if specific time mentioned, else YYYY-MM-DD), 'currency'.\n      2. **INTELLIGENT MAPPING**:\n         - **Symbols**: Use your broad financial knowledge to map spoken company names or asset classes to standard Ticker Symbols (e.g. "Nvidia" -> "NVDA", "Gold" -> "GOLD", "Maotai" -> "600519.SS"). \n         - **Manual Assets**: For Real Estate or unique items, generate a logical, concise uppercase ID (e.g. "APT_NY", "ROLEX_SUB").\n         - **Currencies**: Map spoken currency names (e.g. "RMB", "Bucks", "Yuan") to standard ISO 4217 codes (CNY, USD, HKD, etc.).\n      3. **TRANSACTION MODE**:\n         - If mode is TRANSACTION, map the input to one of the Existing Assets if possible.\n         - Determine 'txType' (BUY, SELL, DIVIDEND). Default to BUY if ambiguous.\n      4. **ASSET MODE**:\n         - Determine 'type' (STOCK, CRYPTO, FUND, CASH, REAL_ESTATE, LIABILITY, OTHER).\n      \n      Return STRICT JSON. No markdown formatting.\n      Fields: symbol, name, type (enum: STOCK, CRYPTO, FUND, CASH, REAL_ESTATE, LIABILITY, OTHER), txType (enum: BUY, SELL, DIVIDEND), quantity (number), price (number), date (string), currency (string).\n    `,l={type:a.OBJECT,properties:{symbol:{type:a.STRING},name:{type:a.STRING},type:{type:a.STRING,enum:["STOCK","CRYPTO","FUND","CASH","REAL_ESTATE","LIABILITY","OTHER"]},txType:{type:a.STRING,enum:["BUY","SELL","DIVIDEND"]},quantity:{type:a.NUMBER},price:{type:a.NUMBER},date:{type:a.STRING},currency:{type:a.STRING}}},o=Kt.create(r,s);return await o.generateJSON(i,l)})(e,o,t,u.aiProvider,r);n&&s&&s(n)}catch(r){y(x("voiceError"))}finally{b(!1)}},w=()=>{if(v.current){try{v.current.stop()}catch(e){}v.current=null,h(!1),setTimeout(()=>{const e=j.current;e&&e.trim().length>0&&N(e)},250)}},S=e=>{if(e.preventDefault(),e.stopPropagation(),v.current)return;j.current="",y(null);const t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t)return void y(x("voiceNoSupport"));if("CHAT"!==o){if(!("deepseek"===u.aiProvider?u.deepSeekApiKey:u.geminiApiKey))return void y(x("apiKeyMissing"))}h(!0);const s=new t;v.current=s,s.continuous=!0,s.interimResults=!0,s.lang="zh"===u.language?"zh-CN":"en-US",s.onresult=e=>{const t=Array.from(e.results).map(e=>e[0].transcript).join("");j.current=t},s.onerror=e=>{if("not-allowed"===e.error||"service-not-allowed"===e.error)return y(x("voicePermissionDenied")),h(!1),void(v.current=null);"no-speech"!==e.error&&y(x("voiceError")),"no-speech"!==e.error&&(h(!1),v.current=null)};try{s.start()}catch(a){h(!1),v.current=null}},A=e=>{e.preventDefault(),e.stopPropagation(),v.current&&w()},T=e=>{e.preventDefault(),e.stopPropagation(),v.current&&w()};return"bar"===d?t.jsxs("div",{className:`relative w-full ${c} select-none touch-none`,children:[f&&t.jsx("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 bg-red-50 text-red-600 text-xs px-3 py-1.5 rounded-lg border border-red-100 shadow-sm whitespace-nowrap z-10 animate-fade-in pointer-events-none",children:f}),g?t.jsxs("div",{className:"flex items-center justify-center gap-2 w-full py-3 bg-slate-100 text-slate-500 rounded-xl font-medium border border-slate-200 cursor-wait",children:[t.jsx(r,{size:16,className:"animate-spin"}),x("processing")]}):t.jsx("button",{type:"button",onMouseDown:S,onMouseUp:A,onMouseLeave:A,onTouchStart:S,onTouchEnd:A,onTouchCancel:A,onContextMenu:T,className:`\n                        w-full py-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2\n                        ${p?"bg-emerald-500 text-white shadow-inner scale-[0.99]":"bg-white border border-slate-300 text-slate-800 shadow-sm active:bg-slate-100"}\n                    `,style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"},children:p?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"relative flex h-3 w-3 mr-1",children:[t.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"}),t.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-white"})]}),t.jsx("span",{children:x("releaseToSend")})]}):t.jsxs(t.Fragment,{children:[t.jsx(n,{size:18,className:"opacity-50"}),t.jsx("span",{children:x("holdToTalk")})]})})]}):t.jsxs("div",{className:`relative flex items-center ${c} select-none`,onClick:e=>e.stopPropagation(),children:[f&&t.jsx("div",{className:"absolute -top-8 right-0 bg-red-50 text-red-600 text-xs px-2 py-1 rounded border border-red-100 whitespace-nowrap z-10 animate-fade-in shadow-sm pointer-events-none",children:f}),g?t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 text-blue-600 rounded-full text-xs font-medium border border-blue-100 animate-pulse",children:[t.jsx(r,{size:14,className:"animate-spin"}),x("processing")]}):t.jsx("button",{type:"button",onMouseDown:S,onMouseUp:A,onMouseLeave:A,onTouchStart:S,onTouchEnd:A,onTouchCancel:A,onContextMenu:T,onClick:e=>{e.preventDefault(),e.stopPropagation()},className:`\n                    flex items-center gap-2 transition-all active:scale-95 touch-none select-none\n                    ${p?"bg-red-500 text-white shadow-md shadow-red-200 ring-4 ring-red-100 scale-105":"text-slate-400 hover:text-blue-600 hover:bg-blue-50"}\n                    ${p?"px-4 py-2 rounded-full":"p-2 rounded-full"}\n                `,style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"},title:x("voiceInput"),children:p?t.jsxs(t.Fragment,{children:[t.jsx(i,{size:16,className:"animate-pulse"}),t.jsx("span",{className:"text-xs font-bold whitespace-nowrap pointer-events-none",children:"zh"===u.language?"松开结束":"Release to Send"})]}):t.jsxs(t.Fragment,{children:[t.jsx(n,{size:20}),t.jsx("span",{className:"sr-only",children:x("holdToTalk")})]})})]})},Wt=(e,t=1280,s=.7)=>new Promise((a,r)=>{const n=new FileReader;n.readAsDataURL(e),n.onload=e=>{var n;const i=new Image;i.src=null==(n=e.target)?void 0:n.result,i.onload=()=>{let e=i.width,n=i.height;e>t&&(n=Math.round(n*t/e),e=t);const l=document.createElement("canvas");l.width=e,l.height=n;const o=l.getContext("2d");if(!o)return void r(new Error("Failed to get canvas context"));o.drawImage(i,0,0,e,n);const c=l.toDataURL("image/jpeg",s);a(c)},i.onerror=e=>r(e)},n.onerror=e=>r(e)}),Gt=({items:s,onUpdate:a})=>{const[r,n]=e.useState(!1),i=(e,t,r)=>{const n=[...s];n[e]={...n[e],[t]:r},a(n)},c=e=>t.jsx("div",{className:"overflow-auto "+(e?"max-h-[80vh]":"max-h-[200px]"),children:t.jsxs("table",{className:"w-full text-left text-xs border-collapse",children:[t.jsx("thead",{className:"bg-indigo-50/50 text-indigo-600 font-medium sticky top-0 z-10 backdrop-blur-sm",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-2 border-b border-indigo-100 min-w-[80px]",children:"Symbol"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 min-w-[100px]",children:"Name"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 min-w-[80px]",children:"Type"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 text-right min-w-[60px]",children:"Qty"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 text-right min-w-[80px]",children:"Price"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 min-w-[60px]",children:"Ccy"}),t.jsx("th",{className:"p-2 border-b border-indigo-100 text-right min-w-[100px]",children:"Date"})]})}),t.jsx("tbody",{className:"divide-y divide-indigo-50",children:s.map((e,s)=>t.jsxs("tr",{className:"hover:bg-indigo-50/30 group",children:[t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"text",value:e.symbol||"",onChange:e=>i(s,"symbol",e.target.value),className:"w-full bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors font-medium text-slate-700 uppercase"})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"text",value:e.name||"",onChange:e=>i(s,"name",e.target.value),className:"w-full bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600"})}),t.jsx("td",{className:"p-1",children:t.jsx("select",{value:e.assetType||e.type||Ye.STOCK,onChange:e=>i(s,"assetType",e.target.value),className:"w-full bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600",children:Object.values(Ye).map(e=>t.jsx("option",{value:e,children:e},e))})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"number",value:e.quantity||"",onChange:e=>i(s,"quantity",e.target.value),className:"w-full text-right bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600"})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"number",value:e.price||"",onChange:e=>i(s,"price",e.target.value),className:"w-full text-right bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600"})}),t.jsx("td",{className:"p-1",children:t.jsx("select",{value:e.currency||He.USD,onChange:e=>i(s,"currency",e.target.value),className:"w-full bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600",children:Object.values(He).map(e=>t.jsx("option",{value:e,children:e},e))})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"date",value:e.dateAcquired?e.dateAcquired.split("T")[0]:"",onChange:e=>i(s,"dateAcquired",e.target.value),className:"w-full text-right bg-transparent border border-transparent hover:border-indigo-200 focus:border-indigo-400 rounded px-1 py-0.5 outline-none transition-colors text-slate-600 text-xs"})})]},s))})]})});return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"relative bg-white/50 rounded-lg border border-indigo-100 overflow-hidden",children:[t.jsx("div",{className:"absolute top-2 right-2 z-20",children:t.jsx("button",{onClick:()=>n(!0),className:"p-1.5 bg-white text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md shadow-sm border border-slate-200 transition-colors",title:"Expand View",children:t.jsx(l,{size:14})})}),c(!1)]}),r&&t.jsx("div",{className:"fixed inset-0 z-[100] bg-slate-900/20 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in duration-200",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-5xl flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-200",children:[t.jsxs("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50 rounded-t-xl",children:[t.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[t.jsx("span",{className:"w-2 h-2 bg-indigo-500 rounded-full"}),"Edit Asset Details"]}),t.jsx("button",{onClick:()=>n(!1),className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:t.jsx(o,{size:20})})]}),t.jsx("div",{className:"p-4 overflow-auto bg-white rounded-b-xl",children:c(!0)}),t.jsx("div",{className:"p-4 border-t border-slate-100 bg-slate-50/50 rounded-b-xl flex justify-end",children:t.jsx("button",{onClick:()=>n(!1),className:"px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 transition-colors shadow-sm",children:"Done"})})]})})]})},Jt="panasset_chat_history",Qt="panasset_chat_dim",Xt=({isOpen:s,onClose:a,isSidebarCollapsed:r=!1})=>{const{settings:n,assets:i,transactions:l,addTransaction:N,editTransaction:w,deleteTransaction:S,addAsset:A,editAsset:T,deleteAsset:D,t:C}=Ct(),[I,E]=e.useState(""),[k,P]=e.useState(!1),[L,_]=e.useState([]),[R,U]=e.useState(!1),[M,z]=e.useState(null),[O,K]=e.useState({width:400,height:600}),[q,F]=e.useState(!1),[$,B]=e.useState(window.innerWidth<768),Y=e.useRef(null),H=e.useRef(null),V=e.useRef(null),W=e.useRef(O);e.useEffect(()=>{W.current=O},[O]),e.useEffect(()=>{const e=localStorage.getItem(Jt);if(e)try{_(JSON.parse(e))}catch(s){}else _([{id:"init",role:"model",content:"zh"===n.language?"您好！我是您的全能资产助手。您可以发送截图让我识别资产信息，或直接说：“把昨天的苹果买入交易改成 20 股”。":"Hi! I'm your PanassetLite assistant. You can upload screenshots for me to analyze, or say \"Update yesterday's AAPL buy to 20 shares\".",timestamp:Date.now()}]);try{const e=localStorage.getItem(Qt);e&&K(JSON.parse(e))}catch(s){}const t=()=>B(window.innerWidth<768);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),e.useEffect(()=>{if(L.length>0){const e=L.filter(e=>e.content&&""!==e.content.trim()||e.image||e.pendingAction);localStorage.setItem(Jt,JSON.stringify(e.slice(-50)))}},[L]),e.useEffect(()=>{var e;null==(e=Y.current)||e.scrollIntoView({behavior:"smooth"})},[L,s,k,R,M]),e.useEffect(()=>{if(V.current){V.current.style.height="auto";const e=Math.min(V.current.scrollHeight,120);V.current.style.height=`${Math.max(24,e)}px`}},[I]);const G=async e=>{const t="string"==typeof e?e:I;if(!(null==t?void 0:t.trim())&&!M)return;const s={id:crypto.randomUUID(),role:"user",content:t.trim(),timestamp:Date.now(),image:M||void 0};_(e=>[...e,s]),"string"!=typeof e&&E("");const a=M;z(null),P(!0);const r=new Rt(n.geminiApiKey),o=await r.processMessage(s.content,L,i,l,n.baseCurrency,n.language,a||void 0),c={id:crypto.randomUUID(),role:"model",content:o.text||"",timestamp:Date.now(),pendingAction:o.action};P(!1),_(e=>[...e,c])},J=r?"md:left-24":"md:left-72",Q=$?{}:{width:O.width,height:O.height},X=({content:e})=>e?t.jsx("div",{className:"prose prose-sm max-w-none prose-p:leading-relaxed prose-pre:bg-slate-800 prose-pre:text-white prose-p:my-1 prose-ul:my-1 prose-li:my-0",children:t.jsx(Ce,{children:e})}):null;return s?t.jsxs("div",{onClick:e=>e.stopPropagation(),className:`\n        fixed z-50 flex flex-col overflow-hidden bg-white shadow-2xl transition-all duration-75\n        inset-0 rounded-none \n        md:inset-auto md:bottom-4 md:right-auto md:rounded-2xl md:border md:border-slate-200 ${J}\n        animate-slide-up origin-bottom-left\n        ${q?"pointer-events-none select-none":""}\n    `,style:Q,children:[t.jsxs("div",{className:"p-4 bg-gradient-to-r from-indigo-600 to-blue-600 flex justify-between items-center shrink-0 text-white shadow-sm relative "+(q?"pointer-events-auto":""),children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-1.5 bg-white/20 rounded-lg",children:t.jsx(c,{size:18,className:"text-white"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold text-sm",children:"zh"===n.language?"盘资产 智能助手":"Panasset Assistant"}),t.jsxs("p",{className:"text-[10px] text-indigo-100 flex items-center gap-1 opacity-90",children:[t.jsx("span",{className:"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"}),"zh"===n.language?"在线":"Online"]})]})]}),t.jsxs("div",{className:"flex items-center gap-1 pr-6 md:pr-0",children:[t.jsx("button",{onClick:()=>{_([]),localStorage.removeItem(Jt)},className:"text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors p-2",title:"zh"===n.language?"清除历史":"Clear History",children:t.jsx(d,{size:18})}),t.jsx("button",{onClick:a,className:"text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors p-2",children:t.jsx(o,{size:22})})]}),!$&&t.jsx("div",{className:"absolute top-0 right-0 w-8 h-8 cursor-ne-resize flex items-center justify-center text-white/50 hover:text-white hover:bg-white/10 rounded-bl-xl transition-colors z-20",onMouseDown:e=>{e.preventDefault(),F(!0);const t=e.clientX,s=e.clientY,a=O.width,r=O.height,n=e=>{const n=e.clientX-t,i=e.clientY-s,l=Math.max(320,Math.min(1200,a+n)),o=Math.max(400,Math.min(window.innerHeight-50,r-i));K({width:l,height:o})},i=()=>{F(!1),window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",i),localStorage.setItem(Qt,JSON.stringify(W.current))};window.addEventListener("mousemove",n),window.addEventListener("mouseup",i)},title:"Resize",children:t.jsx(u,{size:16})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 bg-slate-50 scroll-smooth "+(q?"pointer-events-auto":""),children:[L.map(e=>t.jsxs("div",{className:"flex gap-3 "+("user"===e.role?"flex-row-reverse":"flex-row"),children:[t.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-sm "+("user"===e.role?"bg-slate-200 text-slate-500":"bg-indigo-100 text-indigo-600"),children:"user"===e.role?t.jsx(m,{size:16}):t.jsx(c,{size:16})}),t.jsxs("div",{className:"max-w-[85%] rounded-2xl p-3.5 text-sm shadow-sm "+("user"===e.role?"bg-slate-200 text-slate-800 rounded-tr-none":"bg-white text-slate-700 border border-slate-200 rounded-tl-none"),children:[e.image&&t.jsx("div",{className:"mb-2",children:t.jsx("img",{src:e.image,alt:"Upload",className:"max-w-full max-h-[200px] rounded-lg border border-slate-300/50"})}),t.jsx(X,{content:e.content}),e.pendingAction&&t.jsxs("div",{className:"mt-2 p-3 rounded-xl animate-fade-in border "+("executed"===e.pendingAction.status?"bg-slate-50 border-slate-200 opacity-80":"bg-indigo-50 border-indigo-100"),children:[t.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[t.jsx("div",{className:("executed"===e.pendingAction.status?"text-green-500":"text-indigo-600")+" mt-0.5 shrink-0",children:"executed"===e.pendingAction.status?t.jsx(x,{size:16}):"BULK_ASSET_UPDATE"===e.pendingAction.type?t.jsx(p,{size:16}):t.jsx(h,{size:16})}),t.jsx("div",{className:"text-xs font-medium "+("executed"===e.pendingAction.status?"text-green-700":"text-indigo-800"),children:"zh"===n.language?"executed"===e.pendingAction.status?"操作已执行":"需确认操作":"executed"===e.pendingAction.status?"Action Executed":"Action Required"})]}),t.jsx("div",{className:"text-sm font-bold text-slate-800 mb-3 pl-6",children:e.pendingAction.summary}),"BULK_ASSET_UPDATE"===e.pendingAction.type&&e.pendingAction.items&&t.jsx("div",{className:"pl-6 mb-3",children:t.jsx(Gt,{items:e.pendingAction.items,onUpdate:t=>((e,t)=>{_(s=>s.map(s=>s.id===e&&s.pendingAction?{...s,pendingAction:{...s.pendingAction,items:t}}:s))})(e.id,t)})}),"BULK_ASSET_UPDATE"!==e.pendingAction.type&&t.jsx("div",{className:"pl-6 mb-3",children:t.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs bg-white/50 p-2 rounded-lg border border-indigo-100",children:Object.entries(e.pendingAction.data).map(([e,s])=>null!=s&&"assetId"!==e&&"targetId"!==e?t.jsxs(g.Fragment,{children:[t.jsxs("span",{className:"text-slate-500 font-medium capitalize",children:[e,":"]}),t.jsx("span",{className:"text-slate-800 text-right truncate font-mono",children:s.toString()})]},e):null)})}),"executed"!==e.pendingAction.status&&t.jsx("div",{className:"flex gap-2 pl-6",children:t.jsxs("button",{onClick:()=>((e,t)=>{try{const{type:s,data:a,targetId:r,items:o}=t;if("BULK_ASSET_UPDATE"===s&&o&&o.length>0)o.forEach(e=>{var t;const s=null==(t=e.symbol)?void 0:t.toUpperCase();if(!s)return;const a=i.find(e=>e.symbol===s);if(a){const t=Number(e.quantity)-a.quantity;e.price&&Math.abs(e.price-a.currentPrice)>1e-5&&T({...a,currentPrice:Number(e.price),lastUpdated:Date.now()}),Math.abs(t)>1e-6&&N({assetId:a.id,type:Ve.BALANCE_ADJUSTMENT,date:(new Date).toISOString(),quantityChange:t,pricePerUnit:e.price||a.currentPrice,fee:0,total:t*(e.price||a.currentPrice),note:"AI Bulk Import Adjustment"})}else{const t={id:crypto.randomUUID(),symbol:s,name:e.name||s,type:e.assetType||Ye.STOCK,currentPrice:Number(e.price)||0,currency:e.currency||n.baseCurrency,lastUpdated:Date.now(),dateAcquired:e.dateAcquired||(new Date).toISOString()};A(t,Number(e.quantity)||0,Number(e.price)||0,t.dateAcquired)}});else if("ADD_ASSET"===s){const e={id:crypto.randomUUID(),symbol:a.symbol||"UNKNOWN",name:a.name||a.symbol||"Unknown",type:a.type||Ye.STOCK,currentPrice:a.price||0,currency:a.currency||n.baseCurrency,lastUpdated:Date.now(),dateAcquired:a.date||(new Date).toISOString()};A(e,a.quantity||0,a.price||0,e.dateAcquired)}else if("UPDATE_ASSET"===s&&r){const e=i.find(e=>e.id===r);if(e&&(T({...e,name:a.name??e.name,symbol:a.symbol??e.symbol,type:a.type??e.type,currentPrice:void 0!==a.price?a.price:e.currentPrice,currency:a.currency??e.currency}),void 0!==a.quantity&&null!==a.quantity)){const t=Number(a.quantity)-e.quantity;Math.abs(t)>1e-6&&N({assetId:e.id,type:Ve.BALANCE_ADJUSTMENT,date:(new Date).toISOString(),quantityChange:t,pricePerUnit:e.currentPrice,fee:0,total:t*e.currentPrice,note:"AI Assistant Balance Correction"})}}else if("DELETE_ASSET"===s&&r)D(r);else if("ADD_TRANSACTION"===s){let e=a.assetId;if(!e&&a.symbol){e=crypto.randomUUID();const t={id:e,symbol:a.symbol,name:a.symbol,type:Ye.STOCK,currentPrice:a.price||0,currency:a.currency||n.baseCurrency,lastUpdated:Date.now(),dateAcquired:(new Date).toISOString()};A(t,0,0,t.dateAcquired)}if(e){const t=a.quantity||0,s=a.type===Ve.SELL||a.type===Ve.WITHDRAWAL||a.type===Ve.REPAY;N({assetId:e,type:a.type||Ve.BUY,date:a.date||(new Date).toISOString(),quantityChange:s?-Math.abs(t):Math.abs(t),pricePerUnit:a.price||0,fee:a.fee||0,total:t*(a.price||0)+(a.fee||0)})}}else if("UPDATE_TRANSACTION"===s&&r){const e=l.find(e=>e.id===r);if(e){const t=void 0!==a.quantity?a.quantity:Math.abs(e.quantityChange),s=a.price??e.pricePerUnit,r=a.fee??e.fee,n=a.type??e.type,i=n===Ve.SELL||n===Ve.WITHDRAWAL||n===Ve.REPAY;w({...e,quantityChange:i?-Math.abs(t):Math.abs(t),pricePerUnit:s,date:a.date??e.date,type:n,fee:r,total:t*s+r})}}else"DELETE_TRANSACTION"===s&&r?S(r):"BATCH_DELETE_ASSET"===s&&o&&o.length>0&&o.forEach(e=>{e.id&&D(e.id)});_(t=>t.map(t=>t.id===e?{...t,pendingAction:{...t.pendingAction,status:"executed"}}:t))}catch(s){alert("zh"===n.language?"执行操作失败。":"Failed to execute action.")}})(e.id,e.pendingAction),className:"flex-1 text-white text-xs font-bold py-2 rounded-lg flex items-center justify-center gap-1 transition-colors shadow-sm "+(e.pendingAction.type.includes("DELETE")?"bg-red-500 hover:bg-red-600":"bg-indigo-600 hover:bg-indigo-700"),children:[t.jsx(b,{size:14})," ","zh"===n.language?"BULK_ASSET_UPDATE"===e.pendingAction.type?"确认导入全部":"执行":"Confirm"]})})]})]})]},e.id)),k&&t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0",children:t.jsx(c,{size:16})}),t.jsxs("div",{className:"bg-white border border-slate-200 rounded-2xl rounded-tl-none p-4 shadow-sm flex items-center gap-1.5 h-10",children:[t.jsx("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce"}),t.jsx("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce delay-100"}),t.jsx("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce delay-200"})]})]}),t.jsx("div",{ref:Y})]}),t.jsxs("div",{className:"p-3 bg-white border-t border-slate-200 flex items-end gap-2 shrink-0 pb-6 md:pb-3 transition-all duration-300 relative "+(q?"pointer-events-auto":""),children:[t.jsx("button",{onClick:()=>U(!R),className:"p-2.5 mb-0.5 text-slate-500 hover:text-slate-700 hover:bg-slate-100 rounded-full transition-colors shrink-0",title:C(R?"switchToKeyboard":"switchToVoice"),children:R?t.jsx(f,{size:24}):t.jsx(y,{size:24})}),R?t.jsx("div",{className:"flex-1 animate-in fade-in duration-200 mb-0.5",children:t.jsx(Vt,{mode:"CHAT",variant:"bar",onTextResult:e=>G(e)})}):t.jsxs(t.Fragment,{children:[M&&t.jsx("div",{className:"absolute bottom-full left-0 w-full p-2 bg-gradient-to-t from-white to-transparent",children:t.jsxs("div",{className:"relative inline-block",children:[t.jsx("img",{src:M,alt:"Preview",className:"h-20 w-auto object-cover rounded-lg border border-slate-200 shadow-sm bg-white"}),t.jsx("button",{onClick:()=>z(null),className:"absolute -top-2 -right-2 bg-slate-800 text-white rounded-full p-0.5 hover:bg-slate-700 shadow-md border border-white",children:t.jsx(o,{size:12})})]})}),t.jsxs("div",{className:"flex-1 flex gap-2 items-end bg-slate-50 border border-slate-200 rounded-xl px-2 py-2 focus-within:ring-2 focus-within:ring-indigo-500 focus-within:bg-white transition-all",children:[t.jsx("button",{onClick:()=>{var e;return null==(e=H.current)?void 0:e.click()},className:"p-1.5 mb-px text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors shrink-0 self-end",title:"Upload Image",children:t.jsx(v,{size:20})}),t.jsx("input",{type:"file",ref:H,className:"hidden",accept:"image/*",onChange:async e=>{if(e.target.files&&e.target.files[0]){const s=e.target.files[0];try{const e=await Wt(s);z(e)}catch(t){alert("zh"===n.language?"图片处理失败":"Failed to process image")}}e.target.value=""}}),t.jsx("textarea",{ref:V,value:I,onChange:e=>E(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),k||G())},onPaste:async e=>{const t=e.clipboardData.items;for(let a=0;a<t.length;a++)if(-1!==t[a].type.indexOf("image")){e.preventDefault();const r=t[a].getAsFile();if(r)try{const e=await Wt(r);z(e)}catch(s){alert("zh"===n.language?"图片处理失败":"Failed to process image")}return}},placeholder:"zh"===n.language?"输入消息...":"Type a message...",disabled:k,rows:1,className:"flex-1 bg-transparent border-none p-1.5 text-sm focus:ring-0 resize-none max-h-32 outline-none disabled:opacity-50 overflow-y-auto",style:{minHeight:"24px",lineHeight:"1.5"}})]}),t.jsx("button",{onClick:()=>G(),disabled:!I.trim()&&!M||k,className:"p-3 mb-0.5 bg-indigo-600 text-white rounded-xl shadow-md hover:bg-indigo-700 disabled:bg-slate-200 disabled:text-slate-400 transition-all active:scale-95 flex items-center justify-center shrink-0",children:t.jsx(j,{size:20})})]})]})]}):null},Zt=({className:e="",collapsed:s=!1,title:a,subTitle:r})=>{const n=`cyber-gradient-${g.useId()}`;return s?t.jsx("img",{src:"data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20512%20512'%20width='512'%20height='512'%3e%3cdefs%3e%3clinearGradient%20id='cyber-gradient'%20x1='0%25'%20y1='0%25'%20x2='0%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%2317EAD9'/%3e%3cstop%20offset='100%25'%20stop-color='%236078EA'/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='100%25'%20height='100%25'%20fill='%230C131D'/%3e%3cg%20transform='translate(256,%20256)%20scale(2)'%3e%3crect%20x='-18'%20y='-6'%20width='36'%20height='12'%20rx='3'%20fill='url(%23cyber-gradient)'/%3e%3c/g%3e%3cg%20transform='translate(256,%20256)%20scale(2)%20rotate(-90)'%3e%3cpath%20fill='url(%23cyber-gradient)'%20d='M%20100%20100%20H%200%20V%2085%20H%2085%20V%20-85%20H%20-85%20V%200%20H%20-100%20V%20-100%20H%20100%20Z'%20/%3e%3c/g%3e%3c/svg%3e",alt:"PanassetLite Logo",className:e,width:32,height:32,style:{objectFit:"contain"}}):t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 180 32",width:"180",height:"32",className:e,children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:n,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#17EAD9"}),t.jsx("stop",{offset:"100%",stopColor:"#6078EA"})]})}),t.jsxs("text",{x:"0",y:"22",fontFamily:"'Inter', sans-serif",fontWeight:"700",fontSize:"18",fill:`url(#${n})`,letterSpacing:"-0.02em",children:[a,".",r]})]})},es=({children:s})=>{const{t:a,settings:r}=Ct(),[n,i]=g.useState(!1),[l,d]=e.useState(!1),[u,m]=e.useState(()=>"true"===localStorage.getItem("investflow_sidebar_collapsed"));e.useEffect(()=>{localStorage.setItem("investflow_sidebar_collapsed",String(u))},[u]);const x=!(!r.geminiApiKey&&!r.deepSeekApiKey),p="zh"===r.language?"盘资产":"Panasset",h="zh"===r.language?"轻":"Lite",b=({to:e,icon:s,label:a,onClick:r})=>t.jsxs(I,{to:e,onClick:r,className:({isActive:e})=>`\n        flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group relative\n        ${e?"bg-blue-600 text-white shadow-md shadow-blue-200":"text-slate-500 hover:bg-slate-100"}\n        ${u?"justify-center px-2":""}\n      `,title:u?a:void 0,children:[t.jsx("div",{className:"shrink-0",children:s}),!u&&t.jsx("span",{className:"font-medium whitespace-nowrap overflow-hidden transition-all duration-300 opacity-100",children:a})]});return t.jsxs("div",{className:"min-h-screen flex bg-[#f8fafc]",children:[t.jsxs("aside",{className:"hidden md:flex flex-col bg-white border-r border-slate-100 h-screen fixed left-0 top-0 z-20 transition-all duration-300 ease-in-out "+(u?"w-20":"w-64"),children:[t.jsx("div",{className:"p-6 flex flex-col justify-center "+(u?"items-center px-0":""),children:t.jsx("button",{onClick:()=>m(!u),className:"transition-all duration-300 hover:opacity-80 focus:outline-none cursor-pointer "+(u?"scale-90":""),title:u?"Expand Sidebar":"Collapse Sidebar",children:t.jsx(Zt,{collapsed:u,title:p,subTitle:h})})}),t.jsxs("nav",{className:"flex-1 px-3 space-y-2 mt-2 overflow-y-auto overflow-x-hidden",children:[t.jsx(b,{to:"/",icon:t.jsx(N,{size:20}),label:a("dashboard")}),t.jsx(b,{to:"/assets",icon:t.jsx(w,{size:20}),label:a("assets")}),t.jsx(b,{to:"/history",icon:t.jsx(S,{size:20}),label:a("history")}),t.jsx(b,{to:"/analytics",icon:t.jsx(A,{size:20}),label:a("analytics")}),t.jsx(b,{to:"/settings",icon:t.jsx(T,{size:20}),label:a("settings")})]}),t.jsxs("div",{className:"p-4 border-t border-slate-100 flex flex-col gap-4",children:[x&&t.jsxs("button",{onClick:()=>d(e=>!e),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all border border-transparent ${l?"bg-indigo-600 text-white shadow-md shadow-indigo-200":"bg-indigo-50 text-indigo-600 hover:bg-indigo-100 hover:border-indigo-200"} ${u?"justify-center px-2":""}`,title:a("aiAssistant"),children:[t.jsx(c,{size:20,className:l?"text-white":"text-indigo-600"}),!u&&t.jsx("span",{className:"font-semibold",children:a("aiAssistant")})]}),u?t.jsx("div",{className:"flex flex-col gap-2 items-center",children:t.jsx("a",{href:"https://mp.weixin.qq.com/s/du0wh1As2s-casSadFAgZQ",target:"_blank",rel:"noreferrer",className:"flex justify-center text-slate-400 hover:text-green-600 transition-colors",title:a("about"),children:t.jsx(D,{size:20})})}):t.jsxs("div",{className:"animate-fade-in",children:[t.jsxs("a",{href:"https://mp.weixin.qq.com/s/du0wh1As2s-casSadFAgZQ",target:"_blank",rel:"noreferrer",className:"flex items-center gap-3 text-sm font-medium text-slate-600 hover:text-green-600 transition-colors mb-2 group px-2",children:[t.jsx(D,{size:18,className:"text-slate-400 group-hover:text-green-500 shrink-0"}),t.jsx("span",{className:"whitespace-nowrap",children:a("about")})]}),t.jsx("div",{className:"text-xs text-slate-400 px-2 leading-tight",children:a("disclaimer")})]})]})]}),t.jsxs("div",{className:"md:hidden fixed top-0 left-0 right-0 bg-white z-30 px-4 py-3 border-b border-slate-100 flex justify-between items-center shadow-sm",children:[t.jsx("div",{className:"flex items-center",children:t.jsx(Zt,{collapsed:!1,className:"h-8 w-auto",title:p,subTitle:h})}),t.jsxs("div",{className:"flex items-center gap-2",children:[x&&t.jsx("button",{onClick:()=>d(!l),className:"p-2 rounded-lg transition-colors "+(l?"bg-indigo-600 text-white":"text-indigo-600 bg-indigo-50 hover:bg-indigo-100"),children:t.jsx(c,{size:20})}),t.jsx("button",{onClick:()=>i(!n),className:"p-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:n?t.jsx(o,{size:24}):t.jsx(C,{size:24})})]})]}),n&&t.jsx("div",{className:"fixed inset-0 z-20 bg-slate-900/20 backdrop-blur-sm md:hidden pt-16",onClick:()=>i(!1),children:t.jsx("div",{className:"bg-white border-b border-slate-100 shadow-xl p-4 animate-in slide-in-from-top-5 duration-200",onClick:e=>e.stopPropagation(),children:t.jsxs("nav",{className:"space-y-2",children:[t.jsx(b,{to:"/",icon:t.jsx(N,{size:20}),label:a("dashboard"),onClick:()=>i(!1)}),t.jsx(b,{to:"/assets",icon:t.jsx(w,{size:20}),label:a("assets"),onClick:()=>i(!1)}),t.jsx(b,{to:"/history",icon:t.jsx(S,{size:20}),label:a("history"),onClick:()=>i(!1)}),t.jsx(b,{to:"/analytics",icon:t.jsx(A,{size:20}),label:a("analytics"),onClick:()=>i(!1)}),t.jsx(b,{to:"/settings",icon:t.jsx(T,{size:20}),label:a("settings"),onClick:()=>i(!1)}),t.jsx("div",{className:"pt-4 mt-4 border-t border-slate-100 space-y-2",children:t.jsxs("a",{href:"https://mp.weixin.qq.com/s/du0wh1As2s-casSadFAgZQ",target:"_blank",rel:"noreferrer",className:"flex items-center gap-3 px-4 py-3 text-slate-500 hover:bg-slate-50 rounded-xl transition-colors",children:[t.jsx(D,{size:20}),t.jsx("span",{className:"font-medium",children:a("about")})]})})]})})}),t.jsx("main",{className:"flex-1 pt-20 md:pt-8 md:p-8 p-4 w-full transition-all duration-300 ease-in-out "+(u?"md:ml-20":"md:ml-64"),children:s}),x&&t.jsx(Xt,{isOpen:l,onClose:()=>d(!1),isSidebarCollapsed:u})]})},ts=({title:e,children:s,className:a="",action:r})=>t.jsxs("div",{className:`bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden ${a}`,children:[(e||r)&&t.jsxs("div",{className:"px-4 py-3 sm:px-6 sm:py-4 border-b border-slate-100 flex justify-between items-center",children:[e&&t.jsx("div",{className:"font-semibold text-slate-800 text-base sm:text-lg flex items-center gap-3",children:e}),r&&t.jsx("div",{children:r})]}),t.jsx("div",{className:"p-4 sm:p-6",children:s})]}),ss=({isOpen:e,onClose:s,onConfirm:a,title:r,message:n,confirmText:i="Confirm",cancelText:l="Cancel",isDanger:o=!1})=>e?t.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm transition-all duration-200",children:t.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden transform transition-all scale-100",children:t.jsxs("div",{className:"p-6 text-center",children:[t.jsx("div",{className:"mx-auto w-12 h-12 rounded-full flex items-center justify-center mb-4 "+(o?"bg-red-100 text-red-600":"bg-blue-100 text-blue-600"),children:t.jsx(E,{size:24})}),t.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:r}),t.jsx("p",{className:"text-sm text-slate-500 leading-relaxed mb-6",children:n}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:s,className:"flex-1 px-4 py-2.5 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-colors",children:l}),t.jsx("button",{onClick:()=>{a(),s()},className:"flex-1 px-4 py-2.5 font-medium rounded-xl text-white transition-colors shadow-lg "+(o?"bg-red-600 hover:bg-red-700 shadow-red-200":"bg-blue-600 hover:bg-blue-700 shadow-blue-200"),children:i})]})]})})}):null,as=({isOpen:s,onClose:a,transaction:r})=>{const{editTransaction:n,assets:i,transactions:l,t:c}=Ct(),[d,u]=e.useState(""),[m,x]=e.useState(""),[p,h]=e.useState(""),[g,b]=e.useState("0"),[f,y]=e.useState("0"),[v,j]=e.useState("0"),N=e.useMemo(()=>r&&d?l.filter(e=>e.assetId===r.assetId&&e.id!==r.id&&new Date(e.date).getTime()<new Date(d).getTime()).reduce((e,t)=>e+t.quantityChange,0):0,[l,r,d]);e.useEffect(()=>{if(s&&r){u(r.date),x(Math.abs(r.quantityChange).toString()),h(r.pricePerUnit.toString()),b(r.fee.toString()),y(r.total.toString());const e=l.filter(e=>e.assetId===r.assetId&&e.id!==r.id&&new Date(e.date).getTime()<new Date(r.date).getTime()).reduce((e,t)=>e+t.quantityChange,0);j((e+r.quantityChange).toString())}},[s,r]);const S=(e,t,s,a)=>{switch(a){case Ve.BUY:case Ve.DEPOSIT:case Ve.BORROW:return e*t+s;case Ve.SELL:case Ve.WITHDRAWAL:case Ve.REPAY:case Ve.DIVIDEND:return e*t-s;default:return e*t}},A=e=>{if(x(e),!r)return;const t=parseFloat(e);let s=parseFloat(p);const a=parseFloat(g)||0;if(isNaN(t))return;let n=t;if(r.quantityChange<0&&(n=-t),j((N+n).toString()),isNaN(s)||0===s){const e=(()=>{if(!r)return 0;const e=l.filter(e=>e.assetId===r.assetId&&e.id!==r.id).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());return e.length>0?e[0].pricePerUnit:0})();e>0&&(s=e,h(e.toString()))}if(s>0){const e=S(t,s,a,r.type);y(e.toFixed(2))}};if(!s||!r)return null;const T=i.find(e=>e.id===r.assetId),D=T?T.symbol:"Unknown Asset";return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm transition-opacity",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-slide-up",children:[t.jsxs("div",{className:"px-6 py-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-2 bg-blue-100 text-blue-600 rounded-lg",children:t.jsx(k,{size:18})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-bold text-slate-800",children:c("editTransaction")}),t.jsxs("p",{className:"text-xs text-slate-500",children:[D," • ",c(`tx_${r.type}`)]})]})]}),t.jsx("button",{onClick:a,className:"text-slate-400 hover:text-slate-600",children:t.jsx(o,{size:20})})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=parseFloat(m),s=parseFloat(p),i=parseFloat(g)||0,l=parseFloat(f),o=parseFloat(v);if(isNaN(t)||isNaN(s))return;let c=t;r.type===Ve.BALANCE_ADJUSTMENT?isNaN(o)?r.quantityChange<0&&(c=-t):c=o-N:r.quantityChange<0&&(c=-t),n({...r,date:d,quantityChange:c,pricePerUnit:s,fee:i,total:l}),a()},className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:c("date")}),t.jsxs("div",{className:"relative",children:[t.jsx(P,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"datetime-local",step:"1",value:d,onChange:e=>u(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:c("quantity")}),t.jsxs("div",{className:"relative",children:[t.jsx(L,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:m,onChange:e=>A(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1 flex justify-between",children:[c("balance"),t.jsxs("span",{className:"text-[10px] text-slate-400 font-normal",children:["Prev: ",N.toLocaleString()]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(w,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:v,onChange:e=>(e=>{if(j(e),!r)return;const t=parseFloat(e);if(isNaN(t))return;const s=t-N,a=Math.abs(s);x(a.toString());let n=parseFloat(p);const i=parseFloat(g)||0;if(n>0){const e=S(a,n,i,r.type);y(e.toFixed(2))}})(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:c("pricePerUnit")}),t.jsxs("div",{className:"relative",children:[t.jsx(_,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:p,onChange:e=>(e=>{if(h(e),!r)return;const t=parseFloat(e),s=parseFloat(m),a=parseFloat(g)||0;if(!isNaN(t)&&!isNaN(s)){const e=S(s,t,a,r.type);y(e.toFixed(2))}})(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:c("fees")}),t.jsxs("div",{className:"relative",children:[t.jsx(_,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:g,onChange:e=>(e=>{if(b(e),!r)return;const t=parseFloat(e)||0,s=parseFloat(m),a=parseFloat(p);if(!isNaN(s)&&!isNaN(a)){const e=S(s,a,t,r.type);y(e.toFixed(2))}})(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]})]}),t.jsxs("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2",children:[t.jsx(R,{size:18}),c("saveChanges")]})]})]})})},rs=({options:s,value:a,onChange:r,placeholder:n="Select...",className:i=""})=>{const[l,o]=e.useState(!1),[c,d]=e.useState(""),u=e.useRef(null),m=e.useRef(null);e.useEffect(()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),e.useEffect(()=>{l&&m.current&&m.current.focus()},[l]);const x=e.useMemo(()=>{if(!c)return s;const e=c.toLowerCase();return s.filter(t=>t.label.toLowerCase().includes(e))},[s,c]),p=s.find(e=>e.value===a);return t.jsxs("div",{className:`relative ${i}`,ref:u,children:[t.jsxs("div",{onClick:()=>o(!l),className:`\n                    w-full flex items-center justify-between p-2.5 \n                    bg-slate-50 border border-slate-200 rounded-lg \n                    cursor-pointer hover:bg-slate-100 transition-colors\n                    ${l?"ring-2 ring-blue-500 border-transparent":""}\n                `,children:[t.jsx("span",{className:"block truncate "+(p?"text-slate-700":"text-slate-400"),children:p?p.label:n}),t.jsx(U,{size:16,className:"text-slate-400 transition-transform "+(l?"rotate-180":"")})]}),l&&t.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg max-h-60 overflow-hidden flex flex-col animate-in fade-in zoom-in-95 duration-100",children:[t.jsx("div",{className:"p-2 border-b border-slate-100 bg-slate-50",children:t.jsxs("div",{className:"relative",children:[t.jsx(M,{size:14,className:"absolute left-2.5 top-2.5 text-slate-400"}),t.jsx("input",{ref:m,type:"text",className:"w-full pl-8 pr-3 py-1.5 text-sm bg-white border border-slate-200 rounded-md focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"Search...",value:c,onChange:e=>d(e.target.value),onClick:e=>e.stopPropagation()})]})}),t.jsx("div",{className:"overflow-y-auto flex-1",children:0===x.length?t.jsx("div",{className:"p-3 text-sm text-slate-400 text-center",children:"No results found"}):x.map(e=>t.jsxs("div",{onClick:()=>{return t=e.value,r(t),o(!1),void d("");var t},className:`\n                                        flex items-center justify-between px-3 py-2 text-sm cursor-pointer\n                                        ${e.value===a?"bg-blue-50 text-blue-700 font-medium":"text-slate-700 hover:bg-slate-50"}\n                                    `,children:[t.jsx("span",{children:e.label}),e.value===a&&t.jsx(b,{size:14})]},e.value))})]})]})},ns=()=>{const{transactions:s,assets:a,deleteTransaction:r,settings:n,t:i}=Ct(),[l,o]=e.useState("all"),[c,m]=e.useState("all"),[x,p]=e.useState(""),[h,g]=e.useState(""),[b,f]=e.useState(!1),[y,v]=e.useState(null),[j,N]=e.useState(null),w=e=>{const t=a.find(t=>t.id===e);return t?{symbol:t.symbol,name:t.name,currency:t.currency}:{symbol:"UNKNOWN",name:"Deleted Asset",currency:He.USD}},S=e.useMemo(()=>s.filter(e=>!!e&&(("all"===l||e.assetId===l)&&(("all"===c||e.type===c)&&(!(x&&e.date<x)&&!(h&&e.date>h))))).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[s,l,c,x,h]),A=e=>{switch(e){case Ve.BUY:return"bg-blue-100 text-blue-700";case Ve.DEPOSIT:return"bg-blue-50 text-blue-600";case Ve.SELL:return"bg-purple-100 text-purple-700";case Ve.WITHDRAWAL:return"bg-purple-50 text-purple-600";case Ve.DIVIDEND:return"bg-green-100 text-green-700";case Ve.BORROW:return"bg-amber-100 text-amber-700";case Ve.REPAY:return"bg-indigo-100 text-indigo-700";case Ve.BALANCE_ADJUSTMENT:return"bg-slate-100 text-slate-700 border border-slate-200";default:return"bg-slate-100 text-slate-700"}},T=e=>{switch(e){case Ve.BUY:case Ve.DEPOSIT:return t.jsx($,{size:16});case Ve.SELL:case Ve.WITHDRAWAL:return t.jsx(u,{size:16});case Ve.DIVIDEND:return t.jsx(_,{size:16});case Ve.BORROW:return t.jsx(F,{size:16});case Ve.REPAY:return t.jsx(q,{size:16});case Ve.BALANCE_ADJUSTMENT:return t.jsx(K,{size:14});default:return null}},D=e=>{switch(e){case He.USD:return"$";case He.CNY:return"¥";case He.HKD:return"HK$";default:return"$"}},C=e=>{if(!e)return"-";try{return new Date(e).toLocaleString(void 0,{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e}},I=e.useMemo(()=>{const e=new Map;return a.forEach(t=>e.set(t.id,t)),Array.from(e.values()).sort((e,t)=>e.symbol.localeCompare(t.symbol))},[a]);return t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:i("transactionHistory")}),t.jsx("p",{className:"text-slate-500",children:i("historySubtitle")})]})}),t.jsxs(ts,{children:[t.jsx("div",{className:"md:hidden flex justify-end mb-2",children:t.jsxs("button",{onClick:()=>f(!b),className:"flex items-center gap-2 text-sm font-medium text-slate-600 bg-slate-100 px-3 py-2 rounded-lg hover:bg-slate-200 transition-colors",children:[t.jsx(z,{size:16}),"Filter",b?t.jsx(O,{size:16}):t.jsx(U,{size:16})]})}),t.jsxs("div",{className:(b?"grid":"hidden")+" md:grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6 pb-6 border-b border-slate-100 animate-fade-in",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:i("asset")}),t.jsx(rs,{options:[{value:"all",label:i("allAssets")},...I.map(e=>({value:e.id,label:`${e.symbol} - ${e.name}`}))],value:l,onChange:o,placeholder:i("selectAssetPlaceholder")})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:i("type")}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:c,onChange:e=>m(e.target.value),className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none appearance-none",children:[t.jsx("option",{value:"all",children:i("allTypes")}),t.jsx("option",{value:Ve.BUY,children:i("tx_BUY")}),t.jsx("option",{value:Ve.SELL,children:i("tx_SELL")}),t.jsx("option",{value:Ve.DIVIDEND,children:i("tx_DIVIDEND")}),t.jsx("option",{value:Ve.BALANCE_ADJUSTMENT,children:i("tx_BALANCE_ADJUSTMENT")})]}),t.jsx(z,{className:"absolute right-3 top-3 text-slate-400 pointer-events-none",size:16})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:i("fromDate")}),t.jsx("input",{type:"date",value:x,onChange:e=>p(e.target.value),className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:i("toDate")}),t.jsx("input",{type:"date",value:h,onChange:e=>g(e.target.value),className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),t.jsx("div",{className:"md:hidden space-y-3",children:S.map(e=>{if(!e)return null;const s=w(e.assetId),a=D(s.currency),r=Number(e.pricePerUnit||0),l=Number(e.total||0),o=Number(e.quantityChange||0),c=e.type===Ve.BALANCE_ADJUSTMENT,u=c?o>0?`+${o.toLocaleString()}`:o.toLocaleString():Math.abs(o).toLocaleString(),m=c?o>=0?"text-green-600":"text-red-600":"text-slate-700";return t.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-100 relative group",children:[t.jsx("button",{onClick:()=>v(e.id),className:"absolute top-3 right-3 p-1.5 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:t.jsx(d,{size:16})}),t.jsx("button",{onClick:()=>N(e),className:"absolute top-3 right-10 p-1.5 text-slate-300 hover:text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",children:t.jsx(k,{size:16})}),t.jsx("div",{className:"flex justify-between items-start mb-2 pr-8",children:t.jsxs("div",{children:[t.jsxs("div",{className:"font-bold text-slate-800 text-lg flex items-center gap-2",children:[s.symbol,t.jsx("span",{className:"text-xs font-normal text-slate-400 bg-white px-1.5 py-0.5 rounded border border-slate-100",children:s.name})]}),t.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-500 mt-1",children:[t.jsx(P,{size:12}),C(e.date)]})]})}),t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-bold ${A(e.type)}`,children:[T(e.type),i(`tx_${e.type}`)||e.type]}),t.jsx("div",{className:"text-right",children:t.jsx("div",{className:"font-bold text-lg text-slate-800",children:n.isPrivacyMode?"••••••":`${a}${l.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`})})]}),t.jsxs("div",{className:"pt-3 border-t border-slate-200/50 flex justify-between items-center text-sm",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-xs text-slate-400 uppercase mb-0.5",children:i("quantity")}),t.jsx("span",{className:`font-mono font-medium ${m}`,children:n.isPrivacyMode?"••••••":u})]}),t.jsxs("div",{className:"flex flex-col text-right",children:[t.jsx("span",{className:"text-xs text-slate-400 uppercase mb-0.5",children:i("pricePerUnit")}),t.jsxs("span",{className:"font-mono text-slate-600",children:[a,r.toLocaleString()]})]})]})]},e.id)})}),t.jsx("div",{className:"hidden md:block overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left border-collapse min-w-[800px]",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-xs text-slate-400 uppercase border-b border-slate-100",children:[t.jsx("th",{className:"pb-3 pl-2 font-medium",children:c===Ve.BALANCE_ADJUSTMENT?i("dateRefreshed"):i("date")}),t.jsx("th",{className:"pb-3 font-medium",children:i("asset")}),t.jsx("th",{className:"pb-3 font-medium",children:i("type")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:i("quantity")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:i("pricePerUnit")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:i("fees")}),t.jsx("th",{className:"pb-3 font-medium text-right pr-2",children:i("total")}),t.jsx("th",{className:"pb-3 font-medium text-right pr-2",children:i("actions")})]})}),t.jsx("tbody",{className:"text-sm",children:S.map(e=>{if(!e)return null;const s=w(e.assetId),a=D(s.currency),r=Number(e.pricePerUnit||0),l=Number(e.fee||0),o=Number(e.total||0),c=Number(e.quantityChange||0),u=e.type===Ve.BALANCE_ADJUSTMENT,m=u?c>0?`+${c.toLocaleString()}`:c.toLocaleString():Math.abs(c).toLocaleString(),x=u?c>=0?"text-green-600 font-bold":"text-red-600 font-bold":"text-slate-700";return t.jsxs("tr",{className:"border-b border-slate-50 last:border-0 hover:bg-slate-50/50 transition-colors",children:[t.jsx("td",{className:"py-4 pl-2 text-slate-600 font-mono text-xs whitespace-nowrap",children:C(e.date)}),t.jsxs("td",{className:"py-4",children:[t.jsx("div",{className:"font-semibold text-slate-800",children:s.symbol}),t.jsx("div",{className:"text-xs text-slate-400 hidden sm:block",children:s.name})]}),t.jsx("td",{className:"py-4",children:t.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-medium ${A(e.type)}`,children:[T(e.type),i(`tx_${e.type}`)||e.type]})}),t.jsx("td",{className:`py-4 text-right font-medium ${x}`,children:n.isPrivacyMode?"••••••":"0"!==m?m:"-"}),t.jsxs("td",{className:"py-4 text-right text-slate-600 whitespace-nowrap",children:[a,r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),t.jsx("td",{className:"py-4 text-right text-slate-500 whitespace-nowrap",children:l>0?`${a}${l.toFixed(2)}`:"-"}),t.jsx("td",{className:"py-4 text-right pr-2 font-bold text-slate-800 whitespace-nowrap",children:n.isPrivacyMode?"••••••":`${a}${o.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),t.jsxs("td",{className:"py-4 text-right pr-2",children:[t.jsx("button",{onClick:()=>N(e),className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors mr-1",title:i("editTransaction"),children:t.jsx(k,{size:16})}),t.jsx("button",{onClick:()=>v(e.id),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:i("deleteTransaction"),children:t.jsx(d,{size:16})})]})]},e.id)})})]})}),0===S.length&&t.jsx("div",{className:"py-12 text-center text-slate-400 italic",children:i("noTransactions")})]}),t.jsx(ss,{isOpen:!!y,onClose:()=>v(null),onConfirm:()=>y&&r(y),title:i("deleteTransaction"),message:i("confirmDeleteTransaction"),confirmText:i("delete"),isDanger:!0}),t.jsx(as,{isOpen:!!j,onClose:()=>N(null),transaction:j})]})};var is=(e=>(e.LOW="Low",e.MEDIUM="Medium",e.HIGH="High",e))(is||{});const ls=["USDT","USDC","DAI","BUSD","TUSD","USDD","FRAX","USDP"],os=["BTC","ETH"];function cs(e){return e.type===Ye.LIABILITY||e.type===Ye.CASH||e.type===Ye.REAL_ESTATE?"Low":e.type===Ye.STOCK||e.type===Ye.FUND?"Medium":e.type===Ye.CRYPTO?function(e){const t=e.toUpperCase().trim();return ls.includes(t)}(e.symbol)?"Low":function(e){const t=e.toUpperCase().trim();return os.includes(t)}(e.symbol)?"Medium":"High":"Low"}const ds=({data:e,ratio:s,formatCurrency:a,isPrivacyMode:r,t:n})=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsx(ts,{title:n("netWorthStructure"),className:"md:col-span-2 min-w-0",children:t.jsx("div",{className:"h-[200px] w-full min-w-0",children:t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(Ee,{data:e,layout:"vertical",margin:{left:0,right:40,top:0,bottom:0},barSize:32,children:[t.jsx(ke,{strokeDasharray:"3 3",horizontal:!1,stroke:"#f1f5f9"}),t.jsx(Pe,{type:"number",tickFormatter:a,tick:{fontSize:11,fill:"#94a3b8"},axisLine:!1,tickLine:!1}),t.jsx(Le,{dataKey:"name",type:"category",width:70,tick:{fontSize:12,fontWeight:500,fill:"#64748b"},axisLine:!1,tickLine:!1}),t.jsx(_e,{cursor:{fill:"transparent"},contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>a(e)}),t.jsxs(Re,{dataKey:"value",radius:[0,6,6,0],children:[e.map((e,s)=>t.jsx(Ue,{fill:e.fill},`cell-${s}`)),!r&&t.jsx(Me,{dataKey:"value",position:"right",formatter:a,style:{fontSize:"11px",fill:"#64748b",fontWeight:600}})]})]})})})}),t.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 p-5 flex flex-col justify-center items-center md:col-span-1 relative overflow-hidden",children:[t.jsxs("h3",{className:"text-slate-500 text-sm font-medium mb-3 flex items-center gap-2 z-10",children:[t.jsx(B,{size:16})," ",n("debtRatio")]}),t.jsxs("div",{className:"relative z-10 text-center mb-2",children:[t.jsxs("div",{className:"text-3xl font-bold mb-1 "+(s>50?"text-red-500":s>30?"text-orange-500":"text-slate-800"),children:[s.toFixed(1),"%"]}),t.jsx("div",{className:"text-xs px-2 py-1 rounded-full inline-block "+(s>30?"bg-red-50 text-red-600":"bg-green-50 text-green-600"),children:n(s>30?"highLeverage":"healthy")})]}),t.jsx("div",{className:"w-full bg-slate-100 h-1.5 mt-4 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full transition-all duration-1000 "+(s>50?"bg-red-500":"bg-green-500"),style:{width:`${Math.min(s,100)}%`}})})]})]}),us=({data:e,colors:s,formatCurrency:a,t:r})=>t.jsx(ts,{title:r("assetAllocation"),className:"lg:col-span-1 min-w-0",children:t.jsx("div",{className:"h-[240px] w-full min-w-0",children:t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(ze,{children:[t.jsx(Oe,{data:e,cx:"50%",cy:"50%",innerRadius:55,outerRadius:80,paddingAngle:3,dataKey:"value",children:e.map((e,a)=>t.jsx(Ue,{fill:s[a%s.length],stroke:"none"},`cell-${a}`))}),t.jsx(_e,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>a(e)}),t.jsx(Ke,{verticalAlign:"bottom",height:36,iconType:"circle",iconSize:8,wrapperStyle:{fontSize:"11px"}})]})})})}),ms=({riskProfile:e,riskData:s,loadingRisk:a,riskError:r,onRefreshRisk:n,formatCurrency:i,t:l})=>t.jsx(ts,{className:"lg:col-span-2 min-w-0",title:l("riskAnalysis"),children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-full",children:[t.jsx("div",{className:"h-[240px] min-w-0 flex flex-col justify-center",children:t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(ze,{children:[t.jsx(Oe,{data:e,cx:"50%",cy:"50%",startAngle:180,endAngle:0,innerRadius:60,outerRadius:90,dataKey:"value",paddingAngle:2,children:e.map((e,s)=>t.jsx(Ue,{fill:e.color,stroke:"none"},`cell-risk-${s}`))}),t.jsx(Ke,{verticalAlign:"bottom",iconType:"circle",iconSize:8,wrapperStyle:{fontSize:"11px"}}),t.jsx(_e,{formatter:e=>i(e),contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}})]})})}),t.jsx("div",{className:"flex flex-col justify-center pr-2 py-2",children:t.jsxs("div",{className:"bg-slate-50/50 rounded-2xl p-5 border border-slate-100 h-full flex flex-col relative overflow-hidden",children:[t.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-5",children:t.jsx(c,{size:64,className:"text-purple-600"})}),t.jsxs("div",{className:"flex items-center justify-between mb-4 relative z-10",children:[t.jsxs("h4",{className:"font-semibold text-slate-700 flex items-center gap-2 text-sm",children:[t.jsx("div",{className:"p-1.5 bg-purple-100 text-purple-600 rounded-lg",children:t.jsx(c,{size:14})}),l("aiAssessment")]}),s&&t.jsx("button",{onClick:n,disabled:a,className:"p-1.5 hover:bg-white hover:shadow-sm rounded-lg text-slate-400 hover:text-purple-600 transition-all",title:l("recalculate"),children:t.jsx(K,{size:14,className:a?"animate-spin":""})})]}),t.jsx("div",{className:"flex-1 flex flex-col justify-center relative z-10",children:r?t.jsxs("div",{className:"text-xs text-red-500 bg-red-50 p-3 rounded-lg border border-red-100 text-center",children:[l("unableToGenerate")," ",l("apiKeyMissing")]}):a&&!s?t.jsxs("div",{className:"space-y-3 animate-pulse px-1",children:[t.jsx("div",{className:"h-2 bg-slate-200 rounded w-full"}),t.jsx("div",{className:"h-2 bg-slate-200 rounded w-3/4"}),t.jsx("div",{className:"h-2 bg-slate-200 rounded w-5/6"})]}):s?t.jsxs("div",{className:"animate-fade-in",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("span",{className:"text-xs font-bold px-2.5 py-1 rounded-full border "+(s.riskScore>7?"bg-red-50 text-red-600 border-red-100":s.riskScore>4?"bg-orange-50 text-orange-600 border-orange-100":"bg-green-50 text-green-600 border-green-100"),children:s.riskLevel}),t.jsxs("div",{className:"text-right",children:[t.jsx("span",{className:"text-sm font-bold text-slate-800",children:s.riskScore}),t.jsx("span",{className:"text-xs text-slate-400",children:"/10"})]})]}),t.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden mb-4",children:t.jsx("div",{className:"h-full rounded-full transition-all duration-1000 ease-out "+(s.riskScore>7?"bg-red-500":s.riskScore>4?"bg-orange-500":"bg-green-500"),style:{width:10*s.riskScore+"%"}})}),t.jsxs("div",{className:"text-xs text-slate-600 leading-relaxed italic relative pl-3",children:[t.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-0.5 bg-purple-200 rounded-full"}),s.analysis]})]}):t.jsx("div",{className:"text-center",children:t.jsxs("button",{onClick:n,className:"px-5 py-2.5 bg-white hover:bg-purple-50 text-purple-600 border border-purple-100 hover:border-purple-200 text-sm font-medium rounded-xl transition-all shadow-sm hover:shadow flex items-center gap-2 mx-auto group",children:[t.jsx(Y,{size:16,className:"group-hover:fill-purple-600 transition-colors"}),l("startRiskAnalysis")]})})})]})})]})}),xs=({topAssets:e,pnlRanking:s,liabilityDistribution:a,formatCurrency:r,isPrivacyMode:n,t:i})=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(ts,{title:i("costVsValue"),className:"min-w-0",children:t.jsx("div",{className:"h-[250px] w-full min-w-0",children:t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(Ee,{data:e,layout:"vertical",margin:{left:0,right:10,top:0,bottom:0},barGap:2,children:[t.jsx(ke,{strokeDasharray:"3 3",horizontal:!1,stroke:"#f1f5f9"}),t.jsx(Pe,{type:"number",tickFormatter:r,hide:!0}),t.jsx(Le,{dataKey:"name",type:"category",width:50,tick:{fontSize:11,fill:"#64748b"},interval:0}),t.jsx(_e,{cursor:{fill:"transparent"},contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>r(e)}),t.jsx(Ke,{iconSize:8,wrapperStyle:{fontSize:"11px"}}),t.jsx(Re,{dataKey:"cost",name:i("label_cost"),fill:"#cbd5e1",radius:[0,3,3,0],barSize:8}),t.jsx(Re,{dataKey:"value",name:i("label_value"),fill:"#3b82f6",radius:[0,3,3,0],barSize:8})]})})})}),t.jsx(ts,{title:i("topMovers"),className:"min-w-0",children:t.jsx("div",{className:"h-[250px] w-full min-w-0",children:t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(Ee,{data:s,margin:{top:20,bottom:0},children:[t.jsx(ke,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),t.jsx(Pe,{dataKey:"name",tick:{fontSize:11,fill:"#64748b"},axisLine:!1,tickLine:!1}),t.jsx(Le,{hide:!0}),t.jsx(_e,{cursor:{fill:"#f8fafc"},contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>r(e)}),t.jsxs(Re,{dataKey:"pnl",name:i("label_net_pnl"),radius:[4,4,0,0],children:[s.map((e,s)=>t.jsx(Ue,{fill:e.pnl>=0?"#10b981":"#ef4444"},`cell-pnl-${s}`)),!n&&t.jsx(Me,{dataKey:"pnl",position:"top",formatter:e=>new Intl.NumberFormat("en-US",{notation:"compact"}).format(e),style:{fontSize:"10px",fill:"#94a3b8"}})]}),t.jsx(qe,{y:0,stroke:"#cbd5e1"})]})})})}),a.length>0&&t.jsx(ts,{title:i("liabilityBreakdown"),className:"md:col-span-2 min-w-0",children:t.jsx("div",{className:"h-[180px] w-full flex items-center justify-center min-w-0",children:t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(ze,{children:[t.jsx(Oe,{data:a,cx:"50%",cy:"50%",innerRadius:50,outerRadius:70,paddingAngle:5,dataKey:"value",children:a.map((e,s)=>t.jsx(Ue,{fill:s%2==0?"#ef4444":"#f87171",stroke:"none"},`cell-liab-${s}`))}),t.jsx(_e,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>r(e)}),t.jsx(Ke,{iconSize:8,wrapperStyle:{fontSize:"11px"},layout:"vertical",align:"right",verticalAlign:"middle"})]})})})})]}),ps=["#0ea5e9","#8b5cf6","#10b981","#f59e0b","#ef4444","#6366f1","#f97316"],hs={High:"#ef4444",Medium:"#f59e0b",Low:"#10b981"},gs=()=>{const{assets:s,settings:r,exchangeRates:n,t:i}=Ct(),[l,o]=e.useState(null),[c,d]=e.useState(!1),[u,m]=e.useState(!1),x=e=>r.isPrivacyMode?"••••••":new Intl.NumberFormat("en-US",{style:"currency",currency:r.baseCurrency,notation:"compact"}).format(e),p=e.useMemo(()=>{const e={};return s.forEach(t=>{if(t.type===Ye.LIABILITY)return;const s=t.quantity*t.currentPrice,a=ft(s,t.currency,r.baseCurrency,n);e[t.type]=(e[t.type]||0)+a}),Object.entries(e).map(([e,t])=>({name:i(`type_${e.toLowerCase()}`),value:t})).sort((e,t)=>t.value-e.value)},[s,r.baseCurrency,n,i]),h=e.useMemo(()=>s.filter(e=>e.type===Ye.LIABILITY).map(e=>{const t=e.quantity*e.currentPrice,s=ft(t,e.currency,r.baseCurrency,n);return{name:e.name||e.symbol,value:s}}).sort((e,t)=>t.value-e.value),[s,r.baseCurrency,n]),g=e.useMemo(()=>{let e=0,t=0;return s.forEach(s=>{const a=s.quantity*s.currentPrice,i=ft(a,s.currency,r.baseCurrency,n);s.type===Ye.LIABILITY?t+=i:e+=i}),{data:[{name:i("label_assets"),value:e,fill:"#10b981"},{name:i("label_liabilities"),value:t,fill:"#ef4444"}],totalAssets:e,totalLiabilities:t,ratio:e>0?t/e*100:0}},[s,r.baseCurrency,n,i]),b=e.useMemo(()=>[...s].filter(e=>e.type!==Ye.LIABILITY).map(e=>{const t=ft(e.quantity*e.currentPrice,e.currency,r.baseCurrency,n),s=ft(e.quantity*e.avgCost,e.currency,r.baseCurrency,n);return{name:e.symbol,value:t,cost:s,pnl:t-s}}).sort((e,t)=>t.value-e.value).slice(0,6),[s,r.baseCurrency,n]),f=e.useMemo(()=>{let e=0,t=0,a=0;s.forEach(s=>{if(s.type===Ye.LIABILITY)return;const i=s.quantity*s.currentPrice,l=ft(i,s.currency,r.baseCurrency,n),o=cs(s);o===is.HIGH?e+=l:o===is.MEDIUM?t+=l:a+=l});return 0===e+t+a?[]:[{name:i("risk_high"),value:e,color:hs.High},{name:i("risk_medium"),value:t,color:hs.Medium},{name:i("risk_low"),value:a,color:hs.Low}].filter(e=>e.value>0)},[s,r.baseCurrency,n,i]),y=e.useMemo(()=>[...s].filter(e=>e.type!==Ye.LIABILITY).map(e=>{const t=ft(e.quantity*e.currentPrice,e.currency,r.baseCurrency,n)-ft(e.quantity*e.avgCost,e.currency,r.baseCurrency,n);return{name:e.symbol,pnl:t}}).sort((e,t)=>t.pnl-e.pnl).slice(0,8),[s,r.baseCurrency,n]);return 0===s.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-96 text-slate-400",children:[t.jsx(A,{size:48,className:"mb-4 opacity-50"}),t.jsx("p",{children:i("noAssetsAnalytics")})]}):t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsx("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-2 mb-2",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:i("analytics")}),t.jsx("p",{className:"text-slate-500 text-sm",children:i("analyticsSubtitle")})]})}),t.jsx(ds,{data:g.data,ratio:g.ratio,formatCurrency:x,isPrivacyMode:r.isPrivacyMode,t:i}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx(us,{data:p,colors:ps,formatCurrency:x,t:i}),t.jsx(ms,{riskProfile:f,riskData:l,loadingRisk:c,riskError:u,onRefreshRisk:async()=>{if(0===s.length)return;const e="deepseek"===r.aiProvider?r.deepSeekApiKey:r.geminiApiKey;if(e){d(!0),m(!1);try{const t=await(async(e,t,s,r="en",n=!1)=>{if(!t)throw new Error("API Key is missing");if(0===e.length)return null;const i=`${Ht(e)}:${r}:${s}`,l=Date.now();if(!n){const e=et.getCache(qt);if(e){const{timestamp:t,data:{hash:s,data:a}}=e;if(s===i&&l-t<36e5)return a}}if(Bt&&Bt.hash===i&&!n)return Bt.promise;const o=(async()=>{const n=e.map(e=>({type:e.type,val:(e.quantity*e.currentPrice).toFixed(0)})),l="zh"===r?"Chinese":"English",o=`\n      Analyze the risk profile of this portfolio: ${JSON.stringify(n)}.\n      \n      **PRIVACY RULE**: Do not mention specific monetary amounts in the 'analysis' text. Use percentages or general terms.\n\n      Classify assets by risk level:\n      - High Risk: Altcoins and volatile cryptocurrencies (excluding stablecoins and BTC/ETH)\n      - Medium Risk: Stocks, Funds, Major Cryptocurrencies (BTC, ETH)\n      - Low/Stable Risk: Cash, Real Estate, Stablecoins (USDT, USDC, DAI, BUSD, etc.)\n      - Liability: Debt (increases overall risk profile if high)\n      \n      Return JSON with a riskScore (1-10) and a brief analysis in ${l}.\n      \n      The JSON keys must be: "riskScore", "riskLevel", "analysis".\n    `,c={type:a.OBJECT,properties:{riskScore:{type:a.NUMBER,description:"1-10 Score (10 is Aggressive)"},riskLevel:{type:a.STRING,description:"Conservative, Balanced, Aggressive"},analysis:{type:a.STRING,description:`Max 60 words summary in ${l}, no specific dollar/currency amounts.`}},required:["riskScore","riskLevel","analysis"]},d=Kt.create(s,t),u=await d.generateJSON(o,c);return et.saveCache(qt,{hash:i,data:u}),u})();Bt={hash:i,promise:o};try{return await o}finally{Bt=null}})(s,e,r.aiProvider,r.language,!0);o(t)}catch(t){m(!0)}finally{d(!1)}}else m(!0)},formatCurrency:x,t:i})]}),t.jsx(xs,{topAssets:b,pnlRanking:y,liabilityDistribution:h,formatCurrency:x,isPrivacyMode:r.isPrivacyMode,t:i})]})},bs=()=>{const{assets:s,transactions:a,settings:r,updateSettings:n,importAssetsCSV:i,importTransactionsCSV:l,clearData:o,t:c}=Ct(),[u,m]=e.useState(null),[x,p]=e.useState(!1),h=e.useRef(null),[g,b]=e.useState(!1),[f,y]=e.useState(!1),[v,j]=e.useState(!1),[N,w]=e.useState(!1),S=e=>{if(null==e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t},A=e=>{const t=parseFloat(e);return isNaN(t)?0:t},T=e=>{const t=[];let s=0,a=!1;for(let n=0;n<e.length;n++)if('"'===e[n])a=!a;else if(","===e[n]&&!a){let a=e.substring(s,n);a.startsWith('"')&&a.endsWith('"')&&(a=a.slice(1,-1).replace(/""/g,'"')),t.push(a),s=n+1}let r=e.substring(s);return r.startsWith('"')&&r.endsWith('"')&&(r=r.slice(1,-1).replace(/""/g,'"')),t.push(r),t};return t.jsxs("div",{className:"space-y-6 animate-fade-in max-w-3xl mx-auto",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:c("settings")}),t.jsx("p",{className:"text-slate-500",children:c("managePreferences")})]})}),t.jsx(ts,{title:c("privacyDataManagement"),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"p-3 rounded-xl transition-all "+(r.isPrivacyMode?"bg-indigo-600 text-white shadow-md shadow-indigo-200":"bg-slate-100 text-slate-400"),children:r.isPrivacyMode?t.jsx(H,{size:24}):t.jsx(V,{size:24})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-slate-800 text-base",children:c("privacyMode")}),t.jsx("div",{className:"text-sm text-slate-500 mt-1 max-w-sm leading-relaxed",children:c("privacyModeDesc")})]})]}),t.jsx("button",{onClick:()=>n({isPrivacyMode:!r.isPrivacyMode}),className:"relative w-14 h-8 rounded-full transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 "+(r.isPrivacyMode?"bg-indigo-600":"bg-slate-200"),children:t.jsx("span",{className:"absolute top-1 left-1 bg-white w-6 h-6 rounded-full shadow-sm transform transition-transform duration-200 ease-in-out "+(r.isPrivacyMode?"translate-x-6":"translate-x-0")})})]}),t.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 rounded-xl p-4 flex items-start gap-3",children:[t.jsx(W,{size:20,className:"text-emerald-600 mt-0.5 shrink-0"}),t.jsx("span",{className:"text-sm text-emerald-800 leading-relaxed font-medium",children:c("localDataSecurity")})]}),t.jsx("div",{className:"border-t border-slate-200 my-4"}),u&&t.jsxs("div",{className:"p-3 rounded-lg text-sm flex items-center gap-2 "+("success"===u.type?"bg-green-50 text-green-700":"error"===u.type?"bg-red-50 text-red-700":"bg-orange-50 text-orange-700"),children:["success"===u.type?t.jsx(G,{size:16}):t.jsx(E,{size:16}),u.msg]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"group bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100 rounded-xl p-5 hover:shadow-md hover:border-blue-200 transition-all",children:[t.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[t.jsx("div",{className:"p-2.5 bg-blue-500 text-white rounded-lg group-hover:bg-blue-600 transition-colors shadow-sm",children:t.jsx(J,{size:20})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-slate-800 text-sm mb-1",children:c("exportUnified")}),t.jsx("div",{className:"text-xs text-slate-600 leading-relaxed",children:c("exportUnifiedDesc")})]})]}),t.jsxs("button",{onClick:()=>{const e=a.map(e=>{const t=s.find(t=>t.id===e.assetId),a=`\t${e.assetId}`,r=`\t${(null==t?void 0:t.symbol)||"UNKNOWN"}`;return[e.id,e.date,e.type,e.quantityChange,e.pricePerUnit,e.fee,e.total,e.note||"",a,r,(null==t?void 0:t.name)||"Unknown Asset",(null==t?void 0:t.type)||Ye.OTHER,(null==t?void 0:t.currency)||He.USD,(null==t?void 0:t.currentPrice)||0,(null==t?void 0:t.dateAcquired)||""].map(S).join(",")});((e,t)=>{const s=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.setAttribute("download",t),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)})([["tx_id","tx_date","tx_type","tx_quantity","tx_price","tx_fee","tx_total","tx_note","asset_id","asset_symbol","asset_name","asset_type","asset_currency","asset_current_price","asset_date_acquired"].join(","),...e].join("\n"),`panasset_full_data_${(new Date).toISOString().split("T")[0]}.csv`)},className:"w-full py-2.5 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors text-sm shadow-sm flex items-center justify-center gap-2",children:[t.jsx(Q,{size:16}),c("exportUnified")]})]}),t.jsxs("div",{className:"group bg-gradient-to-br from-emerald-50 to-teal-50 border border-emerald-100 rounded-xl p-5 hover:shadow-md hover:border-emerald-200 transition-all",children:[t.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[t.jsx("div",{className:"p-2.5 bg-emerald-500 text-white rounded-lg group-hover:bg-emerald-600 transition-colors shadow-sm",children:t.jsx(X,{size:20})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-slate-800 text-sm mb-1",children:c("importData")}),t.jsx("div",{className:"text-xs text-slate-600 leading-relaxed",children:c("importHint")})]})]}),t.jsxs("button",{onClick:()=>{var e;null==(e=h.current)||e.click()},className:"w-full py-2.5 px-4 bg-emerald-600 hover:bg-emerald-700 text-white font-medium rounded-lg transition-colors text-sm shadow-sm flex items-center justify-center gap-2",children:[t.jsx(X,{size:16}),c("uploadCSV")]}),t.jsx("input",{type:"file",accept:".csv",ref:h,onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;const a=new FileReader;a.onload=e=>{var t;try{const s=(null==(t=e.target)?void 0:t.result).split(/\r?\n/).filter(e=>""!==e.trim());if(s.length<2)throw new Error("File is empty or invalid");const a=T(s[0]).map(e=>e.trim());if(!a.includes("tx_id")||!a.includes("asset_id"))throw new Error("Invalid CSV format. Please use the Unified Export format.");const r=new Map,n=[];s.slice(1).forEach(e=>{const t=T(e),s=e=>{const s=a.indexOf(e);return-1!==s?t[s]:""};let i=s("asset_id");if(i.startsWith("\t")&&(i=i.substring(1)),!i)return;let l=s("asset_symbol")||"UNKNOWN";l.startsWith("\t")&&(l=l.substring(1)),r.has(i)||r.set(i,{id:i,symbol:l,name:s("asset_name")||"Unknown",type:s("asset_type")||Ye.OTHER,currency:s("asset_currency")||He.USD,currentPrice:A(s("asset_current_price")),dateAcquired:s("asset_date_acquired"),lastUpdated:Date.now()});const o=s("tx_id")||crypto.randomUUID();n.push({id:o,assetId:i,type:s("tx_type")||Ve.BUY,date:s("tx_date")||(new Date).toISOString(),quantityChange:A(s("tx_quantity")),pricePerUnit:A(s("tx_price")),fee:A(s("tx_fee")),total:A(s("tx_total")),note:s("tx_note")})});const o=Array.from(r.values()),d=n;i(o),l(d),m({msg:`${c("importSuccess")} (${o.length} Assets, ${d.length} Txs)`,type:"success"}),setTimeout(()=>m(null),5e3)}catch(s){m({msg:c("importError"),type:"error"})}},a.readAsText(s),e.target.value=""},className:"hidden"})]})]}),t.jsx("div",{className:"border-t border-slate-100 my-2"}),t.jsxs("button",{onClick:()=>p(!0),className:"w-full flex items-center justify-center gap-2 p-3 text-red-600 hover:bg-red-50 rounded-xl transition-colors text-sm font-medium",children:[t.jsx(d,{size:16}),c("resetData")]})]})}),t.jsx(ts,{title:c("apiConfiguration"),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 bg-slate-100 text-slate-600 rounded-lg mt-1",children:t.jsx(Z,{size:20})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:c("aiProvider")}),t.jsx("div",{className:"text-sm text-slate-500 mb-3",children:c("aiProviderDesc")}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md",children:[t.jsx("label",{className:"border rounded-xl p-4 cursor-pointer transition-all "+("gemini"===r.aiProvider?"border-purple-500 bg-purple-50":"border-slate-200 hover:border-purple-200"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"radio",name:"aiProvider",checked:"gemini"===r.aiProvider,onChange:()=>n({aiProvider:"gemini"}),className:"w-4 h-4 text-purple-600 focus:ring-purple-500"}),t.jsx("span",{className:"font-medium text-slate-800",children:"Google Gemini"})]})}),t.jsx("label",{className:"border rounded-xl p-4 cursor-pointer transition-all "+("deepseek"===r.aiProvider?"border-blue-500 bg-blue-50":"border-slate-200 hover:border-blue-200"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"radio",name:"aiProvider",checked:"deepseek"===r.aiProvider,onChange:()=>n({aiProvider:"deepseek"}),className:"w-4 h-4 text-blue-600 focus:ring-blue-500"}),t.jsx("span",{className:"font-medium text-slate-800",children:"DeepSeek"})]})})]})]})]}),t.jsx("div",{className:"border-t border-slate-100 pt-4"}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 bg-purple-50 text-purple-600 rounded-lg mt-1",children:t.jsx(ee,{size:20})}),t.jsx("div",{className:"flex-1",children:"gemini"===r.aiProvider?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:c("geminiKey")}),t.jsxs("div",{className:"text-sm text-slate-500 mb-3 bg-blue-50 p-3 rounded-lg border border-blue-100",children:[c("geminiKeyDesc"),t.jsx("div",{className:"mt-1",children:t.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline font-medium",children:c("getKey")})})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:g?"text":"password",name:"gemini_api_key_field",autoComplete:"off",placeholder:"Paste your Gemini API Key here...",value:r.geminiApiKey,onChange:e=>n({geminiApiKey:e.target.value}),className:"w-full p-3 pr-10 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-mono"}),t.jsx("button",{type:"button",onClick:()=>b(!g),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:g?t.jsx(H,{size:18}):t.jsx(V,{size:18})})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:c("deepSeekKey")}),t.jsxs("div",{className:"text-sm text-slate-500 mb-3 bg-blue-50 p-3 rounded-lg border border-blue-100",children:[c("deepSeekKeyDesc"),t.jsx("div",{className:"mt-1",children:t.jsx("a",{href:"https://platform.deepseek.com/api_keys",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline font-medium",children:c("getKey")})})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:f?"text":"password",name:"deepseek_api_key_field",autoComplete:"off",placeholder:"Paste your DeepSeek API Key here...",value:r.deepSeekApiKey,onChange:e=>n({deepSeekApiKey:e.target.value}),className:"w-full p-3 pr-10 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-mono"}),t.jsx("button",{type:"button",onClick:()=>y(!f),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:f?t.jsx(H,{size:18}):t.jsx(V,{size:18})})]})]})})]}),t.jsx("div",{className:"border-t border-slate-100 pt-4"}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 bg-slate-100 text-slate-600 rounded-lg mt-1",children:t.jsx(te,{size:20})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:c("marketDataProvider")}),t.jsx("div",{className:"text-sm text-slate-500 mb-3",children:c("marketDataProviderDesc")}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md",children:[t.jsx("label",{className:"border rounded-xl p-4 cursor-pointer transition-all "+("finnhub"===r.marketDataProvider?"border-teal-500 bg-teal-50":"border-slate-200 hover:border-teal-200"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"radio",name:"marketDataProvider",checked:"finnhub"===r.marketDataProvider,onChange:()=>n({marketDataProvider:"finnhub"}),className:"w-4 h-4 text-teal-600 focus:ring-teal-500"}),t.jsx("span",{className:"font-medium text-slate-800",children:"Finnhub"})]})}),t.jsx("label",{className:"border rounded-xl p-4 cursor-pointer transition-all "+("alphavantage"===r.marketDataProvider?"border-orange-500 bg-orange-50":"border-slate-200 hover:border-orange-200"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"radio",name:"marketDataProvider",checked:"alphavantage"===r.marketDataProvider,onChange:()=>n({marketDataProvider:"alphavantage"}),className:"w-4 h-4 text-orange-600 focus:ring-orange-500"}),t.jsx("span",{className:"font-medium text-slate-800",children:"Alpha Vantage"})]})})]})]})]}),t.jsx("div",{className:"border-t border-slate-100 pt-4"}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 bg-slate-50 text-slate-500 rounded-lg mt-1",children:t.jsx(ee,{size:20})}),t.jsx("div",{className:"flex-1",children:"finnhub"===r.marketDataProvider?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:c("finnhubKey")}),t.jsxs("div",{className:"text-sm text-slate-500 mb-3",children:[c("finnhubKeyDesc"),t.jsx("a",{href:"https://finnhub.io/",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline ml-1",children:c("getKey")}),"."]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:v?"text":"password",name:"finnhub_api_key_field",autoComplete:"off",placeholder:"Paste your Finnhub API Key here...",value:r.finnhubApiKey,onChange:e=>n({finnhubApiKey:e.target.value}),className:"w-full p-3 pr-10 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-mono"}),t.jsx("button",{type:"button",onClick:()=>j(!v),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:v?t.jsx(H,{size:18}):t.jsx(V,{size:18})})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium text-slate-800 mb-1",children:c("alphaVantageKey")}),t.jsxs("div",{className:"text-sm text-slate-500 mb-3",children:[c("alphaVantageKeyDesc"),t.jsx("a",{href:"https://www.alphavantage.co/support/#api-key",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline ml-1",children:c("getKey")}),"."]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:N?"text":"password",name:"alphavantage_api_key_field",autoComplete:"off",placeholder:"Paste your Alpha Vantage API Key here...",value:r.alphaVantageApiKey,onChange:e=>n({alphaVantageApiKey:e.target.value}),className:"w-full p-3 pr-10 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-mono"}),t.jsx("button",{type:"button",onClick:()=>w(!N),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:N?t.jsx(H,{size:18}):t.jsx(V,{size:18})})]})]})})]}),t.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-3 flex items-start gap-3 mt-4",children:[t.jsx(W,{size:16,className:"text-slate-400 mt-0.5 shrink-0"}),t.jsx("span",{className:"text-sm text-slate-500 leading-relaxed",children:c("apiKeysSecurity")})]})]})}),t.jsx(ts,{title:c("generalPreferences"),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-slate-50 last:border-0 last:pb-0",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-50 text-blue-600 rounded-lg",children:t.jsx(se,{size:20})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-slate-800",children:c("baseCurrency")}),t.jsx("div",{className:"text-sm text-slate-500",children:c("baseCurrencyDesc")})]})]}),t.jsxs("select",{value:r.baseCurrency,onChange:e=>n({baseCurrency:e.target.value}),className:"bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 outline-none min-w-[120px]",children:[t.jsx("option",{value:He.USD,children:"USD ($)"}),t.jsx("option",{value:He.CNY,children:"CNY (¥)"}),t.jsx("option",{value:He.HKD,children:"HKD ($)"})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-emerald-50 text-emerald-600 rounded-lg",children:t.jsx(ae,{size:20})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-slate-800",children:c("language")}),t.jsx("div",{className:"text-sm text-slate-500",children:c("languageDesc")})]})]}),t.jsxs("select",{value:r.language,onChange:e=>n({language:e.target.value}),className:"bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 outline-none min-w-[120px]",children:[t.jsx("option",{value:"en",children:"English"}),t.jsx("option",{value:"zh",children:"中文 (简体)"})]})]})]})}),t.jsx(ts,{title:c("feedback"),children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2.5 bg-slate-100 text-slate-700 rounded-lg shrink-0",children:t.jsx(re,{size:22})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-slate-800",children:c("reportBug")}),t.jsx("div",{className:"text-sm text-slate-500",children:c("githubDesc")})]})]}),t.jsxs("a",{href:"https://github.com/kuka36/PanassetLite/issues",target:"_blank",rel:"noreferrer",className:"px-4 py-2.5 bg-slate-800 hover:bg-slate-900 text-white text-sm font-medium rounded-lg transition-colors flex items-center justify-center gap-2 shrink-0",children:[t.jsx(re,{size:16}),t.jsx("span",{children:c("githubLinkText")}),t.jsx(ne,{size:14,className:"opacity-70"})]})]})}),t.jsx(ss,{isOpen:x,onClose:()=>p(!1),onConfirm:()=>{o(),m({msg:c("resetSuccess"),type:"success"}),setTimeout(()=>m(null),3e3)},title:c("resetData"),message:c("resetConfirm"),confirmText:c("resetData"),isDanger:!0}),t.jsx("div",{className:"text-center text-slate-400 text-sm pt-4",children:"zh"===r.language?"盘资产·轻 v1.2.1 • 本地数据存储":"PanassetLite v1.2.1 • Local Data Storage"})]})},fs=({asset:s,settings:a,exchangeRates:r,onEdit:n,onTransaction:i,onDelete:l,recentReturn:o,t:c})=>{const{updateAssetPrice:m}=Ct(),[x,p]=e.useState(null),[h,g]=e.useState(""),b=e=>{switch(e){case Ye.STOCK:return"bg-blue-100 text-blue-700";case Ye.CRYPTO:return"bg-purple-100 text-purple-700";case Ye.FUND:return"bg-orange-100 text-orange-700";case Ye.CASH:return"bg-green-100 text-green-700";case Ye.REAL_ESTATE:return"bg-amber-100 text-amber-800";case Ye.LIABILITY:return"bg-red-100 text-red-700";default:return"bg-slate-100 text-slate-700"}},f=e=>e===Ye.STOCK||e===Ye.CRYPTO||e===Ye.FUND,y=e=>{switch(e){case He.USD:return"$";case He.CNY:return"¥";case He.HKD:return"HK$";default:return"$"}},v=e=>{const t=parseFloat(h);isNaN(t)||(m(e,t),p(null))},j=e=>{if(!e)return"N/A";return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},N=y(s.currency),w=y(a.baseCurrency),A=s.quantity*s.currentPrice,T=ft(A,s.currency,a.baseCurrency,r),D=s.quantity*s.avgCost,C=A-D,I=D>0?C/D*100:0,E=s.type===Ye.LIABILITY,k=(P=s.type)===Ye.REAL_ESTATE||P===Ye.LIABILITY||P===Ye.OTHER||P===Ye.CASH;var P;const L=x===s.id,_=f(s.type),R=(e=>{if(!f(e.type))return!1;return Date.now()-(e.lastUpdated||0)>18e5})(s),U=()=>t.jsxs("div",{className:"md:hidden p-4 border-b border-slate-100 hover:bg-slate-50/50 transition-colors",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shrink-0 ${b(s.type)}`,children:s.symbol.substring(0,1)}),t.jsxs("div",{className:"min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"font-bold text-slate-800 text-base",children:s.symbol}),t.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-slate-100 text-slate-500 rounded",children:s.currency})]}),t.jsx("div",{className:"text-xs text-slate-400 truncate max-w-[180px]",children:s.name})]})]}),t.jsx("div",{className:"flex items-center gap-1 shrink-0",children:_?R?t.jsx("span",{className:"text-[10px] text-amber-600 flex items-center gap-1 bg-amber-50 px-1.5 py-0.5 rounded border border-amber-100",children:t.jsx(ie,{size:10})}):t.jsx("span",{className:"text-[10px] text-green-600 flex items-center gap-1 bg-green-50 px-1.5 py-0.5 rounded border border-green-100",children:t.jsx(le,{size:10})}):t.jsx("span",{className:"text-[10px] text-slate-400 flex items-center gap-1 bg-slate-100 px-1.5 py-0.5 rounded border border-slate-200",children:t.jsx(oe,{size:10})})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-slate-400 uppercase mb-1",children:c("currentPrice")}),t.jsxs("div",{className:"font-semibold text-slate-700",children:[N,s.currentPrice.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-slate-400 uppercase mb-1",children:c("avgCost")}),t.jsx("div",{className:"font-semibold text-slate-700",children:a.isPrivacyMode?"••••••":`${N}${s.avgCost.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4})}`})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-slate-400 uppercase mb-1",children:c("holdings")}),t.jsx("div",{className:"font-semibold text-slate-700",children:a.isPrivacyMode?"••••••":s.quantity.toLocaleString(void 0,{maximumFractionDigits:4})})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-slate-400 uppercase mb-1",children:c("value")}),t.jsx("div",{className:"font-bold "+(E?"text-red-700":"text-slate-800"),children:a.isPrivacyMode?"••••••":`${E?"-":""}${w}${T.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:1})}`})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-slate-400 uppercase mb-1",children:c("recentReturn")}),null!=o?t.jsxs("div",{className:"font-semibold "+(o>0?"text-green-600":o<0?"text-red-500":"text-slate-500"),children:[o>0?"+":"",(100*o).toFixed(2),"%"]}):t.jsx("span",{className:"text-slate-300 font-medium",children:"-"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-slate-400 uppercase mb-1",children:c("statusPnL")}),k&&!C?t.jsx("div",{className:"text-xs font-medium text-slate-500",children:j(s.lastUpdated)}):a.isPrivacyMode?t.jsx("span",{className:"text-slate-400 font-bold tracking-widest",children:"••••••"}):t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-1 font-semibold "+(C>=0?"text-green-600":"text-red-500"),children:[C>=0?t.jsx(u,{size:14}):t.jsx(ce,{size:14}),Math.abs(I).toFixed(2),"%"]}),t.jsxs("div",{className:"text-xs "+(C>=0?"text-green-600/70":"text-red-500/70"),children:[C>=0?"+":"-",N,Math.abs(C).toLocaleString(void 0,{maximumFractionDigits:0})]})]})]})]}),(n||i)&&t.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-slate-100",children:[i&&t.jsxs("button",{onClick:()=>i(s),className:"flex items-center gap-1.5 px-3 py-1.5 text-sm text-green-600 hover:bg-green-50 rounded-lg transition-colors",children:[t.jsx(q,{size:16}),t.jsx("span",{children:c("recordTransaction")})]}),n&&t.jsxs("button",{onClick:()=>n(s),className:"flex items-center gap-1.5 px-3 py-1.5 text-sm text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:[t.jsx(de,{size:16}),t.jsx("span",{children:c("editDetails")})]}),l&&t.jsx("button",{onClick:()=>l(s.id,s.symbol),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:c("delete"),children:t.jsx(d,{size:16})})]})]}),M=()=>t.jsxs("tr",{className:"hidden md:table-row border-b border-slate-50 hover:bg-slate-50/50 transition-colors group",children:[t.jsx("td",{className:"py-4 pl-2",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold text-xs shrink-0 ${b(s.type)}`,children:s.symbol.substring(0,1)}),t.jsxs("div",{className:"min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"font-semibold text-slate-800",children:s.symbol}),t.jsx("span",{className:"text-[10px] px-1 py-0.5 bg-slate-100 text-slate-500 rounded",children:s.currency})]}),t.jsx("div",{className:"text-xs text-slate-400 truncate max-w-[120px]",children:s.name})]})]})}),t.jsx("td",{className:"py-4",children:L?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-slate-400 text-xs",children:N}),t.jsx("input",{type:"number",autoFocus:!0,className:"w-20 p-1 text-sm border border-blue-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",value:h,onChange:e=>g(e.target.value),onKeyDown:e=>{"Enter"===e.key&&v(s.id),"Escape"===e.key&&p(null)},onBlur:()=>v(s.id)})]}):t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"font-medium text-slate-700 flex items-center gap-2",children:[N,s.currentPrice.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:6}),n&&t.jsx("button",{onClick:()=>{return p((e=s).id),void g(e.currentPrice.toString());var e},className:"opacity-0 group-hover:opacity-100 transition-opacity text-slate-300 hover:text-blue-600",title:c("updatePrice"),children:t.jsx(S,{size:14})})]}),t.jsx("div",{className:"flex items-center gap-1 mt-1",children:_?R?t.jsxs("span",{className:"text-[10px] text-amber-600 flex items-center gap-1 bg-amber-50 px-1.5 py-0.5 rounded border border-amber-100",title:c("dataStale"),children:[t.jsx(ie,{size:10})," ",c("offline")]}):t.jsxs("span",{className:"text-[10px] text-green-600 flex items-center gap-1 bg-green-50 px-1.5 py-0.5 rounded border border-green-100",title:c("liveData"),children:[t.jsx(le,{size:10})," ",c("live")]}):t.jsxs("span",{className:"text-[10px] text-slate-400 flex items-center gap-1 bg-slate-100 px-1.5 py-0.5 rounded border border-slate-200",title:c("manualValuation"),children:[t.jsx(oe,{size:10})," ",c("manual")]})})]})}),t.jsx("td",{className:"py-4",children:t.jsx("div",{className:"font-medium text-slate-700",children:a.isPrivacyMode?"••••••":`${N}${s.avgCost.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:6})}`})}),t.jsx("td",{className:"py-4",children:t.jsx("div",{className:"font-medium text-slate-700",children:a.isPrivacyMode?"••••••":s.quantity.toLocaleString()})}),t.jsx("td",{className:"py-4 text-right pr-4",children:null!=o?t.jsxs("div",{className:"font-medium "+(o>0?"text-green-600":o<0?"text-red-500":"text-slate-500"),children:[o>0?"+":"",(100*o).toFixed(2),"%"]}):t.jsx("span",{className:"text-slate-300",children:"-"})}),t.jsx("td",{className:"py-4 text-right pr-2 font-bold "+(E?"text-red-700":"text-slate-800"),children:a.isPrivacyMode?"••••••":`${E?"-":""}${w}${T.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),t.jsx("td",{className:"py-4 text-right pr-2",children:k&&!C?t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"text-xs font-medium text-slate-500 bg-slate-100 inline-block px-2 py-0.5 rounded-md",children:[c("lastUpdated"),": ",j(s.lastUpdated)]})}):a.isPrivacyMode?t.jsx("div",{className:"text-right",children:t.jsx("span",{className:"text-slate-400 font-bold tracking-widest",children:"••••••"})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-end gap-1 font-medium "+(C>=0?"text-green-600":"text-red-500"),children:[C>=0?t.jsx(u,{size:14}):t.jsx(ce,{size:14}),Math.abs(I).toFixed(2),"%"]}),t.jsxs("div",{className:"text-xs "+(C>=0?"text-green-600/70":"text-red-500/70"),children:[C>=0?"+":"-",N,Math.abs(C).toLocaleString(void 0,{maximumFractionDigits:0})]})]})}),(n||i)&&t.jsx("td",{className:"py-4 text-right pr-2",children:t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[i&&t.jsx("button",{onClick:()=>i(s),className:"p-1.5 text-slate-400 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:c("recordTransaction"),children:t.jsx(q,{size:16})}),n&&t.jsx("button",{onClick:()=>n(s),className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:c("editDetails"),children:t.jsx(de,{size:16})}),l&&t.jsx("button",{onClick:()=>l(s.id,s.symbol),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:c("delete"),children:t.jsx(d,{size:16})})]})})]});return t.jsxs(t.Fragment,{children:[t.jsx(U,{}),t.jsx(M,{})]})},ys=({assetIds:s,title:a})=>{const{transactions:r,assets:n,deleteTransaction:i,settings:l,t:o}=Ct(),[c,m]=e.useState(null),[x,p]=e.useState(null),h=e=>{const t=n.find(t=>t.id===e);return t?{symbol:t.symbol,name:t.name,currency:t.currency}:{symbol:"UNKNOWN",name:"Deleted Asset",currency:He.USD}},g=e.useMemo(()=>r.filter(e=>!!e&&!(s&&s.length>0&&!s.includes(e.assetId))).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[r,s]),b=e=>{switch(e){case Ve.BUY:return"bg-blue-100 text-blue-700";case Ve.DEPOSIT:return"bg-blue-50 text-blue-600";case Ve.SELL:return"bg-purple-100 text-purple-700";case Ve.WITHDRAWAL:return"bg-purple-50 text-purple-600";case Ve.DIVIDEND:return"bg-green-100 text-green-700";case Ve.BORROW:return"bg-amber-100 text-amber-700";case Ve.REPAY:return"bg-indigo-100 text-indigo-700";case Ve.BALANCE_ADJUSTMENT:return"bg-slate-100 text-slate-700 border border-slate-200";default:return"bg-slate-100 text-slate-700"}},f=e=>{switch(e){case Ve.BUY:case Ve.DEPOSIT:return t.jsx($,{size:16});case Ve.SELL:case Ve.WITHDRAWAL:return t.jsx(u,{size:16});case Ve.DIVIDEND:return t.jsx(_,{size:16});case Ve.BORROW:return t.jsx(F,{size:16});case Ve.REPAY:return t.jsx(q,{size:16});case Ve.BALANCE_ADJUSTMENT:return t.jsx(K,{size:14});default:return null}},y=e=>{switch(e){case He.USD:return"$";case He.CNY:return"¥";case He.HKD:return"HK$";default:return"$"}},v=e=>{if(!e)return"-";try{return new Date(e).toLocaleString(void 0,{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e}};return 0===g.length?null:t.jsxs(t.Fragment,{children:[t.jsxs(ts,{title:a||o("transactionHistory"),className:"animate-slide-up",children:[t.jsx("div",{className:"md:hidden space-y-3",children:g.map(e=>{if(!e)return null;const s=h(e.assetId),a=y(s.currency),r=Number(e.pricePerUnit||0),n=Number(e.total||0),i=Number(e.quantityChange||0),c=e.type===Ve.BALANCE_ADJUSTMENT,u=c?i>0?`+${i.toLocaleString()}`:i.toLocaleString():Math.abs(i).toLocaleString(),x=c?i>=0?"text-green-600":"text-red-600":"text-slate-700";return t.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-100 relative group",children:[t.jsx("button",{onClick:()=>m(e.id),className:"absolute top-3 right-3 p-1.5 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:t.jsx(d,{size:16})}),t.jsx("button",{onClick:()=>p(e),className:"absolute top-3 right-10 p-1.5 text-slate-300 hover:text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",children:t.jsx(k,{size:16})}),t.jsx("div",{className:"flex justify-between items-start mb-2 pr-8",children:t.jsxs("div",{children:[t.jsxs("div",{className:"font-bold text-slate-800 text-lg flex items-center gap-2",children:[s.symbol,t.jsx("span",{className:"text-xs font-normal text-slate-400 bg-white px-1.5 py-0.5 rounded border border-slate-100",children:s.name})]}),t.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-500 mt-1",children:[t.jsx(P,{size:12}),v(e.date)]})]})}),t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-bold ${b(e.type)}`,children:[f(e.type),o(`tx_${e.type}`)||e.type]}),t.jsx("div",{className:"text-right",children:t.jsx("div",{className:"font-bold text-lg text-slate-800",children:l.isPrivacyMode?"••••••":`${a}${n.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`})})]}),t.jsxs("div",{className:"pt-3 border-t border-slate-200/50 flex justify-between items-center text-sm",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-xs text-slate-400 uppercase mb-0.5",children:o("quantity")}),t.jsx("span",{className:`font-mono font-medium ${x}`,children:l.isPrivacyMode?"••••••":u})]}),t.jsxs("div",{className:"flex flex-col text-right",children:[t.jsx("span",{className:"text-xs text-slate-400 uppercase mb-0.5",children:o("pricePerUnit")}),t.jsxs("span",{className:"font-mono text-slate-600",children:[a,r.toLocaleString()]})]})]})]},e.id)})}),t.jsx("div",{className:"hidden md:block overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-xs text-slate-400 uppercase border-b border-slate-100",children:[t.jsx("th",{className:"pb-3 pl-2 font-medium",children:o("date")}),t.jsx("th",{className:"pb-3 font-medium",children:o("asset")}),t.jsx("th",{className:"pb-3 font-medium",children:o("type")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:o("quantity")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:o("pricePerUnit")}),t.jsx("th",{className:"pb-3 font-medium text-right",children:o("fees")}),t.jsx("th",{className:"pb-3 font-medium text-right pr-2",children:o("total")}),t.jsx("th",{className:"pb-3 font-medium text-right pr-2",children:o("actions")})]})}),t.jsx("tbody",{className:"text-sm",children:g.map(e=>{if(!e)return null;const s=h(e.assetId),a=y(s.currency),r=Number(e.pricePerUnit||0),n=Number(e.fee||0),i=Number(e.total||0),c=Number(e.quantityChange||0),u=e.type===Ve.BALANCE_ADJUSTMENT,x=u?c>0?`+${c.toLocaleString()}`:c.toLocaleString():Math.abs(c).toLocaleString(),g=u?c>=0?"text-green-600 font-bold":"text-red-600 font-bold":"text-slate-700";return t.jsxs("tr",{className:"border-b border-slate-50 last:border-0 hover:bg-slate-50/50 transition-colors",children:[t.jsx("td",{className:"py-4 pl-2 text-slate-600 font-mono text-xs whitespace-nowrap",children:v(e.date)}),t.jsxs("td",{className:"py-4",children:[t.jsx("div",{className:"font-semibold text-slate-800",children:s.symbol}),t.jsx("div",{className:"text-xs text-slate-400 hidden sm:block",children:s.name})]}),t.jsx("td",{className:"py-4",children:t.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-medium ${b(e.type)}`,children:[f(e.type),o(`tx_${e.type}`)||e.type]})}),t.jsx("td",{className:`py-4 text-right font-medium ${g}`,children:l.isPrivacyMode?"••••••":"0"!==x?x:"-"}),t.jsxs("td",{className:"py-4 text-right text-slate-600 whitespace-nowrap",children:[a,r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),t.jsx("td",{className:"py-4 text-right text-slate-500 whitespace-nowrap",children:n>0?`${a}${n.toFixed(2)}`:"-"}),t.jsx("td",{className:"py-4 text-right pr-2 font-bold text-slate-800 whitespace-nowrap",children:l.isPrivacyMode?"••••••":`${a}${i.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),t.jsxs("td",{className:"py-4 text-right pr-2",children:[t.jsx("button",{onClick:()=>p(e),className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors mr-1",title:o("editTransaction"),children:t.jsx(k,{size:16})}),t.jsx("button",{onClick:()=>m(e.id),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:o("deleteTransaction"),children:t.jsx(d,{size:16})})]})]},e.id)})})]})})]}),t.jsx(ss,{isOpen:!!c,onClose:()=>m(null),onConfirm:()=>c&&i(c),title:o("deleteTransaction"),message:o("confirmDeleteTransaction"),confirmText:o("delete"),isDanger:!0}),t.jsx(as,{isOpen:!!x,onClose:()=>p(null),transaction:x})]})},vs=({assets:s,onEdit:a,onTransaction:r})=>{const{assets:n,transactions:i,deleteAsset:l,settings:o,exchangeRates:c,t:d}=Ct(),u=s||n,[m,x]=e.useState({key:"value",direction:"desc"}),[p,h]=e.useState(null),g=e=>{const t=i.filter(t=>t.assetId===e).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());if(t.length<2)return null;const s=t[0],a=t[1],r=u.find(t=>t.id===e);if(!r||0===r.quantity)return null;const n=s.quantityChange,l=Math.abs(new Date(s.date).getTime()-new Date(a.date).getTime())/864e5;if(0===l)return 0;return n/r.quantity/l*365},b=e.useMemo(()=>{const e=[...u];return e.sort((e,t)=>{let s=0,a=0;const r=e=>e.quantity*e.currentPrice-e.quantity*e.avgCost;switch(m.key){case"symbol":s=e.symbol.toLowerCase(),a=t.symbol.toLowerCase();break;case"price":s=e.currentPrice,a=t.currentPrice;break;case"cost":s=e.avgCost,a=t.avgCost;break;case"quantity":s=e.quantity,a=t.quantity;break;case"value":const n=ft(e.quantity*e.currentPrice,e.currency,o.baseCurrency,c),i=ft(t.quantity*t.currentPrice,t.currency,o.baseCurrency,c);s=e.type===Ye.LIABILITY?-n:n,a=t.type===Ye.LIABILITY?-i:i;break;case"pnl":s=r(e),a=r(t);break;case"recentReturn":s=g(e.id)||-1/0,a=g(t.id)||-1/0;break;default:return 0}return s<a?"asc"===m.direction?-1:1:s>a?"asc"===m.direction?1:-1:0}),e},[u,i,m,o.baseCurrency,c]),f=({label:e,sortKey:s,alignRight:a=!1,className:r=""})=>{return t.jsx("th",{className:`pb-3 font-medium cursor-pointer group select-none ${a?"text-right":"text-left"} ${a?"pr-2":"pl-2"} ${r}`,onClick:()=>{return e=s,void x(t=>({key:e,direction:t.key===e&&"desc"===t.direction?"asc":"desc"}));var e},children:t.jsxs("div",{className:`flex items-center gap-1 ${a?"justify-end":"justify-start"} text-slate-500 group-hover:text-blue-600 transition-colors`,children:[e,t.jsx("span",{className:"text-slate-400 group-hover:text-blue-500",children:(n=s,m.key!==n?t.jsx("div",{className:"w-3 h-3"}):"asc"===m.direction?t.jsx(ue,{size:12}):t.jsx(me,{size:12}))})]})});var n};return t.jsxs(t.Fragment,{children:[t.jsxs(ts,{title:d("portfolioHoldings"),className:"animate-slide-up",children:[t.jsx("div",{className:"hidden md:block overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-xs text-slate-400 uppercase border-b border-slate-100",children:[t.jsx(f,{label:d("asset"),sortKey:"symbol"}),t.jsx(f,{label:d("currentPrice"),sortKey:"price"}),t.jsx(f,{label:d("avgCost"),sortKey:"cost"}),t.jsx(f,{label:d("holdings"),sortKey:"quantity"}),t.jsx(f,{label:d("recentReturn"),sortKey:"recentReturn",alignRight:!0}),t.jsx(f,{label:d("value"),sortKey:"value",alignRight:!0}),t.jsx(f,{label:d("statusPnL"),sortKey:"pnl",alignRight:!0}),(a||r)&&t.jsx("th",{className:"pb-3 font-medium text-right pr-2",children:d("actions")})]})}),t.jsxs("tbody",{className:"text-sm",children:[b.map(e=>t.jsx(fs,{asset:e,settings:o,exchangeRates:c,onEdit:a,onTransaction:r,onDelete:(e,t)=>h({id:e,symbol:t}),recentReturn:g(e.id),t:d},e.id)),0===b.length&&t.jsx("tr",{children:t.jsx("td",{colSpan:a?8:7,className:"text-center py-8 text-slate-400 italic",children:d("noAssets")})})]})]})}),t.jsxs("div",{className:"md:hidden",children:[b.map(e=>t.jsx(fs,{asset:e,settings:o,exchangeRates:c,onEdit:a,onTransaction:r,onDelete:(e,t)=>h({id:e,symbol:t}),recentReturn:g(e.id),t:d},e.id)),0===b.length&&t.jsx("div",{className:"text-center py-8 text-slate-400 italic",children:d("noAssets")})]})]}),t.jsx(ys,{assetIds:b.map(e=>e.id),title:d("relatedTransactions")}),t.jsx(ss,{isOpen:!!p,onClose:()=>h(null),onConfirm:()=>p&&l(p.id),title:d("delete"),message:p?d("confirmDelete").replace("{symbol}",p.symbol):"",confirmText:d("delete"),isDanger:!0})]})},js=e=>{const t=e=>e.toString().padStart(2,"0");return`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())}T${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}`},Ns=({isOpen:s,onClose:a,initialAsset:r})=>{var n;const{addAsset:i,editAsset:l,addTransaction:c,t:d}=Ct(),[u,m]=e.useState(1),[x,p]=e.useState(Ye.STOCK),[h,g]=e.useState(""),[b,f]=e.useState(""),[y,v]=e.useState(""),[j,N]=e.useState(""),[w,S]=e.useState(""),[T,D]=e.useState(He.USD),[C,I]=e.useState(""),[E,L]=e.useState(!1),[_,U]=e.useState(!1),[M,z]=e.useState(""),O=[{id:Ye.STOCK,label:d("type_stock"),icon:xe,desc:"US, HK, CN Stocks",color:"bg-blue-50 text-blue-600 border-blue-200"},{id:Ye.CRYPTO,label:d("type_crypto"),icon:pe,desc:"Coins & Tokens",color:"bg-purple-50 text-purple-600 border-purple-200"},{id:Ye.FUND,label:d("type_fund"),icon:A,desc:"Mutual Funds",color:"bg-orange-50 text-orange-600 border-orange-200"},{id:Ye.REAL_ESTATE,label:d("type_real_estate"),icon:he,desc:"Property",color:"bg-emerald-50 text-emerald-600 border-emerald-200"},{id:Ye.CASH,label:d("type_cash"),icon:ge,desc:"Fiat Reserves",color:"bg-green-50 text-green-600 border-green-200"},{id:Ye.LIABILITY,label:d("type_liability"),icon:F,desc:"Loans & Debt",color:"bg-red-50 text-red-600 border-red-200"},{id:Ye.OTHER,label:d("type_other"),icon:be,desc:"Art, Watches...",color:"bg-slate-50 text-slate-600 border-slate-200"}];e.useEffect(()=>{s&&(r?(p(r.type),g(r.symbol),f(r.name),v(r.quantity.toString()),N(r.avgCost.toString()),S(r.currentPrice.toString()),D(r.currency),I(r.dateAcquired||js(new Date)),L(!!r.isManualPrice||lt.includes(r.symbol)),m(2),U(!1)):(m(1),p(Ye.STOCK),g(""),f(""),v(""),N(""),S(""),D(He.USD),I(js(new Date)),L(!1),U(!1)))},[s,r]);if(!s)return null;const K=e=>e===Ye.REAL_ESTATE||e===Ye.LIABILITY||e===Ye.OTHER,q=K(x)||E,$=e=>{if(e.preventDefault(),_&&r){const e=parseFloat(M);if(isNaN(e))return;const t=e-r.quantity;if(0===t)return void U(!1);c({assetId:r.id,type:Ve.BALANCE_ADJUSTMENT,date:C,quantityChange:t,pricePerUnit:r.avgCost,fee:0,total:t*r.avgCost,note:"Manual Balance Correction"})}const t=parseFloat(y);let s=parseFloat(j),n=parseFloat(w);if(q?(isNaN(s)&&!isNaN(n)&&(s=n),isNaN(n)&&!isNaN(s)&&(n=s)):isNaN(n)&&(n=s||0),!h)return;const o={id:r?r.id:crypto.randomUUID(),symbol:h.toUpperCase(),name:b||h.toUpperCase(),type:x,currentPrice:n||0,currency:T,lastUpdated:Date.now(),dateAcquired:C,isManualPrice:E};if(r)q||(o.currentPrice=r.currentPrice),l(o);else{if(isNaN(t))return;i(o,t,s||0,C)}a()};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm transition-opacity",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-xl overflow-hidden flex flex-col max-h-[90vh]",children:[t.jsxs("div",{className:"px-6 py-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center shrink-0",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:d(r?"editHolding":1===u?"selectAssetType":"assetDetails")}),t.jsx("p",{className:"text-xs text-slate-500",children:r?"Edit metadata or adjust balance":1===u?d("whatKind"):`${d("enterDetails")} ${null==(n=O.find(e=>e.id===x))?void 0:n.label}`})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[!r&&t.jsx(Vt,{mode:"ASSET",onResult:e=>{if(e.symbol&&g(e.symbol),e.name&&f(e.name),e.type&&(p(e.type),m(2)),e.quantity&&v(e.quantity.toString()),e.price){const t=e.price.toString();N(t),S(t)}e.date&&I(e.date),e.currency&&D(e.currency)}}),t.jsx("button",{onClick:a,className:"text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-200 rounded-full transition-colors",children:t.jsx(o,{size:20})})]})]}),t.jsxs("div",{className:"overflow-y-auto p-6",children:[1===u&&!r&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:O.map(e=>t.jsxs("button",{onClick:()=>{p(e.id),m(2)},className:"flex flex-col items-center justify-center p-4 rounded-xl border transition-all hover:scale-[1.02] "+(e.id===x?"ring-2 ring-blue-500 bg-blue-50/50 border-blue-200":"bg-white border-slate-100 hover:border-slate-300 hover:shadow-md"),children:[t.jsx("div",{className:`p-3 rounded-full mb-3 ${e.color}`,children:t.jsx(e.icon,{size:24})}),t.jsx("span",{className:"font-semibold text-slate-700 text-sm",children:e.label}),t.jsx("span",{className:"text-[10px] text-slate-400 mt-1",children:e.desc})]},e.id))})}),(2===u||r)&&t.jsxs("form",{id:"asset-form",onSubmit:$,className:"space-y-5",children:[t.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100 space-y-4",children:[t.jsx("div",{className:"flex justify-between items-center mb-2",children:t.jsx("h3",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:d("identification")})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:d("tickerLabel")}),t.jsx("input",{type:"text",value:h,onChange:e=>g(e.target.value.toUpperCase()),className:"w-full p-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none font-medium",autoFocus:!r,required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:d("nameLabel")}),t.jsx("input",{type:"text",value:b,onChange:e=>f(e.target.value),className:"w-full p-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]})]}),t.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100 space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:d("valuationHoldings")}),!K(x)&&t.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-500 cursor-pointer select-none hover:text-blue-600 transition-colors",children:[t.jsx("input",{type:"checkbox",checked:E,onChange:e=>L(e.target.checked),className:"rounded border-slate-300 text-blue-600 focus:ring-blue-500 w-3.5 h-3.5"}),d("manualPrice")]})]}),_&&t.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-100 mb-2 animate-fade-in",children:[t.jsx("label",{className:"block text-xs font-bold text-blue-700 uppercase mb-1",children:d("newCorrectQuantity")}),t.jsx("input",{type:"number",step:"any",placeholder:d("enterActualQuantity"),value:M,onChange:e=>z(e.target.value),className:"w-full p-2 bg-white border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 outline-none font-bold text-blue-900",autoFocus:!0}),t.jsx("p",{className:"text-[10px] text-blue-600 mt-1",children:d("adjustmentHint")})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:d(_?"dateRefreshed":"dateAcquired")}),t.jsxs("div",{className:"relative",children:[t.jsx(P,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"datetime-local",step:"1",value:C,onChange:e=>I(e.target.value),className:"w-full pl-9 p-2.5 bg-white border border-slate-200 rounded-lg outline-none"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex items-center justify-between text-xs font-medium text-slate-500 uppercase mb-1",children:[x===Ye.CASH?d("balance"):x===Ye.LIABILITY?d("principalRemaining"):d("quantity"),r&&!_&&t.jsxs("button",{type:"button",onClick:()=>U(!0),className:"text-[10px] normal-case text-blue-600 hover:bg-blue-50 px-1.5 py-0.5 rounded flex items-center gap-1 transition-colors",children:[t.jsx(k,{size:10})," ",d("adjustButton")]})]}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:y,onChange:e=>v(e.target.value),disabled:!!r,className:"w-full p-2.5 bg-white border border-slate-200 rounded-lg outline-none disabled:bg-slate-100 disabled:text-slate-500",required:!r})]}),q?t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:d("unitPrice")}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("select",{value:T,onChange:e=>D(e.target.value),className:"w-24 p-2.5 bg-white border border-slate-200 rounded-lg outline-none text-sm",children:Object.values(He).map(e=>t.jsx("option",{value:e,children:e},e))}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:w,onChange:e=>S(e.target.value),className:"flex-1 p-2.5 bg-white border border-slate-200 rounded-lg outline-none"})]})]}):t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:x===Ye.CASH?d("costBasis"):d("avgCostUnit")}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("select",{value:T,onChange:e=>D(e.target.value),className:"w-24 p-2.5 bg-white border border-slate-200 rounded-lg outline-none text-sm",children:Object.values(He).map(e=>t.jsx("option",{value:e,children:e},e))}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:j,onChange:e=>N(e.target.value),disabled:!!r,className:"flex-1 p-2.5 bg-white border border-slate-200 rounded-lg outline-none disabled:bg-slate-100 disabled:text-slate-500"})]})]})]})]})]})]}),(2===u||r)&&t.jsx("div",{className:"p-6 pt-0 bg-white shrink-0",children:t.jsxs("button",{onClick:$,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2",children:[t.jsx(R,{size:18}),d(_?"confirmAdjustment":r?"saveChanges":"addToPortfolio")]})})]})})},ws=({isOpen:s,onClose:a,preselectedAssetId:r})=>{const{assets:n,addTransaction:i,t:l}=Ct(),[c,d]=e.useState(""),[u,m]=e.useState(Ve.BUY),[x,p]=e.useState(""),[h,g]=e.useState(""),[b,f]=e.useState(""),[y,v]=e.useState("0");if(e.useEffect(()=>{if(s){d(r||"");const e=n.find(e=>e.id===r);(null==e?void 0:e.type)===Ye.LIABILITY?m(Ve.BORROW):(null==e?void 0:e.type)===Ye.CASH?m(Ve.DEPOSIT):m(Ve.BUY),p((e=>{const t=e=>e.toString().padStart(2,"0");return`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())}T${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}`})(new Date)),g(""),f(""),v("0")}},[s,r,n]),!s)return null;const j=n.sort((e,t)=>e.symbol.localeCompare(t.symbol)),N=n.find(e=>e.id===c),w=(e=>{const t=[Ve.BUY,Ve.SELL];if(!e)return t;switch(e){case Ye.STOCK:case Ye.FUND:return[...t,Ve.DIVIDEND];case Ye.LIABILITY:return[Ve.BORROW,Ve.REPAY];case Ye.CASH:return[Ve.DEPOSIT,Ve.WITHDRAWAL];default:return[...t,Ve.DIVIDEND]}})(null==N?void 0:N.type);return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm transition-opacity",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-slide-up",children:[t.jsxs("div",{className:"px-6 py-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-2 bg-blue-100 text-blue-600 rounded-lg",children:t.jsx(q,{size:18})}),t.jsx("h2",{className:"text-lg font-bold text-slate-800",children:l("recordTransaction")})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[!r&&t.jsx(Vt,{mode:"TRANSACTION",onResult:e=>{if(e.symbol){const t=j.find(t=>t.symbol===e.symbol);t&&d(t.id)}e.txType&&m(e.txType),e.quantity&&g(e.quantity.toString()),e.price&&f(e.price.toString()),e.date&&p(e.date)}}),t.jsx("button",{onClick:a,className:"text-slate-400 hover:text-slate-600",children:t.jsx(o,{size:20})})]})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=parseFloat(h),s=parseFloat(b),r=parseFloat(y)||0;if(!c||isNaN(t)||isNaN(s))return;let n=t;u!==Ve.SELL&&u!==Ve.WITHDRAWAL&&u!==Ve.REPAY||(n=-t),i({assetId:c,type:u,date:x,quantityChange:n,pricePerUnit:s,fee:r,total:t*s+r}),a()},className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:l("asset")}),t.jsxs("select",{value:c,onChange:e=>d(e.target.value),className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-500",required:!0,disabled:!!r,children:[t.jsx("option",{value:"",disabled:!0,children:l("selectAssetPlaceholder")}),j.map(e=>t.jsxs("option",{value:e.id,children:[e.symbol," - ",e.name]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:l("action")}),t.jsx("div",{className:"flex flex-wrap gap-1 p-1 bg-slate-100 rounded-lg",children:w.map(e=>t.jsx("button",{type:"button",onClick:()=>m(e),className:"flex-1 min-w-[60px] py-2 text-[10px] sm:text-xs font-bold rounded-md transition-all "+(u===e?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"),children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:l("date")}),t.jsxs("div",{className:"relative",children:[t.jsx(P,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"datetime-local",step:"1",value:x,onChange:e=>p(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:l("quantity")}),t.jsxs("div",{className:"relative",children:[t.jsx(L,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:h,onChange:e=>g(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:l("pricePerUnit")}),t.jsxs("div",{className:"relative",children:[t.jsx(_,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:b,onChange:e=>f(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-slate-500 uppercase mb-1",children:l("fees")}),t.jsxs("div",{className:"relative",children:[t.jsx(_,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),t.jsx("input",{type:"number",step:"any",placeholder:"0.00",value:y,onChange:e=>v(e.target.value),className:"w-full pl-9 p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),t.jsxs("div",{className:"p-3 bg-slate-100 rounded-lg flex justify-between items-center text-sm",children:[t.jsx("span",{className:"text-slate-500 font-medium",children:l("totalEstimate")}),t.jsxs("span",{className:"font-bold text-slate-800",children:["$",((parseFloat(h)||0)*(parseFloat(b)||0)+(parseFloat(y)||0)).toLocaleString(void 0,{minimumFractionDigits:2})]})]}),t.jsxs("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2",children:[t.jsx(R,{size:18}),l("recordTransaction")]})]})]})})};const Ss=e=>`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`,As=({assets:s,transactions:a,baseCurrency:r,exchangeRates:n,isPrivacyMode:i,t:l,initialRange:o="1M"})=>{const{settings:c}=Ct(),[d,u]=e.useState(o),[m,x]=e.useState({}),[p,h]=e.useState(!1),[g,b]=e.useState(!1);e.useEffect(()=>{let e=!0;return(async()=>{if(0===s.length)return;h(!0);const t={},r={provider:c.marketDataProvider||"finnhub",alphaVantageKey:c.alphaVantageApiKey,finnhubKey:c.finnhubApiKey},n=s.map(async e=>{if(e.type===Ye.REAL_ESTATE||e.type===Ye.LIABILITY||e.type===Ye.OTHER||e.type===Ye.CASH)return{id:e.id,data:[]};if(!m[e.id]||0===m[e.id].length)try{const t=function(e,t,s){const a=s.filter(t=>t.assetId===e);if(a.length>0){const e=a.reduce((e,t)=>t.date<e.date?t:e),t=new Date(e.date);return t.setDate(t.getDate()-7),t}if(t){const e=new Date(t);return e.setDate(e.getDate()-7),e}const r=new Date;return r.setFullYear(r.getFullYear()-5),r}(e.id,e.dateAcquired,a);return{id:e.id,data:await bt(e,r,t)}}catch(t){return"finnhub"===r.provider&&(null==t?void 0:t.category)===We.ACCESS_DENIED&&b(!0),{id:e.id,data:[]}}return{id:e.id,data:m[e.id]}}),i=await Promise.all(n);e&&(i.forEach(e=>t[e.id]=e.data),x(t),h(!1))})(),()=>{e=!1}},[s.length,c.marketDataProvider,c.alphaVantageApiKey,c.finnhubApiKey]);const f=e=>i?"••••••":new Intl.NumberFormat("en-US",{style:"currency",currency:r,notation:"compact",maximumFractionDigits:1}).format(e),y=e.useMemo(()=>{const e={};return Object.keys(m).forEach(t=>{const s=m[t],a=new Map;[...s].sort((e,t)=>e.date.localeCompare(t.date)).forEach(e=>{a.set(e.date,e.price)}),e[t]=a}),e},[m]),v=e.useMemo(()=>{if(0===s.length)return[];const e=a||[],t=new Set(e.map(e=>e.assetId)),i=[];s.forEach(e=>{if(!t.has(e.id)){const t=e.dateAcquired||Ss(new Date);i.push({id:`synthetic-${e.id}`,assetId:e.id,type:e.type===Ye.LIABILITY?Ve.BORROW:Ve.BUY,date:t,quantityChange:e.quantity,pricePerUnit:e.avgCost,fee:0,total:e.quantity*e.avgCost})}});const l=[...e,...i].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),o=new Date,c=new Date,u=l.length>0?Math.min(...l.map(e=>new Date(e.date).getTime())):o.getTime(),x=new Date(u);switch(d){case"1W":c.setDate(o.getDate()-7);break;case"1M":c.setDate(o.getDate()-30);break;case"3M":c.setDate(o.getDate()-90);break;case"6M":c.setDate(o.getDate()-180);break;case"1Y":c.setFullYear(o.getFullYear()-1);break;case"ALL":c.setTime(u),c.setDate(c.getDate()-2)}const p=new Date(Math.min(c.getTime(),x.getTime()));p.setHours(0,0,0,0);const h=((e,t)=>{const s=[],a=new Date(e);let r=0;for(;a<=t&&r<5e3;)s.push(Ss(a)),a.setDate(a.getDate()+1),r++;return s})(p,o),g={},b={};s.forEach(e=>{g[e.id]=0,b[e.id]=0});const f={};s.forEach(e=>{const t=m[e.id];t&&t.length>0?f[e.id]=t[0].price:f[e.id]=e.currentPrice});const v=[],j=Ss(c);for(const a of h){s.forEach(e=>{const t=y[e.id];t&&t.has(a)&&(f[e.id]=t.get(a))});const e=l.filter(e=>e.date.startsWith(a));for(const s of e){void 0===g[s.assetId]&&(g[s.assetId]=0),void 0===b[s.assetId]&&(b[s.assetId]=0);const e=s.quantityChange||0,t=Math.abs(e),a=s.total||0;if(s.type===Ve.BUY||s.type===Ve.DEPOSIT||s.type===Ve.BORROW||s.type===Ve.BALANCE_ADJUSTMENT)if(e>=0)g[s.assetId]+=e,b[s.assetId]+=a;else{const e=g[s.assetId];if(e>0){const a=t/e;b[s.assetId]-=b[s.assetId]*a}g[s.assetId]-=t}else if(s.type===Ve.SELL||s.type===Ve.WITHDRAWAL||s.type===Ve.REPAY){const e=g[s.assetId];if(e>0){const a=t/e;b[s.assetId]-=b[s.assetId]*a}g[s.assetId]-=t,g[s.assetId]<0&&(g[s.assetId]=0)}}let t=0,i=0;s.forEach(e=>{const s=g[e.id]||0,a=f[e.id];if(s>0){const l=ft(s*a,e.currency,r,n),o=ft(b[e.id],e.currency,r,n);e.type===Ye.LIABILITY?t-=l:(t+=l,i+=o)}}),a>=j&&v.push({date:a,displayDate:new Date(a).toLocaleDateString(void 0,{month:"short",day:"numeric"}),value:t,cost:i,pnl:t-i,pnlPercent:0!==i?(t-i)/i*100:0})}return v},[s,a,d,r,n,m,y]),j=v.length>0&&v[v.length-1].pnl>=0?"#10b981":"#ef4444",N=({active:e,payload:s})=>{if(e&&s&&s.length){const e=s[0].payload;return t.jsxs("div",{className:"bg-white/95 backdrop-blur-sm p-3 sm:p-4 rounded-xl shadow-xl border border-slate-100 text-xs sm:text-sm animate-in fade-in zoom-in-95 duration-150 max-w-[180px] sm:max-w-none",children:[t.jsx("p",{className:"text-slate-500 font-medium mb-1.5 sm:mb-2 border-b border-slate-50 pb-1",children:e.displayDate}),t.jsxs("div",{className:"flex items-center justify-between gap-3 sm:gap-6 mb-1",children:[t.jsxs("span",{className:"text-slate-500 flex items-center gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full",style:{background:j}}),l("value")]}),t.jsx("span",{className:"font-bold text-slate-700",children:f(e.value)})]}),t.jsxs("div",{className:"flex items-center justify-between gap-3 sm:gap-6 mb-1.5",children:[t.jsxs("span",{className:"text-slate-400 flex items-center gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-slate-300"}),l("label_cost")]}),t.jsx("span",{className:"font-medium text-slate-400",children:f(e.cost)})]}),t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 pt-1.5 border-t border-slate-50 font-medium "+(e.pnl>=0?"text-green-600":"text-red-600"),children:[t.jsx("span",{children:e.pnl>=0?l("label_net_pnl"):"Loss"}),t.jsxs("div",{className:"flex items-center gap-1",children:[e.pnl>=0?t.jsx(xe,{size:12}):t.jsx(ye,{size:12}),t.jsxs("span",{children:[f(Math.abs(e.pnl))," ",t.jsxs("span",{className:"text-[10px] opacity-80",children:["(",Math.abs(e.pnlPercent).toFixed(1),"%)"]})]})]})]})]})}return null},w=s.some(e=>e.type===Ye.STOCK||e.type===Ye.FUND),S=c.marketDataProvider||"finnhub",A=w&&("alphavantage"===S&&!c.alphaVantageApiKey||"finnhub"===S&&!c.finnhubApiKey);return t.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden h-full flex flex-col",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-slate-50 flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-slate-800 text-lg flex items-center gap-2",children:l("netWorthTrend")}),t.jsxs("p",{className:"text-xs text-slate-400 flex items-center gap-1 mt-0.5",children:[t.jsx(fe,{size:12})," ",l("costVsValue"),p&&t.jsxs("span",{className:"flex items-center gap-1 text-blue-500 ml-2",children:[t.jsx(K,{size:10,className:"animate-spin"})," Syncing..."]})]})]}),t.jsx("div",{className:"flex bg-slate-50 p-1 rounded-lg self-start sm:self-auto overflow-x-auto max-w-full",children:["1W","1M","3M","6M","1Y","ALL"].map(e=>t.jsx("button",{onClick:()=>u(e),className:"px-3 py-1 text-xs font-medium rounded-md transition-all whitespace-nowrap "+(d===e?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700 hover:bg-slate-200/50"),children:e},e))})]}),A&&!p&&w&&t.jsxs("div",{className:"bg-amber-50 px-4 py-2 text-[10px] text-amber-700 flex items-center justify-center gap-2 border-b border-amber-100",children:[t.jsx(E,{size:12}),t.jsx("span",{children:l("marketDataKeyMissing")})]}),!A&&g&&!p&&w&&t.jsxs("div",{className:"bg-amber-50 px-4 py-2 text-[10px] text-amber-700 flex items-center justify-center gap-2 border-b border-amber-100",children:[t.jsx(E,{size:12}),t.jsx("span",{children:l("finnhubFreePlanLimitation")})]}),t.jsx("div",{className:"p-4 flex-1 min-h-[320px]",children:i?t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-300 bg-slate-50/30 rounded-xl border border-dashed border-slate-200",children:[t.jsx("div",{className:"p-4 bg-white rounded-full shadow-sm mb-3",children:t.jsx(fe,{size:24,className:"text-slate-300"})}),t.jsx("p",{children:l("chartHidden")})]}):v.length>1?t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(Fe,{data:v,margin:{top:10,right:10,left:0,bottom:0},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"colorNetWorth",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:j,stopOpacity:.15}),t.jsx("stop",{offset:"95%",stopColor:j,stopOpacity:0})]})}),t.jsx(ke,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),t.jsx(Pe,{dataKey:"displayDate",tickLine:!1,axisLine:!1,tick:{fill:"#94a3b8",fontSize:11},minTickGap:30}),t.jsx(Le,{hide:!0,domain:["auto","auto"]}),t.jsx(_e,{content:t.jsx(N,{}),cursor:{stroke:"#cbd5e1",strokeWidth:1,strokeDasharray:"4 4"}}),t.jsx($e,{type:"stepAfter",dataKey:"cost",stroke:"#94a3b8",strokeWidth:2,strokeDasharray:"4 4",dot:!1,activeDot:!1,name:"Invested"}),t.jsx(Be,{type:"monotone",dataKey:"value",stroke:j,strokeWidth:2,fillOpacity:1,fill:"url(#colorNetWorth)",activeDot:{r:4,strokeWidth:0,fill:j},name:"Net Worth"})]})}):t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400",children:[p?t.jsx(K,{size:32,className:"mb-2 animate-spin text-blue-400"}):t.jsx(P,{size:32,className:"mb-2 opacity-50"}),t.jsx("span",{className:"text-sm",children:p?"Syncing market data...":l("noTransactions")})]})})]})},Ts=({isOpen:e,onClose:s,assets:a,transactions:r,baseCurrency:n,exchangeRates:i,isPrivacyMode:l,t:c})=>e?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm transition-opacity",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl overflow-hidden flex flex-col h-[600px] max-h-[90vh]",children:[t.jsxs("div",{className:"px-6 py-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center shrink-0",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:c("netWorthTrend")}),t.jsx("p",{className:"text-xs text-slate-500",children:c("trendModalSubtitle")||"Trend analysis based on current filtered assets"})]}),t.jsx("button",{onClick:s,className:"text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-200 rounded-full transition-colors",children:t.jsx(o,{size:20})})]}),t.jsx("div",{className:"flex-1 p-4 bg-slate-50/50 overflow-hidden",children:t.jsx(As,{assets:a,transactions:r,baseCurrency:n,exchangeRates:i,isPrivacyMode:l,t:c,initialRange:"1W"})})]})}):null,Ds=()=>{const{t:s,refreshPrices:a,isRefreshing:r,assets:n,transactions:i,settings:l,exchangeRates:o}=Ct(),[c,d]=e.useState(!1),[u,m]=e.useState(!1),[x,p]=e.useState(!1),[h,g]=e.useState(""),[b,f]=e.useState(null),[y,v]=e.useState(void 0),j=n.filter(e=>e.symbol.toLowerCase().includes(h.toLowerCase())||e.name.toLowerCase().includes(h.toLowerCase()));return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:s("assetsManagement")}),t.jsx("p",{className:"text-slate-500",children:s("assetsSubtitle")})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"relative hidden md:block mr-2",children:[t.jsx(M,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400",size:18}),t.jsx("input",{type:"text",placeholder:s("searchAssets"),value:h,onChange:e=>g(e.target.value),className:"pl-9 pr-4 py-2.5 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all w-64 shadow-sm"})]}),t.jsx("button",{onClick:()=>a(),disabled:r,className:"p-2.5 bg-white hover:bg-slate-50 text-slate-600 border border-slate-200 rounded-xl shadow-sm transition-all",title:s("refreshPrices"),children:t.jsx(K,{size:20,className:r?"animate-spin text-blue-600":"text-slate-400"})}),t.jsx("button",{onClick:()=>p(!0),className:"p-2.5 bg-white hover:bg-slate-50 text-slate-600 border border-slate-200 rounded-xl shadow-sm transition-all",title:s("showTrend"),children:t.jsx(xe,{size:20,className:"text-slate-400"})}),t.jsxs("button",{onClick:()=>{f(null),d(!0)},className:"px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl shadow-lg shadow-blue-200 transition-all flex items-center gap-2",children:[t.jsx(ve,{size:20})," ",t.jsx("span",{className:"hidden sm:inline",children:s("addNewAsset")}),t.jsx("span",{className:"sm:hidden",children:s("addNewAsset").split(" ")[0]})]})]})]}),t.jsxs("div",{className:"relative md:hidden",children:[t.jsx(M,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400",size:18}),t.jsx("input",{type:"text",placeholder:s("searchAssets"),value:h,onChange:e=>g(e.target.value),className:"w-full pl-9 pr-4 py-2.5 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all shadow-sm"})]}),t.jsx(vs,{assets:j,onEdit:e=>{f(e),d(!0)},onTransaction:e=>{v(e.id),m(!0)}}),t.jsx(Ns,{isOpen:c,onClose:()=>{d(!1),f(null)},initialAsset:b}),t.jsx(ws,{isOpen:u,onClose:()=>{m(!1),v(void 0)},preselectedAssetId:y}),t.jsx(Ts,{isOpen:x,onClose:()=>p(!1),assets:j,transactions:i,baseCurrency:l.baseCurrency,exchangeRates:o,isPrivacyMode:l.isPrivacyMode,t:s})]})},Cs=(t,s)=>{const[a,r]=e.useState(null),[n,i]=e.useState(!1),[l,o]=e.useState(null),[c,d]=e.useState(!1);e.useEffect(()=>{(()=>{if(0===t.length)return void d(!1);const e=Ht(t),n=et.getCache(Ft);if(n){const{timestamp:t,data:{hash:i,data:l}}=n,o=Date.now()-t>$t,c=i!==`${e}:${s.language}:${s.aiProvider}`;!a&&l&&r(l),d(o||c)}else d(!0)})()},[t,a,s.language,s.aiProvider]);return{analysis:a,loading:n,error:l,canAnalyze:c,analyze:async()=>{const e="deepseek"===s.aiProvider?s.deepSeekApiKey:s.geminiApiKey;if(!e)throw new Error("API Key is missing");if(0!==t.length){i(!0),o(null);try{const a=await(async(e,t,s,a="en",r=!1)=>{if(!t)throw new Error("API Key is missing");if(0===e.length)return"";const n=`${Ht(e)}:${a}:${s}`,i=Date.now();if(!r){const e=et.getCache(Ft);if(e){const{timestamp:t,data:{hash:s,data:a}}=e;if(s===n&&i-t<$t)return a}}if(Yt&&Yt.hash===n&&!r)return Yt.promise;const l=(async()=>{const r=e.map(e=>({symbol:e.symbol,type:e.type,qty:e.quantity,val:(e.quantity*e.currentPrice).toFixed(0),curr:e.currency})),i="zh"===a?"Chinese (Simplified)":"English",l=`\n    You are the Chief Investment Officer (CIO) for 'PanassetLite' (盘资产·轻), a private wealth management platform.\n\n    **User Portfolio Snapshot (For Analysis Only):**\n    ${JSON.stringify(r)}\n\n    **Financial Context:**\n    - **Net Worth** = Total Assets - Total Liabilities.\n    - **Liquid Assets**: Stocks, Crypto, Cash, Funds.\n    - **Illiquid Assets**: Real Estate (Low volatility, hard to sell).\n    - **Liabilities**: Loans, Mortgages (Negative impact on Net Worth).\n\n    **STRICT PRIVACY & OUTPUT RULES:**\n    1. **NO ABSOLUTE NUMBERS:** You are generating a report for a privacy-focused dashboard. **DO NOT** output any specific monetary values (e.g., do NOT write "$10,000", "72,361 RMB", or "1.5 BTC") in the final report.\n    2. **USE RATIOS & PERCENTAGES:** Instead of numbers, use percentages (%), ratios, and qualitative terms (e.g., "healthy buffer", "significant portion", "minor allocation").\n    3. **LANGUAGE:** The output must be in **${i}**.\n\n    **Task:**\n    Generate a strategic wealth analysis report. Use Markdown.\n\n    **Structure:**\n    1.  **Wealth Health Check**:\n        - Analyze the **Net Worth** structure (Asset vs Liability mix) using percentages only.\n        - Assess **Debt-to-Asset Ratio**. (Liabilities > 30% is caution).\n        - Assess **Liquidity**. Are they over-leveraged or too illiquid?\n\n    2.  **Risk & Allocation**:\n        - Evaluate exposure to High Volatility (Crypto) vs Stable Assets (Real Estate/Cash) based on portfolio weight.\n        - Comment on concentration risk (e.g., "Allocated heavily in a single asset").\n\n    3.  **Strategic Recommendations**:\n        - Provide 3 specific, actionable steps to optimize the portfolio based on the asset mix.\n\n    **Tone:** Professional, insightful, objective, and encouraging.\n    **Length:** Concise (~300 words).\n    `,o=Kt.create(s,t),c=await o.generateText(l)||("zh"===a?"暂时无法生成分析报告。":"Unable to generate analysis report.");return et.saveCache(Ft,{hash:n,data:c}),c})();Yt={hash:n,promise:l};try{return await l}finally{Yt=null}})(t,e,s.aiProvider,s.language);r(a),d(!1)}catch(a){o(a.message||"AI Service Unavailable")}finally{i(!1)}}},setError:o}},Is=()=>{const{assets:s,settings:a,t:r}=Ct(),[n,i]=e.useState(!1),{analysis:l,loading:o,error:d,canAnalyze:u,analyze:m,setError:x}=Cs(s,a);return 0===s.length?null:t.jsxs(ts,{className:"border-purple-100 bg-gradient-to-br from-white to-purple-50/50 transition-all duration-300",children:[t.jsxs("div",{className:"flex items-center justify-between cursor-pointer select-none",onClick:()=>i(!n),children:[t.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[t.jsx("div",{className:"p-2 bg-purple-600 rounded-lg shadow-md shadow-purple-200 shrink-0",children:t.jsx(c,{className:"text-white",size:18})}),t.jsxs("div",{className:"min-w-0 flex flex-col justify-center",children:[t.jsx("h3",{className:"font-bold text-slate-800 text-sm sm:text-base truncate leading-tight",children:r("aiInsights")}),t.jsx("p",{className:"text-xs text-slate-500 hidden sm:block truncate mt-0.5",children:r("wealthManagement")})]})]}),t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 shrink-0 ml-2",children:[u?t.jsx("button",{onClick:async e=>{e&&e.stopPropagation();if(!("deepseek"===a.aiProvider?a.deepSeekApiKey:a.geminiApiKey))return x(r("apiKeyMissing")),void i(!0);i(!0),await m()},disabled:o,className:"text-xs sm:text-sm px-3 py-1.5 sm:px-4 sm:py-2 bg-white border border-slate-200 hover:border-purple-300 text-purple-600 hover:text-purple-700 hover:bg-purple-50 rounded-lg transition-all flex items-center gap-1.5 sm:gap-2 shadow-sm z-10 font-medium",children:o?t.jsx(K,{className:"animate-spin",size:14}):t.jsxs(t.Fragment,{children:[t.jsx(c,{size:14})," ",t.jsx("span",{children:r("analyzeNow")})]})}):t.jsxs("div",{className:"text-[10px] sm:text-xs px-2 py-1 sm:px-3 sm:py-1.5 bg-green-50 text-green-600 rounded-lg border border-green-100 flex items-center gap-1 whitespace-nowrap",children:[t.jsx(G,{size:12})," ",t.jsx("span",{className:"hidden sm:inline",children:r("upToDate")})]}),t.jsx("div",{className:"text-slate-400 hover:text-purple-600 transition-colors p-1",children:n?t.jsx(O,{size:18}):t.jsx(U,{size:18})})]})]}),n&&t.jsxs("div",{className:"mt-3 pt-3 sm:mt-4 sm:pt-4 border-t border-purple-100/50 animate-fade-in",children:[o&&!l&&t.jsxs("div",{className:"space-y-3 animate-pulse",children:[t.jsx("div",{className:"h-4 bg-purple-100 rounded w-3/4"}),t.jsx("div",{className:"h-4 bg-purple-100 rounded w-1/2"}),t.jsx("div",{className:"h-4 bg-purple-100 rounded w-5/6"})]}),d&&t.jsxs("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded-lg border border-red-100 flex justify-between items-center",children:[t.jsx("span",{children:d}),t.jsxs(je,{to:"/settings",className:"flex items-center gap-1 text-blue-600 hover:underline font-medium",children:[t.jsx(ee,{size:14})," ",r("setKey")]})]}),l&&t.jsx("div",{className:"prose prose-sm prose-purple max-w-none text-slate-600",children:t.jsx("div",{className:"whitespace-pre-wrap leading-relaxed text-xs sm:text-sm",children:l})})]})]})},Es=["#0ea5e9","#6366f1","#8b5cf6","#ec4899","#10b981","#f59e0b","#f97316"],ks=()=>{var s;const{assets:a,transactions:r,settings:n,exchangeRates:i,t:l}=Ct(),o=e.useMemo(()=>{let e=0,t=0,s=0,r=0;a.forEach(a=>{const l=a.quantity*a.currentPrice,o=a.quantity*a.avgCost,c=ft(l,a.currency,n.baseCurrency,i),d=ft(o,a.currency,n.baseCurrency,i);var u;a.type===Ye.LIABILITY?(t+=c,s-=d):(e+=c,s+=d,(u=a.type)!==Ye.REAL_ESTATE&&u!==Ye.LIABILITY&&u!==Ye.OTHER&&(r+=c*(.03*Math.random()-.01)))});const l=e-t,o=l-s,c=0!==s?o/Math.abs(s)*100:0;return{totalNetWorth:l,totalAssetsValue:e,totalLiabilitiesValue:t,totalCost:s,totalPnL:o,totalPnLPercent:c,dayPnL:r}},[a,n.baseCurrency,i]),c=e.useMemo(()=>a.filter(e=>e.type!==Ye.LIABILITY).map(e=>{const t=e.quantity*e.currentPrice,s=ft(t,e.currency,n.baseCurrency,i);return{name:e.symbol,value:s}}).filter(e=>e.value>0).sort((e,t)=>t.value-e.value),[a,n.baseCurrency,i]),d=e=>n.isPrivacyMode?"••••••":new Intl.NumberFormat("en-US",{style:"currency",currency:n.baseCurrency,maximumFractionDigits:0}).format(e),u=e=>n.isPrivacyMode?"•••%":`${e.toFixed(2)}%`,m=n.baseCurrency===He.CNY?Ne:_;return t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-700 rounded-2xl p-6 text-white shadow-lg relative overflow-hidden group",children:[n.isPrivacyMode&&t.jsx(H,{className:"absolute top-6 right-6 text-blue-400 opacity-50",size:24}),t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("span",{className:"text-blue-100 font-medium",children:l("netWorth")}),t.jsx(je,{to:"/settings",className:"p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors cursor-pointer flex items-center justify-center",title:l("changeCurrency"),children:t.jsx(m,{size:20})})]}),t.jsx(je,{to:"/assets",className:"block cursor-pointer hover:opacity-90 transition-opacity",children:t.jsx("div",{className:"text-3xl font-bold mb-1",children:d(o.totalNetWorth)})}),t.jsxs("div",{className:"text-sm text-blue-100 flex items-center gap-2",children:[t.jsxs("span",{className:o.totalPnL>=0?"text-green-300":"text-red-300",children:[n.isPrivacyMode?"":o.totalPnL>=0?"+":"",u(o.totalPnLPercent)]}),l("allTime")]})]}),t.jsxs(ts,{className:"flex flex-col justify-center",children:[t.jsxs("span",{className:"text-slate-500 font-medium mb-2 flex items-center gap-2",children:[t.jsx(w,{size:16,className:"text-blue-500"})," ",l("totalAssets")]}),t.jsx(je,{to:"/assets",className:"block cursor-pointer hover:opacity-75 transition-opacity",children:t.jsx("div",{className:"text-2xl font-bold text-slate-800 mb-1",children:d(o.totalAssetsValue)})}),t.jsx("div",{className:"text-xs text-slate-400",children:l("grossValue")})]}),t.jsxs(ts,{className:"flex flex-col justify-center "+(o.totalLiabilitiesValue>0?"border-red-100 bg-red-50/30":""),children:[t.jsxs("span",{className:"text-slate-500 font-medium mb-2 flex items-center gap-2",children:[t.jsx(F,{size:16,className:"text-red-500"})," ",l("totalLiabilities")]}),t.jsx("div",{className:"text-2xl font-bold mb-1 "+(o.totalLiabilitiesValue>0?"text-red-600":"text-slate-800"),children:n.isPrivacyMode?"••••••":(o.totalLiabilitiesValue>0?"-":"")+new Intl.NumberFormat("en-US",{style:"currency",currency:n.baseCurrency,maximumFractionDigits:0}).format(o.totalLiabilitiesValue)}),t.jsx("div",{className:"text-xs text-slate-400",children:l("outstandingDebt")})]}),t.jsxs(ts,{className:"flex flex-col justify-center",children:[t.jsxs("span",{className:"text-slate-500 font-medium mb-2 flex items-center gap-2",children:[l("dayPnL")," ",t.jsx(te,{size:16})]}),t.jsx("div",{className:"text-2xl font-bold text-slate-800 mb-1",children:d(o.dayPnL)}),t.jsxs("div",{className:"text-sm font-medium flex items-center gap-1 "+(o.dayPnL>=0?"text-green-600":"text-red-500"),children:[n.isPrivacyMode?null:o.dayPnL>=0?t.jsx(xe,{size:14}):t.jsx(ye,{size:14}),u(0!==o.dayPnL?100*Math.abs(o.dayPnL/(o.totalNetWorth||1)):0)]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2 min-w-0 h-[400px]",children:t.jsx(As,{assets:a,transactions:r,baseCurrency:n.baseCurrency,exchangeRates:i,isPrivacyMode:n.isPrivacyMode,t:l})}),t.jsxs(ts,{title:`${l("assetAllocation")} (${n.baseCurrency})`,className:"min-w-0",children:[t.jsx("div",{className:"h-[300px] w-full relative min-w-0",children:n.isPrivacyMode?t.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-slate-300",children:[t.jsx(H,{size:48,className:"mb-2"}),t.jsx("p",{children:l("hidden")})]}):t.jsxs(t.Fragment,{children:[t.jsx(Ie,{width:"100%",height:"100%",children:t.jsxs(ze,{children:[t.jsx(Oe,{data:c,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:c.map((e,s)=>t.jsx(Ue,{fill:Es[s%Es.length],stroke:"none"},`cell-${s}`))}),t.jsx(_e,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:e=>d(e)})]})}),t.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center pointer-events-none",children:[t.jsx("div",{className:"text-xs text-slate-400",children:l("topAsset")}),t.jsx("div",{className:"font-bold text-slate-700",children:(null==(s=c[0])?void 0:s.name)||"-"})]})]})}),!n.isPrivacyMode&&t.jsx("div",{className:"flex flex-wrap gap-2 justify-center pb-2 mt-2",children:c.slice(0,4).map((e,s)=>t.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:Es[s%Es.length]}}),e.name," ",(e.value/(c.reduce((e,t)=>e+t.value,0)||1)*100).toFixed(0),"%"]},e.name))})]})]})]})},Ps=()=>{const{t:e}=Ct();return t.jsxs("div",{className:"space-y-6 md:space-y-8",children:[t.jsx("div",{className:"flex flex-col xl:flex-row xl:items-center justify-between gap-4",children:t.jsx("div",{children:t.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-800",children:e("overview")})})}),t.jsx(Is,{}),t.jsx(ks,{})]})},Ls=()=>{const[s,a]=e.useState([]);e.useEffect(()=>wt.subscribe(e=>{a(t=>[...t,e]),e.duration&&setTimeout(()=>{r(e.id)},e.duration)}),[]);const r=e=>{a(t=>t.filter(t=>t.id!==e))},n=e=>{switch(e){case"error":return t.jsx(h,{size:20});case"warning":return t.jsx(E,{size:20});case"success":return t.jsx(G,{size:20});case"info":return t.jsx(we,{size:20})}},i=e=>{switch(e){case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"success":return"bg-green-50 border-green-200 text-green-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800"}};return 0===s.length?null:t.jsxs("div",{className:"toast-container",children:[s.map(e=>t.jsxs("div",{className:`toast-item ${i(e.type)}`,children:[t.jsx("div",{className:"toast-icon",children:n(e.type)}),t.jsx("div",{className:"toast-message",children:e.message}),t.jsx("button",{onClick:()=>r(e.id),className:"toast-close","aria-label":"Close notification",children:t.jsx(o,{size:18})})]},e.id)),t.jsx("style",{children:"\n        .toast-container {\n          position: fixed;\n          top: 20px;\n          right: 20px;\n          z-index: 9999;\n          display: flex;\n          flex-direction: column;\n          gap: 12px;\n          max-width: 420px;\n          pointer-events: none;\n        }\n\n        .toast-item {\n          pointer-events: auto;\n          display: flex;\n          align-items: flex-start;\n          gap: 12px;\n          padding: 14px 16px;\n          border-radius: 8px;\n          border: 1px solid;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n          animation: slideIn 0.3s ease-out;\n          min-width: 300px;\n        }\n\n        @keyframes slideIn {\n          from {\n            transform: translateX(100%);\n            opacity: 0;\n          }\n          to {\n            transform: translateX(0);\n            opacity: 1;\n          }\n        }\n\n        .toast-icon {\n          flex-shrink: 0;\n          display: flex;\n          align-items: center;\n          margin-top: 1px;\n        }\n\n        .toast-message {\n          flex: 1;\n          font-size: 14px;\n          line-height: 1.5;\n          word-break: break-word;\n        }\n\n        .toast-close {\n          flex-shrink: 0;\n          background: transparent;\n          border: none;\n          cursor: pointer;\n          padding: 2px;\n          border-radius: 4px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          opacity: 0.6;\n          transition: opacity 0.2s;\n        }\n\n        .toast-close:hover {\n          opacity: 1;\n        }\n\n        @media (max-width: 640px) {\n          .toast-container {\n            top: 10px;\n            right: 10px;\n            left: 10px;\n            max-width: none;\n          }\n\n          .toast-item {\n            min-width: 0;\n          }\n        }\n      "})]})},_s=()=>t.jsxs(t.Fragment,{children:[t.jsx(Dt,{children:t.jsx(Se,{children:t.jsx(es,{children:t.jsxs(Ae,{children:[t.jsx(Te,{path:"/",element:t.jsx(Ps,{})}),t.jsx(Te,{path:"/assets",element:t.jsx(Ds,{})}),t.jsx(Te,{path:"/history",element:t.jsx(ns,{})}),t.jsx(Te,{path:"/analytics",element:t.jsx(gs,{})}),t.jsx(Te,{path:"/settings",element:t.jsx(bs,{})})]})})})}),t.jsx(Ls,{})]}),Rs=document.getElementById("root");if(!Rs)throw new Error("Could not find root element to mount to");De.createRoot(Rs).render(t.jsx(g.StrictMode,{children:t.jsx(_s,{})}));
